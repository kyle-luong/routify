/*! For license information please see main.b0797f25.js.LICENSE.txt */
(()=>{var t={4:(t,e,i)=>{"use strict";var n=i(853),o=i(43),r=i(950);function s(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function l(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(i=e.return),t=e.return}while(t)}return 3===e.tag?i:null}function u(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function c(t){if(l(t)!==t)throw Error(s(188))}function h(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t;for(t=t.child;null!==t;){if(null!==(e=h(t)))return e;t=t.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),b=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope");var M=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var I=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var E=Symbol.iterator;function P(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=E&&t[E]||t["@@iterator"])?t:null}var k=Symbol.for("react.client.reference");function B(t){if(null==t)return null;if("function"===typeof t)return t.$$typeof===k?null:t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case g:return"Fragment";case _:return"Profiler";case y:return"StrictMode";case w:return"Suspense";case S:return"SuspenseList";case M:return"Activity"}if("object"===typeof t)switch(t.$$typeof){case m:return"Portal";case b:return(t.displayName||"Context")+".Provider";case x:return(t._context.displayName||"Context")+".Consumer";case C:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case T:return null!==(e=t.displayName||null)?e:B(t.type)||"Memo";case A:e=t._payload,t=t._init;try{return B(t(e))}catch(i){}}return null}var D=Array.isArray,R=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},O=[],U=-1;function F(t){return{current:t}}function N(t){0>U||(t.current=O[U],O[U]=null,U--)}function V(t,e){U++,O[U]=t.current,t.current=e}var H=F(null),j=F(null),G=F(null),W=F(null);function q(t,e){switch(V(G,e),V(j,t),V(H,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?oh(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)t=rh(e=oh(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}N(H),V(H,t)}function Z(){N(H),N(j),N(G)}function $(t){null!==t.memoizedState&&V(W,t);var e=H.current,i=rh(e,t.type);e!==i&&(V(j,t),V(H,i))}function K(t){j.current===t&&(N(H),N(j)),W.current===t&&(N(W),$h._currentValue=z)}var Y=Object.prototype.hasOwnProperty,J=n.unstable_scheduleCallback,X=n.unstable_cancelCallback,Q=n.unstable_shouldYield,tt=n.unstable_requestPaint,et=n.unstable_now,it=n.unstable_getCurrentPriorityLevel,nt=n.unstable_ImmediatePriority,ot=n.unstable_UserBlockingPriority,rt=n.unstable_NormalPriority,st=n.unstable_LowPriority,at=n.unstable_IdlePriority,lt=n.log,ut=n.unstable_setDisableYieldValue,ct=null,ht=null;function dt(t){if("function"===typeof lt&&ut(t),ht&&"function"===typeof ht.setStrictMode)try{ht.setStrictMode(ct,t)}catch(e){}}var ft=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(pt(t)/mt|0)|0},pt=Math.log,mt=Math.LN2;var gt=256,yt=4194304;function _t(t){var e=42&t;if(0!==e)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&t;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&t;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function vt(t,e,i){var n=t.pendingLanes;if(0===n)return 0;var o=0,r=t.suspendedLanes,s=t.pingedLanes;t=t.warmLanes;var a=134217727&n;return 0!==a?0!==(n=a&~r)?o=_t(n):0!==(s&=a)?o=_t(s):i||0!==(i=a&~t)&&(o=_t(i)):0!==(a=n&~r)?o=_t(a):0!==s?o=_t(s):i||0!==(i=n&~t)&&(o=_t(i)),0===o?0:0!==e&&e!==o&&0===(e&r)&&((r=o&-o)>=(i=e&-e)||32===r&&0!==(4194048&i))?e:o}function xt(t,e){return 0===(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)}function bt(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function Ct(){var t=gt;return 0===(4194048&(gt<<=1))&&(gt=256),t}function wt(){var t=yt;return 0===(62914560&(yt<<=1))&&(yt=4194304),t}function St(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function Tt(t,e){t.pendingLanes|=e,268435456!==e&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function At(t,e,i){t.pendingLanes|=e,t.suspendedLanes&=~e;var n=31-ft(e);t.entangledLanes|=e,t.entanglements[n]=1073741824|t.entanglements[n]|4194090&i}function Mt(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-ft(i),o=1<<n;o&e|t[n]&e&&(t[n]|=e),i&=~o}}function It(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Et(t){return 2<(t&=-t)?8<t?0!==(134217727&t)?32:268435456:8:2}function Pt(){var t=L.p;return 0!==t?t:void 0===(t=window.event)?32:ud(t.type)}var kt=Math.random().toString(36).slice(2),Bt="__reactFiber$"+kt,Dt="__reactProps$"+kt,Rt="__reactContainer$"+kt,Lt="__reactEvents$"+kt,zt="__reactListeners$"+kt,Ot="__reactHandles$"+kt,Ut="__reactResources$"+kt,Ft="__reactMarker$"+kt;function Nt(t){delete t[Bt],delete t[Dt],delete t[Lt],delete t[zt],delete t[Ot]}function Vt(t){var e=t[Bt];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Rt]||i[Bt]){if(i=e.alternate,null!==e.child||null!==i&&null!==i.child)for(t=vh(t);null!==t;){if(i=t[Bt])return i;t=vh(t)}return e}i=(t=i).parentNode}return null}function Ht(t){if(t=t[Bt]||t[Rt]){var e=t.tag;if(5===e||6===e||13===e||26===e||27===e||3===e)return t}return null}function jt(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t.stateNode;throw Error(s(33))}function Gt(t){var e=t[Ut];return e||(e=t[Ut]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Wt(t){t[Ft]=!0}var qt=new Set,Zt={};function $t(t,e){Kt(t,e),Kt(t+"Capture",e)}function Kt(t,e){for(Zt[t]=e,t=0;t<e.length;t++)qt.add(e[t])}var Yt,Jt,Xt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qt={},te={};function ee(t,e,i){if(o=e,Y.call(te,o)||!Y.call(Qt,o)&&(Xt.test(o)?te[o]=!0:(Qt[o]=!0,0)))if(null===i)t.removeAttribute(e);else{switch(typeof i){case"undefined":case"function":case"symbol":return void t.removeAttribute(e);case"boolean":var n=e.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void t.removeAttribute(e)}t.setAttribute(e,""+i)}var o}function ie(t,e,i){if(null===i)t.removeAttribute(e);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(e)}t.setAttribute(e,""+i)}}function ne(t,e,i,n){if(null===n)t.removeAttribute(i);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(i)}t.setAttributeNS(e,i,""+n)}}function oe(t){if(void 0===Yt)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);Yt=e&&e[1]||"",Jt=-1<i.stack.indexOf("\n    at")?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Yt+t+Jt}var re=!1;function se(t,e){if(!t||re)return"";re=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(e){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(i,[])}catch(o){var n=o}Reflect.construct(t,[],i)}else{try{i.call()}catch(r){n=r}t.call(i.prototype)}}else{try{throw Error()}catch(s){n=s}(i=t())&&"function"===typeof i.catch&&i.catch((function(){}))}}catch(a){if(a&&n&&"string"===typeof a.stack)return[a.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),s=r[0],a=r[1];if(s&&a){var l=s.split("\n"),u=a.split("\n");for(o=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;o<u.length&&!u[o].includes("DetermineComponentFrameRoot");)o++;if(n===l.length||o===u.length)for(n=l.length-1,o=u.length-1;1<=n&&0<=o&&l[n]!==u[o];)o--;for(;1<=n&&0<=o;n--,o--)if(l[n]!==u[o]){if(1!==n||1!==o)do{if(n--,0>--o||l[n]!==u[o]){var c="\n"+l[n].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}}while(1<=n&&0<=o);break}}}finally{re=!1,Error.prepareStackTrace=i}return(i=t?t.displayName||t.name:"")?oe(i):""}function ae(t){switch(t.tag){case 26:case 27:case 5:return oe(t.type);case 16:return oe("Lazy");case 13:return oe("Suspense");case 19:return oe("SuspenseList");case 0:case 15:return se(t.type,!1);case 11:return se(t.type.render,!1);case 1:return se(t.type,!0);case 31:return oe("Activity");default:return""}}function le(t){try{var e="";do{e+=ae(t),t=t.return}while(t);return e}catch(i){return"\nError generating stack: "+i.message+"\n"+i.stack}}function ue(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function ce(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function he(t){t._valueTracker||(t._valueTracker=function(t){var e=ce(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var o=i.get,r=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(t){n=""+t,r.call(this,t)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(t){n=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function de(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=ce(t)?t.checked?"true":"false":t.value),(t=n)!==i&&(e.setValue(t),!0)}function fe(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}var pe=/[\n"\\]/g;function me(t){return t.replace(pe,(function(t){return"\\"+t.charCodeAt(0).toString(16)+" "}))}function ge(t,e,i,n,o,r,s,a){t.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?t.type=s:t.removeAttribute("type"),null!=e?"number"===s?(0===e&&""===t.value||t.value!=e)&&(t.value=""+ue(e)):t.value!==""+ue(e)&&(t.value=""+ue(e)):"submit"!==s&&"reset"!==s||t.removeAttribute("value"),null!=e?_e(t,s,ue(e)):null!=i?_e(t,s,ue(i)):null!=n&&t.removeAttribute("value"),null==o&&null!=r&&(t.defaultChecked=!!r),null!=o&&(t.checked=o&&"function"!==typeof o&&"symbol"!==typeof o),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?t.name=""+ue(a):t.removeAttribute("name")}function ye(t,e,i,n,o,r,s,a){if(null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&"boolean"!==typeof r&&(t.type=r),null!=e||null!=i){if(!("submit"!==r&&"reset"!==r||void 0!==e&&null!==e))return;i=null!=i?""+ue(i):"",e=null!=e?""+ue(e):i,a||e===t.value||(t.value=e),t.defaultValue=e}n="function"!==typeof(n=null!=n?n:o)&&"symbol"!==typeof n&&!!n,t.checked=a?t.checked:!!n,t.defaultChecked=!!n,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(t.name=s)}function _e(t,e,i){"number"===e&&fe(t.ownerDocument)===t||t.defaultValue===""+i||(t.defaultValue=""+i)}function ve(t,e,i,n){if(t=t.options,e){e={};for(var o=0;o<i.length;o++)e["$"+i[o]]=!0;for(i=0;i<t.length;i++)o=e.hasOwnProperty("$"+t[i].value),t[i].selected!==o&&(t[i].selected=o),o&&n&&(t[i].defaultSelected=!0)}else{for(i=""+ue(i),e=null,o=0;o<t.length;o++){if(t[o].value===i)return t[o].selected=!0,void(n&&(t[o].defaultSelected=!0));null!==e||t[o].disabled||(e=t[o])}null!==e&&(e.selected=!0)}}function xe(t,e,i){null==e||((e=""+ue(e))!==t.value&&(t.value=e),null!=i)?t.defaultValue=null!=i?""+ue(i):"":t.defaultValue!==e&&(t.defaultValue=e)}function be(t,e,i,n){if(null==e){if(null!=n){if(null!=i)throw Error(s(92));if(D(n)){if(1<n.length)throw Error(s(93));n=n[0]}i=n}null==i&&(i=""),e=i}i=ue(e),t.defaultValue=i,(n=t.textContent)===i&&""!==n&&null!==n&&(t.value=n)}function Ce(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&3===i.nodeType)return void(i.nodeValue=e)}t.textContent=e}var we=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Se(t,e,i){var n=0===e.indexOf("--");null==i||"boolean"===typeof i||""===i?n?t.setProperty(e,""):"float"===e?t.cssFloat="":t[e]="":n?t.setProperty(e,i):"number"!==typeof i||0===i||we.has(e)?"float"===e?t.cssFloat=i:t[e]=(""+i).trim():t[e]=i+"px"}function Te(t,e,i){if(null!=e&&"object"!==typeof e)throw Error(s(62));if(t=t.style,null!=i){for(var n in i)!i.hasOwnProperty(n)||null!=e&&e.hasOwnProperty(n)||(0===n.indexOf("--")?t.setProperty(n,""):"float"===n?t.cssFloat="":t[n]="");for(var o in e)n=e[o],e.hasOwnProperty(o)&&i[o]!==n&&Se(t,o,n)}else for(var r in e)e.hasOwnProperty(r)&&Se(t,r,e[r])}function Ae(t){if(-1===t.indexOf("-"))return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Me=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ie=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ee(t){return Ie.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Pe=null;function ke(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Be=null,De=null;function Re(t){var e=Ht(t);if(e&&(t=e.stateNode)){var i=t[Dt]||null;t:switch(t=e.stateNode,e.type){case"input":if(ge(t,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),e=i.name,"radio"===i.type&&null!=e){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+me(""+e)+'"][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var o=n[Dt]||null;if(!o)throw Error(s(90));ge(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(e=0;e<i.length;e++)(n=i[e]).form===t.form&&de(n)}break t;case"textarea":xe(t,i.value,i.defaultValue);break t;case"select":null!=(e=i.value)&&ve(t,!!i.multiple,e,!1)}}}var Le=!1;function ze(t,e,i){if(Le)return t(e,i);Le=!0;try{return t(e)}finally{if(Le=!1,(null!==Be||null!==De)&&(Vu(),Be&&(e=Be,t=De,De=Be=null,Re(e),t)))for(e=0;e<t.length;e++)Re(t[e])}}function Oe(t,e){var i=t.stateNode;if(null===i)return null;var n=i[Dt]||null;if(null===n)return null;i=n[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!n;break t;default:t=!1}if(t)return null;if(i&&"function"!==typeof i)throw Error(s(231,e,typeof i));return i}var Ue=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Fe=!1;if(Ue)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(Dd){Fe=!1}var Ve=null,He=null,je=null;function Ge(){if(je)return je;var t,e,i=He,n=i.length,o="value"in Ve?Ve.value:Ve.textContent,r=o.length;for(t=0;t<n&&i[t]===o[t];t++);var s=n-t;for(e=1;e<=s&&i[n-e]===o[r-e];e++);return je=o.slice(t,1<e?1-e:void 0)}function We(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function qe(){return!0}function Ze(){return!1}function $e(t){function e(e,i,n,o,r){for(var s in this._reactName=e,this._targetInst=n,this.type=i,this.nativeEvent=o,this.target=r,this.currentTarget=null,t)t.hasOwnProperty(s)&&(e=t[s],this[s]=e?e(o):o[s]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?qe:Ze,this.isPropagationStopped=Ze,this}return d(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=qe)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=qe)},persist:function(){},isPersistent:qe}),e}var Ke,Ye,Je,Xe={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qe=$e(Xe),ti=d({},Xe,{view:0,detail:0}),ei=$e(ti),ii=d({},ti,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fi,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Je&&(Je&&"mousemove"===t.type?(Ke=t.screenX-Je.screenX,Ye=t.screenY-Je.screenY):Ye=Ke=0,Je=t),Ke)},movementY:function(t){return"movementY"in t?t.movementY:Ye}}),ni=$e(ii),oi=$e(d({},ii,{dataTransfer:0})),ri=$e(d({},ti,{relatedTarget:0})),si=$e(d({},Xe,{animationName:0,elapsedTime:0,pseudoElement:0})),ai=$e(d({},Xe,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}})),li=$e(d({},Xe,{data:0})),ui={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ci={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function di(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=hi[t])&&!!e[t]}function fi(){return di}var pi=$e(d({},ti,{key:function(t){if(t.key){var e=ui[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=We(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?ci[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fi,charCode:function(t){return"keypress"===t.type?We(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?We(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}})),mi=$e(d({},ii,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),gi=$e(d({},ti,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fi})),yi=$e(d({},Xe,{propertyName:0,elapsedTime:0,pseudoElement:0})),_i=$e(d({},ii,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0})),vi=$e(d({},Xe,{newState:0,oldState:0})),xi=[9,13,27,32],bi=Ue&&"CompositionEvent"in window,Ci=null;Ue&&"documentMode"in document&&(Ci=document.documentMode);var wi=Ue&&"TextEvent"in window&&!Ci,Si=Ue&&(!bi||Ci&&8<Ci&&11>=Ci),Ti=String.fromCharCode(32),Ai=!1;function Mi(t,e){switch(t){case"keyup":return-1!==xi.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ii(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Ei=!1;var Pi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ki(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Pi[t.type]:"textarea"===e}function Bi(t,e,i,n){Be?De?De.push(n):De=[n]:Be=n,0<(e=Gc(e,"onChange")).length&&(i=new Qe("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var Di=null,Ri=null;function Li(t){zc(t,0)}function zi(t){if(de(jt(t)))return t}function Oi(t,e){if("change"===t)return e}var Ui=!1;if(Ue){var Fi;if(Ue){var Ni="oninput"in document;if(!Ni){var Vi=document.createElement("div");Vi.setAttribute("oninput","return;"),Ni="function"===typeof Vi.oninput}Fi=Ni}else Fi=!1;Ui=Fi&&(!document.documentMode||9<document.documentMode)}function Hi(){Di&&(Di.detachEvent("onpropertychange",ji),Ri=Di=null)}function ji(t){if("value"===t.propertyName&&zi(Ri)){var e=[];Bi(e,Ri,t,ke(t)),ze(Li,e)}}function Gi(t,e,i){"focusin"===t?(Hi(),Ri=i,(Di=e).attachEvent("onpropertychange",ji)):"focusout"===t&&Hi()}function Wi(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return zi(Ri)}function qi(t,e){if("click"===t)return zi(e)}function Zi(t,e){if("input"===t||"change"===t)return zi(e)}var $i="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function Ki(t,e){if($i(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var o=i[n];if(!Y.call(e,o)||!$i(t[o],e[o]))return!1}return!0}function Yi(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ji(t,e){var i,n=Yi(t);for(t=0;n;){if(3===n.nodeType){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}t:{for(;n;){if(n.nextSibling){n=n.nextSibling;break t}n=n.parentNode}n=void 0}n=Yi(n)}}function Xi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?Xi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function Qi(t){for(var e=fe((t=null!=t&&null!=t.ownerDocument&&null!=t.ownerDocument.defaultView?t.ownerDocument.defaultView:window).document);e instanceof t.HTMLIFrameElement;){try{var i="string"===typeof e.contentWindow.location.href}catch(n){i=!1}if(!i)break;e=fe((t=e.contentWindow).document)}return e}function tn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var en=Ue&&"documentMode"in document&&11>=document.documentMode,nn=null,on=null,rn=null,sn=!1;function an(t,e,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;sn||null==nn||nn!==fe(n)||("selectionStart"in(n=nn)&&tn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},rn&&Ki(rn,n)||(rn=n,0<(n=Gc(on,"onSelect")).length&&(e=new Qe("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=nn)))}function ln(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var un={animationend:ln("Animation","AnimationEnd"),animationiteration:ln("Animation","AnimationIteration"),animationstart:ln("Animation","AnimationStart"),transitionrun:ln("Transition","TransitionRun"),transitionstart:ln("Transition","TransitionStart"),transitioncancel:ln("Transition","TransitionCancel"),transitionend:ln("Transition","TransitionEnd")},cn={},hn={};function dn(t){if(cn[t])return cn[t];if(!un[t])return t;var e,i=un[t];for(e in i)if(i.hasOwnProperty(e)&&e in hn)return cn[t]=i[e];return t}Ue&&(hn=document.createElement("div").style,"AnimationEvent"in window||(delete un.animationend.animation,delete un.animationiteration.animation,delete un.animationstart.animation),"TransitionEvent"in window||delete un.transitionend.transition);var fn=dn("animationend"),pn=dn("animationiteration"),mn=dn("animationstart"),gn=dn("transitionrun"),yn=dn("transitionstart"),_n=dn("transitioncancel"),vn=dn("transitionend"),xn=new Map,bn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cn(t,e){xn.set(t,e),$t(e,[t])}bn.push("scrollEnd");var wn=new WeakMap;function Sn(t,e){if("object"===typeof t&&null!==t){var i=wn.get(t);return void 0!==i?i:(e={value:t,source:e,stack:le(e)},wn.set(t,e),e)}return{value:t,source:e,stack:le(e)}}var Tn=[],An=0,Mn=0;function In(){for(var t=An,e=Mn=An=0;e<t;){var i=Tn[e];Tn[e++]=null;var n=Tn[e];Tn[e++]=null;var o=Tn[e];Tn[e++]=null;var r=Tn[e];if(Tn[e++]=null,null!==n&&null!==o){var s=n.pending;null===s?o.next=o:(o.next=s.next,s.next=o),n.pending=o}0!==r&&Bn(i,o,r)}}function En(t,e,i,n){Tn[An++]=t,Tn[An++]=e,Tn[An++]=i,Tn[An++]=n,Mn|=n,t.lanes|=n,null!==(t=t.alternate)&&(t.lanes|=n)}function Pn(t,e,i,n){return En(t,e,i,n),Dn(t)}function kn(t,e){return En(t,null,null,e),Dn(t)}function Bn(t,e,i){t.lanes|=i;var n=t.alternate;null!==n&&(n.lanes|=i);for(var o=!1,r=t.return;null!==r;)r.childLanes|=i,null!==(n=r.alternate)&&(n.childLanes|=i),22===r.tag&&(null===(t=r.stateNode)||1&t._visibility||(o=!0)),t=r,r=r.return;return 3===t.tag?(r=t.stateNode,o&&null!==e&&(o=31-ft(i),null===(n=(t=r.hiddenUpdates)[o])?t[o]=[e]:n.push(e),e.lane=536870912|i),r):null}function Dn(t){if(50<Bu)throw Bu=0,Du=null,Error(s(185));for(var e=t.return;null!==e;)e=(t=e).return;return 3===t.tag?t.stateNode:null}var Rn={};function Ln(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(t,e,i,n){return new Ln(t,e,i,n)}function On(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Un(t,e){var i=t.alternate;return null===i?((i=zn(t.tag,e,t.key,t.mode)).elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=65011712&t.flags,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i.refCleanup=t.refCleanup,i}function Fn(t,e){t.flags&=65011714;var i=t.alternate;return null===i?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,t.type=i.type,e=i.dependencies,t.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Nn(t,e,i,n,o,r){var a=0;if(n=t,"function"===typeof t)On(t)&&(a=1);else if("string"===typeof t)a=function(t,e,i){if(1===i||null!=e.itemProp)return!1;switch(t){case"meta":case"title":return!0;case"style":if("string"!==typeof e.precedence||"string"!==typeof e.href||""===e.href)break;return!0;case"link":if("string"!==typeof e.rel||"string"!==typeof e.href||""===e.href||e.onLoad||e.onError)break;return"stylesheet"!==e.rel||(t=e.disabled,"string"===typeof e.precedence&&null==t);case"script":if(e.async&&"function"!==typeof e.async&&"symbol"!==typeof e.async&&!e.onLoad&&!e.onError&&e.src&&"string"===typeof e.src)return!0}return!1}(t,i,H.current)?26:"html"===t||"head"===t||"body"===t?27:5;else t:switch(t){case M:return(t=zn(31,i,e,o)).elementType=M,t.lanes=r,t;case g:return Vn(i.children,o,r,e);case y:a=8,o|=24;break;case _:return(t=zn(12,i,e,2|o)).elementType=_,t.lanes=r,t;case w:return(t=zn(13,i,e,o)).elementType=w,t.lanes=r,t;case S:return(t=zn(19,i,e,o)).elementType=S,t.lanes=r,t;default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case v:case b:a=10;break t;case x:a=9;break t;case C:a=11;break t;case T:a=14;break t;case A:a=16,n=null;break t}a=29,i=Error(s(130,null===t?"null":typeof t,"")),n=null}return(e=zn(a,i,e,o)).elementType=t,e.type=n,e.lanes=r,e}function Vn(t,e,i,n){return(t=zn(7,t,n,e)).lanes=i,t}function Hn(t,e,i){return(t=zn(6,t,null,e)).lanes=i,t}function jn(t,e,i){return(e=zn(4,null!==t.children?t.children:[],t.key,e)).lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var Gn=[],Wn=0,qn=null,Zn=0,$n=[],Kn=0,Yn=null,Jn=1,Xn="";function Qn(t,e){Gn[Wn++]=Zn,Gn[Wn++]=qn,qn=t,Zn=e}function to(t,e,i){$n[Kn++]=Jn,$n[Kn++]=Xn,$n[Kn++]=Yn,Yn=t;var n=Jn;t=Xn;var o=32-ft(n)-1;n&=~(1<<o),i+=1;var r=32-ft(e)+o;if(30<r){var s=o-o%5;r=(n&(1<<s)-1).toString(32),n>>=s,o-=s,Jn=1<<32-ft(e)+o|i<<o|n,Xn=r+t}else Jn=1<<r|i<<o|n,Xn=t}function eo(t){null!==t.return&&(Qn(t,1),to(t,1,0))}function io(t){for(;t===qn;)qn=Gn[--Wn],Gn[Wn]=null,Zn=Gn[--Wn],Gn[Wn]=null;for(;t===Yn;)Yn=$n[--Kn],$n[Kn]=null,Xn=$n[--Kn],$n[Kn]=null,Jn=$n[--Kn],$n[Kn]=null}var no=null,oo=null,ro=!1,so=null,ao=!1,lo=Error(s(519));function uo(t){throw go(Sn(Error(s(418,"")),t)),lo}function co(t){var e=t.stateNode,i=t.type,n=t.memoizedProps;switch(e[Bt]=t,e[Dt]=n,i){case"dialog":Oc("cancel",e),Oc("close",e);break;case"iframe":case"object":case"embed":Oc("load",e);break;case"video":case"audio":for(i=0;i<Rc.length;i++)Oc(Rc[i],e);break;case"source":Oc("error",e);break;case"img":case"image":case"link":Oc("error",e),Oc("load",e);break;case"details":Oc("toggle",e);break;case"input":Oc("invalid",e),ye(e,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),he(e);break;case"select":Oc("invalid",e);break;case"textarea":Oc("invalid",e),be(e,n.value,n.defaultValue,n.children),he(e)}"string"!==typeof(i=n.children)&&"number"!==typeof i&&"bigint"!==typeof i||e.textContent===""+i||!0===n.suppressHydrationWarning||Yc(e.textContent,i)?(null!=n.popover&&(Oc("beforetoggle",e),Oc("toggle",e)),null!=n.onScroll&&Oc("scroll",e),null!=n.onScrollEnd&&Oc("scrollend",e),null!=n.onClick&&(e.onclick=Jc),e=!0):e=!1,e||uo(t)}function ho(t){for(no=t.return;no;)switch(no.tag){case 5:case 13:return void(ao=!1);case 27:case 3:return void(ao=!0);default:no=no.return}}function fo(t){if(t!==no)return!1;if(!ro)return ho(t),ro=!0,!1;var e,i=t.tag;if((e=3!==i&&27!==i)&&((e=5===i)&&(e=!("form"!==(e=t.type)&&"button"!==e)||sh(t.type,t.memoizedProps)),e=!e),e&&oo&&uo(t),ho(t),13===i){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,i=0;t;){if(8===t.nodeType)if("/$"===(e=t.data)){if(0===i){oo=yh(t.nextSibling);break t}i--}else"$"!==e&&"$!"!==e&&"$?"!==e||i++;t=t.nextSibling}oo=null}}else 27===i?(i=oo,fh(t.type)?(t=_h,_h=null,oo=t):oo=i):oo=no?yh(t.stateNode.nextSibling):null;return!0}function po(){oo=no=null,ro=!1}function mo(){var t=so;return null!==t&&(null===vu?vu=t:vu.push.apply(vu,t),so=null),t}function go(t){null===so?so=[t]:so.push(t)}var yo=F(null),_o=null,vo=null;function xo(t,e,i){V(yo,e._currentValue),e._currentValue=i}function bo(t){t._currentValue=yo.current,N(yo)}function Co(t,e,i){for(;null!==t;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==n&&(n.childLanes|=e)):null!==n&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function wo(t,e,i,n){var o=t.child;for(null!==o&&(o.return=t);null!==o;){var r=o.dependencies;if(null!==r){var a=o.child;r=r.firstContext;t:for(;null!==r;){var l=r;r=o;for(var u=0;u<e.length;u++)if(l.context===e[u]){r.lanes|=i,null!==(l=r.alternate)&&(l.lanes|=i),Co(r.return,i,t),n||(a=null);break t}r=l.next}}else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=i,null!==(r=a.alternate)&&(r.lanes|=i),Co(a,i,t),a=null}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}}function So(t,e,i,n){t=null;for(var o=e,r=!1;null!==o;){if(!r)if(0!==(524288&o.flags))r=!0;else if(0!==(262144&o.flags))break;if(10===o.tag){var a=o.alternate;if(null===a)throw Error(s(387));if(null!==(a=a.memoizedProps)){var l=o.type;$i(o.pendingProps.value,a.value)||(null!==t?t.push(l):t=[l])}}else if(o===W.current){if(null===(a=o.alternate))throw Error(s(387));a.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==t?t.push($h):t=[$h])}o=o.return}null!==t&&wo(e,t,i,n),e.flags|=262144}function To(t){for(t=t.firstContext;null!==t;){if(!$i(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Ao(t){_o=t,vo=null,null!==(t=t.dependencies)&&(t.firstContext=null)}function Mo(t){return Eo(_o,t)}function Io(t,e){return null===_o&&Ao(t),Eo(t,e)}function Eo(t,e){var i=e._currentValue;if(e={context:e,memoizedValue:i,next:null},null===vo){if(null===t)throw Error(s(308));vo=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else vo=vo.next=e;return i}var Po="undefined"!==typeof AbortController?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(e,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach((function(t){return t()}))}},ko=n.unstable_scheduleCallback,Bo=n.unstable_NormalPriority,Do={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ro(){return{controller:new Po,data:new Map,refCount:0}}function Lo(t){t.refCount--,0===t.refCount&&ko(Bo,(function(){t.controller.abort()}))}var zo=null,Oo=0,Uo=0,Fo=null;function No(){if(0===--Oo&&null!==zo){null!==Fo&&(Fo.status="fulfilled");var t=zo;zo=null,Uo=0,Fo=null;for(var e=0;e<t.length;e++)(0,t[e])()}}var Vo=R.S;R.S=function(t,e){"object"===typeof e&&null!==e&&"function"===typeof e.then&&function(t,e){if(null===zo){var i=zo=[];Oo=0,Uo=Ec(),Fo={status:"pending",value:void 0,then:function(t){i.push(t)}}}Oo++,e.then(No,No)}(0,e),null!==Vo&&Vo(t,e)};var Ho=F(null);function jo(){var t=Ho.current;return null!==t?t:nu.pooledCache}function Go(t,e){V(Ho,null===e?Ho.current:e.pool)}function Wo(){var t=jo();return null===t?null:{parent:Do._currentValue,pool:t}}var qo=Error(s(460)),Zo=Error(s(474)),$o=Error(s(542)),Ko={then:function(){}};function Yo(t){return"fulfilled"===(t=t.status)||"rejected"===t}function Jo(){}function Xo(t,e,i){switch(void 0===(i=t[i])?t.push(e):i!==e&&(e.then(Jo,Jo),e=i),e.status){case"fulfilled":return e.value;case"rejected":throw er(t=e.reason),t;default:if("string"===typeof e.status)e.then(Jo,Jo);else{if(null!==(t=nu)&&100<t.shellSuspendCounter)throw Error(s(482));(t=e).status="pending",t.then((function(t){if("pending"===e.status){var i=e;i.status="fulfilled",i.value=t}}),(function(t){if("pending"===e.status){var i=e;i.status="rejected",i.reason=t}}))}switch(e.status){case"fulfilled":return e.value;case"rejected":throw er(t=e.reason),t}throw Qo=e,qo}}var Qo=null;function tr(){if(null===Qo)throw Error(s(459));var t=Qo;return Qo=null,t}function er(t){if(t===qo||t===$o)throw Error(s(483))}var ir=!1;function nr(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function or(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function rr(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function sr(t,e,i){var n=t.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&iu)){var o=n.pending;return null===o?e.next=e:(e.next=o.next,o.next=e),n.pending=e,e=Dn(t),Bn(t,null,i),e}return En(t,n,e,i),Dn(t)}function ar(t,e,i){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194048&i))){var n=e.lanes;i|=n&=t.pendingLanes,e.lanes=i,Mt(t,i)}}function lr(t,e){var i=t.updateQueue,n=t.alternate;if(null!==n&&i===(n=n.updateQueue)){var o=null,r=null;if(null!==(i=i.firstBaseUpdate)){do{var s={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};null===r?o=r=s:r=r.next=s,i=i.next}while(null!==i);null===r?o=r=e:r=r.next=e}else o=r=e;return i={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},void(t.updateQueue=i)}null===(t=i.lastBaseUpdate)?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}var ur=!1;function cr(){if(ur){if(null!==Fo)throw Fo}}function hr(t,e,i,n){ur=!1;var o=t.updateQueue;ir=!1;var r=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(null!==a){o.shared.pending=null;var l=a,u=l.next;l.next=null,null===s?r=u:s.next=u,s=l;var c=t.alternate;null!==c&&((a=(c=c.updateQueue).lastBaseUpdate)!==s&&(null===a?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(null!==r){var h=o.baseState;for(s=0,c=u=l=null,a=r;;){var f=-536870913&a.lane,p=f!==a.lane;if(p?(ru&f)===f:(n&f)===f){0!==f&&f===Uo&&(ur=!0),null!==c&&(c=c.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});t:{var m=t,g=a;f=e;var y=i;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(y,h,f);break t}h=m;break t;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(f="function"===typeof(m=g.payload)?m.call(y,h,f):m)||void 0===f)break t;h=d({},h,f);break t;case 2:ir=!0}}null!==(f=a.callback)&&(t.flags|=64,p&&(t.flags|=8192),null===(p=o.callbacks)?o.callbacks=[f]:p.push(f))}else p={lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===c?(u=c=p,l=h):c=c.next=p,s|=f;if(null===(a=a.next)){if(null===(a=o.shared.pending))break;a=(p=a).next,p.next=null,o.lastBaseUpdate=p,o.shared.pending=null}}null===c&&(l=h),o.baseState=l,o.firstBaseUpdate=u,o.lastBaseUpdate=c,null===r&&(o.shared.lanes=0),fu|=s,t.lanes=s,t.memoizedState=h}}function dr(t,e){if("function"!==typeof t)throw Error(s(191,t));t.call(e)}function fr(t,e){var i=t.callbacks;if(null!==i)for(t.callbacks=null,t=0;t<i.length;t++)dr(i[t],e)}var pr=F(null),mr=F(0);function gr(t,e){V(mr,t=hu),V(pr,e),hu=t|e.baseLanes}function yr(){V(mr,hu),V(pr,pr.current)}function _r(){hu=mr.current,N(pr),N(mr)}var vr=0,xr=null,br=null,Cr=null,wr=!1,Sr=!1,Tr=!1,Ar=0,Mr=0,Ir=null,Er=0;function Pr(){throw Error(s(321))}function kr(t,e){if(null===e)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!$i(t[i],e[i]))return!1;return!0}function Br(t,e,i,n,o,r){return vr=r,xr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,R.H=null===t||null===t.memoizedState?qs:Zs,Tr=!1,r=i(n,o),Tr=!1,Sr&&(r=Rr(e,i,n,o)),Dr(t),r}function Dr(t){R.H=Ws;var e=null!==br&&null!==br.next;if(vr=0,Cr=br=xr=null,wr=!1,Mr=0,Ir=null,e)throw Error(s(300));null===t||Ma||null!==(t=t.dependencies)&&To(t)&&(Ma=!0)}function Rr(t,e,i,n){xr=t;var o=0;do{if(Sr&&(Ir=null),Mr=0,Sr=!1,25<=o)throw Error(s(301));if(o+=1,Cr=br=null,null!=t.updateQueue){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,null!=r.memoCache&&(r.memoCache.index=0)}R.H=$s,r=e(i,n)}while(Sr);return r}function Lr(){var t=R.H,e=t.useState()[0];return e="function"===typeof e.then?Vr(e):e,t=t.useState()[0],(null!==br?br.memoizedState:null)!==t&&(xr.flags|=1024),e}function zr(){var t=0!==Ar;return Ar=0,t}function Or(t,e,i){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i}function Ur(t){if(wr){for(t=t.memoizedState;null!==t;){var e=t.queue;null!==e&&(e.pending=null),t=t.next}wr=!1}vr=0,Cr=br=xr=null,Sr=!1,Mr=Ar=0,Ir=null}function Fr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Cr?xr.memoizedState=Cr=t:Cr=Cr.next=t,Cr}function Nr(){if(null===br){var t=xr.alternate;t=null!==t?t.memoizedState:null}else t=br.next;var e=null===Cr?xr.memoizedState:Cr.next;if(null!==e)Cr=e,br=t;else{if(null===t){if(null===xr.alternate)throw Error(s(467));throw Error(s(310))}t={memoizedState:(br=t).memoizedState,baseState:br.baseState,baseQueue:br.baseQueue,queue:br.queue,next:null},null===Cr?xr.memoizedState=Cr=t:Cr=Cr.next=t}return Cr}function Vr(t){var e=Mr;return Mr+=1,null===Ir&&(Ir=[]),t=Xo(Ir,t,e),e=xr,null===(null===Cr?e.memoizedState:Cr.next)&&(e=e.alternate,R.H=null===e||null===e.memoizedState?qs:Zs),t}function Hr(t){if(null!==t&&"object"===typeof t){if("function"===typeof t.then)return Vr(t);if(t.$$typeof===b)return Mo(t)}throw Error(s(438,String(t)))}function jr(t){var e=null,i=xr.updateQueue;if(null!==i&&(e=i.memoCache),null==e){var n=xr.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(e={data:n.data.map((function(t){return t.slice()})),index:0})))}if(null==e&&(e={data:[],index:0}),null===i&&(i={lastEffect:null,events:null,stores:null,memoCache:null},xr.updateQueue=i),i.memoCache=e,void 0===(i=e.data[e.index]))for(i=e.data[e.index]=Array(t),n=0;n<t;n++)i[n]=I;return e.index++,i}function Gr(t,e){return"function"===typeof e?e(t):e}function Wr(t){return qr(Nr(),br,t)}function qr(t,e,i){var n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=i;var o=t.baseQueue,r=n.pending;if(null!==r){if(null!==o){var a=o.next;o.next=r.next,r.next=a}e.baseQueue=o=r,n.pending=null}if(r=t.baseState,null===o)t.memoizedState=r;else{var l=a=null,u=null,c=e=o.next,h=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(ru&d)===d:(vr&d)===d){var f=c.revertLane;if(0===f)null!==u&&(u=u.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Uo&&(h=!0);else{if((vr&f)===f){c=c.next,f===Uo&&(h=!0);continue}d={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(l=u=d,a=r):u=u.next=d,xr.lanes|=f,fu|=f}d=c.action,Tr&&i(r,d),r=c.hasEagerState?c.eagerState:i(r,d)}else f={lane:d,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(l=u=f,a=r):u=u.next=f,xr.lanes|=d,fu|=d;c=c.next}while(null!==c&&c!==e);if(null===u?a=r:u.next=l,!$i(r,t.memoizedState)&&(Ma=!0,h&&null!==(i=Fo)))throw i;t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}return null===o&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Zr(t){var e=Nr(),i=e.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=t;var n=i.dispatch,o=i.pending,r=e.memoizedState;if(null!==o){i.pending=null;var a=o=o.next;do{r=t(r,a.action),a=a.next}while(a!==o);$i(r,e.memoizedState)||(Ma=!0),e.memoizedState=r,null===e.baseQueue&&(e.baseState=r),i.lastRenderedState=r}return[r,n]}function $r(t,e,i){var n=xr,o=Nr(),r=ro;if(r){if(void 0===i)throw Error(s(407));i=i()}else i=e();var a=!$i((br||o).memoizedState,i);if(a&&(o.memoizedState=i,Ma=!0),o=o.queue,ys(2048,8,Jr.bind(null,n,o,t),[t]),o.getSnapshot!==e||a||null!==Cr&&1&Cr.memoizedState.tag){if(n.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Yr.bind(null,n,o,i,e),null),null===nu)throw Error(s(349));r||0!==(124&vr)||Kr(n,e,i)}return i}function Kr(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},null===(e=xr.updateQueue)?(e={lastEffect:null,events:null,stores:null,memoCache:null},xr.updateQueue=e,e.stores=[t]):null===(i=e.stores)?e.stores=[t]:i.push(t)}function Yr(t,e,i,n){e.value=i,e.getSnapshot=n,Xr(e)&&Qr(t)}function Jr(t,e,i){return i((function(){Xr(e)&&Qr(t)}))}function Xr(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!$i(t,i)}catch(n){return!0}}function Qr(t){var e=kn(t,2);null!==e&&zu(e,t,2)}function ts(t){var e=Fr();if("function"===typeof t){var i=t;if(t=i(),Tr){dt(!0);try{i()}finally{dt(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gr,lastRenderedState:t},e}function es(t,e,i,n){return t.baseState=i,qr(t,br,"function"===typeof n?n:Gr)}function is(t,e,i,n,o){if(Hs(t))throw Error(s(485));if(null!==(t=e.action)){var r={payload:o,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(t){r.listeners.push(t)}};null!==R.T?i(!0):r.isTransition=!1,n(r),null===(i=e.pending)?(r.next=e.pending=r,ns(e,r)):(r.next=i.next,e.pending=i.next=r)}}function ns(t,e){var i=e.action,n=e.payload,o=t.state;if(e.isTransition){var r=R.T,s={};R.T=s;try{var a=i(o,n),l=R.S;null!==l&&l(s,a),os(t,e,a)}catch(u){ss(t,e,u)}finally{R.T=r}}else try{os(t,e,r=i(o,n))}catch(c){ss(t,e,c)}}function os(t,e,i){null!==i&&"object"===typeof i&&"function"===typeof i.then?i.then((function(i){rs(t,e,i)}),(function(i){return ss(t,e,i)})):rs(t,e,i)}function rs(t,e,i){e.status="fulfilled",e.value=i,as(e),t.state=i,null!==(e=t.pending)&&((i=e.next)===e?t.pending=null:(i=i.next,e.next=i,ns(t,i)))}function ss(t,e,i){var n=t.pending;if(t.pending=null,null!==n){n=n.next;do{e.status="rejected",e.reason=i,as(e),e=e.next}while(e!==n)}t.action=null}function as(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function ls(t,e){return e}function us(t,e){if(ro){var i=nu.formState;if(null!==i){t:{var n=xr;if(ro){if(oo){e:{for(var o=oo,r=ao;8!==o.nodeType;){if(!r){o=null;break e}if(null===(o=yh(o.nextSibling))){o=null;break e}}o="F!"===(r=o.data)||"F"===r?o:null}if(o){oo=yh(o.nextSibling),n="F!"===o.data;break t}}uo(n)}n=!1}n&&(e=i[0])}}return(i=Fr()).memoizedState=i.baseState=e,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:e},i.queue=n,i=Fs.bind(null,xr,n),n.dispatch=i,n=ts(!1),r=Vs.bind(null,xr,!1,n.queue),o={state:e,dispatch:null,action:t,pending:null},(n=Fr()).queue=o,i=is.bind(null,xr,o,r,i),o.dispatch=i,n.memoizedState=t,[e,i,!1]}function cs(t){return hs(Nr(),br,t)}function hs(t,e,i){if(e=qr(t,e,ls)[0],t=Wr(Gr)[0],"object"===typeof e&&null!==e&&"function"===typeof e.then)try{var n=Vr(e)}catch(s){if(s===qo)throw $o;throw s}else n=e;var o=(e=Nr()).queue,r=o.dispatch;return i!==e.memoizedState&&(xr.flags|=2048,ps(9,{destroy:void 0,resource:void 0},ds.bind(null,o,i),null)),[n,r,t]}function ds(t,e){t.action=e}function fs(t){var e=Nr(),i=br;if(null!==i)return hs(e,i,t);Nr(),e=e.memoizedState;var n=(i=Nr()).queue.dispatch;return i.memoizedState=t,[e,n,!1]}function ps(t,e,i,n){return t={tag:t,create:i,deps:n,inst:e,next:null},null===(e=xr.updateQueue)&&(e={lastEffect:null,events:null,stores:null,memoCache:null},xr.updateQueue=e),null===(i=e.lastEffect)?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t),t}function ms(){return Nr().memoizedState}function gs(t,e,i,n){var o=Fr();n=void 0===n?null:n,xr.flags|=t,o.memoizedState=ps(1|e,{destroy:void 0,resource:void 0},i,n)}function ys(t,e,i,n){var o=Nr();n=void 0===n?null:n;var r=o.memoizedState.inst;null!==br&&null!==n&&kr(n,br.memoizedState.deps)?o.memoizedState=ps(e,r,i,n):(xr.flags|=t,o.memoizedState=ps(1|e,r,i,n))}function _s(t,e){gs(8390656,8,t,e)}function vs(t,e){ys(2048,8,t,e)}function xs(t,e){return ys(4,2,t,e)}function bs(t,e){return ys(4,4,t,e)}function Cs(t,e){if("function"===typeof e){t=t();var i=e(t);return function(){"function"===typeof i?i():e(null)}}if(null!==e&&void 0!==e)return t=t(),e.current=t,function(){e.current=null}}function ws(t,e,i){i=null!==i&&void 0!==i?i.concat([t]):null,ys(4,4,Cs.bind(null,e,t),i)}function Ss(){}function Ts(t,e){var i=Nr();e=void 0===e?null:e;var n=i.memoizedState;return null!==e&&kr(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function As(t,e){var i=Nr();e=void 0===e?null:e;var n=i.memoizedState;if(null!==e&&kr(e,n[1]))return n[0];if(n=t(),Tr){dt(!0);try{t()}finally{dt(!1)}}return i.memoizedState=[n,e],n}function Ms(t,e,i){return void 0===i||0!==(1073741824&vr)?t.memoizedState=e:(t.memoizedState=i,t=Lu(),xr.lanes|=t,fu|=t,i)}function Is(t,e,i,n){return $i(i,e)?i:null!==pr.current?(t=Ms(t,i,n),$i(t,e)||(Ma=!0),t):0===(42&vr)?(Ma=!0,t.memoizedState=i):(t=Lu(),xr.lanes|=t,fu|=t,e)}function Es(t,e,i,n,o){var r=L.p;L.p=0!==r&&8>r?r:8;var s=R.T,a={};R.T=a,Vs(t,!1,e,i);try{var l=o(),u=R.S;if(null!==u&&u(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)Ns(t,e,function(t,e){var i=[],n={status:"pending",value:null,reason:null,then:function(t){i.push(t)}};return t.then((function(){n.status="fulfilled",n.value=e;for(var t=0;t<i.length;t++)(0,i[t])(e)}),(function(t){for(n.status="rejected",n.reason=t,t=0;t<i.length;t++)(0,i[t])(void 0)})),n}(l,n),Ru());else Ns(t,e,n,Ru())}catch(c){Ns(t,e,{then:function(){},status:"rejected",reason:c},Ru())}finally{L.p=r,R.T=s}}function Ps(){}function ks(t,e,i,n){if(5!==t.tag)throw Error(s(476));var o=Bs(t).queue;Es(t,o,e,z,null===i?Ps:function(){return Ds(t),i(n)})}function Bs(t){var e=t.memoizedState;if(null!==e)return e;var i={};return(e={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gr,lastRenderedState:z},next:null}).next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gr,lastRenderedState:i},next:null},t.memoizedState=e,null!==(t=t.alternate)&&(t.memoizedState=e),e}function Ds(t){Ns(t,Bs(t).next.queue,{},Ru())}function Rs(){return Mo($h)}function Ls(){return Nr().memoizedState}function zs(){return Nr().memoizedState}function Os(t){for(var e=t.return;null!==e;){switch(e.tag){case 24:case 3:var i=Ru(),n=sr(e,t=rr(i),i);return null!==n&&(zu(n,e,i),ar(n,e,i)),e={cache:Ro()},void(t.payload=e)}e=e.return}}function Us(t,e,i){var n=Ru();i={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},Hs(t)?js(e,i):null!==(i=Pn(t,e,i,n))&&(zu(i,t,n),Gs(i,e,n))}function Fs(t,e,i){Ns(t,e,i,Ru())}function Ns(t,e,i,n){var o={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(Hs(t))js(e,o);else{var r=t.alternate;if(0===t.lanes&&(null===r||0===r.lanes)&&null!==(r=e.lastRenderedReducer))try{var s=e.lastRenderedState,a=r(s,i);if(o.hasEagerState=!0,o.eagerState=a,$i(a,s))return En(t,e,o,0),null===nu&&In(),!1}catch(l){}if(null!==(i=Pn(t,e,o,n)))return zu(i,t,n),Gs(i,e,n),!0}return!1}function Vs(t,e,i,n){if(n={lane:2,revertLane:Ec(),action:n,hasEagerState:!1,eagerState:null,next:null},Hs(t)){if(e)throw Error(s(479))}else null!==(e=Pn(t,i,n,2))&&zu(e,t,2)}function Hs(t){var e=t.alternate;return t===xr||null!==e&&e===xr}function js(t,e){Sr=wr=!0;var i=t.pending;null===i?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function Gs(t,e,i){if(0!==(4194048&i)){var n=e.lanes;i|=n&=t.pendingLanes,e.lanes=i,Mt(t,i)}}var Ws={readContext:Mo,use:Hr,useCallback:Pr,useContext:Pr,useEffect:Pr,useImperativeHandle:Pr,useLayoutEffect:Pr,useInsertionEffect:Pr,useMemo:Pr,useReducer:Pr,useRef:Pr,useState:Pr,useDebugValue:Pr,useDeferredValue:Pr,useTransition:Pr,useSyncExternalStore:Pr,useId:Pr,useHostTransitionStatus:Pr,useFormState:Pr,useActionState:Pr,useOptimistic:Pr,useMemoCache:Pr,useCacheRefresh:Pr},qs={readContext:Mo,use:Hr,useCallback:function(t,e){return Fr().memoizedState=[t,void 0===e?null:e],t},useContext:Mo,useEffect:_s,useImperativeHandle:function(t,e,i){i=null!==i&&void 0!==i?i.concat([t]):null,gs(4194308,4,Cs.bind(null,e,t),i)},useLayoutEffect:function(t,e){return gs(4194308,4,t,e)},useInsertionEffect:function(t,e){gs(4,2,t,e)},useMemo:function(t,e){var i=Fr();e=void 0===e?null:e;var n=t();if(Tr){dt(!0);try{t()}finally{dt(!1)}}return i.memoizedState=[n,e],n},useReducer:function(t,e,i){var n=Fr();if(void 0!==i){var o=i(e);if(Tr){dt(!0);try{i(e)}finally{dt(!1)}}}else o=e;return n.memoizedState=n.baseState=o,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},n.queue=t,t=t.dispatch=Us.bind(null,xr,t),[n.memoizedState,t]},useRef:function(t){return t={current:t},Fr().memoizedState=t},useState:function(t){var e=(t=ts(t)).queue,i=Fs.bind(null,xr,e);return e.dispatch=i,[t.memoizedState,i]},useDebugValue:Ss,useDeferredValue:function(t,e){return Ms(Fr(),t,e)},useTransition:function(){var t=ts(!1);return t=Es.bind(null,xr,t.queue,!0,!1),Fr().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,i){var n=xr,o=Fr();if(ro){if(void 0===i)throw Error(s(407));i=i()}else{if(i=e(),null===nu)throw Error(s(349));0!==(124&ru)||Kr(n,e,i)}o.memoizedState=i;var r={value:i,getSnapshot:e};return o.queue=r,_s(Jr.bind(null,n,r,t),[t]),n.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Yr.bind(null,n,r,i,e),null),i},useId:function(){var t=Fr(),e=nu.identifierPrefix;if(ro){var i=Xn;e="\xab"+e+"R"+(i=(Jn&~(1<<32-ft(Jn)-1)).toString(32)+i),0<(i=Ar++)&&(e+="H"+i.toString(32)),e+="\xbb"}else e="\xab"+e+"r"+(i=Er++).toString(32)+"\xbb";return t.memoizedState=e},useHostTransitionStatus:Rs,useFormState:us,useActionState:us,useOptimistic:function(t){var e=Fr();e.memoizedState=e.baseState=t;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=i,e=Vs.bind(null,xr,!0,i),i.dispatch=e,[t,e]},useMemoCache:jr,useCacheRefresh:function(){return Fr().memoizedState=Os.bind(null,xr)}},Zs={readContext:Mo,use:Hr,useCallback:Ts,useContext:Mo,useEffect:vs,useImperativeHandle:ws,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:Wr,useRef:ms,useState:function(){return Wr(Gr)},useDebugValue:Ss,useDeferredValue:function(t,e){return Is(Nr(),br.memoizedState,t,e)},useTransition:function(){var t=Wr(Gr)[0],e=Nr().memoizedState;return["boolean"===typeof t?t:Vr(t),e]},useSyncExternalStore:$r,useId:Ls,useHostTransitionStatus:Rs,useFormState:cs,useActionState:cs,useOptimistic:function(t,e){return es(Nr(),0,t,e)},useMemoCache:jr,useCacheRefresh:zs},$s={readContext:Mo,use:Hr,useCallback:Ts,useContext:Mo,useEffect:vs,useImperativeHandle:ws,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:Zr,useRef:ms,useState:function(){return Zr(Gr)},useDebugValue:Ss,useDeferredValue:function(t,e){var i=Nr();return null===br?Ms(i,t,e):Is(i,br.memoizedState,t,e)},useTransition:function(){var t=Zr(Gr)[0],e=Nr().memoizedState;return["boolean"===typeof t?t:Vr(t),e]},useSyncExternalStore:$r,useId:Ls,useHostTransitionStatus:Rs,useFormState:fs,useActionState:fs,useOptimistic:function(t,e){var i=Nr();return null!==br?es(i,0,t,e):(i.baseState=t,[t,i.queue.dispatch])},useMemoCache:jr,useCacheRefresh:zs},Ks=null,Ys=0;function Js(t){var e=Ys;return Ys+=1,null===Ks&&(Ks=[]),Xo(Ks,t,e)}function Xs(t,e){e=e.props.ref,t.ref=void 0!==e?e:null}function Qs(t,e){if(e.$$typeof===f)throw Error(s(525));throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ta(t){return(0,t._init)(t._payload)}function ea(t){function e(e,i){if(t){var n=e.deletions;null===n?(e.deletions=[i],e.flags|=16):n.push(i)}}function i(i,n){if(!t)return null;for(;null!==n;)e(i,n),n=n.sibling;return null}function n(t){for(var e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(t,e){return(t=Un(t,e)).index=0,t.sibling=null,t}function r(e,i,n){return e.index=n,t?null!==(n=e.alternate)?(n=n.index)<i?(e.flags|=67108866,i):n:(e.flags|=67108866,i):(e.flags|=1048576,i)}function a(e){return t&&null===e.alternate&&(e.flags|=67108866),e}function l(t,e,i,n){return null===e||6!==e.tag?((e=Hn(i,t.mode,n)).return=t,e):((e=o(e,i)).return=t,e)}function u(t,e,i,n){var r=i.type;return r===g?h(t,e,i.props.children,n,i.key):null!==e&&(e.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===A&&ta(r)===e.type)?(Xs(e=o(e,i.props),i),e.return=t,e):(Xs(e=Nn(i.type,i.key,i.props,null,t.mode,n),i),e.return=t,e)}function c(t,e,i,n){return null===e||4!==e.tag||e.stateNode.containerInfo!==i.containerInfo||e.stateNode.implementation!==i.implementation?((e=jn(i,t.mode,n)).return=t,e):((e=o(e,i.children||[])).return=t,e)}function h(t,e,i,n,r){return null===e||7!==e.tag?((e=Vn(i,t.mode,n,r)).return=t,e):((e=o(e,i)).return=t,e)}function d(t,e,i){if("string"===typeof e&&""!==e||"number"===typeof e||"bigint"===typeof e)return(e=Hn(""+e,t.mode,i)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case p:return Xs(i=Nn(e.type,e.key,e.props,null,t.mode,i),e),i.return=t,i;case m:return(e=jn(e,t.mode,i)).return=t,e;case A:return d(t,e=(0,e._init)(e._payload),i)}if(D(e)||P(e))return(e=Vn(e,t.mode,i,null)).return=t,e;if("function"===typeof e.then)return d(t,Js(e),i);if(e.$$typeof===b)return d(t,Io(t,e),i);Qs(t,e)}return null}function f(t,e,i,n){var o=null!==e?e.key:null;if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return null!==o?null:l(t,e,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case p:return i.key===o?u(t,e,i,n):null;case m:return i.key===o?c(t,e,i,n):null;case A:return f(t,e,i=(o=i._init)(i._payload),n)}if(D(i)||P(i))return null!==o?null:h(t,e,i,n,null);if("function"===typeof i.then)return f(t,e,Js(i),n);if(i.$$typeof===b)return f(t,e,Io(t,i),n);Qs(t,i)}return null}function y(t,e,i,n,o){if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return l(e,t=t.get(i)||null,""+n,o);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return u(e,t=t.get(null===n.key?i:n.key)||null,n,o);case m:return c(e,t=t.get(null===n.key?i:n.key)||null,n,o);case A:return y(t,e,i,n=(0,n._init)(n._payload),o)}if(D(n)||P(n))return h(e,t=t.get(i)||null,n,o,null);if("function"===typeof n.then)return y(t,e,i,Js(n),o);if(n.$$typeof===b)return y(t,e,i,Io(e,n),o);Qs(e,n)}return null}function _(l,u,c,h){if("object"===typeof c&&null!==c&&c.type===g&&null===c.key&&(c=c.props.children),"object"===typeof c&&null!==c){switch(c.$$typeof){case p:t:{for(var v=c.key;null!==u;){if(u.key===v){if((v=c.type)===g){if(7===u.tag){i(l,u.sibling),(h=o(u,c.props.children)).return=l,l=h;break t}}else if(u.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===A&&ta(v)===u.type){i(l,u.sibling),Xs(h=o(u,c.props),c),h.return=l,l=h;break t}i(l,u);break}e(l,u),u=u.sibling}c.type===g?((h=Vn(c.props.children,l.mode,h,c.key)).return=l,l=h):(Xs(h=Nn(c.type,c.key,c.props,null,l.mode,h),c),h.return=l,l=h)}return a(l);case m:t:{for(v=c.key;null!==u;){if(u.key===v){if(4===u.tag&&u.stateNode.containerInfo===c.containerInfo&&u.stateNode.implementation===c.implementation){i(l,u.sibling),(h=o(u,c.children||[])).return=l,l=h;break t}i(l,u);break}e(l,u),u=u.sibling}(h=jn(c,l.mode,h)).return=l,l=h}return a(l);case A:return _(l,u,c=(v=c._init)(c._payload),h)}if(D(c))return function(o,s,a,l){for(var u=null,c=null,h=s,p=s=0,m=null;null!==h&&p<a.length;p++){h.index>p?(m=h,h=null):m=h.sibling;var g=f(o,h,a[p],l);if(null===g){null===h&&(h=m);break}t&&h&&null===g.alternate&&e(o,h),s=r(g,s,p),null===c?u=g:c.sibling=g,c=g,h=m}if(p===a.length)return i(o,h),ro&&Qn(o,p),u;if(null===h){for(;p<a.length;p++)null!==(h=d(o,a[p],l))&&(s=r(h,s,p),null===c?u=h:c.sibling=h,c=h);return ro&&Qn(o,p),u}for(h=n(h);p<a.length;p++)null!==(m=y(h,o,p,a[p],l))&&(t&&null!==m.alternate&&h.delete(null===m.key?p:m.key),s=r(m,s,p),null===c?u=m:c.sibling=m,c=m);return t&&h.forEach((function(t){return e(o,t)})),ro&&Qn(o,p),u}(l,u,c,h);if(P(c)){if("function"!==typeof(v=P(c)))throw Error(s(150));return function(o,a,l,u){if(null==l)throw Error(s(151));for(var c=null,h=null,p=a,m=a=0,g=null,_=l.next();null!==p&&!_.done;m++,_=l.next()){p.index>m?(g=p,p=null):g=p.sibling;var v=f(o,p,_.value,u);if(null===v){null===p&&(p=g);break}t&&p&&null===v.alternate&&e(o,p),a=r(v,a,m),null===h?c=v:h.sibling=v,h=v,p=g}if(_.done)return i(o,p),ro&&Qn(o,m),c;if(null===p){for(;!_.done;m++,_=l.next())null!==(_=d(o,_.value,u))&&(a=r(_,a,m),null===h?c=_:h.sibling=_,h=_);return ro&&Qn(o,m),c}for(p=n(p);!_.done;m++,_=l.next())null!==(_=y(p,o,m,_.value,u))&&(t&&null!==_.alternate&&p.delete(null===_.key?m:_.key),a=r(_,a,m),null===h?c=_:h.sibling=_,h=_);return t&&p.forEach((function(t){return e(o,t)})),ro&&Qn(o,m),c}(l,u,c=v.call(c),h)}if("function"===typeof c.then)return _(l,u,Js(c),h);if(c.$$typeof===b)return _(l,u,Io(l,c),h);Qs(l,c)}return"string"===typeof c&&""!==c||"number"===typeof c||"bigint"===typeof c?(c=""+c,null!==u&&6===u.tag?(i(l,u.sibling),(h=o(u,c)).return=l,l=h):(i(l,u),(h=Hn(c,l.mode,h)).return=l,l=h),a(l)):i(l,u)}return function(t,e,i,n){try{Ys=0;var o=_(t,e,i,n);return Ks=null,o}catch(s){if(s===qo||s===$o)throw s;var r=zn(29,s,null,t.mode);return r.lanes=n,r.return=t,r}}}var ia=ea(!0),na=ea(!1),oa=F(null),ra=null;function sa(t){var e=t.alternate;V(ca,1&ca.current),V(oa,t),null===ra&&(null===e||null!==pr.current||null!==e.memoizedState)&&(ra=t)}function aa(t){if(22===t.tag){if(V(ca,ca.current),V(oa,t),null===ra){var e=t.alternate;null!==e&&null!==e.memoizedState&&(ra=t)}}else la()}function la(){V(ca,ca.current),V(oa,oa.current)}function ua(t){N(oa),ra===t&&(ra=null),N(ca)}var ca=F(0);function ha(t){for(var e=t;null!==e;){if(13===e.tag){var i=e.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||gh(i)))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function da(t,e,i,n){i=null===(i=i(n,e=t.memoizedState))||void 0===i?e:d({},e,i),t.memoizedState=i,0===t.lanes&&(t.updateQueue.baseState=i)}var fa={enqueueSetState:function(t,e,i){t=t._reactInternals;var n=Ru(),o=rr(n);o.payload=e,void 0!==i&&null!==i&&(o.callback=i),null!==(e=sr(t,o,n))&&(zu(e,t,n),ar(e,t,n))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=Ru(),o=rr(n);o.tag=1,o.payload=e,void 0!==i&&null!==i&&(o.callback=i),null!==(e=sr(t,o,n))&&(zu(e,t,n),ar(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Ru(),n=rr(i);n.tag=2,void 0!==e&&null!==e&&(n.callback=e),null!==(e=sr(t,n,i))&&(zu(e,t,i),ar(e,t,i))}};function pa(t,e,i,n,o,r,s){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(n,r,s):!e.prototype||!e.prototype.isPureReactComponent||(!Ki(i,n)||!Ki(o,r))}function ma(t,e,i,n){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(i,n),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&fa.enqueueReplaceState(e,e.state,null)}function ga(t,e){var i=e;if("ref"in e)for(var n in i={},e)"ref"!==n&&(i[n]=e[n]);if(t=t.defaultProps)for(var o in i===e&&(i=d({},i)),t)void 0===i[o]&&(i[o]=t[o]);return i}var ya="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function _a(t){ya(t)}function va(t){console.error(t)}function xa(t){ya(t)}function ba(t,e){try{(0,t.onUncaughtError)(e.value,{componentStack:e.stack})}catch(i){setTimeout((function(){throw i}))}}function Ca(t,e,i){try{(0,t.onCaughtError)(i.value,{componentStack:i.stack,errorBoundary:1===e.tag?e.stateNode:null})}catch(n){setTimeout((function(){throw n}))}}function wa(t,e,i){return(i=rr(i)).tag=3,i.payload={element:null},i.callback=function(){ba(t,e)},i}function Sa(t){return(t=rr(t)).tag=3,t}function Ta(t,e,i,n){var o=i.type.getDerivedStateFromError;if("function"===typeof o){var r=n.value;t.payload=function(){return o(r)},t.callback=function(){Ca(e,i,n)}}var s=i.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(t.callback=function(){Ca(e,i,n),"function"!==typeof o&&(null===Su?Su=new Set([this]):Su.add(this));var t=n.stack;this.componentDidCatch(n.value,{componentStack:null!==t?t:""})})}var Aa=Error(s(461)),Ma=!1;function Ia(t,e,i,n){e.child=null===t?na(e,null,i,n):ia(e,t.child,i,n)}function Ea(t,e,i,n,o){i=i.render;var r=e.ref;if("ref"in n){var s={};for(var a in n)"ref"!==a&&(s[a]=n[a])}else s=n;return Ao(e),n=Br(t,e,i,s,r,o),a=zr(),null===t||Ma?(ro&&a&&eo(e),e.flags|=1,Ia(t,e,n,o),e.child):(Or(t,e,o),Ka(t,e,o))}function Pa(t,e,i,n,o){if(null===t){var r=i.type;return"function"!==typeof r||On(r)||void 0!==r.defaultProps||null!==i.compare?((t=Nn(i.type,null,n,e,e.mode,o)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=r,ka(t,e,r,n,o))}if(r=t.child,!Ya(t,o)){var s=r.memoizedProps;if((i=null!==(i=i.compare)?i:Ki)(s,n)&&t.ref===e.ref)return Ka(t,e,o)}return e.flags|=1,(t=Un(r,n)).ref=e.ref,t.return=e,e.child=t}function ka(t,e,i,n,o){if(null!==t){var r=t.memoizedProps;if(Ki(r,n)&&t.ref===e.ref){if(Ma=!1,e.pendingProps=n=r,!Ya(t,o))return e.lanes=t.lanes,Ka(t,e,o);0!==(131072&t.flags)&&(Ma=!0)}}return La(t,e,i,n,o)}function Ba(t,e,i){var n=e.pendingProps,o=n.children,r=null!==t?t.memoizedState:null;if("hidden"===n.mode){if(0!==(128&e.flags)){if(n=null!==r?r.baseLanes|i:i,null!==t){for(o=e.child=t.child,r=0;null!==o;)r=r|o.lanes|o.childLanes,o=o.sibling;e.childLanes=r&~n}else e.childLanes=0,e.child=null;return Da(t,e,n,i)}if(0===(536870912&i))return e.lanes=e.childLanes=536870912,Da(t,e,null!==r?r.baseLanes|i:i,i);e.memoizedState={baseLanes:0,cachePool:null},null!==t&&Go(0,null!==r?r.cachePool:null),null!==r?gr(e,r):yr(),aa(e)}else null!==r?(Go(0,r.cachePool),gr(e,r),la(),e.memoizedState=null):(null!==t&&Go(0,null),yr(),la());return Ia(t,e,o,i),e.child}function Da(t,e,i,n){var o=jo();return o=null===o?null:{parent:Do._currentValue,pool:o},e.memoizedState={baseLanes:i,cachePool:o},null!==t&&Go(0,null),yr(),aa(e),null!==t&&So(t,e,n,!0),null}function Ra(t,e){var i=e.ref;if(null===i)null!==t&&null!==t.ref&&(e.flags|=4194816);else{if("function"!==typeof i&&"object"!==typeof i)throw Error(s(284));null!==t&&t.ref===i||(e.flags|=4194816)}}function La(t,e,i,n,o){return Ao(e),i=Br(t,e,i,n,void 0,o),n=zr(),null===t||Ma?(ro&&n&&eo(e),e.flags|=1,Ia(t,e,i,o),e.child):(Or(t,e,o),Ka(t,e,o))}function za(t,e,i,n,o,r){return Ao(e),e.updateQueue=null,i=Rr(e,n,i,o),Dr(t),n=zr(),null===t||Ma?(ro&&n&&eo(e),e.flags|=1,Ia(t,e,i,r),e.child):(Or(t,e,r),Ka(t,e,r))}function Oa(t,e,i,n,o){if(Ao(e),null===e.stateNode){var r=Rn,s=i.contextType;"object"===typeof s&&null!==s&&(r=Mo(s)),r=new i(n,r),e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=fa,e.stateNode=r,r._reactInternals=e,(r=e.stateNode).props=n,r.state=e.memoizedState,r.refs={},nr(e),s=i.contextType,r.context="object"===typeof s&&null!==s?Mo(s):Rn,r.state=e.memoizedState,"function"===typeof(s=i.getDerivedStateFromProps)&&(da(e,i,s,n),r.state=e.memoizedState),"function"===typeof i.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(s=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),s!==r.state&&fa.enqueueReplaceState(r,r.state,null),hr(e,n,r,o),cr(),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308),n=!0}else if(null===t){r=e.stateNode;var a=e.memoizedProps,l=ga(i,a);r.props=l;var u=r.context,c=i.contextType;s=Rn,"object"===typeof c&&null!==c&&(s=Mo(c));var h=i.getDerivedStateFromProps;c="function"===typeof h||"function"===typeof r.getSnapshotBeforeUpdate,a=e.pendingProps!==a,c||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(a||u!==s)&&ma(e,r,n,s),ir=!1;var d=e.memoizedState;r.state=d,hr(e,n,r,o),cr(),u=e.memoizedState,a||d!==u||ir?("function"===typeof h&&(da(e,i,h,n),u=e.memoizedState),(l=ir||pa(e,i,l,n,d,u,s))?(c||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||("function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"===typeof r.componentDidMount&&(e.flags|=4194308)):("function"===typeof r.componentDidMount&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=u),r.props=n,r.state=u,r.context=s,n=l):("function"===typeof r.componentDidMount&&(e.flags|=4194308),n=!1)}else{r=e.stateNode,or(t,e),c=ga(i,s=e.memoizedProps),r.props=c,h=e.pendingProps,d=r.context,u=i.contextType,l=Rn,"object"===typeof u&&null!==u&&(l=Mo(u)),(u="function"===typeof(a=i.getDerivedStateFromProps)||"function"===typeof r.getSnapshotBeforeUpdate)||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(s!==h||d!==l)&&ma(e,r,n,l),ir=!1,d=e.memoizedState,r.state=d,hr(e,n,r,o),cr();var f=e.memoizedState;s!==h||d!==f||ir||null!==t&&null!==t.dependencies&&To(t.dependencies)?("function"===typeof a&&(da(e,i,a,n),f=e.memoizedState),(c=ir||pa(e,i,c,n,d,f,l)||null!==t&&null!==t.dependencies&&To(t.dependencies))?(u||"function"!==typeof r.UNSAFE_componentWillUpdate&&"function"!==typeof r.componentWillUpdate||("function"===typeof r.componentWillUpdate&&r.componentWillUpdate(n,f,l),"function"===typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof r.componentDidUpdate&&(e.flags|=4),"function"===typeof r.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof r.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),r.props=n,r.state=f,r.context=l,n=c):("function"!==typeof r.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),n=!1)}return r=n,Ra(t,e),n=0!==(128&e.flags),r||n?(r=e.stateNode,i=n&&"function"!==typeof i.getDerivedStateFromError?null:r.render(),e.flags|=1,null!==t&&n?(e.child=ia(e,t.child,null,o),e.child=ia(e,null,i,o)):Ia(t,e,i,o),e.memoizedState=r.state,t=e.child):t=Ka(t,e,o),t}function Ua(t,e,i,n){return po(),e.flags|=256,Ia(t,e,i,n),e.child}var Fa={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Na(t){return{baseLanes:t,cachePool:Wo()}}function Va(t,e,i){return t=null!==t?t.childLanes&~i:0,e&&(t|=gu),t}function Ha(t,e,i){var n,o=e.pendingProps,r=!1,a=0!==(128&e.flags);if((n=a)||(n=(null===t||null!==t.memoizedState)&&0!==(2&ca.current)),n&&(r=!0,e.flags&=-129),n=0!==(32&e.flags),e.flags&=-33,null===t){if(ro){if(r?sa(e):la(),ro){var l,u=oo;if(l=u){t:{for(l=u,u=ao;8!==l.nodeType;){if(!u){u=null;break t}if(null===(l=yh(l.nextSibling))){u=null;break t}}u=l}null!==u?(e.memoizedState={dehydrated:u,treeContext:null!==Yn?{id:Jn,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},(l=zn(18,null,null,0)).stateNode=u,l.return=e,e.child=l,no=e,oo=null,l=!0):l=!1}l||uo(e)}if(null!==(u=e.memoizedState)&&null!==(u=u.dehydrated))return gh(u)?e.lanes=32:e.lanes=536870912,null;ua(e)}return u=o.children,o=o.fallback,r?(la(),u=Ga({mode:"hidden",children:u},r=e.mode),o=Vn(o,r,i,null),u.return=e,o.return=e,u.sibling=o,e.child=u,(r=e.child).memoizedState=Na(i),r.childLanes=Va(t,n,i),e.memoizedState=Fa,o):(sa(e),ja(e,u))}if(null!==(l=t.memoizedState)&&null!==(u=l.dehydrated)){if(a)256&e.flags?(sa(e),e.flags&=-257,e=Wa(t,e,i)):null!==e.memoizedState?(la(),e.child=t.child,e.flags|=128,e=null):(la(),r=o.fallback,u=e.mode,o=Ga({mode:"visible",children:o.children},u),(r=Vn(r,u,i,null)).flags|=2,o.return=e,r.return=e,o.sibling=r,e.child=o,ia(e,t.child,null,i),(o=e.child).memoizedState=Na(i),o.childLanes=Va(t,n,i),e.memoizedState=Fa,e=r);else if(sa(e),gh(u)){if(n=u.nextSibling&&u.nextSibling.dataset)var c=n.dgst;n=c,(o=Error(s(419))).stack="",o.digest=n,go({value:o,source:null,stack:null}),e=Wa(t,e,i)}else if(Ma||So(t,e,i,!1),n=0!==(i&t.childLanes),Ma||n){if(null!==(n=nu)&&(0!==(o=0!==((o=0!==(42&(o=i&-i))?1:It(o))&(n.suspendedLanes|i))?0:o)&&o!==l.retryLane))throw l.retryLane=o,kn(t,o),zu(n,t,o),Aa;"$?"===u.data||Zu(),e=Wa(t,e,i)}else"$?"===u.data?(e.flags|=192,e.child=t.child,e=null):(t=l.treeContext,oo=yh(u.nextSibling),no=e,ro=!0,so=null,ao=!1,null!==t&&($n[Kn++]=Jn,$n[Kn++]=Xn,$n[Kn++]=Yn,Jn=t.id,Xn=t.overflow,Yn=e),(e=ja(e,o.children)).flags|=4096);return e}return r?(la(),r=o.fallback,u=e.mode,c=(l=t.child).sibling,(o=Un(l,{mode:"hidden",children:o.children})).subtreeFlags=65011712&l.subtreeFlags,null!==c?r=Un(c,r):(r=Vn(r,u,i,null)).flags|=2,r.return=e,o.return=e,o.sibling=r,e.child=o,o=r,r=e.child,null===(u=t.child.memoizedState)?u=Na(i):(null!==(l=u.cachePool)?(c=Do._currentValue,l=l.parent!==c?{parent:c,pool:c}:l):l=Wo(),u={baseLanes:u.baseLanes|i,cachePool:l}),r.memoizedState=u,r.childLanes=Va(t,n,i),e.memoizedState=Fa,o):(sa(e),t=(i=t.child).sibling,(i=Un(i,{mode:"visible",children:o.children})).return=e,i.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i)}function ja(t,e){return(e=Ga({mode:"visible",children:e},t.mode)).return=t,t.child=e}function Ga(t,e){return(t=zn(22,t,null,e)).lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Wa(t,e,i){return ia(e,t.child,null,i),(t=ja(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function qa(t,e,i){t.lanes|=e;var n=t.alternate;null!==n&&(n.lanes|=e),Co(t.return,e,i)}function Za(t,e,i,n,o){var r=t.memoizedState;null===r?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:o}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=i,r.tailMode=o)}function $a(t,e,i){var n=e.pendingProps,o=n.revealOrder,r=n.tail;if(Ia(t,e,n.children,i),0!==(2&(n=ca.current)))n=1&n|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&qa(t,i,e);else if(19===t.tag)qa(t,i,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}switch(V(ca,n),o){case"forwards":for(i=e.child,o=null;null!==i;)null!==(t=i.alternate)&&null===ha(t)&&(o=i),i=i.sibling;null===(i=o)?(o=e.child,e.child=null):(o=i.sibling,i.sibling=null),Za(e,!1,o,i,r);break;case"backwards":for(i=null,o=e.child,e.child=null;null!==o;){if(null!==(t=o.alternate)&&null===ha(t)){e.child=o;break}t=o.sibling,o.sibling=i,i=o,o=t}Za(e,!0,i,null,r);break;case"together":Za(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ka(t,e,i){if(null!==t&&(e.dependencies=t.dependencies),fu|=e.lanes,0===(i&e.childLanes)){if(null===t)return null;if(So(t,e,i,!1),0===(i&e.childLanes))return null}if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(i=Un(t=e.child,t.pendingProps),e.child=i,i.return=e;null!==t.sibling;)t=t.sibling,(i=i.sibling=Un(t,t.pendingProps)).return=e;i.sibling=null}return e.child}function Ya(t,e){return 0!==(t.lanes&e)||!(null===(t=t.dependencies)||!To(t))}function Ja(t,e,i){if(null!==t)if(t.memoizedProps!==e.pendingProps)Ma=!0;else{if(!Ya(t,i)&&0===(128&e.flags))return Ma=!1,function(t,e,i){switch(e.tag){case 3:q(e,e.stateNode.containerInfo),xo(0,Do,t.memoizedState.cache),po();break;case 27:case 5:$(e);break;case 4:q(e,e.stateNode.containerInfo);break;case 10:xo(0,e.type,e.memoizedProps.value);break;case 13:var n=e.memoizedState;if(null!==n)return null!==n.dehydrated?(sa(e),e.flags|=128,null):0!==(i&e.child.childLanes)?Ha(t,e,i):(sa(e),null!==(t=Ka(t,e,i))?t.sibling:null);sa(e);break;case 19:var o=0!==(128&t.flags);if((n=0!==(i&e.childLanes))||(So(t,e,i,!1),n=0!==(i&e.childLanes)),o){if(n)return $a(t,e,i);e.flags|=128}if(null!==(o=e.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),V(ca,ca.current),n)break;return null;case 22:case 23:return e.lanes=0,Ba(t,e,i);case 24:xo(0,Do,t.memoizedState.cache)}return Ka(t,e,i)}(t,e,i);Ma=0!==(131072&t.flags)}else Ma=!1,ro&&0!==(1048576&e.flags)&&to(e,Zn,e.index);switch(e.lanes=0,e.tag){case 16:t:{t=e.pendingProps;var n=e.elementType,o=n._init;if(n=o(n._payload),e.type=n,"function"!==typeof n){if(void 0!==n&&null!==n){if((o=n.$$typeof)===C){e.tag=11,e=Ea(null,e,n,t,i);break t}if(o===T){e.tag=14,e=Pa(null,e,n,t,i);break t}}throw e=B(n)||n,Error(s(306,e,""))}On(n)?(t=ga(n,t),e.tag=1,e=Oa(null,e,n,t,i)):(e.tag=0,e=La(null,e,n,t,i))}return e;case 0:return La(t,e,e.type,e.pendingProps,i);case 1:return Oa(t,e,n=e.type,o=ga(n,e.pendingProps),i);case 3:t:{if(q(e,e.stateNode.containerInfo),null===t)throw Error(s(387));n=e.pendingProps;var r=e.memoizedState;o=r.element,or(t,e),hr(e,n,null,i);var a=e.memoizedState;if(n=a.cache,xo(0,Do,n),n!==r.cache&&wo(e,[Do],i,!0),cr(),n=a.element,r.isDehydrated){if(r={element:n,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,256&e.flags){e=Ua(t,e,n,i);break t}if(n!==o){go(o=Sn(Error(s(424)),e)),e=Ua(t,e,n,i);break t}if(9===(t=e.stateNode.containerInfo).nodeType)t=t.body;else t="HTML"===t.nodeName?t.ownerDocument.body:t;for(oo=yh(t.firstChild),no=e,ro=!0,so=null,ao=!0,i=na(e,null,n,i),e.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(po(),n===o){e=Ka(t,e,i);break t}Ia(t,e,n,i)}e=e.child}return e;case 26:return Ra(t,e),null===t?(i=Ih(e.type,null,e.pendingProps,null))?e.memoizedState=i:ro||(i=e.type,t=e.pendingProps,(n=nh(G.current).createElement(i))[Bt]=e,n[Dt]=t,th(n,i,t),Wt(n),e.stateNode=n):e.memoizedState=Ih(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return $(e),null===t&&ro&&(n=e.stateNode=xh(e.type,e.pendingProps,G.current),no=e,ao=!0,o=oo,fh(e.type)?(_h=o,oo=yh(n.firstChild)):oo=o),Ia(t,e,e.pendingProps.children,i),Ra(t,e),null===t&&(e.flags|=4194304),e.child;case 5:return null===t&&ro&&((o=n=oo)&&(null!==(n=function(t,e,i,n){for(;1===t.nodeType;){var o=i;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!n&&("INPUT"!==t.nodeName||"hidden"!==t.type))break}else if(n){if(!t[Ft])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if("stylesheet"===(r=t.getAttribute("rel"))&&t.hasAttribute("data-precedence"))break;if(r!==o.rel||t.getAttribute("href")!==(null==o.href||""===o.href?null:o.href)||t.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin)||t.getAttribute("title")!==(null==o.title?null:o.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(((r=t.getAttribute("src"))!==(null==o.src?null:o.src)||t.getAttribute("type")!==(null==o.type?null:o.type)||t.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else{if("input"!==e||"hidden"!==t.type)return t;var r=null==o.name?null:""+o.name;if("hidden"===o.type&&t.getAttribute("name")===r)return t}if(null===(t=yh(t.nextSibling)))break}return null}(n,e.type,e.pendingProps,ao))?(e.stateNode=n,no=e,oo=yh(n.firstChild),ao=!1,o=!0):o=!1),o||uo(e)),$(e),o=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,n=r.children,sh(o,r)?n=null:null!==a&&sh(o,a)&&(e.flags|=32),null!==e.memoizedState&&(o=Br(t,e,Lr,null,null,i),$h._currentValue=o),Ra(t,e),Ia(t,e,n,i),e.child;case 6:return null===t&&ro&&((t=i=oo)&&(null!==(i=function(t,e,i){if(""===e)return null;for(;3!==t.nodeType;){if((1!==t.nodeType||"INPUT"!==t.nodeName||"hidden"!==t.type)&&!i)return null;if(null===(t=yh(t.nextSibling)))return null}return t}(i,e.pendingProps,ao))?(e.stateNode=i,no=e,oo=null,t=!0):t=!1),t||uo(e)),null;case 13:return Ha(t,e,i);case 4:return q(e,e.stateNode.containerInfo),n=e.pendingProps,null===t?e.child=ia(e,null,n,i):Ia(t,e,n,i),e.child;case 11:return Ea(t,e,e.type,e.pendingProps,i);case 7:return Ia(t,e,e.pendingProps,i),e.child;case 8:case 12:return Ia(t,e,e.pendingProps.children,i),e.child;case 10:return n=e.pendingProps,xo(0,e.type,n.value),Ia(t,e,n.children,i),e.child;case 9:return o=e.type._context,n=e.pendingProps.children,Ao(e),n=n(o=Mo(o)),e.flags|=1,Ia(t,e,n,i),e.child;case 14:return Pa(t,e,e.type,e.pendingProps,i);case 15:return ka(t,e,e.type,e.pendingProps,i);case 19:return $a(t,e,i);case 31:return n=e.pendingProps,i=e.mode,n={mode:n.mode,children:n.children},null===t?((i=Ga(n,i)).ref=e.ref,e.child=i,i.return=e,e=i):((i=Un(t.child,n)).ref=e.ref,e.child=i,i.return=e,e=i),e;case 22:return Ba(t,e,i);case 24:return Ao(e),n=Mo(Do),null===t?(null===(o=jo())&&(o=nu,r=Ro(),o.pooledCache=r,r.refCount++,null!==r&&(o.pooledCacheLanes|=i),o=r),e.memoizedState={parent:n,cache:o},nr(e),xo(0,Do,o)):(0!==(t.lanes&i)&&(or(t,e),hr(e,null,null,i),cr()),o=t.memoizedState,r=e.memoizedState,o.parent!==n?(o={parent:n,cache:n},e.memoizedState=o,0===e.lanes&&(e.memoizedState=e.updateQueue.baseState=o),xo(0,Do,n)):(n=r.cache,xo(0,Do,n),n!==o.cache&&wo(e,[Do],i,!0))),Ia(t,e,e.pendingProps.children,i),e.child;case 29:throw e.pendingProps}throw Error(s(156,e.tag))}function Xa(t){t.flags|=4}function Qa(t,e){if("stylesheet"!==e.type||0!==(4&e.state.loading))t.flags&=-16777217;else if(t.flags|=16777216,!Vh(e)){if(null!==(e=oa.current)&&((4194048&ru)===ru?null!==ra:(62914560&ru)!==ru&&0===(536870912&ru)||e!==ra))throw Qo=Ko,Zo;t.flags|=8192}}function tl(t,e){null!==e&&(t.flags|=4),16384&t.flags&&(e=22!==t.tag?wt():536870912,t.lanes|=e,yu|=e)}function el(t,e){if(!ro)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;null!==e;)null!==e.alternate&&(i=e),e=e.sibling;null===i?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?e||null===t.tail?t.tail=null:t.tail.sibling=null:n.sibling=null}}function il(t){var e=null!==t.alternate&&t.alternate.child===t.child,i=0,n=0;if(e)for(var o=t.child;null!==o;)i|=o.lanes|o.childLanes,n|=65011712&o.subtreeFlags,n|=65011712&o.flags,o.return=t,o=o.sibling;else for(o=t.child;null!==o;)i|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function nl(t,e,i){var n=e.pendingProps;switch(io(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return il(e),null;case 3:return i=e.stateNode,n=null,null!==t&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),bo(Do),Z(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(fo(e)?Xa(e):null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,mo())),il(e),null;case 26:return i=e.memoizedState,null===t?(Xa(e),null!==i?(il(e),Qa(e,i)):(il(e),e.flags&=-16777217)):i?i!==t.memoizedState?(Xa(e),il(e),Qa(e,i)):(il(e),e.flags&=-16777217):(t.memoizedProps!==n&&Xa(e),il(e),e.flags&=-16777217),null;case 27:K(e),i=G.current;var o=e.type;if(null!==t&&null!=e.stateNode)t.memoizedProps!==n&&Xa(e);else{if(!n){if(null===e.stateNode)throw Error(s(166));return il(e),null}t=H.current,fo(e)?co(e):(t=xh(o,n,i),e.stateNode=t,Xa(e))}return il(e),null;case 5:if(K(e),i=e.type,null!==t&&null!=e.stateNode)t.memoizedProps!==n&&Xa(e);else{if(!n){if(null===e.stateNode)throw Error(s(166));return il(e),null}if(t=H.current,fo(e))co(e);else{switch(o=nh(G.current),t){case 1:t=o.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:t=o.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":t=o.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":t=o.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(t=o.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t="string"===typeof n.is?o.createElement("select",{is:n.is}):o.createElement("select"),n.multiple?t.multiple=!0:n.size&&(t.size=n.size);break;default:t="string"===typeof n.is?o.createElement(i,{is:n.is}):o.createElement(i)}}t[Bt]=e,t[Dt]=n;t:for(o=e.child;null!==o;){if(5===o.tag||6===o.tag)t.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===e)break t;for(;null===o.sibling;){if(null===o.return||o.return===e)break t;o=o.return}o.sibling.return=o.return,o=o.sibling}e.stateNode=t;t:switch(th(t,i,n),i){case"button":case"input":case"select":case"textarea":t=!!n.autoFocus;break t;case"img":t=!0;break t;default:t=!1}t&&Xa(e)}}return il(e),e.flags&=-16777217,null;case 6:if(t&&null!=e.stateNode)t.memoizedProps!==n&&Xa(e);else{if("string"!==typeof n&&null===e.stateNode)throw Error(s(166));if(t=G.current,fo(e)){if(t=e.stateNode,i=e.memoizedProps,n=null,null!==(o=no))switch(o.tag){case 27:case 5:n=o.memoizedProps}t[Bt]=e,(t=!!(t.nodeValue===i||null!==n&&!0===n.suppressHydrationWarning||Yc(t.nodeValue,i)))||uo(e)}else(t=nh(t).createTextNode(n))[Bt]=e,e.stateNode=t}return il(e),null;case 13:if(n=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(o=fo(e),null!==n&&null!==n.dehydrated){if(null===t){if(!o)throw Error(s(318));if(!(o=null!==(o=e.memoizedState)?o.dehydrated:null))throw Error(s(317));o[Bt]=e}else po(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;il(e),o=!1}else o=mo(),null!==t&&null!==t.memoizedState&&(t.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&e.flags?(ua(e),e):(ua(e),null)}if(ua(e),0!==(128&e.flags))return e.lanes=i,e;if(i=null!==n,t=null!==t&&null!==t.memoizedState,i){o=null,null!==(n=e.child).alternate&&null!==n.alternate.memoizedState&&null!==n.alternate.memoizedState.cachePool&&(o=n.alternate.memoizedState.cachePool.pool);var r=null;null!==n.memoizedState&&null!==n.memoizedState.cachePool&&(r=n.memoizedState.cachePool.pool),r!==o&&(n.flags|=2048)}return i!==t&&i&&(e.child.flags|=8192),tl(e,e.updateQueue),il(e),null;case 4:return Z(),null===t&&Nc(e.stateNode.containerInfo),il(e),null;case 10:return bo(e.type),il(e),null;case 19:if(N(ca),null===(o=e.memoizedState))return il(e),null;if(n=0!==(128&e.flags),null===(r=o.rendering))if(n)el(o,!1);else{if(0!==du||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(r=ha(t))){for(e.flags|=128,el(o,!1),t=r.updateQueue,e.updateQueue=t,tl(e,t),e.subtreeFlags=0,t=i,i=e.child;null!==i;)Fn(i,t),i=i.sibling;return V(ca,1&ca.current|2),e.child}t=t.sibling}null!==o.tail&&et()>Cu&&(e.flags|=128,n=!0,el(o,!1),e.lanes=4194304)}else{if(!n)if(null!==(t=ha(r))){if(e.flags|=128,n=!0,t=t.updateQueue,e.updateQueue=t,tl(e,t),el(o,!0),null===o.tail&&"hidden"===o.tailMode&&!r.alternate&&!ro)return il(e),null}else 2*et()-o.renderingStartTime>Cu&&536870912!==i&&(e.flags|=128,n=!0,el(o,!1),e.lanes=4194304);o.isBackwards?(r.sibling=e.child,e.child=r):(null!==(t=o.last)?t.sibling=r:e.child=r,o.last=r)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=et(),e.sibling=null,t=ca.current,V(ca,n?1&t|2:1&t),e):(il(e),null);case 22:case 23:return ua(e),_r(),n=null!==e.memoizedState,null!==t?null!==t.memoizedState!==n&&(e.flags|=8192):n&&(e.flags|=8192),n?0!==(536870912&i)&&0===(128&e.flags)&&(il(e),6&e.subtreeFlags&&(e.flags|=8192)):il(e),null!==(i=e.updateQueue)&&tl(e,i.retryQueue),i=null,null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),n=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),n!==i&&(e.flags|=2048),null!==t&&N(Ho),null;case 24:return i=null,null!==t&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),bo(Do),il(e),null;case 25:case 30:return null}throw Error(s(156,e.tag))}function ol(t,e){switch(io(e),e.tag){case 1:return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return bo(Do),Z(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 26:case 27:case 5:return K(e),null;case 13:if(ua(e),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));po()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return N(ca),null;case 4:return Z(),null;case 10:return bo(e.type),null;case 22:case 23:return ua(e),_r(),null!==t&&N(Ho),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 24:return bo(Do),null;default:return null}}function rl(t,e){switch(io(e),e.tag){case 3:bo(Do),Z();break;case 26:case 27:case 5:K(e);break;case 4:Z();break;case 13:ua(e);break;case 19:N(ca);break;case 10:bo(e.type);break;case 22:case 23:ua(e),_r(),null!==t&&N(Ho);break;case 24:bo(Do)}}function sl(t,e){try{var i=e.updateQueue,n=null!==i?i.lastEffect:null;if(null!==n){var o=n.next;i=o;do{if((i.tag&t)===t){n=void 0;var r=i.create,s=i.inst;n=r(),s.destroy=n}i=i.next}while(i!==o)}}catch(a){cc(e,e.return,a)}}function al(t,e,i){try{var n=e.updateQueue,o=null!==n?n.lastEffect:null;if(null!==o){var r=o.next;n=r;do{if((n.tag&t)===t){var s=n.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,o=e;var l=i,u=a;try{u()}catch(c){cc(o,l,c)}}}n=n.next}while(n!==r)}}catch(c){cc(e,e.return,c)}}function ll(t){var e=t.updateQueue;if(null!==e){var i=t.stateNode;try{fr(e,i)}catch(n){cc(t,t.return,n)}}}function ul(t,e,i){i.props=ga(t.type,t.memoizedProps),i.state=t.memoizedState;try{i.componentWillUnmount()}catch(n){cc(t,e,n)}}function cl(t,e){try{var i=t.ref;if(null!==i){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;default:n=t.stateNode}"function"===typeof i?t.refCleanup=i(n):i.current=n}}catch(o){cc(t,e,o)}}function hl(t,e){var i=t.ref,n=t.refCleanup;if(null!==i)if("function"===typeof n)try{n()}catch(o){cc(t,e,o)}finally{t.refCleanup=null,null!=(t=t.alternate)&&(t.refCleanup=null)}else if("function"===typeof i)try{i(null)}catch(r){cc(t,e,r)}else i.current=null}function dl(t){var e=t.type,i=t.memoizedProps,n=t.stateNode;try{t:switch(e){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break t;case"img":i.src?n.src=i.src:i.srcSet&&(n.srcset=i.srcSet)}}catch(o){cc(t,t.return,o)}}function fl(t,e,i){try{var n=t.stateNode;!function(t,e,i,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,r=null,a=null,l=null,u=null,c=null,h=null;for(p in i){var d=i[p];if(i.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":u=d;default:n.hasOwnProperty(p)||Xc(t,e,p,null,n,d)}}for(var f in n){var p=n[f];if(d=i[f],n.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":r=p;break;case"name":o=p;break;case"checked":c=p;break;case"defaultChecked":h=p;break;case"value":a=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,e));break;default:p!==d&&Xc(t,e,f,p,n,d)}}return void ge(t,a,l,u,c,h,r,o);case"select":for(r in p=a=l=f=null,i)if(u=i[r],i.hasOwnProperty(r)&&null!=u)switch(r){case"value":break;case"multiple":p=u;default:n.hasOwnProperty(r)||Xc(t,e,r,null,n,u)}for(o in n)if(r=n[o],u=i[o],n.hasOwnProperty(o)&&(null!=r||null!=u))switch(o){case"value":f=r;break;case"defaultValue":l=r;break;case"multiple":a=r;default:r!==u&&Xc(t,e,o,r,n,u)}return e=l,i=a,n=p,void(null!=f?ve(t,!!i,f,!1):!!n!==!!i&&(null!=e?ve(t,!!i,e,!0):ve(t,!!i,i?[]:"",!1)));case"textarea":for(l in p=f=null,i)if(o=i[l],i.hasOwnProperty(l)&&null!=o&&!n.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Xc(t,e,l,null,n,o)}for(a in n)if(o=n[a],r=i[a],n.hasOwnProperty(a)&&(null!=o||null!=r))switch(a){case"value":f=o;break;case"defaultValue":p=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(s(91));break;default:o!==r&&Xc(t,e,a,o,n,r)}return void xe(t,f,p);case"option":for(var m in i)if(f=i[m],i.hasOwnProperty(m)&&null!=f&&!n.hasOwnProperty(m))if("selected"===m)t.selected=!1;else Xc(t,e,m,null,n,f);for(u in n)if(f=n[u],p=i[u],n.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))if("selected"===u)t.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else Xc(t,e,u,f,n,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in i)f=i[g],i.hasOwnProperty(g)&&null!=f&&!n.hasOwnProperty(g)&&Xc(t,e,g,null,n,f);for(c in n)if(f=n[c],p=i[c],n.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,e));break;default:Xc(t,e,c,f,n,p)}return;default:if(Ae(e)){for(var y in i)f=i[y],i.hasOwnProperty(y)&&void 0!==f&&!n.hasOwnProperty(y)&&Qc(t,e,y,void 0,n,f);for(h in n)f=n[h],p=i[h],!n.hasOwnProperty(h)||f===p||void 0===f&&void 0===p||Qc(t,e,h,f,n,p);return}}for(var _ in i)f=i[_],i.hasOwnProperty(_)&&null!=f&&!n.hasOwnProperty(_)&&Xc(t,e,_,null,n,f);for(d in n)f=n[d],p=i[d],!n.hasOwnProperty(d)||f===p||null==f&&null==p||Xc(t,e,d,f,n,p)}(n,t.type,i,e),n[Dt]=e}catch(o){cc(t,t.return,o)}}function pl(t){return 5===t.tag||3===t.tag||26===t.tag||27===t.tag&&fh(t.type)||4===t.tag}function ml(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||pl(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(27===t.tag&&fh(t.type))continue t;if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function gl(t,e,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?(9===i.nodeType?i.body:"HTML"===i.nodeName?i.ownerDocument.body:i).insertBefore(t,e):((e=9===i.nodeType?i.body:"HTML"===i.nodeName?i.ownerDocument.body:i).appendChild(t),null!==(i=i._reactRootContainer)&&void 0!==i||null!==e.onclick||(e.onclick=Jc));else if(4!==n&&(27===n&&fh(t.type)&&(i=t.stateNode,e=null),null!==(t=t.child)))for(gl(t,e,i),t=t.sibling;null!==t;)gl(t,e,i),t=t.sibling}function yl(t,e,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(4!==n&&(27===n&&fh(t.type)&&(i=t.stateNode),null!==(t=t.child)))for(yl(t,e,i),t=t.sibling;null!==t;)yl(t,e,i),t=t.sibling}function _l(t){var e=t.stateNode,i=t.memoizedProps;try{for(var n=t.type,o=e.attributes;o.length;)e.removeAttributeNode(o[0]);th(e,n,i),e[Bt]=t,e[Dt]=i}catch(r){cc(t,t.return,r)}}var vl=!1,xl=!1,bl=!1,Cl="function"===typeof WeakSet?WeakSet:Set,wl=null;function Sl(t,e,i){var n=i.flags;switch(i.tag){case 0:case 11:case 15:Ol(t,i),4&n&&sl(5,i);break;case 1:if(Ol(t,i),4&n)if(t=i.stateNode,null===e)try{t.componentDidMount()}catch(s){cc(i,i.return,s)}else{var o=ga(i.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(o,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){cc(i,i.return,a)}}64&n&&ll(i),512&n&&cl(i,i.return);break;case 3:if(Ol(t,i),64&n&&null!==(t=i.updateQueue)){if(e=null,null!==i.child)switch(i.child.tag){case 27:case 5:case 1:e=i.child.stateNode}try{fr(t,e)}catch(s){cc(i,i.return,s)}}break;case 27:null===e&&4&n&&_l(i);case 26:case 5:Ol(t,i),null===e&&4&n&&dl(i),512&n&&cl(i,i.return);break;case 12:Ol(t,i);break;case 13:Ol(t,i),4&n&&Pl(t,i),64&n&&(null!==(t=i.memoizedState)&&(null!==(t=t.dehydrated)&&function(t,e){var i=t.ownerDocument;if("$?"!==t.data||"complete"===i.readyState)e();else{var n=function(){e(),i.removeEventListener("DOMContentLoaded",n)};i.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}(t,i=pc.bind(null,i))));break;case 22:if(!(n=null!==i.memoizedState||vl)){e=null!==e&&null!==e.memoizedState||xl,o=vl;var r=xl;vl=n,(xl=e)&&!r?Fl(t,i,0!==(8772&i.subtreeFlags)):Ol(t,i),vl=o,xl=r}break;case 30:break;default:Ol(t,i)}}function Tl(t){var e=t.alternate;null!==e&&(t.alternate=null,Tl(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&Nt(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Al=null,Ml=!1;function Il(t,e,i){for(i=i.child;null!==i;)El(t,e,i),i=i.sibling}function El(t,e,i){if(ht&&"function"===typeof ht.onCommitFiberUnmount)try{ht.onCommitFiberUnmount(ct,i)}catch(r){}switch(i.tag){case 26:xl||hl(i,e),Il(t,e,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode).parentNode.removeChild(i);break;case 27:xl||hl(i,e);var n=Al,o=Ml;fh(i.type)&&(Al=i.stateNode,Ml=!1),Il(t,e,i),bh(i.stateNode),Al=n,Ml=o;break;case 5:xl||hl(i,e);case 6:if(n=Al,o=Ml,Al=null,Il(t,e,i),Ml=o,null!==(Al=n))if(Ml)try{(9===Al.nodeType?Al.body:"HTML"===Al.nodeName?Al.ownerDocument.body:Al).removeChild(i.stateNode)}catch(s){cc(i,e,s)}else try{Al.removeChild(i.stateNode)}catch(s){cc(i,e,s)}break;case 18:null!==Al&&(Ml?(ph(9===(t=Al).nodeType?t.body:"HTML"===t.nodeName?t.ownerDocument.body:t,i.stateNode),Md(t)):ph(Al,i.stateNode));break;case 4:n=Al,o=Ml,Al=i.stateNode.containerInfo,Ml=!0,Il(t,e,i),Al=n,Ml=o;break;case 0:case 11:case 14:case 15:xl||al(2,i,e),xl||al(4,i,e),Il(t,e,i);break;case 1:xl||(hl(i,e),"function"===typeof(n=i.stateNode).componentWillUnmount&&ul(i,e,n)),Il(t,e,i);break;case 21:Il(t,e,i);break;case 22:xl=(n=xl)||null!==i.memoizedState,Il(t,e,i),xl=n;break;default:Il(t,e,i)}}function Pl(t,e){if(null===e.memoizedState&&(null!==(t=e.alternate)&&(null!==(t=t.memoizedState)&&null!==(t=t.dehydrated))))try{Md(t)}catch(i){cc(e,e.return,i)}}function kl(t,e){var i=function(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return null===e&&(e=t.stateNode=new Cl),e;case 22:return null===(e=(t=t.stateNode)._retryCache)&&(e=t._retryCache=new Cl),e;default:throw Error(s(435,t.tag))}}(t);e.forEach((function(e){var n=mc.bind(null,t,e);i.has(e)||(i.add(e),e.then(n,n))}))}function Bl(t,e){var i=e.deletions;if(null!==i)for(var n=0;n<i.length;n++){var o=i[n],r=t,a=e,l=a;t:for(;null!==l;){switch(l.tag){case 27:if(fh(l.type)){Al=l.stateNode,Ml=!1;break t}break;case 5:Al=l.stateNode,Ml=!1;break t;case 3:case 4:Al=l.stateNode.containerInfo,Ml=!0;break t}l=l.return}if(null===Al)throw Error(s(160));El(r,a,o),Al=null,Ml=!1,null!==(r=o.alternate)&&(r.return=null),o.return=null}if(13878&e.subtreeFlags)for(e=e.child;null!==e;)Rl(e,t),e=e.sibling}var Dl=null;function Rl(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Bl(e,t),Ll(t),4&n&&(al(3,t,t.return),sl(3,t),al(5,t,t.return));break;case 1:Bl(e,t),Ll(t),512&n&&(xl||null===i||hl(i,i.return)),64&n&&vl&&(null!==(t=t.updateQueue)&&(null!==(n=t.callbacks)&&(i=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=null===i?n:i.concat(n))));break;case 26:var o=Dl;if(Bl(e,t),Ll(t),512&n&&(xl||null===i||hl(i,i.return)),4&n){var r=null!==i?i.memoizedState:null;if(n=t.memoizedState,null===i)if(null===n)if(null===t.stateNode){t:{n=t.type,i=t.memoizedProps,o=o.ownerDocument||o;e:switch(n){case"title":(!(r=o.getElementsByTagName("title")[0])||r[Ft]||r[Bt]||"http://www.w3.org/2000/svg"===r.namespaceURI||r.hasAttribute("itemprop"))&&(r=o.createElement(n),o.head.insertBefore(r,o.querySelector("head > title"))),th(r,n,i),r[Bt]=t,Wt(r),n=r;break t;case"link":var a=Fh("link","href",o).get(n+(i.href||""));if(a)for(var l=0;l<a.length;l++)if((r=a[l]).getAttribute("href")===(null==i.href||""===i.href?null:i.href)&&r.getAttribute("rel")===(null==i.rel?null:i.rel)&&r.getAttribute("title")===(null==i.title?null:i.title)&&r.getAttribute("crossorigin")===(null==i.crossOrigin?null:i.crossOrigin)){a.splice(l,1);break e}th(r=o.createElement(n),n,i),o.head.appendChild(r);break;case"meta":if(a=Fh("meta","content",o).get(n+(i.content||"")))for(l=0;l<a.length;l++)if((r=a[l]).getAttribute("content")===(null==i.content?null:""+i.content)&&r.getAttribute("name")===(null==i.name?null:i.name)&&r.getAttribute("property")===(null==i.property?null:i.property)&&r.getAttribute("http-equiv")===(null==i.httpEquiv?null:i.httpEquiv)&&r.getAttribute("charset")===(null==i.charSet?null:i.charSet)){a.splice(l,1);break e}th(r=o.createElement(n),n,i),o.head.appendChild(r);break;default:throw Error(s(468,n))}r[Bt]=t,Wt(r),n=r}t.stateNode=n}else Nh(o,t.type,t.stateNode);else t.stateNode=Rh(o,n,t.memoizedProps);else r!==n?(null===r?null!==i.stateNode&&(i=i.stateNode).parentNode.removeChild(i):r.count--,null===n?Nh(o,t.type,t.stateNode):Rh(o,n,t.memoizedProps)):null===n&&null!==t.stateNode&&fl(t,t.memoizedProps,i.memoizedProps)}break;case 27:Bl(e,t),Ll(t),512&n&&(xl||null===i||hl(i,i.return)),null!==i&&4&n&&fl(t,t.memoizedProps,i.memoizedProps);break;case 5:if(Bl(e,t),Ll(t),512&n&&(xl||null===i||hl(i,i.return)),32&t.flags){o=t.stateNode;try{Ce(o,"")}catch(p){cc(t,t.return,p)}}4&n&&null!=t.stateNode&&fl(t,o=t.memoizedProps,null!==i?i.memoizedProps:o),1024&n&&(bl=!0);break;case 6:if(Bl(e,t),Ll(t),4&n){if(null===t.stateNode)throw Error(s(162));n=t.memoizedProps,i=t.stateNode;try{i.nodeValue=n}catch(p){cc(t,t.return,p)}}break;case 3:if(Uh=null,o=Dl,Dl=Sh(e.containerInfo),Bl(e,t),Dl=o,Ll(t),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Md(e.containerInfo)}catch(p){cc(t,t.return,p)}bl&&(bl=!1,zl(t));break;case 4:n=Dl,Dl=Sh(t.stateNode.containerInfo),Bl(e,t),Ll(t),Dl=n;break;case 12:default:Bl(e,t),Ll(t);break;case 13:Bl(e,t),Ll(t),8192&t.child.flags&&null!==t.memoizedState!==(null!==i&&null!==i.memoizedState)&&(bu=et()),4&n&&(null!==(n=t.updateQueue)&&(t.updateQueue=null,kl(t,n)));break;case 22:o=null!==t.memoizedState;var u=null!==i&&null!==i.memoizedState,c=vl,h=xl;if(vl=c||o,xl=h||u,Bl(e,t),xl=h,vl=c,Ll(t),8192&n)t:for(e=t.stateNode,e._visibility=o?-2&e._visibility:1|e._visibility,o&&(null===i||u||vl||xl||Ul(t)),i=null,e=t;;){if(5===e.tag||26===e.tag){if(null===i){u=i=e;try{if(r=u.stateNode,o)"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=u.stateNode;var d=u.memoizedProps.style,f=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(p){cc(u,u.return,p)}}}else if(6===e.tag){if(null===i){u=e;try{u.stateNode.nodeValue=o?"":u.memoizedProps}catch(p){cc(u,u.return,p)}}}else if((22!==e.tag&&23!==e.tag||null===e.memoizedState||e===t)&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;null===e.sibling;){if(null===e.return||e.return===t)break t;i===e&&(i=null),e=e.return}i===e&&(i=null),e.sibling.return=e.return,e=e.sibling}4&n&&(null!==(n=t.updateQueue)&&(null!==(i=n.retryQueue)&&(n.retryQueue=null,kl(t,i))));break;case 19:Bl(e,t),Ll(t),4&n&&(null!==(n=t.updateQueue)&&(t.updateQueue=null,kl(t,n)));case 30:case 21:}}function Ll(t){var e=t.flags;if(2&e){try{for(var i,n=t.return;null!==n;){if(pl(n)){i=n;break}n=n.return}if(null==i)throw Error(s(160));switch(i.tag){case 27:var o=i.stateNode;yl(t,ml(t),o);break;case 5:var r=i.stateNode;32&i.flags&&(Ce(r,""),i.flags&=-33),yl(t,ml(t),r);break;case 3:case 4:var a=i.stateNode.containerInfo;gl(t,ml(t),a);break;default:throw Error(s(161))}}catch(l){cc(t,t.return,l)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function zl(t){if(1024&t.subtreeFlags)for(t=t.child;null!==t;){var e=t;zl(e),5===e.tag&&1024&e.flags&&e.stateNode.reset(),t=t.sibling}}function Ol(t,e){if(8772&e.subtreeFlags)for(e=e.child;null!==e;)Sl(t,e.alternate,e),e=e.sibling}function Ul(t){for(t=t.child;null!==t;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:al(4,e,e.return),Ul(e);break;case 1:hl(e,e.return);var i=e.stateNode;"function"===typeof i.componentWillUnmount&&ul(e,e.return,i),Ul(e);break;case 27:bh(e.stateNode);case 26:case 5:hl(e,e.return),Ul(e);break;case 22:null===e.memoizedState&&Ul(e);break;default:Ul(e)}t=t.sibling}}function Fl(t,e,i){for(i=i&&0!==(8772&e.subtreeFlags),e=e.child;null!==e;){var n=e.alternate,o=t,r=e,s=r.flags;switch(r.tag){case 0:case 11:case 15:Fl(o,r,i),sl(4,r);break;case 1:if(Fl(o,r,i),"function"===typeof(o=(n=r).stateNode).componentDidMount)try{o.componentDidMount()}catch(u){cc(n,n.return,u)}if(null!==(o=(n=r).updateQueue)){var a=n.stateNode;try{var l=o.shared.hiddenCallbacks;if(null!==l)for(o.shared.hiddenCallbacks=null,o=0;o<l.length;o++)dr(l[o],a)}catch(u){cc(n,n.return,u)}}i&&64&s&&ll(r),cl(r,r.return);break;case 27:_l(r);case 26:case 5:Fl(o,r,i),i&&null===n&&4&s&&dl(r),cl(r,r.return);break;case 12:Fl(o,r,i);break;case 13:Fl(o,r,i),i&&4&s&&Pl(o,r);break;case 22:null===r.memoizedState&&Fl(o,r,i),cl(r,r.return);break;case 30:break;default:Fl(o,r,i)}e=e.sibling}}function Nl(t,e){var i=null;null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),t=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(t=e.memoizedState.cachePool.pool),t!==i&&(null!=t&&t.refCount++,null!=i&&Lo(i))}function Vl(t,e){t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Lo(t))}function Hl(t,e,i,n){if(10256&e.subtreeFlags)for(e=e.child;null!==e;)jl(t,e,i,n),e=e.sibling}function jl(t,e,i,n){var o=e.flags;switch(e.tag){case 0:case 11:case 15:Hl(t,e,i,n),2048&o&&sl(9,e);break;case 1:case 13:default:Hl(t,e,i,n);break;case 3:Hl(t,e,i,n),2048&o&&(t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Lo(t)));break;case 12:if(2048&o){Hl(t,e,i,n),t=e.stateNode;try{var r=e.memoizedProps,s=r.id,a=r.onPostCommit;"function"===typeof a&&a(s,null===e.alternate?"mount":"update",t.passiveEffectDuration,-0)}catch(l){cc(e,e.return,l)}}else Hl(t,e,i,n);break;case 23:break;case 22:r=e.stateNode,s=e.alternate,null!==e.memoizedState?2&r._visibility?Hl(t,e,i,n):Wl(t,e):2&r._visibility?Hl(t,e,i,n):(r._visibility|=2,Gl(t,e,i,n,0!==(10256&e.subtreeFlags))),2048&o&&Nl(s,e);break;case 24:Hl(t,e,i,n),2048&o&&Vl(e.alternate,e)}}function Gl(t,e,i,n,o){for(o=o&&0!==(10256&e.subtreeFlags),e=e.child;null!==e;){var r=t,s=e,a=i,l=n,u=s.flags;switch(s.tag){case 0:case 11:case 15:Gl(r,s,a,l,o),sl(8,s);break;case 23:break;case 22:var c=s.stateNode;null!==s.memoizedState?2&c._visibility?Gl(r,s,a,l,o):Wl(r,s):(c._visibility|=2,Gl(r,s,a,l,o)),o&&2048&u&&Nl(s.alternate,s);break;case 24:Gl(r,s,a,l,o),o&&2048&u&&Vl(s.alternate,s);break;default:Gl(r,s,a,l,o)}e=e.sibling}}function Wl(t,e){if(10256&e.subtreeFlags)for(e=e.child;null!==e;){var i=t,n=e,o=n.flags;switch(n.tag){case 22:Wl(i,n),2048&o&&Nl(n.alternate,n);break;case 24:Wl(i,n),2048&o&&Vl(n.alternate,n);break;default:Wl(i,n)}e=e.sibling}}var ql=8192;function Zl(t){if(t.subtreeFlags&ql)for(t=t.child;null!==t;)$l(t),t=t.sibling}function $l(t){switch(t.tag){case 26:Zl(t),t.flags&ql&&null!==t.memoizedState&&function(t,e,i){if(null===Hh)throw Error(s(475));var n=Hh;if("stylesheet"===e.type&&("string"!==typeof i.media||!1!==matchMedia(i.media).matches)&&0===(4&e.state.loading)){if(null===e.instance){var o=Eh(i.href),r=t.querySelector(Ph(o));if(r)return null!==(t=r._p)&&"object"===typeof t&&"function"===typeof t.then&&(n.count++,n=Gh.bind(n),t.then(n,n)),e.state.loading|=4,e.instance=r,void Wt(r);r=t.ownerDocument||t,i=kh(i),(o=Ch.get(o))&&zh(i,o),Wt(r=r.createElement("link"));var a=r;a._p=new Promise((function(t,e){a.onload=t,a.onerror=e})),th(r,"link",i),e.instance=r}null===n.stylesheets&&(n.stylesheets=new Map),n.stylesheets.set(e,t),(t=e.state.preload)&&0===(3&e.state.loading)&&(n.count++,e=Gh.bind(n),t.addEventListener("load",e),t.addEventListener("error",e))}}(Dl,t.memoizedState,t.memoizedProps);break;case 5:default:Zl(t);break;case 3:case 4:var e=Dl;Dl=Sh(t.stateNode.containerInfo),Zl(t),Dl=e;break;case 22:null===t.memoizedState&&(null!==(e=t.alternate)&&null!==e.memoizedState?(e=ql,ql=16777216,Zl(t),ql=e):Zl(t))}}function Kl(t){var e=t.alternate;if(null!==e&&null!==(t=e.child)){e.child=null;do{e=t.sibling,t.sibling=null,t=e}while(null!==t)}}function Yl(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];wl=n,Ql(n,t)}Kl(t)}if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Jl(t),t=t.sibling}function Jl(t){switch(t.tag){case 0:case 11:case 15:Yl(t),2048&t.flags&&al(9,t,t.return);break;case 3:case 12:default:Yl(t);break;case 22:var e=t.stateNode;null!==t.memoizedState&&2&e._visibility&&(null===t.return||13!==t.return.tag)?(e._visibility&=-3,Xl(t)):Yl(t)}}function Xl(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];wl=n,Ql(n,t)}Kl(t)}for(t=t.child;null!==t;){switch((e=t).tag){case 0:case 11:case 15:al(8,e,e.return),Xl(e);break;case 22:2&(i=e.stateNode)._visibility&&(i._visibility&=-3,Xl(e));break;default:Xl(e)}t=t.sibling}}function Ql(t,e){for(;null!==wl;){var i=wl;switch(i.tag){case 0:case 11:case 15:al(8,i,e);break;case 23:case 22:if(null!==i.memoizedState&&null!==i.memoizedState.cachePool){var n=i.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Lo(i.memoizedState.cache)}if(null!==(n=i.child))n.return=i,wl=n;else t:for(i=t;null!==wl;){var o=(n=wl).sibling,r=n.return;if(Tl(n),n===i){wl=null;break t}if(null!==o){o.return=r,wl=o;break t}wl=r}}}var tu={getCacheForType:function(t){var e=Mo(Do),i=e.data.get(t);return void 0===i&&(i=t(),e.data.set(t,i)),i}},eu="function"===typeof WeakMap?WeakMap:Map,iu=0,nu=null,ou=null,ru=0,su=0,au=null,lu=!1,uu=!1,cu=!1,hu=0,du=0,fu=0,pu=0,mu=0,gu=0,yu=0,_u=null,vu=null,xu=!1,bu=0,Cu=1/0,wu=null,Su=null,Tu=0,Au=null,Mu=null,Iu=0,Eu=0,Pu=null,ku=null,Bu=0,Du=null;function Ru(){if(0!==(2&iu)&&0!==ru)return ru&-ru;if(null!==R.T){return 0!==Uo?Uo:Ec()}return Pt()}function Lu(){0===gu&&(gu=0===(536870912&ru)||ro?Ct():536870912);var t=oa.current;return null!==t&&(t.flags|=32),gu}function zu(t,e,i){(t!==nu||2!==su&&9!==su)&&null===t.cancelPendingCommit||(ju(t,0),Nu(t,ru,gu,!1)),Tt(t,i),0!==(2&iu)&&t===nu||(t===nu&&(0===(2&iu)&&(pu|=i),4===du&&Nu(t,ru,gu,!1)),Cc(t))}function Ou(t,e,i){if(0!==(6&iu))throw Error(s(327));for(var n=!i&&0===(124&e)&&0===(e&t.expiredLanes)||xt(t,e),o=n?function(t,e){var i=iu;iu|=2;var n=Wu(),o=qu();nu!==t||ru!==e?(wu=null,Cu=et()+500,ju(t,e)):uu=xt(t,e);t:for(;;)try{if(0!==su&&null!==ou){e=ou;var r=au;e:switch(su){case 1:su=0,au=null,Qu(t,e,r,1);break;case 2:case 9:if(Yo(r)){su=0,au=null,Xu(e);break}e=function(){2!==su&&9!==su||nu!==t||(su=7),Cc(t)},r.then(e,e);break t;case 3:su=7;break t;case 4:su=5;break t;case 7:Yo(r)?(su=0,au=null,Xu(e)):(su=0,au=null,Qu(t,e,r,7));break;case 5:var a=null;switch(ou.tag){case 26:a=ou.memoizedState;case 5:case 27:var l=ou;if(!a||Vh(a)){su=0,au=null;var u=l.sibling;if(null!==u)ou=u;else{var c=l.return;null!==c?(ou=c,tc(c)):ou=null}break e}}su=0,au=null,Qu(t,e,r,5);break;case 6:su=0,au=null,Qu(t,e,r,6);break;case 8:Hu(),du=6;break t;default:throw Error(s(462))}}Yu();break}catch(h){Gu(t,h)}return vo=_o=null,R.H=n,R.A=o,iu=i,null!==ou?0:(nu=null,ru=0,In(),du)}(t,e):$u(t,e,!0),r=n;;){if(0===o){uu&&!n&&Nu(t,e,0,!1);break}if(i=t.current.alternate,!r||Fu(i)){if(2===o){if(r=e,t.errorRecoveryDisabledLanes&r)var a=0;else a=0!==(a=-536870913&t.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){e=a;t:{var l=t;o=_u;var u=l.current.memoizedState.isDehydrated;if(u&&(ju(l,a).flags|=256),2!==(a=$u(l,a,!1))){if(cu&&!u){l.errorRecoveryDisabledLanes|=r,pu|=r,o=4;break t}r=vu,vu=o,null!==r&&(null===vu?vu=r:vu.push.apply(vu,r))}o=a}if(r=!1,2!==o)continue}}if(1===o){ju(t,0),Nu(t,e,0,!0);break}t:{switch(n=t,r=o){case 0:case 1:throw Error(s(345));case 4:if((4194048&e)!==e)break;case 6:Nu(n,e,gu,!lu);break t;case 2:vu=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&e)===e&&10<(o=bu+300-et())){if(Nu(n,e,gu,!lu),0!==vt(n,0,!0))break t;n.timeoutHandle=lh(Uu.bind(null,n,i,vu,wu,xu,e,gu,pu,yu,lu,r,2,-0,0),o)}else Uu(n,i,vu,wu,xu,e,gu,pu,yu,lu,r,0,-0,0)}break}o=$u(t,e,!1),r=!1}Cc(t)}function Uu(t,e,i,n,o,r,a,l,u,c,h,d,f,p){if(t.timeoutHandle=-1,(8192&(d=e.subtreeFlags)||16785408===(16785408&d))&&(Hh={stylesheets:null,count:0,unsuspend:jh},$l(e),null!==(d=function(){if(null===Hh)throw Error(s(475));var t=Hh;return t.stylesheets&&0===t.count&&qh(t,t.stylesheets),0<t.count?function(e){var i=setTimeout((function(){if(t.stylesheets&&qh(t,t.stylesheets),t.unsuspend){var e=t.unsuspend;t.unsuspend=null,e()}}),6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(i)}}:null}())))return t.cancelPendingCommit=d(ic.bind(null,t,e,r,i,n,o,a,l,u,h,1,f,p)),void Nu(t,r,a,!c);ic(t,e,r,i,n,o,a,l,u)}function Fu(t){for(var e=t;;){var i=e.tag;if((0===i||11===i||15===i)&&16384&e.flags&&(null!==(i=e.updateQueue)&&null!==(i=i.stores)))for(var n=0;n<i.length;n++){var o=i[n],r=o.getSnapshot;o=o.value;try{if(!$i(r(),o))return!1}catch(s){return!1}}if(i=e.child,16384&e.subtreeFlags&&null!==i)i.return=e,e=i;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Nu(t,e,i,n){e&=~mu,e&=~pu,t.suspendedLanes|=e,t.pingedLanes&=~e,n&&(t.warmLanes|=e),n=t.expirationTimes;for(var o=e;0<o;){var r=31-ft(o),s=1<<r;n[r]=-1,o&=~s}0!==i&&At(t,i,e)}function Vu(){return 0!==(6&iu)||(wc(0,!1),!1)}function Hu(){if(null!==ou){if(0===su)var t=ou.return;else vo=_o=null,Ur(t=ou),Ks=null,Ys=0,t=ou;for(;null!==t;)rl(t.alternate,t),t=t.return;ou=null}}function ju(t,e){var i=t.timeoutHandle;-1!==i&&(t.timeoutHandle=-1,uh(i)),null!==(i=t.cancelPendingCommit)&&(t.cancelPendingCommit=null,i()),Hu(),nu=t,ou=i=Un(t.current,null),ru=e,su=0,au=null,lu=!1,uu=xt(t,e),cu=!1,yu=gu=mu=pu=fu=du=0,vu=_u=null,xu=!1,0!==(8&e)&&(e|=32&e);var n=t.entangledLanes;if(0!==n)for(t=t.entanglements,n&=e;0<n;){var o=31-ft(n),r=1<<o;e|=t[o],n&=~r}return hu=e,In(),i}function Gu(t,e){xr=null,R.H=Ws,e===qo||e===$o?(e=tr(),su=3):e===Zo?(e=tr(),su=4):su=e===Aa?8:null!==e&&"object"===typeof e&&"function"===typeof e.then?6:1,au=e,null===ou&&(du=1,ba(t,Sn(e,t.current)))}function Wu(){var t=R.H;return R.H=Ws,null===t?Ws:t}function qu(){var t=R.A;return R.A=tu,t}function Zu(){du=4,lu||(4194048&ru)!==ru&&null!==oa.current||(uu=!0),0===(134217727&fu)&&0===(134217727&pu)||null===nu||Nu(nu,ru,gu,!1)}function $u(t,e,i){var n=iu;iu|=2;var o=Wu(),r=qu();nu===t&&ru===e||(wu=null,ju(t,e)),e=!1;var s=du;t:for(;;)try{if(0!==su&&null!==ou){var a=ou,l=au;switch(su){case 8:Hu(),s=6;break t;case 3:case 2:case 9:case 6:null===oa.current&&(e=!0);var u=su;if(su=0,au=null,Qu(t,a,l,u),i&&uu){s=0;break t}break;default:u=su,su=0,au=null,Qu(t,a,l,u)}}Ku(),s=du;break}catch(c){Gu(t,c)}return e&&t.shellSuspendCounter++,vo=_o=null,iu=n,R.H=o,R.A=r,null===ou&&(nu=null,ru=0,In()),s}function Ku(){for(;null!==ou;)Ju(ou)}function Yu(){for(;null!==ou&&!Q();)Ju(ou)}function Ju(t){var e=Ja(t.alternate,t,hu);t.memoizedProps=t.pendingProps,null===e?tc(t):ou=e}function Xu(t){var e=t,i=e.alternate;switch(e.tag){case 15:case 0:e=za(i,e,e.pendingProps,e.type,void 0,ru);break;case 11:e=za(i,e,e.pendingProps,e.type.render,e.ref,ru);break;case 5:Ur(e);default:rl(i,e),e=Ja(i,e=ou=Fn(e,hu),hu)}t.memoizedProps=t.pendingProps,null===e?tc(t):ou=e}function Qu(t,e,i,n){vo=_o=null,Ur(e),Ks=null,Ys=0;var o=e.return;try{if(function(t,e,i,n,o){if(i.flags|=32768,null!==n&&"object"===typeof n&&"function"===typeof n.then){if(null!==(e=i.alternate)&&So(e,i,o,!0),null!==(i=oa.current)){switch(i.tag){case 13:return null===ra?Zu():null===i.alternate&&0===du&&(du=3),i.flags&=-257,i.flags|=65536,i.lanes=o,n===Ko?i.flags|=16384:(null===(e=i.updateQueue)?i.updateQueue=new Set([n]):e.add(n),hc(t,n,o)),!1;case 22:return i.flags|=65536,n===Ko?i.flags|=16384:(null===(e=i.updateQueue)?(e={transitions:null,markerInstances:null,retryQueue:new Set([n])},i.updateQueue=e):null===(i=e.retryQueue)?e.retryQueue=new Set([n]):i.add(n),hc(t,n,o)),!1}throw Error(s(435,i.tag))}return hc(t,n,o),Zu(),!1}if(ro)return null!==(e=oa.current)?(0===(65536&e.flags)&&(e.flags|=256),e.flags|=65536,e.lanes=o,n!==lo&&go(Sn(t=Error(s(422),{cause:n}),i))):(n!==lo&&go(Sn(e=Error(s(423),{cause:n}),i)),(t=t.current.alternate).flags|=65536,o&=-o,t.lanes|=o,n=Sn(n,i),lr(t,o=wa(t.stateNode,n,o)),4!==du&&(du=2)),!1;var r=Error(s(520),{cause:n});if(r=Sn(r,i),null===_u?_u=[r]:_u.push(r),4!==du&&(du=2),null===e)return!0;n=Sn(n,i),i=e;do{switch(i.tag){case 3:return i.flags|=65536,t=o&-o,i.lanes|=t,lr(i,t=wa(i.stateNode,n,t)),!1;case 1:if(e=i.type,r=i.stateNode,0===(128&i.flags)&&("function"===typeof e.getDerivedStateFromError||null!==r&&"function"===typeof r.componentDidCatch&&(null===Su||!Su.has(r))))return i.flags|=65536,o&=-o,i.lanes|=o,Ta(o=Sa(o),t,i,n),lr(i,o),!1}i=i.return}while(null!==i);return!1}(t,o,e,i,ru))return du=1,ba(t,Sn(i,t.current)),void(ou=null)}catch(r){if(null!==o)throw ou=o,r;return du=1,ba(t,Sn(i,t.current)),void(ou=null)}32768&e.flags?(ro||1===n?t=!0:uu||0!==(536870912&ru)?t=!1:(lu=t=!0,(2===n||9===n||3===n||6===n)&&(null!==(n=oa.current)&&13===n.tag&&(n.flags|=16384))),ec(e,t)):tc(e)}function tc(t){var e=t;do{if(0!==(32768&e.flags))return void ec(e,lu);t=e.return;var i=nl(e.alternate,e,hu);if(null!==i)return void(ou=i);if(null!==(e=e.sibling))return void(ou=e);ou=e=t}while(null!==e);0===du&&(du=5)}function ec(t,e){do{var i=ol(t.alternate,t);if(null!==i)return i.flags&=32767,void(ou=i);if(null!==(i=t.return)&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!e&&null!==(t=t.sibling))return void(ou=t);ou=t=i}while(null!==t);du=6,ou=null}function ic(t,e,i,n,o,r,a,l,u){t.cancelPendingCommit=null;do{ac()}while(0!==Tu);if(0!==(6&iu))throw Error(s(327));if(null!==e){if(e===t.current)throw Error(s(177));if(r=e.lanes|e.childLanes,function(t,e,i,n,o,r){var s=t.pendingLanes;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=i,t.entangledLanes&=i,t.errorRecoveryDisabledLanes&=i,t.shellSuspendCounter=0;var a=t.entanglements,l=t.expirationTimes,u=t.hiddenUpdates;for(i=s&~i;0<i;){var c=31-ft(i),h=1<<c;a[c]=0,l[c]=-1;var d=u[c];if(null!==d)for(u[c]=null,c=0;c<d.length;c++){var f=d[c];null!==f&&(f.lane&=-536870913)}i&=~h}0!==n&&At(t,n,0),0!==r&&0===o&&0!==t.tag&&(t.suspendedLanes|=r&~(s&~e))}(t,i,r|=Mn,a,l,u),t===nu&&(ou=nu=null,ru=0),Mu=e,Au=t,Iu=i,Eu=r,Pu=o,ku=n,0!==(10256&e.subtreeFlags)||0!==(10256&e.flags)?(t.callbackNode=null,t.callbackPriority=0,J(rt,(function(){return lc(),null}))):(t.callbackNode=null,t.callbackPriority=0),n=0!==(13878&e.flags),0!==(13878&e.subtreeFlags)||n){n=R.T,R.T=null,o=L.p,L.p=2,a=iu,iu|=4;try{!function(t,e){if(t=t.containerInfo,eh=id,tn(t=Qi(t))){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else t:{var n=(i=(i=t.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var o=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{i.nodeType,r.nodeType}catch(g){i=null;break t}var a=0,l=-1,u=-1,c=0,h=0,d=t,f=null;e:for(;;){for(var p;d!==i||0!==o&&3!==d.nodeType||(l=a+o),d!==r||0!==n&&3!==d.nodeType||(u=a+n),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===t)break e;if(f===i&&++c===o&&(l=a),f===r&&++h===n&&(u=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}i=-1===l||-1===u?null:{start:l,end:u}}else i=null}i=i||{start:0,end:0}}else i=null;for(ih={focusedElem:t,selectionRange:i},id=!1,wl=e;null!==wl;)if(t=(e=wl).child,0!==(1024&e.subtreeFlags)&&null!==t)t.return=e,wl=t;else for(;null!==wl;){switch(r=(e=wl).alternate,t=e.flags,e.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&t)&&null!==r){t=void 0,i=e,o=r.memoizedProps,r=r.memoizedState,n=i.stateNode;try{var m=ga(i.type,o,(i.elementType,i.type));t=n.getSnapshotBeforeUpdate(m,r),n.__reactInternalSnapshotBeforeUpdate=t}catch(y){cc(i,i.return,y)}}break;case 3:if(0!==(1024&t))if(9===(i=(t=e.stateNode.containerInfo).nodeType))mh(t);else if(1===i)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":mh(t);break;default:t.textContent=""}break;default:if(0!==(1024&t))throw Error(s(163))}if(null!==(t=e.sibling)){t.return=e.return,wl=t;break}wl=e.return}}(t,e)}finally{iu=a,L.p=o,R.T=n}}Tu=1,nc(),oc(),rc()}}function nc(){if(1===Tu){Tu=0;var t=Au,e=Mu,i=0!==(13878&e.flags);if(0!==(13878&e.subtreeFlags)||i){i=R.T,R.T=null;var n=L.p;L.p=2;var o=iu;iu|=4;try{Rl(e,t);var r=ih,s=Qi(t.containerInfo),a=r.focusedElem,l=r.selectionRange;if(s!==a&&a&&a.ownerDocument&&Xi(a.ownerDocument.documentElement,a)){if(null!==l&&tn(a)){var u=l.start,c=l.end;if(void 0===c&&(c=u),"selectionStart"in a)a.selectionStart=u,a.selectionEnd=Math.min(c,a.value.length);else{var h=a.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=a.textContent.length,m=Math.min(l.start,p),g=void 0===l.end?m:Math.min(l.end,p);!f.extend&&m>g&&(s=g,g=m,m=s);var y=Ji(a,m),_=Ji(a,g);if(y&&_&&(1!==f.rangeCount||f.anchorNode!==y.node||f.anchorOffset!==y.offset||f.focusNode!==_.node||f.focusOffset!==_.offset)){var v=h.createRange();v.setStart(y.node,y.offset),f.removeAllRanges(),m>g?(f.addRange(v),f.extend(_.node,_.offset)):(v.setEnd(_.node,_.offset),f.addRange(v))}}}}for(h=[],f=a;f=f.parentNode;)1===f.nodeType&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<h.length;a++){var x=h[a];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}id=!!eh,ih=eh=null}finally{iu=o,L.p=n,R.T=i}}t.current=e,Tu=2}}function oc(){if(2===Tu){Tu=0;var t=Au,e=Mu,i=0!==(8772&e.flags);if(0!==(8772&e.subtreeFlags)||i){i=R.T,R.T=null;var n=L.p;L.p=2;var o=iu;iu|=4;try{Sl(t,e.alternate,e)}finally{iu=o,L.p=n,R.T=i}}Tu=3}}function rc(){if(4===Tu||3===Tu){Tu=0,tt();var t=Au,e=Mu,i=Iu,n=ku;0!==(10256&e.subtreeFlags)||0!==(10256&e.flags)?Tu=5:(Tu=0,Mu=Au=null,sc(t,t.pendingLanes));var o=t.pendingLanes;if(0===o&&(Su=null),Et(i),e=e.stateNode,ht&&"function"===typeof ht.onCommitFiberRoot)try{ht.onCommitFiberRoot(ct,e,void 0,128===(128&e.current.flags))}catch(l){}if(null!==n){e=R.T,o=L.p,L.p=2,R.T=null;try{for(var r=t.onRecoverableError,s=0;s<n.length;s++){var a=n[s];r(a.value,{componentStack:a.stack})}}finally{R.T=e,L.p=o}}0!==(3&Iu)&&ac(),Cc(t),o=t.pendingLanes,0!==(4194090&i)&&0!==(42&o)?t===Du?Bu++:(Bu=0,Du=t):Bu=0,wc(0,!1)}}function sc(t,e){0===(t.pooledCacheLanes&=e)&&(null!=(e=t.pooledCache)&&(t.pooledCache=null,Lo(e)))}function ac(t){return nc(),oc(),rc(),lc()}function lc(){if(5!==Tu)return!1;var t=Au,e=Eu;Eu=0;var i=Et(Iu),n=R.T,o=L.p;try{L.p=32>i?32:i,R.T=null,i=Pu,Pu=null;var r=Au,a=Iu;if(Tu=0,Mu=Au=null,Iu=0,0!==(6&iu))throw Error(s(331));var l=iu;if(iu|=4,Jl(r.current),jl(r,r.current,a,i),iu=l,wc(0,!1),ht&&"function"===typeof ht.onPostCommitFiberRoot)try{ht.onPostCommitFiberRoot(ct,r)}catch(u){}return!0}finally{L.p=o,R.T=n,sc(t,e)}}function uc(t,e,i){e=Sn(i,e),null!==(t=sr(t,e=wa(t.stateNode,e,2),2))&&(Tt(t,2),Cc(t))}function cc(t,e,i){if(3===t.tag)uc(t,t,i);else for(;null!==e;){if(3===e.tag){uc(e,t,i);break}if(1===e.tag){var n=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Su||!Su.has(n))){t=Sn(i,t),null!==(n=sr(e,i=Sa(2),2))&&(Ta(i,n,e,t),Tt(n,2),Cc(n));break}}e=e.return}}function hc(t,e,i){var n=t.pingCache;if(null===n){n=t.pingCache=new eu;var o=new Set;n.set(e,o)}else void 0===(o=n.get(e))&&(o=new Set,n.set(e,o));o.has(i)||(cu=!0,o.add(i),t=dc.bind(null,t,e,i),e.then(t,t))}function dc(t,e,i){var n=t.pingCache;null!==n&&n.delete(e),t.pingedLanes|=t.suspendedLanes&i,t.warmLanes&=~i,nu===t&&(ru&i)===i&&(4===du||3===du&&(62914560&ru)===ru&&300>et()-bu?0===(2&iu)&&ju(t,0):mu|=i,yu===ru&&(yu=0)),Cc(t)}function fc(t,e){0===e&&(e=wt()),null!==(t=kn(t,e))&&(Tt(t,e),Cc(t))}function pc(t){var e=t.memoizedState,i=0;null!==e&&(i=e.retryLane),fc(t,i)}function mc(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,o=t.memoizedState;null!==o&&(i=o.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(s(314))}null!==n&&n.delete(e),fc(t,i)}var gc=null,yc=null,_c=!1,vc=!1,xc=!1,bc=0;function Cc(t){t!==yc&&null===t.next&&(null===yc?gc=yc=t:yc=yc.next=t),vc=!0,_c||(_c=!0,hh((function(){0!==(6&iu)?J(nt,Sc):Tc()})))}function wc(t,e){if(!xc&&vc){xc=!0;do{for(var i=!1,n=gc;null!==n;){if(!e)if(0!==t){var o=n.pendingLanes;if(0===o)var r=0;else{var s=n.suspendedLanes,a=n.pingedLanes;r=(1<<31-ft(42|t)+1)-1,r=201326741&(r&=o&~(s&~a))?201326741&r|1:r?2|r:0}0!==r&&(i=!0,Ic(n,r))}else r=ru,0===(3&(r=vt(n,n===nu?r:0,null!==n.cancelPendingCommit||-1!==n.timeoutHandle)))||xt(n,r)||(i=!0,Ic(n,r));n=n.next}}while(i);xc=!1}}function Sc(){Tc()}function Tc(){vc=_c=!1;var t=0;0!==bc&&(function(){var t=window.event;if(t&&"popstate"===t.type)return t!==ah&&(ah=t,!0);return ah=null,!1}()&&(t=bc),bc=0);for(var e=et(),i=null,n=gc;null!==n;){var o=n.next,r=Ac(n,e);0===r?(n.next=null,null===i?gc=o:i.next=o,null===o&&(yc=i)):(i=n,(0!==t||0!==(3&r))&&(vc=!0)),n=o}wc(t,!1)}function Ac(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,r=-62914561&t.pendingLanes;0<r;){var s=31-ft(r),a=1<<s,l=o[s];-1===l?0!==(a&i)&&0===(a&n)||(o[s]=bt(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}if(i=ru,i=vt(t,t===(e=nu)?i:0,null!==t.cancelPendingCommit||-1!==t.timeoutHandle),n=t.callbackNode,0===i||t===e&&(2===su||9===su)||null!==t.cancelPendingCommit)return null!==n&&null!==n&&X(n),t.callbackNode=null,t.callbackPriority=0;if(0===(3&i)||xt(t,i)){if((e=i&-i)===t.callbackPriority)return e;switch(null!==n&&X(n),Et(i)){case 2:case 8:i=ot;break;case 32:default:i=rt;break;case 268435456:i=at}return n=Mc.bind(null,t),i=J(i,n),t.callbackPriority=e,t.callbackNode=i,e}return null!==n&&null!==n&&X(n),t.callbackPriority=2,t.callbackNode=null,2}function Mc(t,e){if(0!==Tu&&5!==Tu)return t.callbackNode=null,t.callbackPriority=0,null;var i=t.callbackNode;if(ac()&&t.callbackNode!==i)return null;var n=ru;return 0===(n=vt(t,t===nu?n:0,null!==t.cancelPendingCommit||-1!==t.timeoutHandle))?null:(Ou(t,n,e),Ac(t,et()),null!=t.callbackNode&&t.callbackNode===i?Mc.bind(null,t):null)}function Ic(t,e){if(ac())return null;Ou(t,e,!0)}function Ec(){return 0===bc&&(bc=Ct()),bc}function Pc(t){return null==t||"symbol"===typeof t||"boolean"===typeof t?null:"function"===typeof t?t:Ee(""+t)}function kc(t,e){var i=e.ownerDocument.createElement("input");return i.name=e.name,i.value=e.value,t.id&&i.setAttribute("form",t.id),e.parentNode.insertBefore(i,e),t=new FormData(t),i.parentNode.removeChild(i),t}for(var Bc=0;Bc<bn.length;Bc++){var Dc=bn[Bc];Cn(Dc.toLowerCase(),"on"+(Dc[0].toUpperCase()+Dc.slice(1)))}Cn(fn,"onAnimationEnd"),Cn(pn,"onAnimationIteration"),Cn(mn,"onAnimationStart"),Cn("dblclick","onDoubleClick"),Cn("focusin","onFocus"),Cn("focusout","onBlur"),Cn(gn,"onTransitionRun"),Cn(yn,"onTransitionStart"),Cn(_n,"onTransitionCancel"),Cn(vn,"onTransitionEnd"),Kt("onMouseEnter",["mouseout","mouseover"]),Kt("onMouseLeave",["mouseout","mouseover"]),Kt("onPointerEnter",["pointerout","pointerover"]),Kt("onPointerLeave",["pointerout","pointerover"]),$t("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$t("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$t("onBeforeInput",["compositionend","keypress","textInput","paste"]),$t("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$t("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$t("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lc=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rc));function zc(t,e){e=0!==(4&e);for(var i=0;i<t.length;i++){var n=t[i],o=n.event;n=n.listeners;t:{var r=void 0;if(e)for(var s=n.length-1;0<=s;s--){var a=n[s],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==r&&o.isPropagationStopped())break t;r=a,o.currentTarget=u;try{r(o)}catch(c){ya(c)}o.currentTarget=null,r=l}else for(s=0;s<n.length;s++){if(l=(a=n[s]).instance,u=a.currentTarget,a=a.listener,l!==r&&o.isPropagationStopped())break t;r=a,o.currentTarget=u;try{r(o)}catch(c){ya(c)}o.currentTarget=null,r=l}}}}function Oc(t,e){var i=e[Lt];void 0===i&&(i=e[Lt]=new Set);var n=t+"__bubble";i.has(n)||(Vc(e,t,2,!1),i.add(n))}function Uc(t,e,i){var n=0;e&&(n|=4),Vc(i,t,n,e)}var Fc="_reactListening"+Math.random().toString(36).slice(2);function Nc(t){if(!t[Fc]){t[Fc]=!0,qt.forEach((function(e){"selectionchange"!==e&&(Lc.has(e)||Uc(e,!1,t),Uc(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[Fc]||(e[Fc]=!0,Uc("selectionchange",!1,e))}}function Vc(t,e,i,n){switch(ud(e)){case 2:var o=nd;break;case 8:o=od;break;default:o=rd}i=o.bind(null,e,i,t),o=void 0,!Fe||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(o=!0),n?void 0!==o?t.addEventListener(e,i,{capture:!0,passive:o}):t.addEventListener(e,i,!0):void 0!==o?t.addEventListener(e,i,{passive:o}):t.addEventListener(e,i,!1)}function Hc(t,e,i,n,o){var r=n;if(0===(1&e)&&0===(2&e)&&null!==n)t:for(;;){if(null===n)return;var s=n.tag;if(3===s||4===s){var a=n.stateNode.containerInfo;if(a===o)break;if(4===s)for(s=n.return;null!==s;){var u=s.tag;if((3===u||4===u)&&s.stateNode.containerInfo===o)return;s=s.return}for(;null!==a;){if(null===(s=Vt(a)))return;if(5===(u=s.tag)||6===u||26===u||27===u){n=r=s;continue t}a=a.parentNode}}n=n.return}ze((function(){var n=r,o=ke(i),s=[];t:{var a=xn.get(t);if(void 0!==a){var u=Qe,c=t;switch(t){case"keypress":if(0===We(i))break t;case"keydown":case"keyup":u=pi;break;case"focusin":c="focus",u=ri;break;case"focusout":c="blur",u=ri;break;case"beforeblur":case"afterblur":u=ri;break;case"click":if(2===i.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=ni;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=oi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=gi;break;case fn:case pn:case mn:u=si;break;case vn:u=yi;break;case"scroll":case"scrollend":u=ei;break;case"wheel":u=_i;break;case"copy":case"cut":case"paste":u=ai;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=mi;break;case"toggle":case"beforetoggle":u=vi}var h=0!==(4&e),d=!h&&("scroll"===t||"scrollend"===t),f=h?null!==a?a+"Capture":null:a;h=[];for(var p,m=n;null!==m;){var g=m;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===f||null!=(g=Oe(m,f))&&h.push(jc(m,g,p)),d)break;m=m.return}0<h.length&&(a=new u(a,c,null,i,o),s.push({event:a,listeners:h}))}}if(0===(7&e)){if(u="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||i===Pe||!(c=i.relatedTarget||i.fromElement)||!Vt(c)&&!c[Rt])&&(u||a)&&(a=o.window===o?o:(a=o.ownerDocument)?a.defaultView||a.parentWindow:window,u?(u=n,null!==(c=(c=i.relatedTarget||i.toElement)?Vt(c):null)&&(d=l(c),h=c.tag,c!==d||5!==h&&27!==h&&6!==h)&&(c=null)):(u=null,c=n),u!==c)){if(h=ni,g="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==t&&"pointerover"!==t||(h=mi,g="onPointerLeave",f="onPointerEnter",m="pointer"),d=null==u?a:jt(u),p=null==c?a:jt(c),(a=new h(g,m+"leave",u,i,o)).target=d,a.relatedTarget=p,g=null,Vt(o)===n&&((h=new h(f,m+"enter",c,i,o)).target=p,h.relatedTarget=d,g=h),d=g,u&&c)t:{for(f=c,m=0,p=h=u;p;p=Wc(p))m++;for(p=0,g=f;g;g=Wc(g))p++;for(;0<m-p;)h=Wc(h),m--;for(;0<p-m;)f=Wc(f),p--;for(;m--;){if(h===f||null!==f&&h===f.alternate)break t;h=Wc(h),f=Wc(f)}h=null}else h=null;null!==u&&qc(s,a,u,h,!1),null!==c&&null!==d&&qc(s,d,c,h,!0)}if("select"===(u=(a=n?jt(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===u&&"file"===a.type)var y=Oi;else if(ki(a))if(Ui)y=Zi;else{y=Wi;var _=Gi}else!(u=a.nodeName)||"input"!==u.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?n&&Ae(n.elementType)&&(y=Oi):y=qi;switch(y&&(y=y(t,n))?Bi(s,y,i,o):(_&&_(t,a,n),"focusout"===t&&n&&"number"===a.type&&null!=n.memoizedProps.value&&_e(a,"number",a.value)),_=n?jt(n):window,t){case"focusin":(ki(_)||"true"===_.contentEditable)&&(nn=_,on=n,rn=null);break;case"focusout":rn=on=nn=null;break;case"mousedown":sn=!0;break;case"contextmenu":case"mouseup":case"dragend":sn=!1,an(s,i,o);break;case"selectionchange":if(en)break;case"keydown":case"keyup":an(s,i,o)}var v;if(bi)t:{switch(t){case"compositionstart":var x="onCompositionStart";break t;case"compositionend":x="onCompositionEnd";break t;case"compositionupdate":x="onCompositionUpdate";break t}x=void 0}else Ei?Mi(t,i)&&(x="onCompositionEnd"):"keydown"===t&&229===i.keyCode&&(x="onCompositionStart");x&&(Si&&"ko"!==i.locale&&(Ei||"onCompositionStart"!==x?"onCompositionEnd"===x&&Ei&&(v=Ge()):(He="value"in(Ve=o)?Ve.value:Ve.textContent,Ei=!0)),0<(_=Gc(n,x)).length&&(x=new li(x,t,null,i,o),s.push({event:x,listeners:_}),v?x.data=v:null!==(v=Ii(i))&&(x.data=v))),(v=wi?function(t,e){switch(t){case"compositionend":return Ii(e);case"keypress":return 32!==e.which?null:(Ai=!0,Ti);case"textInput":return(t=e.data)===Ti&&Ai?null:t;default:return null}}(t,i):function(t,e){if(Ei)return"compositionend"===t||!bi&&Mi(t,e)?(t=Ge(),je=He=Ve=null,Ei=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Si&&"ko"!==e.locale?null:e.data}}(t,i))&&(0<(x=Gc(n,"onBeforeInput")).length&&(_=new li("onBeforeInput","beforeinput",null,i,o),s.push({event:_,listeners:x}),_.data=v)),function(t,e,i,n,o){if("submit"===e&&i&&i.stateNode===o){var r=Pc((o[Dt]||null).action),s=n.submitter;s&&null!==(e=(e=s[Dt]||null)?Pc(e.formAction):s.getAttribute("formAction"))&&(r=e,s=null);var a=new Qe("action","action",null,n,o);t.push({event:a,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==bc){var t=s?kc(o,s):new FormData(o);ks(i,{pending:!0,data:t,method:o.method,action:r},null,t)}}else"function"===typeof r&&(a.preventDefault(),t=s?kc(o,s):new FormData(o),ks(i,{pending:!0,data:t,method:o.method,action:r},r,t))},currentTarget:o}]})}}(s,t,n,i,o)}zc(s,e)}))}function jc(t,e,i){return{instance:t,listener:e,currentTarget:i}}function Gc(t,e){for(var i=e+"Capture",n=[];null!==t;){var o=t,r=o.stateNode;if(5!==(o=o.tag)&&26!==o&&27!==o||null===r||(null!=(o=Oe(t,i))&&n.unshift(jc(t,o,r)),null!=(o=Oe(t,e))&&n.push(jc(t,o,r))),3===t.tag)return n;t=t.return}return[]}function Wc(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag&&27!==t.tag);return t||null}function qc(t,e,i,n,o){for(var r=e._reactName,s=[];null!==i&&i!==n;){var a=i,l=a.alternate,u=a.stateNode;if(a=a.tag,null!==l&&l===n)break;5!==a&&26!==a&&27!==a||null===u||(l=u,o?null!=(u=Oe(i,r))&&s.unshift(jc(i,u,l)):o||null!=(u=Oe(i,r))&&s.push(jc(i,u,l))),i=i.return}0!==s.length&&t.push({event:e,listeners:s})}var Zc=/\r\n?/g,$c=/\u0000|\uFFFD/g;function Kc(t){return("string"===typeof t?t:""+t).replace(Zc,"\n").replace($c,"")}function Yc(t,e){return e=Kc(e),Kc(t)===e}function Jc(){}function Xc(t,e,i,n,o,r){switch(i){case"children":"string"===typeof n?"body"===e||"textarea"===e&&""===n||Ce(t,n):("number"===typeof n||"bigint"===typeof n)&&"body"!==e&&Ce(t,""+n);break;case"className":ie(t,"class",n);break;case"tabIndex":ie(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ie(t,i,n);break;case"style":Te(t,n,r);break;case"data":if("object"!==e){ie(t,"data",n);break}case"src":case"href":if(""===n&&("a"!==e||"href"!==i)){t.removeAttribute(i);break}if(null==n||"function"===typeof n||"symbol"===typeof n||"boolean"===typeof n){t.removeAttribute(i);break}n=Ee(""+n),t.setAttribute(i,n);break;case"action":case"formAction":if("function"===typeof n){t.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof r&&("formAction"===i?("input"!==e&&Xc(t,e,"name",o.name,o,null),Xc(t,e,"formEncType",o.formEncType,o,null),Xc(t,e,"formMethod",o.formMethod,o,null),Xc(t,e,"formTarget",o.formTarget,o,null)):(Xc(t,e,"encType",o.encType,o,null),Xc(t,e,"method",o.method,o,null),Xc(t,e,"target",o.target,o,null))),null==n||"symbol"===typeof n||"boolean"===typeof n){t.removeAttribute(i);break}n=Ee(""+n),t.setAttribute(i,n);break;case"onClick":null!=n&&(t.onclick=Jc);break;case"onScroll":null!=n&&Oc("scroll",t);break;case"onScrollEnd":null!=n&&Oc("scrollend",t);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(s(61));if(null!=(i=n.__html)){if(null!=o.children)throw Error(s(60));t.innerHTML=i}}break;case"multiple":t.multiple=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"muted":t.muted=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==n||"function"===typeof n||"boolean"===typeof n||"symbol"===typeof n){t.removeAttribute("xlink:href");break}i=Ee(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,""+n):t.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,""):t.removeAttribute(i);break;case"capture":case"download":!0===n?t.setAttribute(i,""):!1!==n&&null!=n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,n):t.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":null!=n&&"function"!==typeof n&&"symbol"!==typeof n&&!isNaN(n)&&1<=n?t.setAttribute(i,n):t.removeAttribute(i);break;case"rowSpan":case"start":null==n||"function"===typeof n||"symbol"===typeof n||isNaN(n)?t.removeAttribute(i):t.setAttribute(i,n);break;case"popover":Oc("beforetoggle",t),Oc("toggle",t),ee(t,"popover",n);break;case"xlinkActuate":ne(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ne(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ne(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ne(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ne(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ne(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ne(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ne(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ne(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ee(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<i.length)||"o"!==i[0]&&"O"!==i[0]||"n"!==i[1]&&"N"!==i[1])&&ee(t,i=Me.get(i)||i,n)}}function Qc(t,e,i,n,o,r){switch(i){case"style":Te(t,n,r);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(s(61));if(null!=(i=n.__html)){if(null!=o.children)throw Error(s(60));t.innerHTML=i}}break;case"children":"string"===typeof n?Ce(t,n):("number"===typeof n||"bigint"===typeof n)&&Ce(t,""+n);break;case"onScroll":null!=n&&Oc("scroll",t);break;case"onScrollEnd":null!=n&&Oc("scrollend",t);break;case"onClick":null!=n&&(t.onclick=Jc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Zt.hasOwnProperty(i)||("o"!==i[0]||"n"!==i[1]||(o=i.endsWith("Capture"),e=i.slice(2,o?i.length-7:void 0),"function"===typeof(r=null!=(r=t[Dt]||null)?r[i]:null)&&t.removeEventListener(e,r,o),"function"!==typeof n)?i in t?t[i]=n:!0===n?t.setAttribute(i,""):ee(t,i,n):("function"!==typeof r&&null!==r&&(i in t?t[i]=null:t.hasAttribute(i)&&t.removeAttribute(i)),t.addEventListener(e,n,o)))}}function th(t,e,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oc("error",t),Oc("load",t);var n,o=!1,r=!1;for(n in i)if(i.hasOwnProperty(n)){var a=i[n];if(null!=a)switch(n){case"src":o=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,e));default:Xc(t,e,n,a,i,null)}}return r&&Xc(t,e,"srcSet",i.srcSet,i,null),void(o&&Xc(t,e,"src",i.src,i,null));case"input":Oc("invalid",t);var l=n=a=r=null,u=null,c=null;for(o in i)if(i.hasOwnProperty(o)){var h=i[o];if(null!=h)switch(o){case"name":r=h;break;case"type":a=h;break;case"checked":u=h;break;case"defaultChecked":c=h;break;case"value":n=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(s(137,e));break;default:Xc(t,e,o,h,i,null)}}return ye(t,n,l,u,c,a,r,!1),void he(t);case"select":for(r in Oc("invalid",t),o=a=n=null,i)if(i.hasOwnProperty(r)&&null!=(l=i[r]))switch(r){case"value":n=l;break;case"defaultValue":a=l;break;case"multiple":o=l;default:Xc(t,e,r,l,i,null)}return e=n,i=a,t.multiple=!!o,void(null!=e?ve(t,!!o,e,!1):null!=i&&ve(t,!!o,i,!0));case"textarea":for(a in Oc("invalid",t),n=r=o=null,i)if(i.hasOwnProperty(a)&&null!=(l=i[a]))switch(a){case"value":o=l;break;case"defaultValue":r=l;break;case"children":n=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:Xc(t,e,a,l,i,null)}return be(t,o,r,n),void he(t);case"option":for(u in i)if(i.hasOwnProperty(u)&&null!=(o=i[u]))if("selected"===u)t.selected=o&&"function"!==typeof o&&"symbol"!==typeof o;else Xc(t,e,u,o,i,null);return;case"dialog":Oc("beforetoggle",t),Oc("toggle",t),Oc("cancel",t),Oc("close",t);break;case"iframe":case"object":Oc("load",t);break;case"video":case"audio":for(o=0;o<Rc.length;o++)Oc(Rc[o],t);break;case"image":Oc("error",t),Oc("load",t);break;case"details":Oc("toggle",t);break;case"embed":case"source":case"link":Oc("error",t),Oc("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in i)if(i.hasOwnProperty(c)&&null!=(o=i[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,e));default:Xc(t,e,c,o,i,null)}return;default:if(Ae(e)){for(h in i)i.hasOwnProperty(h)&&(void 0!==(o=i[h])&&Qc(t,e,h,o,i,void 0));return}}for(l in i)i.hasOwnProperty(l)&&(null!=(o=i[l])&&Xc(t,e,l,o,i,null))}var eh=null,ih=null;function nh(t){return 9===t.nodeType?t:t.ownerDocument}function oh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rh(t,e){if(0===t)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return 1===t&&"foreignObject"===e?0:t}function sh(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"bigint"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ah=null;var lh="function"===typeof setTimeout?setTimeout:void 0,uh="function"===typeof clearTimeout?clearTimeout:void 0,ch="function"===typeof Promise?Promise:void 0,hh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ch?function(t){return ch.resolve(null).then(t).catch(dh)}:lh;function dh(t){setTimeout((function(){throw t}))}function fh(t){return"head"===t}function ph(t,e){var i=e,n=0,o=0;do{var r=i.nextSibling;if(t.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0<n&&8>n){i=n;var s=t.ownerDocument;if(1&i&&bh(s.documentElement),2&i&&bh(s.body),4&i)for(bh(i=s.head),s=i.firstChild;s;){var a=s.nextSibling,l=s.nodeName;s[Ft]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===s.rel.toLowerCase()||i.removeChild(s),s=a}}if(0===o)return t.removeChild(r),void Md(e);o--}else"$"===i||"$?"===i||"$!"===i?o++:n=i.charCodeAt(0)-48;else n=0;i=r}while(i);Md(e)}function mh(t){var e=t.firstChild;for(e&&10===e.nodeType&&(e=e.nextSibling);e;){var i=e;switch(e=e.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":mh(i),Nt(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===i.rel.toLowerCase())continue}t.removeChild(i)}}function gh(t){return"$!"===t.data||"$?"===t.data&&"complete"===t.ownerDocument.readyState}function yh(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e||"F!"===e||"F"===e)break;if("/$"===e)return null}}return t}var _h=null;function vh(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var i=t.data;if("$"===i||"$!"===i||"$?"===i){if(0===e)return t;e--}else"/$"===i&&e++}t=t.previousSibling}return null}function xh(t,e,i){switch(e=nh(i),t){case"html":if(!(t=e.documentElement))throw Error(s(452));return t;case"head":if(!(t=e.head))throw Error(s(453));return t;case"body":if(!(t=e.body))throw Error(s(454));return t;default:throw Error(s(451))}}function bh(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Nt(t)}var Ch=new Map,wh=new Set;function Sh(t){return"function"===typeof t.getRootNode?t.getRootNode():9===t.nodeType?t:t.ownerDocument}var Th=L.d;L.d={f:function(){var t=Th.f(),e=Vu();return t||e},r:function(t){var e=Ht(t);null!==e&&5===e.tag&&"form"===e.type?Ds(e):Th.r(t)},D:function(t){Th.D(t),Mh("dns-prefetch",t,null)},C:function(t,e){Th.C(t,e),Mh("preconnect",t,e)},L:function(t,e,i){Th.L(t,e,i);var n=Ah;if(n&&t&&e){var o='link[rel="preload"][as="'+me(e)+'"]';"image"===e&&i&&i.imageSrcSet?(o+='[imagesrcset="'+me(i.imageSrcSet)+'"]',"string"===typeof i.imageSizes&&(o+='[imagesizes="'+me(i.imageSizes)+'"]')):o+='[href="'+me(t)+'"]';var r=o;switch(e){case"style":r=Eh(t);break;case"script":r=Bh(t)}Ch.has(r)||(t=d({rel:"preload",href:"image"===e&&i&&i.imageSrcSet?void 0:t,as:e},i),Ch.set(r,t),null!==n.querySelector(o)||"style"===e&&n.querySelector(Ph(r))||"script"===e&&n.querySelector(Dh(r))||(th(e=n.createElement("link"),"link",t),Wt(e),n.head.appendChild(e)))}},m:function(t,e){Th.m(t,e);var i=Ah;if(i&&t){var n=e&&"string"===typeof e.as?e.as:"script",o='link[rel="modulepreload"][as="'+me(n)+'"][href="'+me(t)+'"]',r=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Bh(t)}if(!Ch.has(r)&&(t=d({rel:"modulepreload",href:t},e),Ch.set(r,t),null===i.querySelector(o))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Dh(r)))return}th(n=i.createElement("link"),"link",t),Wt(n),i.head.appendChild(n)}}},X:function(t,e){Th.X(t,e);var i=Ah;if(i&&t){var n=Gt(i).hoistableScripts,o=Bh(t),r=n.get(o);r||((r=i.querySelector(Dh(o)))||(t=d({src:t,async:!0},e),(e=Ch.get(o))&&Oh(t,e),Wt(r=i.createElement("script")),th(r,"link",t),i.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(o,r))}},S:function(t,e,i){Th.S(t,e,i);var n=Ah;if(n&&t){var o=Gt(n).hoistableStyles,r=Eh(t);e=e||"default";var s=o.get(r);if(!s){var a={loading:0,preload:null};if(s=n.querySelector(Ph(r)))a.loading=5;else{t=d({rel:"stylesheet",href:t,"data-precedence":e},i),(i=Ch.get(r))&&zh(t,i);var l=s=n.createElement("link");Wt(l),th(l,"link",t),l._p=new Promise((function(t,e){l.onload=t,l.onerror=e})),l.addEventListener("load",(function(){a.loading|=1})),l.addEventListener("error",(function(){a.loading|=2})),a.loading|=4,Lh(s,e,n)}s={type:"stylesheet",instance:s,count:1,state:a},o.set(r,s)}}},M:function(t,e){Th.M(t,e);var i=Ah;if(i&&t){var n=Gt(i).hoistableScripts,o=Bh(t),r=n.get(o);r||((r=i.querySelector(Dh(o)))||(t=d({src:t,async:!0,type:"module"},e),(e=Ch.get(o))&&Oh(t,e),Wt(r=i.createElement("script")),th(r,"link",t),i.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(o,r))}}};var Ah="undefined"===typeof document?null:document;function Mh(t,e,i){var n=Ah;if(n&&"string"===typeof e&&e){var o=me(e);o='link[rel="'+t+'"][href="'+o+'"]',"string"===typeof i&&(o+='[crossorigin="'+i+'"]'),wh.has(o)||(wh.add(o),t={rel:t,crossOrigin:i,href:e},null===n.querySelector(o)&&(th(e=n.createElement("link"),"link",t),Wt(e),n.head.appendChild(e)))}}function Ih(t,e,i,n){var o,r,a,l,u=(u=G.current)?Sh(u):null;if(!u)throw Error(s(446));switch(t){case"meta":case"title":return null;case"style":return"string"===typeof i.precedence&&"string"===typeof i.href?(e=Eh(i.href),(n=(i=Gt(u).hoistableStyles).get(e))||(n={type:"style",instance:null,count:0,state:null},i.set(e,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===i.rel&&"string"===typeof i.href&&"string"===typeof i.precedence){t=Eh(i.href);var c=Gt(u).hoistableStyles,h=c.get(t);if(h||(u=u.ownerDocument||u,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(t,h),(c=u.querySelector(Ph(t)))&&!c._p&&(h.instance=c,h.state.loading=5),Ch.has(t)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},Ch.set(t,i),c||(o=u,r=t,a=i,l=h.state,o.querySelector('link[rel="preload"][as="style"]['+r+"]")?l.loading=1:(r=o.createElement("link"),l.preload=r,r.addEventListener("load",(function(){return l.loading|=1})),r.addEventListener("error",(function(){return l.loading|=2})),th(r,"link",a),Wt(r),o.head.appendChild(r))))),e&&null===n)throw Error(s(528,""));return h}if(e&&null!==n)throw Error(s(529,""));return null;case"script":return e=i.async,"string"===typeof(i=i.src)&&e&&"function"!==typeof e&&"symbol"!==typeof e?(e=Bh(i),(n=(i=Gt(u).hoistableScripts).get(e))||(n={type:"script",instance:null,count:0,state:null},i.set(e,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,t))}}function Eh(t){return'href="'+me(t)+'"'}function Ph(t){return'link[rel="stylesheet"]['+t+"]"}function kh(t){return d({},t,{"data-precedence":t.precedence,precedence:null})}function Bh(t){return'[src="'+me(t)+'"]'}function Dh(t){return"script[async]"+t}function Rh(t,e,i){if(e.count++,null===e.instance)switch(e.type){case"style":var n=t.querySelector('style[data-href~="'+me(i.href)+'"]');if(n)return e.instance=n,Wt(n),n;var o=d({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return Wt(n=(t.ownerDocument||t).createElement("style")),th(n,"style",o),Lh(n,i.precedence,t),e.instance=n;case"stylesheet":o=Eh(i.href);var r=t.querySelector(Ph(o));if(r)return e.state.loading|=4,e.instance=r,Wt(r),r;n=kh(i),(o=Ch.get(o))&&zh(n,o),Wt(r=(t.ownerDocument||t).createElement("link"));var a=r;return a._p=new Promise((function(t,e){a.onload=t,a.onerror=e})),th(r,"link",n),e.state.loading|=4,Lh(r,i.precedence,t),e.instance=r;case"script":return r=Bh(i.src),(o=t.querySelector(Dh(r)))?(e.instance=o,Wt(o),o):(n=i,(o=Ch.get(r))&&Oh(n=d({},i),o),Wt(o=(t=t.ownerDocument||t).createElement("script")),th(o,"link",n),t.head.appendChild(o),e.instance=o);case"void":return null;default:throw Error(s(443,e.type))}else"stylesheet"===e.type&&0===(4&e.state.loading)&&(n=e.instance,e.state.loading|=4,Lh(n,i.precedence,t));return e.instance}function Lh(t,e,i){for(var n=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,r=o,s=0;s<n.length;s++){var a=n[s];if(a.dataset.precedence===e)r=a;else if(r!==o)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=9===i.nodeType?i.head:i).insertBefore(t,e.firstChild)}function zh(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.title&&(t.title=e.title)}function Oh(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.integrity&&(t.integrity=e.integrity)}var Uh=null;function Fh(t,e,i){if(null===Uh){var n=new Map,o=Uh=new Map;o.set(i,n)}else(n=(o=Uh).get(i))||(n=new Map,o.set(i,n));if(n.has(t))return n;for(n.set(t,null),i=i.getElementsByTagName(t),o=0;o<i.length;o++){var r=i[o];if(!(r[Ft]||r[Bt]||"link"===t&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var s=r.getAttribute(e)||"";s=t+s;var a=n.get(s);a?a.push(r):n.set(s,[r])}}return n}function Nh(t,e,i){(t=t.ownerDocument||t).head.insertBefore(i,"title"===e?t.querySelector("head > title"):null)}function Vh(t){return"stylesheet"!==t.type||0!==(3&t.state.loading)}var Hh=null;function jh(){}function Gh(){if(this.count--,0===this.count)if(this.stylesheets)qh(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}var Wh=null;function qh(t,e){t.stylesheets=null,null!==t.unsuspend&&(t.count++,Wh=new Map,e.forEach(Zh,t),Wh=null,Gh.call(t))}function Zh(t,e){if(!(4&e.state.loading)){var i=Wh.get(t);if(i)var n=i.get(null);else{i=new Map,Wh.set(t,i);for(var o=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<o.length;r++){var s=o[r];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(i.set(s.dataset.precedence,s),n=s)}n&&i.set(null,n)}s=(o=e.instance).getAttribute("data-precedence"),(r=i.get(s)||n)===n&&i.set(null,o),i.set(s,o),this.count++,n=Gh.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),r?r.parentNode.insertBefore(o,r.nextSibling):(t=9===t.nodeType?t.head:t).insertBefore(o,t.firstChild),e.state.loading|=4}}var $h={$$typeof:b,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function Kh(t,e,i,n,o,r,s,a){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=St(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=St(0),this.hiddenUpdates=St(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=r,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Yh(t,e,i,n,o,r,s,a,l,u,c,h){return t=new Kh(t,e,i,s,a,l,u,h),e=1,!0===r&&(e|=24),r=zn(3,null,null,e),t.current=r,r.stateNode=t,(e=Ro()).refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:n,isDehydrated:i,cache:e},nr(r),t}function Jh(t){return t?t=Rn:Rn}function Xh(t,e,i,n,o,r){o=Jh(o),null===n.context?n.context=o:n.pendingContext=o,(n=rr(e)).payload={element:i},null!==(r=void 0===r?null:r)&&(n.callback=r),null!==(i=sr(t,n,e))&&(zu(i,0,e),ar(i,t,e))}function Qh(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var i=t.retryLane;t.retryLane=0!==i&&i<e?i:e}}function td(t,e){Qh(t,e),(t=t.alternate)&&Qh(t,e)}function ed(t){if(13===t.tag){var e=kn(t,67108864);null!==e&&zu(e,0,67108864),td(t,67108864)}}var id=!0;function nd(t,e,i,n){var o=R.T;R.T=null;var r=L.p;try{L.p=2,rd(t,e,i,n)}finally{L.p=r,R.T=o}}function od(t,e,i,n){var o=R.T;R.T=null;var r=L.p;try{L.p=8,rd(t,e,i,n)}finally{L.p=r,R.T=o}}function rd(t,e,i,n){if(id){var o=sd(n);if(null===o)Hc(t,e,n,ad,i),_d(t,n);else if(function(t,e,i,n,o){switch(e){case"focusin":return hd=vd(hd,t,e,i,n,o),!0;case"dragenter":return dd=vd(dd,t,e,i,n,o),!0;case"mouseover":return fd=vd(fd,t,e,i,n,o),!0;case"pointerover":var r=o.pointerId;return pd.set(r,vd(pd.get(r)||null,t,e,i,n,o)),!0;case"gotpointercapture":return r=o.pointerId,md.set(r,vd(md.get(r)||null,t,e,i,n,o)),!0}return!1}(o,t,e,i,n))n.stopPropagation();else if(_d(t,n),4&e&&-1<yd.indexOf(t)){for(;null!==o;){var r=Ht(o);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var s=_t(r.pendingLanes);if(0!==s){var a=r;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-ft(s);a.entanglements[1]|=l,s&=~l}Cc(r),0===(6&iu)&&(Cu=et()+500,wc(0,!1))}}break;case 13:null!==(a=kn(r,2))&&zu(a,0,2),Vu(),td(r,2)}if(null===(r=sd(n))&&Hc(t,e,n,ad,i),r===o)break;o=r}null!==o&&n.stopPropagation()}else Hc(t,e,n,null,i)}}function sd(t){return ld(t=ke(t))}var ad=null;function ld(t){if(ad=null,null!==(t=Vt(t))){var e=l(t);if(null===e)t=null;else{var i=e.tag;if(13===i){if(null!==(t=u(e)))return t;t=null}else if(3===i){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return ad=t,null}function ud(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(it()){case nt:return 2;case ot:return 8;case rt:case st:return 32;case at:return 268435456;default:return 32}default:return 32}}var cd=!1,hd=null,dd=null,fd=null,pd=new Map,md=new Map,gd=[],yd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _d(t,e){switch(t){case"focusin":case"focusout":hd=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":fd=null;break;case"pointerover":case"pointerout":pd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(e.pointerId)}}function vd(t,e,i,n,o,r){return null===t||t.nativeEvent!==r?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:r,targetContainers:[o]},null!==e&&(null!==(e=Ht(e))&&ed(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,null!==o&&-1===e.indexOf(o)&&e.push(o),t)}function xd(t){var e=Vt(t.target);if(null!==e){var i=l(e);if(null!==i)if(13===(e=i.tag)){if(null!==(e=u(i)))return t.blockedOn=e,void function(t,e){var i=L.p;try{return L.p=t,e()}finally{L.p=i}}(t.priority,(function(){if(13===i.tag){var t=Ru();t=It(t);var e=kn(i,t);null!==e&&zu(e,0,t),td(i,t)}}))}else if(3===e&&i.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}t.blockedOn=null}function bd(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var i=sd(t.nativeEvent);if(null!==i)return null!==(e=Ht(i))&&ed(e),t.blockedOn=i,!1;var n=new(i=t.nativeEvent).constructor(i.type,i);Pe=n,i.target.dispatchEvent(n),Pe=null,e.shift()}return!0}function Cd(t,e,i){bd(t)&&i.delete(e)}function wd(){cd=!1,null!==hd&&bd(hd)&&(hd=null),null!==dd&&bd(dd)&&(dd=null),null!==fd&&bd(fd)&&(fd=null),pd.forEach(Cd),md.forEach(Cd)}function Sd(t,e){t.blockedOn===e&&(t.blockedOn=null,cd||(cd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,wd)))}var Td=null;function Ad(t){Td!==t&&(Td=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,(function(){Td===t&&(Td=null);for(var e=0;e<t.length;e+=3){var i=t[e],n=t[e+1],o=t[e+2];if("function"!==typeof n){if(null===ld(n||i))continue;break}var r=Ht(i);null!==r&&(t.splice(e,3),e-=3,ks(r,{pending:!0,data:o,method:i.method,action:n},n,o))}})))}function Md(t){function e(e){return Sd(e,t)}null!==hd&&Sd(hd,t),null!==dd&&Sd(dd,t),null!==fd&&Sd(fd,t),pd.forEach(e),md.forEach(e);for(var i=0;i<gd.length;i++){var n=gd[i];n.blockedOn===t&&(n.blockedOn=null)}for(;0<gd.length&&null===(i=gd[0]).blockedOn;)xd(i),null===i.blockedOn&&gd.shift();if(null!=(i=(t.ownerDocument||t).$$reactFormReplay))for(n=0;n<i.length;n+=3){var o=i[n],r=i[n+1],s=o[Dt]||null;if("function"===typeof r)s||Ad(i);else if(s){var a=null;if(r&&r.hasAttribute("formAction")){if(o=r,s=r[Dt]||null)a=s.formAction;else if(null!==ld(o))continue}else a=s.action;"function"===typeof a?i[n+1]=a:(i.splice(n,3),n-=3),Ad(i)}}}function Id(t){this._internalRoot=t}function Ed(t){this._internalRoot=t}Ed.prototype.render=Id.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));Xh(e.current,Ru(),t,e,null,null)},Ed.prototype.unmount=Id.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;Xh(t.current,2,null,t,null,null),Vu(),e[Rt]=null}},Ed.prototype.unstable_scheduleHydration=function(t){if(t){var e=Pt();t={blockedOn:null,target:t,priority:e};for(var i=0;i<gd.length&&0!==e&&e<gd[i].priority;i++);gd.splice(i,0,t),0===i&&xd(t)}};var Pd=o.version;if("19.1.0"!==Pd)throw Error(s(527,Pd,"19.1.0"));L.findDOMNode=function(t){var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return t=function(t){var e=t.alternate;if(!e){if(null===(e=l(t)))throw Error(s(188));return e!==t?null:t}for(var i=t,n=e;;){var o=i.return;if(null===o)break;var r=o.alternate;if(null===r){if(null!==(n=o.return)){i=n;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===i)return c(o),t;if(r===n)return c(o),e;r=r.sibling}throw Error(s(188))}if(i.return!==n.return)i=o,n=r;else{for(var a=!1,u=o.child;u;){if(u===i){a=!0,i=o,n=r;break}if(u===n){a=!0,n=o,i=r;break}u=u.sibling}if(!a){for(u=r.child;u;){if(u===i){a=!0,i=r,n=o;break}if(u===n){a=!0,n=r,i=o;break}u=u.sibling}if(!a)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?t:e}(e),t=null===(t=null!==t?h(t):null)?null:t.stateNode};var kd={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bd.isDisabled&&Bd.supportsFiber)try{ct=Bd.inject(kd),ht=Bd}catch(Rd){}}e.createRoot=function(t,e){if(!a(t))throw Error(s(299));var i=!1,n="",o=_a,r=va,l=xa;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(i=!0),void 0!==e.identifierPrefix&&(n=e.identifierPrefix),void 0!==e.onUncaughtError&&(o=e.onUncaughtError),void 0!==e.onCaughtError&&(r=e.onCaughtError),void 0!==e.onRecoverableError&&(l=e.onRecoverableError),void 0!==e.unstable_transitionCallbacks&&e.unstable_transitionCallbacks),e=Yh(t,1,!1,null,0,i,n,o,r,l,0,null),t[Rt]=e.current,Nc(t),new Id(e)},e.hydrateRoot=function(t,e,i){if(!a(t))throw Error(s(299));var n=!1,o="",r=_a,l=va,u=xa,c=null;return null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(o=i.identifierPrefix),void 0!==i.onUncaughtError&&(r=i.onUncaughtError),void 0!==i.onCaughtError&&(l=i.onCaughtError),void 0!==i.onRecoverableError&&(u=i.onRecoverableError),void 0!==i.unstable_transitionCallbacks&&i.unstable_transitionCallbacks,void 0!==i.formState&&(c=i.formState)),(e=Yh(t,1,!0,e,0,n,o,r,l,u,0,c)).context=Jh(null),i=e.current,(o=rr(n=It(n=Ru()))).callback=null,sr(i,o,n),i=n,e.current.lanes=i,Tt(e,i),Cc(e),t[Rt]=e.current,Nc(t),new Ed(e)},e.version="19.1.0"},43:(t,e,i)=>{"use strict";t.exports=i(288)},288:(t,e)=>{"use strict";var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(t,e,i){this.props=t,this.context=e,this.refs=g,this.updater=i||p}function _(){}function v(t,e,i){this.props=t,this.context=e,this.refs=g,this.updater=i||p}y.prototype.isReactComponent={},y.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},y.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},_.prototype=y.prototype;var x=v.prototype=new _;x.constructor=v,m(x,y.prototype),x.isPureReactComponent=!0;var b=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},w=Object.prototype.hasOwnProperty;function S(t,e,n,o,r,s){return n=s.ref,{$$typeof:i,type:t,key:e,ref:void 0!==n?n:null,props:s}}function T(t){return"object"===typeof t&&null!==t&&t.$$typeof===i}var A=/\/+/g;function M(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function I(){}function E(t,e,o,r,s){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l,u,c=!1;if(null===t)c=!0;else switch(a){case"bigint":case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case i:case n:c=!0;break;case d:return E((c=t._init)(t._payload),e,o,r,s)}}if(c)return s=s(t),c=""===r?"."+M(t,0):r,b(s)?(o="",null!=c&&(o=c.replace(A,"$&/")+"/"),E(s,e,o,"",(function(t){return t}))):null!=s&&(T(s)&&(l=s,u=o+(null==s.key||t&&t.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+c,s=S(l.type,u,void 0,0,0,l.props)),e.push(s)),1;c=0;var h,p=""===r?".":r+":";if(b(t))for(var m=0;m<t.length;m++)c+=E(r=t[m],e,o,a=p+M(r,m),s);else if("function"===typeof(m=null===(h=t)||"object"!==typeof h?null:"function"===typeof(h=f&&h[f]||h["@@iterator"])?h:null))for(t=m.call(t),m=0;!(r=t.next()).done;)c+=E(r=r.value,e,o,a=p+M(r,m++),s);else if("object"===a){if("function"===typeof t.then)return E(function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch("string"===typeof t.status?t.then(I,I):(t.status="pending",t.then((function(e){"pending"===t.status&&(t.status="fulfilled",t.value=e)}),(function(e){"pending"===t.status&&(t.status="rejected",t.reason=e)}))),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}(t),e,o,r,s);throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return c}function P(t,e,i){if(null==t)return t;var n=[],o=0;return E(t,n,"","",(function(t){return e.call(i,t,o++)})),n}function k(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var B="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function D(){}e.Children={map:P,forEach:function(t,e,i){P(t,(function(){e.apply(this,arguments)}),i)},count:function(t){var e=0;return P(t,(function(){e++})),e},toArray:function(t){return P(t,(function(t){return t}))||[]},only:function(t){if(!T(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=y,e.Fragment=o,e.Profiler=s,e.PureComponent=v,e.StrictMode=r,e.Suspense=c,e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,e.__COMPILER_RUNTIME={__proto__:null,c:function(t){return C.H.useMemoCache(t)}},e.cache=function(t){return function(){return t.apply(null,arguments)}},e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("The argument must be a React element, but you passed "+t+".");var n=m({},t.props),o=t.key;if(null!=e)for(r in void 0!==e.ref&&void 0,void 0!==e.key&&(o=""+e.key),e)!w.call(e,r)||"key"===r||"__self"===r||"__source"===r||"ref"===r&&void 0===e.ref||(n[r]=e[r]);var r=arguments.length-2;if(1===r)n.children=i;else if(1<r){for(var s=Array(r),a=0;a<r;a++)s[a]=arguments[a+2];n.children=s}return S(t.type,o,void 0,0,0,n)},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider=t,t.Consumer={$$typeof:a,_context:t},t},e.createElement=function(t,e,i){var n,o={},r=null;if(null!=e)for(n in void 0!==e.key&&(r=""+e.key),e)w.call(e,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(o[n]=e[n]);var s=arguments.length-2;if(1===s)o.children=i;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];o.children=a}if(t&&t.defaultProps)for(n in s=t.defaultProps)void 0===o[n]&&(o[n]=s[n]);return S(t,r,void 0,0,0,o)},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:u,render:t}},e.isValidElement=T,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:k}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=C.T,i={};C.T=i;try{var n=t(),o=C.S;null!==o&&o(i,n),"object"===typeof n&&null!==n&&"function"===typeof n.then&&n.then(D,B)}catch(r){B(r)}finally{C.T=e}},e.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},e.use=function(t){return C.H.use(t)},e.useActionState=function(t,e,i){return C.H.useActionState(t,e,i)},e.useCallback=function(t,e){return C.H.useCallback(t,e)},e.useContext=function(t){return C.H.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t,e){return C.H.useDeferredValue(t,e)},e.useEffect=function(t,e,i){var n=C.H;if("function"===typeof i)throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(t,e)},e.useId=function(){return C.H.useId()},e.useImperativeHandle=function(t,e,i){return C.H.useImperativeHandle(t,e,i)},e.useInsertionEffect=function(t,e){return C.H.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return C.H.useLayoutEffect(t,e)},e.useMemo=function(t,e){return C.H.useMemo(t,e)},e.useOptimistic=function(t,e){return C.H.useOptimistic(t,e)},e.useReducer=function(t,e,i){return C.H.useReducer(t,e,i)},e.useRef=function(t){return C.H.useRef(t)},e.useState=function(t){return C.H.useState(t)},e.useSyncExternalStore=function(t,e,i){return C.H.useSyncExternalStore(t,e,i)},e.useTransition=function(){return C.H.useTransition()},e.version="19.1.0"},391:(t,e,i)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=i(4)},579:(t,e,i)=>{"use strict";t.exports=i(799)},672:(t,e,i)=>{"use strict";var n=i(43);function o(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var s={d:{f:r,r:function(){throw Error(o(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(t,e){return"font"===t?"":"string"===typeof e?"use-credentials"===e?e:"":void 0}e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,e.createPortal=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)throw Error(o(299));return function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==n?null:""+n,children:t,containerInfo:e,implementation:i}}(t,e,null,i)},e.flushSync=function(t){var e=l.T,i=s.p;try{if(l.T=null,s.p=2,t)return t()}finally{l.T=e,s.p=i,s.d.f()}},e.preconnect=function(t,e){"string"===typeof t&&(e?e="string"===typeof(e=e.crossOrigin)?"use-credentials"===e?e:"":void 0:e=null,s.d.C(t,e))},e.prefetchDNS=function(t){"string"===typeof t&&s.d.D(t)},e.preinit=function(t,e){if("string"===typeof t&&e&&"string"===typeof e.as){var i=e.as,n=u(i,e.crossOrigin),o="string"===typeof e.integrity?e.integrity:void 0,r="string"===typeof e.fetchPriority?e.fetchPriority:void 0;"style"===i?s.d.S(t,"string"===typeof e.precedence?e.precedence:void 0,{crossOrigin:n,integrity:o,fetchPriority:r}):"script"===i&&s.d.X(t,{crossOrigin:n,integrity:o,fetchPriority:r,nonce:"string"===typeof e.nonce?e.nonce:void 0})}},e.preinitModule=function(t,e){if("string"===typeof t)if("object"===typeof e&&null!==e){if(null==e.as||"script"===e.as){var i=u(e.as,e.crossOrigin);s.d.M(t,{crossOrigin:i,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0})}}else null==e&&s.d.M(t)},e.preload=function(t,e){if("string"===typeof t&&"object"===typeof e&&null!==e&&"string"===typeof e.as){var i=e.as,n=u(i,e.crossOrigin);s.d.L(t,i,{crossOrigin:n,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0,type:"string"===typeof e.type?e.type:void 0,fetchPriority:"string"===typeof e.fetchPriority?e.fetchPriority:void 0,referrerPolicy:"string"===typeof e.referrerPolicy?e.referrerPolicy:void 0,imageSrcSet:"string"===typeof e.imageSrcSet?e.imageSrcSet:void 0,imageSizes:"string"===typeof e.imageSizes?e.imageSizes:void 0,media:"string"===typeof e.media?e.media:void 0})}},e.preloadModule=function(t,e){if("string"===typeof t)if(e){var i=u(e.as,e.crossOrigin);s.d.m(t,{as:"string"===typeof e.as&&"script"!==e.as?e.as:void 0,crossOrigin:i,integrity:"string"===typeof e.integrity?e.integrity:void 0})}else s.d.m(t)},e.requestFormReset=function(t){s.d.r(t)},e.unstable_batchedUpdates=function(t,e){return t(e)},e.useFormState=function(t,e,i){return l.H.useFormState(t,e,i)},e.useFormStatus=function(){return l.H.useHostTransitionStatus()},e.version="19.1.0"},799:(t,e)=>{"use strict";var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function o(t,e,n){var o=null;if(void 0!==n&&(o=""+n),void 0!==e.key&&(o=""+e.key),"key"in e)for(var r in n={},e)"key"!==r&&(n[r]=e[r]);else n=e;return e=n.ref,{$$typeof:i,type:t,key:o,ref:void 0!==e?e:null,props:n}}e.Fragment=n,e.jsx=o,e.jsxs=o},853:(t,e,i)=>{"use strict";t.exports=i(896)},879:function(t){t.exports=function(){"use strict";var t,e,i;function n(n,o){if(t)if(e){var r="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),i=o(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))}else e=o;else t=o}return n(["exports"],(function(t){function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var i,n={},o={};function r(){if(i)return o;i=1,Object.defineProperty(o,"__esModule",{value:!0}),o.setMatrixArrayType=function(t){o.ARRAY_TYPE=e=t},o.toRadian=function(t){return t*r},o.equals=function(e,i){return Math.abs(e-i)<=t*Math.max(1,Math.abs(e),Math.abs(i))},o.RANDOM=o.ARRAY_TYPE=o.EPSILON=void 0;var t=1e-6;o.EPSILON=t;var e="undefined"!=typeof Float32Array?Float32Array:Array;o.ARRAY_TYPE=e;var n=Math.random;o.RANDOM=n;var r=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),o}var s,a={};function l(){if(s)return a;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}s=1,Object.defineProperty(a,"__esModule",{value:!0}),a.create=function(){var t=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},a.clone=function(t){var i=new e.ARRAY_TYPE(4);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},a.fromValues=function(t,i,n,o){var r=new e.ARRAY_TYPE(4);return r[0]=t,r[1]=i,r[2]=n,r[3]=o,r},a.set=function(t,e,i,n,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t},a.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},a.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*r-o*n;return s?(t[0]=r*(s=1/s),t[1]=-n*s,t[2]=-o*s,t[3]=i*s,t):null},a.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},a.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},a.multiply=n,a.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*a,t[1]=o*l+s*a,t[2]=n*-a+r*l,t[3]=o*-a+s*l,t},a.scale=function(t,e,i){var n=e[1],o=e[2],r=e[3],s=i[0],a=i[1];return t[0]=e[0]*s,t[1]=n*s,t[2]=o*a,t[3]=r*a,t},a.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},a.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},a.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},a.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},a.subtract=o,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=i[0],l=i[1],u=i[2],c=i[3];return Math.abs(n-a)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-l)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(r-u)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-c)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},a.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},a.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},a.sub=a.mul=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],l=i[1],u=i[2],c=i[3];return t[0]=n*a+r*l,t[1]=o*a+s*l,t[2]=n*u+r*c,t[3]=o*u+s*c,t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}return a.mul=n,a.sub=o,a}var u,c={};function h(){if(u)return c;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}u=1,Object.defineProperty(c,"__esModule",{value:!0}),c.create=function(){var t=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},c.clone=function(t){var i=new e.ARRAY_TYPE(6);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.fromValues=function(t,i,n,o,r,s){var a=new e.ARRAY_TYPE(6);return a[0]=t,a[1]=i,a[2]=n,a[3]=o,a[4]=r,a[5]=s,a},c.set=function(t,e,i,n,o,r,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t[4]=r,t[5]=s,t},c.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=i*r-n*o;return l?(t[0]=r*(l=1/l),t[1]=-n*l,t[2]=-o*l,t[3]=i*l,t[4]=(o*a-r*s)*l,t[5]=(n*s-i*a)*l,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=n,c.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=Math.sin(i),c=Math.cos(i);return t[0]=n*c+r*u,t[1]=o*c+s*u,t[2]=n*-u+r*c,t[3]=o*-u+s*c,t[4]=a,t[5]=l,t},c.scale=function(t,e,i){var n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=i[0],u=i[1];return t[0]=e[0]*l,t[1]=n*l,t[2]=o*u,t[3]=r*u,t[4]=s,t[5]=a,t},c.translate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=i[0],c=i[1];return t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=n*u+r*c+a,t[5]=o*u+s*c+l,t},c.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},c.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},c.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},c.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},c.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},c.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},c.subtract=o,c.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},c.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},c.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],u=i[0],c=i[1],h=i[2],d=i[3],f=i[4],p=i[5];return Math.abs(n-u)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(r-h)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-d)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-f)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},c.sub=c.mul=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=i[0],c=i[1],h=i[2],d=i[3],f=i[4],p=i[5];return t[0]=n*u+r*c,t[1]=o*u+s*c,t[2]=n*h+r*d,t[3]=o*h+s*d,t[4]=n*f+r*p+a,t[5]=o*f+s*p+l,t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}return c.mul=n,c.sub=o,c}var d,f={};function p(){if(d)return f;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}d=1,Object.defineProperty(f,"__esModule",{value:!0}),f.create=function(){var t=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},f.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},f.clone=function(t){var i=new e.ARRAY_TYPE(9);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i},f.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},f.fromValues=function(t,i,n,o,r,s,a,l,u){var c=new e.ARRAY_TYPE(9);return c[0]=t,c[1]=i,c[2]=n,c[3]=o,c[4]=r,c[5]=s,c[6]=a,c[7]=l,c[8]=u,c},f.set=function(t,e,i,n,o,r,s,a,l,u){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},f.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=c*s-a*u,d=-c*r+a*l,f=u*r-s*l,p=i*h+n*d+o*f;return p?(t[0]=h*(p=1/p),t[1]=(-c*n+o*u)*p,t[2]=(a*n-o*s)*p,t[3]=d*p,t[4]=(c*i-o*l)*p,t[5]=(-a*i+o*r)*p,t[6]=f*p,t[7]=(-u*i+n*l)*p,t[8]=(s*i-n*r)*p,t):null},f.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=o*u-n*c,t[2]=n*a-o*s,t[3]=a*l-r*c,t[4]=i*c-o*l,t[5]=o*r-i*a,t[6]=r*u-s*l,t[7]=n*l-i*u,t[8]=i*s-n*r,t},f.determinant=function(t){var e=t[3],i=t[4],n=t[5],o=t[6],r=t[7],s=t[8];return t[0]*(s*i-n*r)+t[1]*(-s*e+n*o)+t[2]*(r*e-i*o)},f.multiply=n,f.translate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=i[0],f=i[1];return t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=a,t[5]=l,t[6]=d*n+f*s+u,t[7]=d*o+f*a+c,t[8]=d*r+f*l+h,t},f.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=Math.sin(i),f=Math.cos(i);return t[0]=f*n+d*s,t[1]=f*o+d*a,t[2]=f*r+d*l,t[3]=f*s-d*n,t[4]=f*a-d*o,t[5]=f*l-d*r,t[6]=u,t[7]=c,t[8]=h,t},f.scale=function(t,e,i){var n=i[0],o=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},f.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},f.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},f.fromQuat=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i+i,a=n+n,l=o+o,u=i*s,c=n*s,h=n*a,d=o*s,f=o*a,p=o*l,m=r*s,g=r*a,y=r*l;return t[0]=1-h-p,t[3]=c-y,t[6]=d+g,t[1]=c+y,t[4]=1-u-p,t[7]=f-m,t[2]=d-g,t[5]=f+m,t[8]=1-u-h,t},f.normalFromMat4=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*s,v=i*l-o*s,x=i*u-r*s,b=n*l-o*a,C=n*u-r*a,w=o*u-r*l,S=c*m-h*p,T=c*g-d*p,A=c*y-f*p,M=h*g-d*m,I=h*y-f*m,E=d*y-f*g,P=_*E-v*I+x*M+b*A-C*T+w*S;return P?(t[0]=(a*E-l*I+u*M)*(P=1/P),t[1]=(l*A-s*E-u*T)*P,t[2]=(s*I-a*A+u*S)*P,t[3]=(o*I-n*E-r*M)*P,t[4]=(i*E-o*A+r*T)*P,t[5]=(n*A-i*I-r*S)*P,t[6]=(m*w-g*C+y*b)*P,t[7]=(g*x-p*w-y*v)*P,t[8]=(p*C-m*x+y*_)*P,t):null},f.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},f.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},f.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},f.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},f.subtract=o,f.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},f.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},f.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},f.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=i[0],f=i[1],p=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],x=i[8];return Math.abs(n-d)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(r-p)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-m)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-_)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-v)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-x)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))},f.sub=f.mul=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=i[0],f=i[1],p=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],x=i[8];return t[0]=d*n+f*s+p*u,t[1]=d*o+f*a+p*c,t[2]=d*r+f*l+p*h,t[3]=m*n+g*s+y*u,t[4]=m*o+g*a+y*c,t[5]=m*r+g*l+y*h,t[6]=_*n+v*s+x*u,t[7]=_*o+v*a+x*c,t[8]=_*r+v*l+x*h,t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}return f.mul=n,f.sub=o,f}var m,g={};function y(){if(m)return g;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}m=1,Object.defineProperty(g,"__esModule",{value:!0}),g.create=function(){var t=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},g.clone=function(t){var i=new e.ARRAY_TYPE(16);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},g.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},g.fromValues=function(t,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g){var y=new e.ARRAY_TYPE(16);return y[0]=t,y[1]=i,y[2]=n,y[3]=o,y[4]=r,y[5]=s,y[6]=a,y[7]=l,y[8]=u,y[9]=c,y[10]=h,y[11]=d,y[12]=f,y[13]=p,y[14]=m,y[15]=g,y},g.set=function(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=d,t[12]=f,t[13]=p,t[14]=m,t[15]=g,t},g.identity=n,g.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[3],r=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=r,t[11]=e[14],t[12]=o,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},g.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*s,v=i*l-o*s,x=i*u-r*s,b=n*l-o*a,C=n*u-r*a,w=o*u-r*l,S=c*m-h*p,T=c*g-d*p,A=c*y-f*p,M=h*g-d*m,I=h*y-f*m,E=d*y-f*g,P=_*E-v*I+x*M+b*A-C*T+w*S;return P?(t[0]=(a*E-l*I+u*M)*(P=1/P),t[1]=(o*I-n*E-r*M)*P,t[2]=(m*w-g*C+y*b)*P,t[3]=(d*C-h*w-f*b)*P,t[4]=(l*A-s*E-u*T)*P,t[5]=(i*E-o*A+r*T)*P,t[6]=(g*x-p*w-y*v)*P,t[7]=(c*w-d*x+f*v)*P,t[8]=(s*I-a*A+u*S)*P,t[9]=(n*A-i*I-r*S)*P,t[10]=(p*C-m*x+y*_)*P,t[11]=(h*x-c*C-f*_)*P,t[12]=(a*T-s*M-l*S)*P,t[13]=(i*M-n*T+o*S)*P,t[14]=(m*v-p*b-g*_)*P,t[15]=(c*b-h*v+d*_)*P,t):null},g.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],y=e[15];return t[0]=a*(d*y-f*g)-h*(l*y-u*g)+m*(l*f-u*d),t[1]=-(n*(d*y-f*g)-h*(o*y-r*g)+m*(o*f-r*d)),t[2]=n*(l*y-u*g)-a*(o*y-r*g)+m*(o*u-r*l),t[3]=-(n*(l*f-u*d)-a*(o*f-r*d)+h*(o*u-r*l)),t[4]=-(s*(d*y-f*g)-c*(l*y-u*g)+p*(l*f-u*d)),t[5]=i*(d*y-f*g)-c*(o*y-r*g)+p*(o*f-r*d),t[6]=-(i*(l*y-u*g)-s*(o*y-r*g)+p*(o*u-r*l)),t[7]=i*(l*f-u*d)-s*(o*f-r*d)+c*(o*u-r*l),t[8]=s*(h*y-f*m)-c*(a*y-u*m)+p*(a*f-u*h),t[9]=-(i*(h*y-f*m)-c*(n*y-r*m)+p*(n*f-r*h)),t[10]=i*(a*y-u*m)-s*(n*y-r*m)+p*(n*u-r*a),t[11]=-(i*(a*f-u*h)-s*(n*f-r*h)+c*(n*u-r*a)),t[12]=-(s*(h*g-d*m)-c*(a*g-l*m)+p*(a*d-l*h)),t[13]=i*(h*g-d*m)-c*(n*g-o*m)+p*(n*d-o*h),t[14]=-(i*(a*g-l*m)-s*(n*g-o*m)+p*(n*l-o*a)),t[15]=i*(a*d-l*h)-s*(n*d-o*h)+c*(n*l-o*a),t},g.determinant=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],r=t[4],s=t[5],a=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15];return(e*s-i*r)*(h*g-d*m)-(e*a-n*r)*(c*g-d*p)+(e*l-o*r)*(c*m-h*p)+(i*a-n*s)*(u*g-d*f)-(i*l-o*s)*(u*m-h*f)+(n*l-o*a)*(u*p-c*f)},g.multiply=o,g.translate=function(t,e,i){var n,o,r,s,a,l,u,c,h,d,f,p,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=n=e[0],t[1]=o,t[2]=r,t[3]=s,t[4]=a,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=n*m+a*g+h*y+e[12],t[13]=o*m+l*g+d*y+e[13],t[14]=r*m+u*g+f*y+e[14],t[15]=s*m+c*g+p*y+e[15]),t},g.scale=function(t,e,i){var n=i[0],o=i[1],r=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},g.rotate=function(t,i,n,o){var r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C,w,S,T,A,M,I,E=o[0],P=o[1],k=o[2],B=Math.hypot(E,P,k);return B<e.EPSILON?null:(E*=B=1/B,P*=B,k*=B,r=Math.sin(n),s=Math.cos(n),u=i[1],c=i[2],h=i[3],f=i[5],p=i[6],m=i[7],y=i[9],_=i[10],v=i[11],x=E*E*(a=1-s)+s,w=E*P*a-k*r,S=P*P*a+s,T=k*P*a+E*r,A=E*k*a+P*r,M=P*k*a-E*r,I=k*k*a+s,t[0]=(l=i[0])*x+(d=i[4])*(b=P*E*a+k*r)+(g=i[8])*(C=k*E*a-P*r),t[1]=u*x+f*b+y*C,t[2]=c*x+p*b+_*C,t[3]=h*x+m*b+v*C,t[4]=l*w+d*S+g*T,t[5]=u*w+f*S+y*T,t[6]=c*w+p*S+_*T,t[7]=h*w+m*S+v*T,t[8]=l*A+d*M+g*I,t[9]=u*A+f*M+y*I,t[10]=c*A+p*M+_*I,t[11]=h*A+m*M+v*I,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)},g.rotateX=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*o+u*n,t[5]=s*o+c*n,t[6]=a*o+h*n,t[7]=l*o+d*n,t[8]=u*o-r*n,t[9]=c*o-s*n,t[10]=h*o-a*n,t[11]=d*o-l*n,t},g.rotateY=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o-u*n,t[1]=s*o-c*n,t[2]=a*o-h*n,t[3]=l*o-d*n,t[8]=r*n+u*o,t[9]=s*n+c*o,t[10]=a*n+h*o,t[11]=l*n+d*o,t},g.rotateZ=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o+u*n,t[1]=s*o+c*n,t[2]=a*o+h*n,t[3]=l*o+d*n,t[4]=u*o-r*n,t[5]=c*o-s*n,t[6]=h*o-a*n,t[7]=d*o-l*n,t},g.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},g.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},g.fromRotation=function(t,i,n){var o,r,s,a=n[0],l=n[1],u=n[2],c=Math.hypot(a,l,u);return c<e.EPSILON?null:(a*=c=1/c,l*=c,u*=c,o=Math.sin(i),r=Math.cos(i),t[0]=a*a*(s=1-r)+r,t[1]=l*a*s+u*o,t[2]=u*a*s-l*o,t[3]=0,t[4]=a*l*s-u*o,t[5]=l*l*s+r,t[6]=u*l*s+a*o,t[7]=0,t[8]=a*u*s+l*o,t[9]=l*u*s-a*o,t[10]=u*u*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},g.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},g.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},g.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},g.fromRotationTranslation=s,g.fromQuat2=function(t,i){var n=new e.ARRAY_TYPE(3),o=-i[0],r=-i[1],a=-i[2],l=i[3],u=i[4],c=i[5],h=i[6],d=i[7],f=o*o+r*r+a*a+l*l;return f>0?(n[0]=2*(u*l+d*o+c*a-h*r)/f,n[1]=2*(c*l+d*r+h*o-u*a)/f,n[2]=2*(h*l+d*a+u*r-c*o)/f):(n[0]=2*(u*l+d*o+c*a-h*r),n[1]=2*(c*l+d*r+h*o-u*a),n[2]=2*(h*l+d*a+u*r-c*o)),s(t,i,n),t},g.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},g.getScaling=a,g.getRotation=function(t,i){var n=new e.ARRAY_TYPE(3);a(n,i);var o=1/n[0],r=1/n[1],s=1/n[2],l=i[0]*o,u=i[1]*r,c=i[2]*s,h=i[4]*o,d=i[5]*r,f=i[6]*s,p=i[8]*o,m=i[9]*r,g=i[10]*s,y=l+d+g,_=0;return y>0?(_=2*Math.sqrt(y+1),t[3]=.25*_,t[0]=(f-m)/_,t[1]=(p-c)/_,t[2]=(u-h)/_):l>d&&l>g?(_=2*Math.sqrt(1+l-d-g),t[3]=(f-m)/_,t[0]=.25*_,t[1]=(u+h)/_,t[2]=(p+c)/_):d>g?(_=2*Math.sqrt(1+d-l-g),t[3]=(p-c)/_,t[0]=(u+h)/_,t[1]=.25*_,t[2]=(f+m)/_):(_=2*Math.sqrt(1+g-l-d),t[3]=(u-h)/_,t[0]=(p+c)/_,t[1]=(f+m)/_,t[2]=.25*_),t},g.fromRotationTranslationScale=function(t,e,i,n){var o=e[0],r=e[1],s=e[2],a=e[3],l=o+o,u=r+r,c=s+s,h=o*l,d=o*u,f=o*c,p=r*u,m=r*c,g=s*c,y=a*l,_=a*u,v=a*c,x=n[0],b=n[1],C=n[2];return t[0]=(1-(p+g))*x,t[1]=(d+v)*x,t[2]=(f-_)*x,t[3]=0,t[4]=(d-v)*b,t[5]=(1-(h+g))*b,t[6]=(m+y)*b,t[7]=0,t[8]=(f+_)*C,t[9]=(m-y)*C,t[10]=(1-(h+p))*C,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},g.fromRotationTranslationScaleOrigin=function(t,e,i,n,o){var r=e[0],s=e[1],a=e[2],l=e[3],u=r+r,c=s+s,h=a+a,d=r*u,f=r*c,p=r*h,m=s*c,g=s*h,y=a*h,_=l*u,v=l*c,x=l*h,b=n[0],C=n[1],w=n[2],S=o[0],T=o[1],A=o[2],M=(1-(m+y))*b,I=(f+x)*b,E=(p-v)*b,P=(f-x)*C,k=(1-(d+y))*C,B=(g+_)*C,D=(p+v)*w,R=(g-_)*w,L=(1-(d+m))*w;return t[0]=M,t[1]=I,t[2]=E,t[3]=0,t[4]=P,t[5]=k,t[6]=B,t[7]=0,t[8]=D,t[9]=R,t[10]=L,t[11]=0,t[12]=i[0]+S-(M*S+P*T+D*A),t[13]=i[1]+T-(I*S+k*T+R*A),t[14]=i[2]+A-(E*S+B*T+L*A),t[15]=1,t},g.fromQuat=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i+i,a=n+n,l=o+o,u=i*s,c=n*s,h=n*a,d=o*s,f=o*a,p=o*l,m=r*s,g=r*a,y=r*l;return t[0]=1-h-p,t[1]=c+y,t[2]=d-g,t[3]=0,t[4]=c-y,t[5]=1-u-p,t[6]=f+m,t[7]=0,t[8]=d+g,t[9]=f-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},g.frustum=function(t,e,i,n,o,r,s){var a=1/(i-e),l=1/(o-n),u=1/(r-s);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(o+n)*l,t[10]=(s+r)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r*2*u,t[15]=0,t},g.perspectiveNO=l,g.perspectiveZO=function(t,e,i,n,o){var r,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(t[10]=o*(r=1/(n-o)),t[14]=o*n*r):(t[10]=-1,t[14]=-n),t},g.perspectiveFromFieldOfView=function(t,e,i,n){var o=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),u=2/(o+r);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(o-r)*u*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},g.orthoNO=u,g.orthoZO=function(t,e,i,n,o,r,s){var a=1/(e-i),l=1/(n-o),u=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+i)*a,t[13]=(o+n)*l,t[14]=r*u,t[15]=1,t},g.lookAt=function(t,i,o,r){var s,a,l,u,c,h,d,f,p,m,g=i[0],y=i[1],_=i[2],v=r[0],x=r[1],b=r[2],C=o[0],w=o[1],S=o[2];return Math.abs(g-C)<e.EPSILON&&Math.abs(y-w)<e.EPSILON&&Math.abs(_-S)<e.EPSILON?n(t):(d=g-C,f=y-w,p=_-S,s=x*(p*=m=1/Math.hypot(d,f,p))-b*(f*=m),a=b*(d*=m)-v*p,l=v*f-x*d,(m=Math.hypot(s,a,l))?(s*=m=1/m,a*=m,l*=m):(s=0,a=0,l=0),u=f*l-p*a,c=p*s-d*l,h=d*a-f*s,(m=Math.hypot(u,c,h))?(u*=m=1/m,c*=m,h*=m):(u=0,c=0,h=0),t[0]=s,t[1]=u,t[2]=d,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=l,t[9]=h,t[10]=p,t[11]=0,t[12]=-(s*g+a*y+l*_),t[13]=-(u*g+c*y+h*_),t[14]=-(d*g+f*y+p*_),t[15]=1,t)},g.targetTo=function(t,e,i,n){var o=e[0],r=e[1],s=e[2],a=n[0],l=n[1],u=n[2],c=o-i[0],h=r-i[1],d=s-i[2],f=c*c+h*h+d*d;f>0&&(c*=f=1/Math.sqrt(f),h*=f,d*=f);var p=l*d-u*h,m=u*c-a*d,g=a*h-l*c;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-d*m,t[5]=d*p-c*g,t[6]=c*m-h*p,t[7]=0,t[8]=c,t[9]=h,t[10]=d,t[11]=0,t[12]=o,t[13]=r,t[14]=s,t[15]=1,t},g.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},g.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},g.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},g.subtract=c,g.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},g.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},g.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},g.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=i[0],x=i[1],b=i[2],C=i[3],w=i[4],S=i[5],T=i[6],A=i[7],M=i[8],I=i[9],E=i[10],P=i[11],k=i[12],B=i[13],D=i[14],R=i[15];return Math.abs(n-v)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(r-b)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-C)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-w)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-S)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-T)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-A)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-M)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-I)<=e.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-E)<=e.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(p-P)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-k)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-B)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(y-D)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(_-R)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},g.sub=g.mul=g.ortho=g.perspective=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=i[0],x=i[1],b=i[2],C=i[3];return t[0]=v*n+x*a+b*h+C*m,t[1]=v*o+x*l+b*d+C*g,t[2]=v*r+x*u+b*f+C*y,t[3]=v*s+x*c+b*p+C*_,t[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(C=i[7])*m,t[5]=v*o+x*l+b*d+C*g,t[6]=v*r+x*u+b*f+C*y,t[7]=v*s+x*c+b*p+C*_,t[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(C=i[11])*m,t[9]=v*o+x*l+b*d+C*g,t[10]=v*r+x*u+b*f+C*y,t[11]=v*s+x*c+b*p+C*_,t[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(C=i[15])*m,t[13]=v*o+x*l+b*d+C*g,t[14]=v*r+x*u+b*f+C*y,t[15]=v*s+x*c+b*p+C*_,t}function s(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=n+n,l=o+o,u=r+r,c=n*a,h=n*l,d=n*u,f=o*l,p=o*u,m=r*u,g=s*a,y=s*l,_=s*u;return t[0]=1-(f+m),t[1]=h+_,t[2]=d-y,t[3]=0,t[4]=h-_,t[5]=1-(c+m),t[6]=p+g,t[7]=0,t[8]=d+y,t[9]=p-g,t[10]=1-(c+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function a(t,e){var i=e[4],n=e[5],o=e[6],r=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,o),t[2]=Math.hypot(r,s,a),t}function l(t,e,i,n,o){var r,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(t[10]=(o+n)*(r=1/(n-o)),t[14]=2*o*n*r):(t[10]=-1,t[14]=-2*n),t}function u(t,e,i,n,o,r,s){var a=1/(e-i),l=1/(n-o),u=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(o+n)*l,t[14]=(s+r)*u,t[15]=1,t}function c(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}return g.perspective=l,g.ortho=u,g.mul=o,g.sub=c,g}var _,v={},x={};function b(){if(_)return x;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}_=1,Object.defineProperty(x,"__esModule",{value:!0}),x.create=n,x.clone=function(t){var i=new e.ARRAY_TYPE(3);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i},x.length=o,x.fromValues=function(t,i,n){var o=new e.ARRAY_TYPE(3);return o[0]=t,o[1]=i,o[2]=n,o},x.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},x.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},x.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},x.subtract=s,x.multiply=a,x.divide=l,x.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},x.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},x.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},x.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},x.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},x.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},x.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},x.distance=u,x.squaredDistance=c,x.squaredLength=h,x.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},x.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},x.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],r=i*i+n*n+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},x.dot=d,x.cross=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[0],a=i[1],l=i[2];return t[0]=o*l-r*a,t[1]=r*s-n*l,t[2]=n*a-o*s,t},x.lerp=function(t,e,i,n){var o=e[0],r=e[1],s=e[2];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t[2]=s+n*(i[2]-s),t},x.hermite=function(t,e,i,n,o,r){var s=r*r,a=s*(2*r-3)+1,l=s*(r-2)+r,u=s*(r-1),c=s*(3-2*r);return t[0]=e[0]*a+i[0]*l+n[0]*u+o[0]*c,t[1]=e[1]*a+i[1]*l+n[1]*u+o[1]*c,t[2]=e[2]*a+i[2]*l+n[2]*u+o[2]*c,t},x.bezier=function(t,e,i,n,o,r){var s=1-r,a=s*s,l=r*r,u=a*s,c=3*r*a,h=3*l*s,d=l*r;return t[0]=e[0]*u+i[0]*c+n[0]*h+o[0]*d,t[1]=e[1]*u+i[1]*c+n[1]*h+o[1]*d,t[2]=e[2]*u+i[2]*c+n[2]*h+o[2]*d,t},x.random=function(t,i){i=i||1;var n=2*e.RANDOM()*Math.PI,o=2*e.RANDOM()-1,r=Math.sqrt(1-o*o)*i;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=o*i,t},x.transformMat4=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[3]*n+i[7]*o+i[11]*r+i[15];return t[0]=(i[0]*n+i[4]*o+i[8]*r+i[12])/(s=s||1),t[1]=(i[1]*n+i[5]*o+i[9]*r+i[13])/s,t[2]=(i[2]*n+i[6]*o+i[10]*r+i[14])/s,t},x.transformMat3=function(t,e,i){var n=e[0],o=e[1],r=e[2];return t[0]=n*i[0]+o*i[3]+r*i[6],t[1]=n*i[1]+o*i[4]+r*i[7],t[2]=n*i[2]+o*i[5]+r*i[8],t},x.transformQuat=function(t,e,i){var n=i[0],o=i[1],r=i[2],s=e[0],a=e[1],l=e[2],u=o*l-r*a,c=r*s-n*l,h=n*a-o*s,d=o*h-r*c,f=r*u-n*h,p=n*c-o*u,m=2*i[3];return c*=m,h*=m,f*=2,p*=2,t[0]=s+(u*=m)+(d*=2),t[1]=a+c+f,t[2]=l+h+p,t},x.rotateX=function(t,e,i,n){var o=[],r=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],r[0]=o[0],r[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),r[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},x.rotateY=function(t,e,i,n){var o=[],r=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],r[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),r[1]=o[1],r[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},x.rotateZ=function(t,e,i,n){var o=[],r=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],r[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),r[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),r[2]=o[2],t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},x.angle=function(t,e){var i=t[0],n=t[1],o=t[2],r=e[0],s=e[1],a=e[2],l=Math.sqrt(i*i+n*n+o*o)*Math.sqrt(r*r+s*s+a*a),u=l&&d(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))},x.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},x.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},x.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},x.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=i[0],a=i[1],l=i[2];return Math.abs(n-s)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-a)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-l)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))},x.forEach=x.sqrLen=x.len=x.sqrDist=x.dist=x.div=x.mul=x.sub=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(){var t=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){return Math.hypot(t[0],t[1],t[2])}function s(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function a(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function l(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function u(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function c(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return i*i+n*n+o*o}function h(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}x.sub=s,x.mul=a,x.div=l,x.dist=u,x.sqrDist=c,x.len=o,x.sqrLen=h;var f,p=(f=n(),function(t,e,i,n,o,r){var s,a;for(e||(e=3),i||(i=0),a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)f[0]=t[s],f[1]=t[s+1],f[2]=t[s+2],o(f,f,r),t[s]=f[0],t[s+1]=f[1],t[s+2]=f[2];return t});return x.forEach=p,x}var C,w,S={};function T(){if(C)return S;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}C=1,Object.defineProperty(S,"__esModule",{value:!0}),S.create=n,S.clone=function(t){var i=new e.ARRAY_TYPE(4);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i},S.fromValues=function(t,i,n,o){var r=new e.ARRAY_TYPE(4);return r[0]=t,r[1]=i,r[2]=n,r[3]=o,r},S.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},S.set=function(t,e,i,n,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t},S.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},S.subtract=o,S.multiply=s,S.divide=a,S.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},S.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},S.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},S.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},S.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},S.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},S.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},S.distance=l,S.squaredDistance=u,S.length=c,S.squaredLength=h,S.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},S.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},S.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*i+n*n+o*o+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=n*s,t[2]=o*s,t[3]=r*s,t},S.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},S.cross=function(t,e,i,n){var o=i[0]*n[1]-i[1]*n[0],r=i[0]*n[2]-i[2]*n[0],s=i[0]*n[3]-i[3]*n[0],a=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],u=i[2]*n[3]-i[3]*n[2],c=e[0],h=e[1],d=e[2],f=e[3];return t[0]=h*u-d*l+f*a,t[1]=-c*u+d*s-f*r,t[2]=c*l-h*s+f*o,t[3]=-c*a+h*r-d*o,t},S.lerp=function(t,e,i,n){var o=e[0],r=e[1],s=e[2],a=e[3];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t[2]=s+n*(i[2]-s),t[3]=a+n*(i[3]-a),t},S.random=function(t,i){var n,o,r,s,a,l;i=i||1;do{a=(n=2*e.RANDOM()-1)*n+(o=2*e.RANDOM()-1)*o}while(a>=1);do{l=(r=2*e.RANDOM()-1)*r+(s=2*e.RANDOM()-1)*s}while(l>=1);var u=Math.sqrt((1-a)/l);return t[0]=i*n,t[1]=i*o,t[2]=i*r*u,t[3]=i*s*u,t},S.transformMat4=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3];return t[0]=i[0]*n+i[4]*o+i[8]*r+i[12]*s,t[1]=i[1]*n+i[5]*o+i[9]*r+i[13]*s,t[2]=i[2]*n+i[6]*o+i[10]*r+i[14]*s,t[3]=i[3]*n+i[7]*o+i[11]*r+i[15]*s,t},S.transformQuat=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[0],a=i[1],l=i[2],u=i[3],c=u*n+a*r-l*o,h=u*o+l*n-s*r,d=u*r+s*o-a*n,f=-s*n-a*o-l*r;return t[0]=c*u+f*-s+h*-l-d*-a,t[1]=h*u+f*-a+d*-s-c*-l,t[2]=d*u+f*-l+c*-a-h*-s,t[3]=e[3],t},S.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},S.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},S.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},S.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=i[0],l=i[1],u=i[2],c=i[3];return Math.abs(n-a)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-l)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(r-u)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-c)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},S.forEach=S.sqrLen=S.len=S.sqrDist=S.dist=S.div=S.mul=S.sub=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(){var t=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function s(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function a(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function l(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function u(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],r=e[3]-t[3];return i*i+n*n+o*o+r*r}function c(t){return Math.hypot(t[0],t[1],t[2],t[3])}function h(t){var e=t[0],i=t[1],n=t[2],o=t[3];return e*e+i*i+n*n+o*o}S.sub=o,S.mul=s,S.div=a,S.dist=l,S.sqrDist=u,S.len=c,S.sqrLen=h;var d,f=(d=n(),function(t,e,i,n,o,r){var s,a;for(e||(e=4),i||(i=0),a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)d[0]=t[s],d[1]=t[s+1],d[2]=t[s+2],d[3]=t[s+3],o(d,d,r),t[s]=d[0],t[s+1]=d[1],t[s+2]=d[2],t[s+3]=d[3];return t});return S.forEach=f,S}function A(){if(w)return v;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}w=1,Object.defineProperty(v,"__esModule",{value:!0}),v.create=l,v.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},v.setAxisAngle=u,v.getAxisAngle=function(t,i){var n=2*Math.acos(i[3]),o=Math.sin(n/2);return o>e.EPSILON?(t[0]=i[0]/o,t[1]=i[1]/o,t[2]=i[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},v.getAngle=function(t,e){var i=y(t,e);return Math.acos(2*i*i-1)},v.multiply=c,v.rotateX=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*a,t[1]=o*l+r*a,t[2]=r*l-o*a,t[3]=s*l-n*a,t},v.rotateY=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l-r*a,t[1]=o*l+s*a,t[2]=r*l+n*a,t[3]=s*l-o*a,t},v.rotateZ=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*a,t[1]=o*l-n*a,t[2]=r*l+s*a,t[3]=s*l-r*a,t},v.calculateW=function(t,e){var i=e[0],n=e[1],o=e[2];return t[0]=i,t[1]=n,t[2]=o,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-o*o)),t},v.exp=h,v.ln=d,v.pow=function(t,e,i){return d(t,e),g(t,t,i),h(t,t),t},v.slerp=f,v.random=function(t){var i=e.RANDOM(),n=e.RANDOM(),o=e.RANDOM(),r=Math.sqrt(1-i),s=Math.sqrt(i);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=s*Math.sin(2*Math.PI*o),t[3]=s*Math.cos(2*Math.PI*o),t},v.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*i+n*n+o*o+r*r,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-o*a,t[3]=r*a,t},v.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},v.fromMat3=m,v.fromEuler=function(t,e,i,n){var o=.5*Math.PI/180;e*=o,i*=o,n*=o;var r=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),u=Math.sin(n),c=Math.cos(n);return t[0]=r*l*c-s*a*u,t[1]=s*a*c+r*l*u,t[2]=s*l*u-r*a*c,t[3]=s*l*c+r*a*u,t},v.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},v.setAxes=v.sqlerp=v.rotationTo=v.equals=v.exactEquals=v.normalize=v.sqrLen=v.squaredLength=v.len=v.length=v.lerp=v.dot=v.scale=v.mul=v.add=v.set=v.copy=v.fromValues=v.clone=void 0;var e=a(r()),i=a(p()),n=a(b()),o=a(T());function s(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(s=function(t){return t?i:e})(t)}function a(e,i){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=s(i);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=r?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}function l(){var t=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function u(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function c(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],l=i[1],u=i[2],c=i[3];return t[0]=n*c+s*a+o*u-r*l,t[1]=o*c+s*l+r*a-n*u,t[2]=r*c+s*u+n*l-o*a,t[3]=s*c-n*a-o*l-r*u,t}function h(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=Math.sqrt(i*i+n*n+o*o),a=Math.exp(r),l=s>0?a*Math.sin(s)/s:0;return t[0]=i*l,t[1]=n*l,t[2]=o*l,t[3]=a*Math.cos(s),t}function d(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=Math.sqrt(i*i+n*n+o*o),a=s>0?Math.atan2(s,r)/s:0;return t[0]=i*a,t[1]=n*a,t[2]=o*a,t[3]=.5*Math.log(i*i+n*n+o*o+r*r),t}function f(t,i,n,o){var r,s,a,l,u,c=i[0],h=i[1],d=i[2],f=i[3],p=n[0],m=n[1],g=n[2],y=n[3];return(s=c*p+h*m+d*g+f*y)<0&&(s=-s,p=-p,m=-m,g=-g,y=-y),1-s>e.EPSILON?(r=Math.acos(s),a=Math.sin(r),l=Math.sin((1-o)*r)/a,u=Math.sin(o*r)/a):(l=1-o,u=o),t[0]=l*c+u*p,t[1]=l*h+u*m,t[2]=l*d+u*g,t[3]=l*f+u*y,t}function m(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var r=(o+1)%3,s=(o+2)%3;i=Math.sqrt(e[3*o+o]-e[3*r+r]-e[3*s+s]+1),t[o]=.5*i,t[3]=(e[3*r+s]-e[3*s+r])*(i=.5/i),t[r]=(e[3*r+o]+e[3*o+r])*i,t[s]=(e[3*s+o]+e[3*o+s])*i}return t}v.clone=o.clone,v.fromValues=o.fromValues,v.copy=o.copy,v.set=o.set,v.add=o.add,v.mul=c;var g=o.scale;v.scale=g;var y=o.dot;v.dot=y,v.lerp=o.lerp;var _=o.length;v.length=_,v.len=_;var x=o.squaredLength;v.squaredLength=x,v.sqrLen=x;var C=o.normalize;v.normalize=C,v.exactEquals=o.exactEquals,v.equals=o.equals;var S,A,M,I=(S=n.create(),A=n.fromValues(1,0,0),M=n.fromValues(0,1,0),function(t,e,i){var o=n.dot(e,i);return o<-.999999?(n.cross(S,A,e),n.len(S)<1e-6&&n.cross(S,M,e),n.normalize(S,S),u(t,S,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(n.cross(S,e,i),t[0]=S[0],t[1]=S[1],t[2]=S[2],t[3]=1+o,C(t,t))});v.rotationTo=I;var E,P,k=(E=l(),P=l(),function(t,e,i,n,o,r){return f(E,e,o,r),f(P,i,n,r),f(t,E,P,2*r*(1-r)),t});v.sqlerp=k;var B,D=(B=i.create(),function(t,e,i,n){return B[0]=i[0],B[3]=i[1],B[6]=i[2],B[1]=n[0],B[4]=n[1],B[7]=n[2],B[2]=-e[0],B[5]=-e[1],B[8]=-e[2],C(t,m(t,B))});return v.setAxes=D,v}var M,I={};function E(){if(M)return I;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}M=1,Object.defineProperty(I,"__esModule",{value:!0}),I.create=function(){var t=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},I.clone=function(t){var i=new e.ARRAY_TYPE(8);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i},I.fromValues=function(t,i,n,o,r,s,a,l){var u=new e.ARRAY_TYPE(8);return u[0]=t,u[1]=i,u[2]=n,u[3]=o,u[4]=r,u[5]=s,u[6]=a,u[7]=l,u},I.fromRotationTranslationValues=function(t,i,n,o,r,s,a){var l=new e.ARRAY_TYPE(8);l[0]=t,l[1]=i,l[2]=n,l[3]=o;var u=.5*r,c=.5*s,h=.5*a;return l[4]=u*o+c*n-h*i,l[5]=c*o+h*t-u*n,l[6]=h*o+u*i-c*t,l[7]=-u*t-c*i-h*n,l},I.fromRotationTranslation=a,I.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},I.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},I.fromMat4=function(t,o){var r=i.create();n.getRotation(r,o);var s=new e.ARRAY_TYPE(3);return n.getTranslation(s,o),a(t,r,s),t},I.copy=l,I.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},I.set=function(t,e,i,n,o,r,s,a,l){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=l,t},I.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},I.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},I.getTranslation=function(t,e){var i=e[4],n=e[5],o=e[6],r=e[7],s=-e[0],a=-e[1],l=-e[2],u=e[3];return t[0]=2*(i*u+r*s+n*l-o*a),t[1]=2*(n*u+r*a+o*s-i*l),t[2]=2*(o*u+r*l+i*a-n*s),t},I.translate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=.5*i[0],l=.5*i[1],u=.5*i[2],c=e[4],h=e[5],d=e[6],f=e[7];return t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=s*a+o*u-r*l+c,t[5]=s*l+r*a-n*u+h,t[6]=s*u+n*l-o*a+d,t[7]=-n*a-o*l-r*u+f,t},I.rotateX=function(t,e,n){var o=-e[0],r=-e[1],s=-e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=l*a+h*o+u*s-c*r,f=u*a+h*r+c*o-l*s,p=c*a+h*s+l*r-u*o,m=h*a-l*o-u*r-c*s;return i.rotateX(t,e,n),t[4]=d*(a=t[3])+m*(o=t[0])+f*(s=t[2])-p*(r=t[1]),t[5]=f*a+m*r+p*o-d*s,t[6]=p*a+m*s+d*r-f*o,t[7]=m*a-d*o-f*r-p*s,t},I.rotateY=function(t,e,n){var o=-e[0],r=-e[1],s=-e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=l*a+h*o+u*s-c*r,f=u*a+h*r+c*o-l*s,p=c*a+h*s+l*r-u*o,m=h*a-l*o-u*r-c*s;return i.rotateY(t,e,n),t[4]=d*(a=t[3])+m*(o=t[0])+f*(s=t[2])-p*(r=t[1]),t[5]=f*a+m*r+p*o-d*s,t[6]=p*a+m*s+d*r-f*o,t[7]=m*a-d*o-f*r-p*s,t},I.rotateZ=function(t,e,n){var o=-e[0],r=-e[1],s=-e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=l*a+h*o+u*s-c*r,f=u*a+h*r+c*o-l*s,p=c*a+h*s+l*r-u*o,m=h*a-l*o-u*r-c*s;return i.rotateZ(t,e,n),t[4]=d*(a=t[3])+m*(o=t[0])+f*(s=t[2])-p*(r=t[1]),t[5]=f*a+m*r+p*o-d*s,t[6]=p*a+m*s+d*r-f*o,t[7]=m*a-d*o-f*r-p*s,t},I.rotateByQuatAppend=function(t,e,i){var n=i[0],o=i[1],r=i[2],s=i[3],a=e[0],l=e[1],u=e[2],c=e[3];return t[0]=a*s+c*n+l*r-u*o,t[1]=l*s+c*o+u*n-a*r,t[2]=u*s+c*r+a*o-l*n,t[3]=c*s-a*n-l*o-u*r,t[4]=(a=e[4])*s+(c=e[7])*n+(l=e[5])*r-(u=e[6])*o,t[5]=l*s+c*o+u*n-a*r,t[6]=u*s+c*r+a*o-l*n,t[7]=c*s-a*n-l*o-u*r,t},I.rotateByQuatPrepend=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],l=i[1],u=i[2],c=i[3];return t[0]=n*c+s*a+o*u-r*l,t[1]=o*c+s*l+r*a-n*u,t[2]=r*c+s*u+n*l-o*a,t[3]=s*c-n*a-o*l-r*u,t[4]=n*(c=i[7])+s*(a=i[4])+o*(u=i[6])-r*(l=i[5]),t[5]=o*c+s*l+r*a-n*u,t[6]=r*c+s*u+n*l-o*a,t[7]=s*c-n*a-o*l-r*u,t},I.rotateAroundAxis=function(t,i,n,o){if(Math.abs(o)<e.EPSILON)return l(t,i);var r=Math.hypot(n[0],n[1],n[2]);o*=.5;var s=Math.sin(o),a=s*n[0]/r,u=s*n[1]/r,c=s*n[2]/r,h=Math.cos(o),d=i[0],f=i[1],p=i[2],m=i[3];t[0]=d*h+m*a+f*c-p*u,t[1]=f*h+m*u+p*a-d*c,t[2]=p*h+m*c+d*u-f*a,t[3]=m*h-d*a-f*u-p*c;var g=i[4],y=i[5],_=i[6],v=i[7];return t[4]=g*h+v*a+y*c-_*u,t[5]=y*h+v*u+_*a-g*c,t[6]=_*h+v*c+g*u-y*a,t[7]=v*h-g*a-y*u-_*c,t},I.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},I.multiply=u,I.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},I.lerp=function(t,e,i,n){var o=1-n;return c(e,i)<0&&(n=-n),t[0]=e[0]*o+i[0]*n,t[1]=e[1]*o+i[1]*n,t[2]=e[2]*o+i[2]*n,t[3]=e[3]*o+i[3]*n,t[4]=e[4]*o+i[4]*n,t[5]=e[5]*o+i[5]*n,t[6]=e[6]*o+i[6]*n,t[7]=e[7]*o+i[7]*n,t},I.invert=function(t,e){var i=d(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},I.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},I.normalize=function(t,e){var i=d(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,o=e[1]/i,r=e[2]/i,s=e[3]/i,a=e[4],l=e[5],u=e[6],c=e[7],h=n*a+o*l+r*u+s*c;t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=(a-n*h)/i,t[5]=(l-o*h)/i,t[6]=(u-r*h)/i,t[7]=(c-s*h)/i}return t},I.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},I.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},I.equals=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=i[0],d=i[1],f=i[2],p=i[3],m=i[4],g=i[5],y=i[6],_=i[7];return Math.abs(n-h)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-d)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(r-f)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-p)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-m)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-y)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-_)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},I.sqrLen=I.squaredLength=I.len=I.length=I.dot=I.mul=I.setReal=I.getReal=void 0;var e=s(r()),i=s(A()),n=s(y());function o(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(o=function(t){return t?i:e})(t)}function s(e,i){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=o(i);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(r,a,l):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function a(t,e,i){var n=.5*i[0],o=.5*i[1],r=.5*i[2],s=e[0],a=e[1],l=e[2],u=e[3];return t[0]=s,t[1]=a,t[2]=l,t[3]=u,t[4]=n*u+o*l-r*a,t[5]=o*u+r*s-n*l,t[6]=r*u+n*a-o*s,t[7]=-n*s-o*a-r*l,t}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function u(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[4],l=i[5],u=i[6],c=i[7],h=e[4],d=e[5],f=e[6],p=e[7],m=i[0],g=i[1],y=i[2],_=i[3];return t[0]=n*_+s*m+o*y-r*g,t[1]=o*_+s*g+r*m-n*y,t[2]=r*_+s*y+n*g-o*m,t[3]=s*_-n*m-o*g-r*y,t[4]=n*c+s*a+o*u-r*l+h*_+p*m+d*y-f*g,t[5]=o*c+s*l+r*a-n*u+d*_+p*g+f*m-h*y,t[6]=r*c+s*u+n*l-o*a+f*_+p*y+h*g-d*m,t[7]=s*c-n*a-o*l-r*u+p*_-h*m-d*g-f*y,t}I.getReal=i.copy,I.setReal=i.copy,I.mul=u;var c=i.dot;I.dot=c;var h=i.length;I.length=h,I.len=h;var d=i.squaredLength;return I.squaredLength=d,I.sqrLen=d,I}var P,k,B={};function D(){if(P)return B;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}P=1,Object.defineProperty(B,"__esModule",{value:!0}),B.create=n,B.clone=function(t){var i=new e.ARRAY_TYPE(2);return i[0]=t[0],i[1]=t[1],i},B.fromValues=function(t,i){var n=new e.ARRAY_TYPE(2);return n[0]=t,n[1]=i,n},B.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},B.set=function(t,e,i){return t[0]=e,t[1]=i,t},B.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},B.subtract=o,B.multiply=s,B.divide=a,B.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},B.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},B.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},B.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},B.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},B.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},B.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},B.distance=l,B.squaredDistance=u,B.length=c,B.squaredLength=h,B.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},B.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},B.normalize=function(t,e){var i=e[0],n=e[1],o=i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t},B.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},B.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},B.lerp=function(t,e,i,n){var o=e[0],r=e[1];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t},B.random=function(t,i){i=i||1;var n=2*e.RANDOM()*Math.PI;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t},B.transformMat2=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[2]*o,t[1]=i[1]*n+i[3]*o,t},B.transformMat2d=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[2]*o+i[4],t[1]=i[1]*n+i[3]*o+i[5],t},B.transformMat3=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[3]*o+i[6],t[1]=i[1]*n+i[4]*o+i[7],t},B.transformMat4=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[4]*o+i[12],t[1]=i[1]*n+i[5]*o+i[13],t},B.rotate=function(t,e,i,n){var o=e[0]-i[0],r=e[1]-i[1],s=Math.sin(n),a=Math.cos(n);return t[0]=o*a-r*s+i[0],t[1]=o*s+r*a+i[1],t},B.angle=function(t,e){var i=t[0],n=t[1],o=e[0],r=e[1],s=Math.sqrt(i*i+n*n)*Math.sqrt(o*o+r*r);return Math.acos(Math.min(Math.max(s&&(i*o+n*r)/s,-1),1))},B.zero=function(t){return t[0]=0,t[1]=0,t},B.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},B.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},B.equals=function(t,i){var n=t[0],o=t[1],r=i[0],s=i[1];return Math.abs(n-r)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(o-s)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))},B.forEach=B.sqrLen=B.sqrDist=B.dist=B.div=B.mul=B.sub=B.len=void 0;var e=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(r());function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}function n(){var t=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function s(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function a(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function l(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function u(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function c(t){return Math.hypot(t[0],t[1])}function h(t){var e=t[0],i=t[1];return e*e+i*i}B.len=c,B.sub=o,B.mul=s,B.div=a,B.dist=l,B.sqrDist=u,B.sqrLen=h;var d,f=(d=n(),function(t,e,i,n,o,r){var s,a;for(e||(e=2),i||(i=0),a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)d[0]=t[s],d[1]=t[s+1],o(d,d,r),t[s]=d[0],t[s+1]=d[1];return t});return B.forEach=f,B}function R(){if(k)return n;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}k=1,Object.defineProperty(n,"__esModule",{value:!0}),n.vec4=n.vec3=n.vec2=n.quat2=n.quat=n.mat4=n.mat3=n.mat2d=n.mat2=n.glMatrix=void 0;var e=_(r());n.glMatrix=e;var i=_(l());n.mat2=i;var o=_(h());n.mat2d=o;var s=_(p());n.mat3=s;var a=_(y());n.mat4=a;var u=_(A());n.quat=u;var c=_(E());n.quat2=c;var d=_(D());n.vec2=d;var f=_(b());n.vec3=f;var m=_(T());function g(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(g=function(t){return t?i:e})(t)}function _(e,i){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=g(i);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}return n.vec4=m,n}var L,z,O,U,F=R(),N=function(){if(z)return L;function t(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}return z=1,L=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var o=this.sampleCurveX(i)-t;if(Math.abs(o)<e)return i;var r=this.sampleCurveDerivativeX(i);if(Math.abs(r)<1e-6)break;i-=o/r}var s=0,a=1;for(i=t,n=0;n<20&&(o=this.sampleCurveX(i),!(Math.abs(o-t)<e));n++)t>o?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},L}(),V=e(N);function H(){if(U)return O;function t(t,e){this.x=t,this.y=e}return U=1,O=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e},O}var j=e(H());function G(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!G(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!G(t[i],e[i]))return!1;return!0}return t===e}const W=Math.PI/180,q=180/Math.PI;function Z(t){return t*W}function $(t){return t*q}const K=[[0,0],[1,0],[1,1],[0,1]];function Y(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function J(t,e,i,n){const o=new V(t,e,i,n);return function(t){return o.solve(t)}}const X=J(.25,.1,.25,1);function Q(t,e,i){return Math.min(i,Math.max(e,t))}function tt(t,e,i){return(i=Q((i-t)/(e-t),0,1))*i*(3-2*i)}function et(t,e,i){const n=i-e,o=((t-e)%n+n)%n+e;return o===e?i:o}function it(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const o=new Array(t.length);let r=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(r=t),o[s]=e,0==--n&&i(r,o)}))}))}function nt(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const o of i)for(const e in o)t[e]=o[e];return t}let ot=1;function rt(){return ot++}function st(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function at(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function lt(t,e){return-1!==t.indexOf(e,t.length-e.length)}function ut(t,e,i){const n={};for(const o in t)n[o]=e.call(this,t[o],o,t);return n}function ct(t,e,i){const n={};for(const o in t)e.call(this,t[o],o,t)&&(n[o]=t[o]);return n}function ht(t){return Array.isArray(t)?t.map(ht):"object"==typeof t&&t?ut(t,ht):t}const dt={};function ft(t){dt[t]||("undefined"!=typeof console&&console.warn(t),dt[t]=!0)}function pt(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function mt(t){let e=0;for(let i,n,o=0,r=t.length,s=r-1;o<r;s=o++)i=t[o],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}function gt(t){let[e,i,n]=t;const o=Z(i+90),r=Z(n);return{x:e*Math.cos(o)*Math.sin(r),y:e*Math.sin(o)*Math.sin(r),z:e*Math.cos(r),azimuthal:i,polar:n}}function yt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function _t(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,o)=>{const r=n||o;return e[i]=!r||r.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let vt=null;function xt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function bt(t,e,i,n){for(;e<i;){const o=e+i>>1;t[o]<n?e=o+1:i=o}return e}function Ct(t,e,i,n){for(;e<i;){const o=e+i>>1;t[o]<=n?e=o+1:i=o}return e}function wt(t){return t>0?1/(1.001-t):1+t}function St(t){return t>0?1-1/(1.001-t):-t}const Tt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Tt.API_URL)return null;try{const t=new URL(Tt.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function At(t){return Tt.API_URL_REGEX.test(t)}function Mt(t){return Tt.API_SPRITE_REGEX.test(t)}let It,Et,Pt,kt,Bt,Dt;function Rt(){return null==It&&(It=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),It}const Lt={now:()=>void 0!==kt?kt:performance.now(),setNow(t){kt=t},restoreNow(){kt=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:i,height:n}=t;Bt||(Bt=document.createElement("canvas"));const o=Bt.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>Bt.width||n>Bt.height)&&(Bt.width=i,Bt.height=n),o.clearRect(-e,-e,i+2*e,n+2*e),o.drawImage(t,0,0,i,n),o.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(Et||(Et=document.createElement("a")),Et.href=t,Et.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Pt&&(Pt=window.matchMedia("(prefers-reduced-motion: reduce)")),Pt.matches)},hasCanvasFingerprintNoise(){if(void 0!==Dt)return Dt;if(!Rt())return Dt=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let o=0;o<t.width;++o)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(o,0,1,1);const n=e.getImageData(0,0,t.width,t.height);i=0;for(let o=0;o<n.data.length;++o)if(o%4!=3&&i++!==n.data[o])return Dt=!0,!0;return Dt=!1,!1}};function zt(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(i));for(const o in e)n.set(o,e[o]);return`${t.slice(0,i)}?${n.toString()}`}function Ot(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const i=t.indexOf("?");if(i<0)return t;const n=new URLSearchParams,o=new URLSearchParams(t.slice(i));for(const s of e.persistentParams){const t=o.get(s);t&&n.set(s,t)}const r=n.toString();return`${t.slice(0,i)}${r.length>0?`?${r}`:""}`}const Ut="mapbox-tiles";let Ft=500,Nt=50;const Vt=["language","worldview","jobid"];let Ht,jt;function Gt(){try{return caches}catch(t){}}function Wt(){const t=Gt();t&&null==Ht&&(Ht=t.open(Ut))}let qt=1/0;const Zt={supported:!1,testSupport:function(t){!Yt&&Kt&&(Jt?Qt(t):$t=t)}};let $t,Kt,Yt=!1,Jt=!1;const Xt="undefined"!=typeof self?self:{};function Qt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Kt),t.isContextLost())return;Zt.supported=!0}catch(t){}t.deleteTexture(e),Yt=!0}Xt.document&&(Kt=Xt.document.createElement("img"),Kt.onload=function(){$t&&Qt($t),$t=null,Jt=!0},Kt.onerror=function(){Yt=!0,$t=null},Kt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(te);class ee extends Error{constructor(t,e,i){401===e&&At(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ie=yt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,ne=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(ie())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const i=new AbortController,n=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:ie(),referrerPolicy:t.referrerPolicy,signal:i.signal});let o=!1,r=!1;const s=(a=n.url).indexOf("sku=")>0&&At(a);var a;"json"===t.type&&n.headers.set("Accept","application/json");const l=(i,o,a)=>{if(r)return;if(i&&"SecurityError"!==i.message&&ft(i.toString()),o&&a)return u(o);const l=Date.now();fetch(n).then((i=>{if(i.ok){const t=s?i.clone():null;return u(i,t,l)}return e(new ee(i.statusText,i.status,t.url))})).catch((i=>{"AbortError"!==i.name&&e(new Error(`${i.message} ${t.url}`))}))},u=(i,s,a)=>{("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{r||(s&&a&&function(t,e,i){if(Wt(),null==Ht)return;const n=_t(e.headers.get("Cache-Control")||"");if(n["no-store"])return;const o={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>o.headers.set(e,t))),n["max-age"]&&o.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString());const r=o.headers.get("Expires");if(!r)return;if(new Date(r).getTime()-i<42e4)return;let s=Ot(t.url,{persistentParams:Vt});if(206===e.status){const e=t.headers.get("Range");if(!e)return;o.status=200,s=zt(s,{range:e})}!function(t,e){if(void 0===jt)try{new Response(new ReadableStream),jt=!0}catch(t){jt=!1}jt?e(t.body):t.blob().then(e)}(e,(t=>{const i=new Response(200!==(n=e.status)&&404!==n&&[101,103,204,205,304].includes(n)?null:t,o);var n;Wt(),null!=Ht&&Ht.then((t=>t.put(s,i))).catch((t=>ft(t.message)))}))}(n,s,a),o=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{r||e(new Error(t.message))}))};return s?function(t,e){if(Wt(),null==Ht)return e(null);Ht.then((i=>{let n=Ot(t.url,{persistentParams:Vt});const o=t.headers.get("Range");o&&(n=zt(n,{range:o})),i.match(n).then((t=>{const o=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=_t(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(t);i.delete(n),o&&i.put(n,t.clone()),e(null,t,o)})).catch(e)})).catch(e)}(n,l):l(null,null),{cancel:()=>{r=!0,o||i.abort()}}}(t,e);if(yt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const n in t.headers)i.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===t.type)try{n=JSON.parse(i.response)}catch(t){return e(t)}e(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new ee(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},oe=function(t,e){return ne(nt(t,{type:"arrayBuffer"}),e)};function re(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ae,le;ae=[],le=0;const ue=function(t,e){if(Zt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),le>=Tt.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ae.push(i),i}le++;let i=!1;const n=()=>{if(!i)for(i=!0,le--;ae.length&&le<Tt.MAX_PARALLEL_IMAGE_REQUESTS;){const t=ae.shift(),{requestParameters:e,callback:i,cancelled:n}=t;n||(t.cancel=ue(e,i).cancel)}},o=oe(t,((t,i,o,r)=>{n(),t?e(t):i&&(self.createImageBitmap?function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((t,i)=>e(t,i,o,r))):function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=se}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(n):se}(i,((t,i)=>e(t,i,o,r))))}));return{cancel:()=>{o.cancel(),n()}}};var ce,he,de,fe={exports:{}},pe={exports:{}},me={exports:{}},ge=function(){if(de)return fe.exports;de=1;var t=(ce||(ce=1,pe.exports=function(t,e){var i,n,o,r,s,a,l,u;for(n=t.length-(i=3&t.length),o=e,s=3432918353,a=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,o=27492+(65535&(r=5*(65535&(o=(o^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:o^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return o^=t.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0}),pe.exports),e=(he||(he=1,me.exports=function(t,e){for(var i,n=t.length,o=e^n,r=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(r)|(255&t.charCodeAt(++r))<<8|(255&t.charCodeAt(++r))<<16|(255&t.charCodeAt(++r))<<24))+((1540483477*(i>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++r;switch(n){case 3:o^=(255&t.charCodeAt(r+2))<<16;case 2:o^=(255&t.charCodeAt(r+1))<<8;case 1:o=1540483477*(65535&(o^=255&t.charCodeAt(r)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0}),me.exports);return fe.exports=t,fe.exports.murmur3=t,fe.exports.murmur2=e,fe.exports}(),ye=e(ge);class _e{constructor(t){nt(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=t}}class ve extends _e{constructor(t){super("error",nt({error:t},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}function xe(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function be(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class Ce{on(t,e){return this._listeners=this._listeners||{},xe(t,e,this._listeners),this}off(t,e){return be(t,e,this._listeners),be(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},xe(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){const i="string"==typeof t?new _e(t,e):t,n=i.type;if(this.listens(n)){i.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,i);const e=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const r of e)be(n,r,this._oneTimeListeners),r.call(this,i);const o=this._eventedParent;o&&(nt(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),o.fire(i))}else i instanceof ve&&console.error(i.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var we,Se={},Te=function(){if(we)return Se;we=1;var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return e("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function n(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function o(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Se.parseCSSColor=function(r){var s,a=r.replace(/ /g,"").toLowerCase();if(a in t)return t[a].slice();if("#"===a[0])return 4===a.length?(s=parseInt(a.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===a.length&&(s=parseInt(a.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),d=1;switch(c){case"rgba":if(4!==h.length)return null;d=n(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),d];case"hsla":if(4!==h.length)return null;d=n(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=n(h[1]),m=n(h[2]),g=m<=.5?m*(p+1):m+p-m*p,y=2*m-g;return[e(255*o(y,g,f+1/3)),e(255*o(y,g,f)),e(255*o(y,g,f-1/3)),d];default:return null}}return null}}catch(t){}return Se}();class Ae{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof Ae)return t;if("string"!=typeof t)return;const e=Te.parseCSSColor(t);return e?new Ae(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toStringPremultipliedAlpha(){const[t,e,i,n]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toString(){const[t,e,i,n]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*e)},${Math.round(255*i)},${n})`}toRenderColor(t){const{r:e,g:i,b:n,a:o}=this;return new Me(t,e,i,n,o)}clone(){return new Ae(this.r,this.g,this.b,this.a)}}class Me{constructor(t,e,i,n,o){if(t){const r=t.image.height,s=r*r;e=0===o?0:e/o*(r-1),i=0===o?0:i/o*(r-1),n=0===o?0:n/o*(r-1);const a=Math.floor(e),l=Math.floor(i),u=Math.floor(n),c=Math.ceil(e),h=Math.ceil(i),d=Math.ceil(n),f=e-a,p=i-l,m=n-u,g=t.image.data,y=4*(a+l*s+u*r),_=4*(a+l*s+d*r),v=4*(a+h*s+u*r),x=4*(a+h*s+d*r),b=4*(c+l*s+u*r),C=4*(c+l*s+d*r),w=4*(c+h*s+u*r),S=4*(c+h*s+d*r);if(y<0||S>=g.length)throw new Error("out of range");this.r=Ie(Ie(Ie(g[y],g[_],m),Ie(g[v],g[x],m),p),Ie(Ie(g[b],g[C],m),Ie(g[w],g[S],m),p),f)/255*o,this.g=Ie(Ie(Ie(g[y+1],g[_+1],m),Ie(g[v+1],g[x+1],m),p),Ie(Ie(g[b+1],g[C+1],m),Ie(g[w+1],g[S+1],m),p),f)/255*o,this.b=Ie(Ie(Ie(g[y+2],g[_+2],m),Ie(g[v+2],g[x+2],m),p),Ie(Ie(g[b+2],g[C+2],m),Ie(g[w+2],g[S+2],m),p),f)/255*o,this.a=o}else this.r=e,this.g=i,this.b=n,this.a=o}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}toHslaArray(){if(0===this.a)return[0,0,0,0];const{r:t,g:e,b:i,a:n}=this,o=Math.min(Math.max(t/n,0),1),r=Math.min(Math.max(e/n,0),1),s=Math.min(Math.max(i/n,0),1),a=Math.min(o,r,s),l=Math.max(o,r,s),u=(a+l)/2;if(a===l)return[0,0,100*u,n];const c=l-a,h=u>.5?c/(2-l-a):c/(l+a);let d=0;return l===o?d=(r-s)/c+(r<s?6:0):l===r?d=(s-o)/c+2:l===s&&(d=(o-r)/c+4),d*=60,[Math.min(Math.max(d,0),360),Math.min(Math.max(100*h,0),100),Math.min(Math.max(100*u,0),100),n]}toArray01(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[t/n,e/n,i/n,n]}toArray01Scaled(t){const{r:e,g:i,b:n,a:o}=this;return 0===o?[0,0,0]:[e/o*t,i/o*t,n/o*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:n}=this;return[t,e,i,n]}toArray01Linear(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(t/n,2.2),Math.pow(e/n,2.2),Math.pow(i/n,2.2),n]}}function Ie(t,e,i){return t*(1-i)+e*i}function Ee(t,e,i){return t.map(((t,n)=>Ie(t,e[n],i)))}Ae.black=new Ae(0,0,0,1),Ae.white=new Ae(1,1,1,1),Ae.transparent=new Ae(0,0,0,0),Ae.red=new Ae(1,0,0,1),Ae.blue=new Ae(0,0,1,1);var Pe=Object.freeze({__proto__:null,array:Ee,color:function(t,e,i){return new Ae(Ie(t.r,e.r,i),Ie(t.g,e.g,i),Ie(t.b,e.b,i),Ie(t.a,e.a,i))},number:Ie});function ke(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const o of i)for(const e in o)t[e]=o[e];return t}class Be extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class De{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[i,n]of e)this.bindings[i]=n}concat(t){return new De(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Re={kind:"null"},Le={kind:"number"},ze={kind:"string"},Oe={kind:"boolean"},Ue={kind:"color"},Fe={kind:"object"},Ne={kind:"value"},Ve={kind:"collator"},He={kind:"formatted"},je={kind:"resolvedImage"};function Ge(t,e){return{kind:"array",itemType:t,N:e}}function We(t){if("array"===t.kind){const e=We(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const qe=[Re,Le,ze,Oe,Ue,He,Fe,Ge(Ne),je];function Ze(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ze(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of qe)if(!Ze(t,e))return null}return`Expected ${We(t)} but found ${We(e)} instead.`}function $e(t,e){return e.some((e=>e.kind===t.kind))}function Ke(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class Ye{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Je{constructor(t,e,i,n,o){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=o}}class Xe{constructor(t){this.sections=t}static fromString(t){return new Xe([new Je(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&t.image.namePrimary))}static factory(t){return t instanceof Xe?t:Xe.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toRenderColor(null).toArray())),t.push(i)}return t}}class Qe{constructor(t,e){if(this.id=t,this.options=e||{params:{}},this.options.transform){const{a:t,b:e,c:i,d:n,e:o,f:r}=this.options.transform;this.options.transform=new DOMMatrix([t,e,i,n,o,r])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(t){return JSON.parse(t).id}static deserializeFromString(t){const e=JSON.parse(t),{a:i,b:n,c:o,d:r,e:s,f:a}=e.options.transform;return new DOMMatrix([i,n,o,r,s,a]),new Qe(e.id,e.options)}scaleSelf(t){return this.options.transform=this.options.transform.scale(t),this}serialize(){const t={id:this.id};this.options&&(t.options=this.options);const{a:e,b:i,c:n,d:o,e:r,f:s}=this.options.transform;return t.options.transform={a:e,b:i,c:n,d:o,e:r,f:s},JSON.stringify(t)}}class ti{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),t.optionsPrimary&&(this.optionsPrimary=t.optionsPrimary),t.optionsSecondary&&(this.optionsSecondary=t.optionsSecondary),this.available=t.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Qe(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Qe(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(t){return"string"==typeof t?ti.build(t):t}static build(t,e,i,n){return t?new ti({namePrimary:t,nameSecondary:e,optionsPrimary:i,optionsSecondary:n,available:!1}):null}}function ei(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ii(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Ae)return!0;if(t instanceof Ye)return!0;if(t instanceof Xe)return!0;if(t instanceof ti)return!0;if(Array.isArray(t)){for(const e of t)if(!ii(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ii(t[e]))return!1;return!0}return!1}function ni(t){if(null===t)return Re;if("string"==typeof t)return ze;if("boolean"==typeof t)return Oe;if("number"==typeof t)return Le;if(t instanceof Ae)return Ue;if(t instanceof Ye)return Ve;if(t instanceof Xe)return He;if(t instanceof ti)return je;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const t=ni(n);if(i){if(i===t)continue;i=Ne;break}i=t}return Ge(i||Ne,e)}return Fe}function oi(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Ae?t.toStringPremultipliedAlpha():t instanceof Xe||t instanceof ti?t.toString():JSON.stringify(t)}class ri{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ii(t[1]))return e.error("invalid value");const i=t[1];let n=ni(i);const o=e.expectedType;return"array"!==n.kind||0!==n.N||!o||"array"!==o.kind||"number"==typeof o.N&&0!==o.N||(n=o),new ri(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ae?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xe?this.value.serialize():this.value}}class si{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ai={string:ze,number:Le,boolean:Oe,object:Fe};class li{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const o=t[0];if("array"===o){let o,r;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in ai)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ai[i],n++}else o=Ne;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);r=t[2],n++}i=Ge(o,r)}else i=ai[o];const r=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Ne);if(!i)return null;r.push(i)}return new li(i,r)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Ze(this.type,ni(i)))return i;if(e===this.args.length-1)throw new si(`The expression ${JSON.stringify(this.args[e].serialize())} evaluated to ${We(ni(i))} but was expected to be of type ${We(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}class ui{constructor(t){this.type=He,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let o=!1;for(let r=1;r<=t.length-1;++r){const i=t[r];if(o&&"object"==typeof i&&!Array.isArray(i)){o=!1;let t=null;if(i["font-scale"]&&(t=e.parseObjectValue(i["font-scale"],r,"font-scale",Le),!t))return null;let s=null;if(i["text-font"]&&(s=e.parseObjectValue(i["text-font"],r,"text-font",Ge(ze)),!s))return null;let a=null;if(i["text-color"]&&(a=e.parseObjectValue(i["text-color"],r,"text-color",Ue),!a))return null;const l=n[n.length-1];l.scale=t,l.font=s,l.textColor=a}else{const i=e.parse(t[r],r,Ne);if(!i)return null;const s=i.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,n.push({content:i,scale:null,font:null,textColor:null})}}return new ui(n)}evaluate(t){return new Xe(this.sections.map((e=>{const i=e.content.evaluate(t);return ni(i)===je?new Je("",i,null,null,null):new Je(oi(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class ci{constructor(t,e,i,n){this._imageWarnHistory={},this.type=je,this.inputPrimary=t,this.inputSecondary=e,this.inputPrimaryParams=i,this.inputSecondaryParams=n}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");let i=1;const n=[];function o(){if(i<t.length){const o=e.parse(t[i],i++,ze);return o?(n.push({image:o,options:void 0}),!0):(e.error(n.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function r(){if(i<t.length){if(null===(o=t[i])||"object"!=typeof o||Array.isArray(o))return!0;const r=t[i].params,s=e.concat(i);if(!r)return i++,!0;if("object"!=typeof r||r.constructor!==Object)return s.error('Image options "params" should be an object'),!1;const a={},l=s.concat(void 0,"params");for(const t in r){if(!t)return l.error("Image parameter name should be non-empty"),!1;const e=l.concat(void 0,t).parse(r[t],void 0,Ue,void 0,{typeAnnotation:"coerce"});if(!e)return!1;a[t]=e}return n[n.length-1].options=a,i++,!0}var o;return!0}for(let s=0;s<2;s++)if(!o()||!r())return;return new ci(n[0].image,n[1]?n[1].image:void 0,n[0].options,n[1]?n[1].options:void 0)}evaluateParams(t,e){const i={};if(e){for(const n in e)if(e[n])try{const o=e[n].evaluate(t),r=`Ignoring image parameter "${n}" with semi-transparent color ${o.toString()}`;if(1!==o.a){this._imageWarnHistory[r]||(console.warn(r),this._imageWarnHistory[r]=!0);continue}i[n]=o}catch(t){continue}if(0!==Object.keys(i).length)return{params:i}}}evaluate(t){const e=ti.build(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0,this.inputPrimaryParams?this.evaluateParams(t,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(t,this.inputSecondaryParams):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){if(t(this.inputPrimary),this.inputPrimaryParams)for(const e in this.inputPrimaryParams)this.inputPrimaryParams[e]&&t(this.inputPrimaryParams[e]);if(this.inputSecondary&&(t(this.inputSecondary),this.inputSecondaryParams))for(const e in this.inputSecondaryParams)this.inputSecondaryParams[e]&&t(this.inputSecondaryParams[e])}outputDefined(){return!1}serializeParams(t){const e={};if(t){for(const i in t)t[i]&&(e[i]=t[i].serialize());return{params:e}}}serialize(){const t=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&t.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(t.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&t.push(this.serializeParams(this.inputSecondaryParams))),t}}function hi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const di={"to-boolean":Oe,"to-color":Ue,"to-number":Le,"to-string":ze};class fi{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0],n=[];let o=Re;if("to-array"===i){if(!Array.isArray(t[1]))return null;const i=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);o=Ge(e.expectedType.itemType,i)}else{if(!(i>0&&ii(t[1][0])))return null;o=Ge(ni(t[1][0]),i)}for(let r=0;r<i;r++){const i=t[1][r];let s;if("array"===hi(i))s=e.parse(i,void 0,o.itemType);else{const t=hi(i);if(t!==o.itemType.kind)return e.error(`Expected ${o.itemType.kind} but found ${t}.`);s=e.registry.literal.parse(["literal",void 0===i?null:i],e)}if(!s)return null;n.push(s)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");o=di[i];for(let i=1;i<t.length;i++){const o=e.parse(t[i],i,Ne);if(!o)return null;n.push(o)}}return new fi(o,n)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Ae)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ei(e[0],e[1],e[2],e[3]),!i))return new Ae(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new si(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new si(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Xe.fromString(oi(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ti.build(oi(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):oi(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new ui([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ci(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const pi=["Unknown","Point","LineString","Polygon"];class mi{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?pi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Ae.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}}class gi{constructor(t,e,i,n,o){this.name=t,this.type=e,this._evaluate=i,this.args=n,this._overloadIndex=o}evaluate(t){if(!this._evaluate){const t=gi.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=gi.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const o=Array.isArray(n)?n[0]:n.type,r=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=[];let a=null,l=-1;for(const[u,c]of r){if(Array.isArray(u)&&u.length!==t.length-1)continue;s.push(u),l++,a=new On(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const n=[];let r=!1;for(let e=1;e<t.length;e++){const i=t[e],o=Array.isArray(u)?u[e-1]:u.type,s=a.parse(i,1+n.length,o);if(!s){r=!0;break}n.push(s)}if(!r)if(Array.isArray(u)&&u.length!==n.length)a.error(`Expected ${u.length} arguments, but found ${n.length} instead.`);else{for(let t=0;t<n.length;t++){const e=Array.isArray(u)?u[t]:u.type,i=n[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new gi(i,o,c,n,l)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:r.map((t=>{let[e]=t;return e}))).map(yi).join(" | "),n=[];for(let o=1;o<t.length;o++){const i=e.parse(t[o],1+n.length);if(!i)return null;n.push(We(i.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){gi.definitions=e;for(const i in e)t[i]=gi}}function yi(t){return Array.isArray(t)?`(${t.map(We).join(", ")})`:`(${We(t.type)}...)`}class _i{constructor(t,e,i){this.type=Ve,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=void 0===i["case-sensitive"]?e.parse(!1,1,Oe):e.parseObjectValue(i["case-sensitive"],1,"case-sensitive",Oe);if(!n)return null;const o=void 0===i["diacritic-sensitive"]?e.parse(!1,1,Oe):e.parseObjectValue(i["diacritic-sensitive"],1,"diacritic-sensitive",Oe);if(!o)return null;let r=null;return i.locale&&(r=e.parseObjectValue(i.locale,1,"locale",ze),!r)?null:new _i(n,o,r)}evaluate(t){return new Ye(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function vi(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bi;for(;n>i;){if(n-i>600){const r=n-i+1,s=e-i+1,a=Math.log(r),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(r-l)/r)*(s-r/2<0?-1:1);vi(t,e,Math.max(i,Math.floor(e-s*l/r+u)),Math.min(n,Math.floor(e+(r-s)*l/r+u)),o)}const r=t[e];let s=i,a=n;for(xi(t,i,e),o(t[n],r)>0&&xi(t,i,n);s<a;){for(xi(t,s,a),s++,a--;o(t[s],r)<0;)s++;for(;o(t[a],r)>0;)a--}0===o(t[i],r)?xi(t,i,a):(a++,xi(t,a,n)),a<=e&&(i=a+1),e<=a&&(n=a-1)}}function xi(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function bi(t,e){return t<e?-1:t>e?1:0}function Ci(t){let e=0;for(let i,n,o=0,r=t.length,s=r-1;o<r;s=o++)i=t[o],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}function wi(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Si(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ti(t,e,i){const n=t[0]-e[0],o=t[1]-e[1],r=t[0]-i[0],s=t[1]-i[1];return n*s-r*o==0&&n*r<=0&&o*s<=0}function Ai(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!1;for(let a=0,l=e.length;a<l;a++){const l=e[a];for(let e=0,a=l.length,u=a-1;e<a;u=e++){const a=l[u],c=l[e];if(Ti(t,a,c))return i;(r=a)[1]>(o=t)[1]!=(s=c)[1]>o[1]&&o[0]<(s[0]-r[0])*(o[1]-r[1])/(s[1]-r[1])+r[0]&&(n=!n)}}var o,r,s;return n}function Mi(t,e,i,n){const o=n[0]-i[0],r=n[1]-i[1],s=(t[0]-i[0])*r-o*(t[1]-i[1]),a=(e[0]-i[0])*r-o*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ii(t,e,i,n){return 0!=(o=[n[0]-i[0],n[1]-i[1]])[0]*(r=[e[0]-t[0],e[1]-t[1]])[1]-o[1]*r[0]&&!(!Mi(t,e,i,n)||!Mi(i,n,t,e));var o,r}const Ei=8192;function Pi(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(i*o*Ei),Math.round(n*o*Ei)]}function ki(t,e){for(let i=0;i<e.length;i++)if(Ai(t,e[i]))return!0;return!1}function Bi(t,e,i){for(const n of i)for(let i=0,o=n.length,r=o-1;i<o;r=i++)if(Ii(t,e,n[r],n[i]))return!0;return!1}function Di(t,e){for(let i=0;i<t.length;++i)if(!Ai(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Bi(t[i],t[i+1],e))return!1;return!0}function Ri(t,e){for(let i=0;i<e.length;i++)if(Di(t,e[i]))return!0;return!1}function Li(t,e,i){const n=[];for(let o=0;o<t.length;o++){const r=[];for(let n=0;n<t[o].length;n++){const s=Pi(t[o][n],i);wi(e,s),r.push(s)}n.push(r)}return n}function zi(t,e,i){const n=[];for(let o=0;o<t.length;o++){const r=Li(t[o],e,i);n.push(r)}return n}function Oi(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let o=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===o&&(o=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=o}wi(e,t)}function Ui(t,e,i,n){const o=Math.pow(2,n.z)*Ei,r=[n.x*Ei,n.y*Ei],s=[];if(!t)return s;for(const a of t)for(const t of a){const n=[t.x+r[0],t.y+r[1]];Oi(n,e,i,o),s.push(n)}return s}function Fi(t,e,i,n){const o=Math.pow(2,n.z)*Ei,r=[n.x*Ei,n.y*Ei],s=[];if(!t)return s;for(const l of t){const t=[];for(const i of l){const n=[i.x+r[0],i.y+r[1]];wi(e,n),t.push(n)}s.push(t)}if(e[2]-e[0]<=o/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)Oi(n,e,i,o)}var a;return s}class Ni{constructor(t,e){this.type=Oe,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ii(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ni(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ni(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ni(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(!o)return!1;if("Polygon"===e.type){const r=Li(e.coordinates,n,o),s=Ui(t.geometry(),i,n,o);if(!Si(i,n))return!1;for(const t of s)if(!Ai(t,r))return!1}if("MultiPolygon"===e.type){const r=zi(e.coordinates,n,o),s=Ui(t.geometry(),i,n,o);if(!Si(i,n))return!1;for(const t of s)if(!ki(t,r))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(!o)return!1;if("Polygon"===e.type){const r=Li(e.coordinates,n,o),s=Fi(t.geometry(),i,n,o);if(!Si(i,n))return!1;for(const t of s)if(!Di(t,r))return!1}if("MultiPolygon"===e.type){const r=zi(e.coordinates,n,o),s=Fi(t.geometry(),i,n,o);if(!Si(i,n))return!1;for(const t of s)if(!Ri(t,r))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Vi={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Hi=1/298.257223563,ji=Hi*(2-Hi),Gi=Math.PI/180;class Wi{static fromTile(t,e,i){const n=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),o=Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/Gi;return new Wi(o,i)}static get units(){return Vi}constructor(t,e){if(void 0===t)throw new Error("No latitude given.");if(e&&!Vi[e])throw new Error(`Unknown unit ${e}. Use one of: ${Object.keys(Vi).join(", ")}`);const i=6378.137*Gi*(e?Vi[e]:1),n=Math.cos(t*Gi),o=1/(1-ji*(1-n*n)),r=Math.sqrt(o);this.kx=i*r*n,this.ky=i*r*o*(1-ji)}distance(t,e){const i=$i(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)}bearing(t,e){const i=$i(e[0]-t[0])*this.kx;return Math.atan2(i,(e[1]-t[1])*this.ky)/Gi}destination(t,e,i){const n=i*Gi;return this.offset(t,Math.sin(n)*e,Math.cos(n)*e)}offset(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]}lineDistance(t){let e=0;for(let i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e}area(t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];for(let t=0,o=n.length,r=o-1;t<o;r=t++)e+=$i(n[t][0]-n[r][0])*(n[t][1]+n[r][1])*(i?-1:1)}return Math.abs(e)/2*this.kx*this.ky}along(t,e){let i=0;if(e<=0)return t[0];for(let n=0;n<t.length-1;n++){const o=t[n],r=t[n+1],s=this.distance(o,r);if(i+=s,i>e)return Zi(o,r,(e-(i-s))/s)}return t[t.length-1]}pointToSegmentDistance(t,e,i){let[n,o]=e,r=$i(i[0]-n)*this.kx,s=(i[1]-o)*this.ky;if(0!==r||0!==s){const e=($i(t[0]-n)*this.kx*r+(t[1]-o)*this.ky*s)/(r*r+s*s);e>1?(n=i[0],o=i[1]):e>0&&(n+=r/this.kx*e,o+=s/this.ky*e)}return r=$i(t[0]-n)*this.kx,s=(t[1]-o)*this.ky,Math.sqrt(r*r+s*s)}pointOnLine(t,e){let i=1/0,n=t[0][0],o=t[0][1],r=0,s=0;for(let a=0;a<t.length-1;a++){let l=t[a][0],u=t[a][1],c=$i(t[a+1][0]-l)*this.kx,h=(t[a+1][1]-u)*this.ky,d=0;0===c&&0===h||(d=($i(e[0]-l)*this.kx*c+(e[1]-u)*this.ky*h)/(c*c+h*h),d>1?(l=t[a+1][0],u=t[a+1][1]):d>0&&(l+=c/this.kx*d,u+=h/this.ky*d)),c=$i(e[0]-l)*this.kx,h=(e[1]-u)*this.ky;const f=c*c+h*h;f<i&&(i=f,n=l,o=u,r=a,s=d)}return{point:[n,o],index:r,t:Math.max(0,Math.min(1,s))}}lineSlice(t,e,i){let n=this.pointOnLine(i,t),o=this.pointOnLine(i,e);if(n.index>o.index||n.index===o.index&&n.t>o.t){const t=n;n=o,o=t}const r=[n.point],s=n.index+1,a=o.index;!qi(i[s],r[0])&&s<=a&&r.push(i[s]);for(let l=s+1;l<=a;l++)r.push(i[l]);return qi(i[a],o.point)||r.push(o.point),r}lineSliceAlong(t,e,i){let n=0;const o=[];for(let r=0;r<i.length-1;r++){const s=i[r],a=i[r+1],l=this.distance(s,a);if(n+=l,n>t&&0===o.length&&o.push(Zi(s,a,(t-(n-l))/l)),n>=e)return o.push(Zi(s,a,(e-(n-l))/l)),o;n>t&&o.push(a)}return o}bufferPoint(t,e){const i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[0]+n,t[1]+i]}bufferBBox(t,e){const i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[2]+n,t[3]+i]}insideBBox(t,e){return $i(t[0]-e[0])>=0&&$i(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]}}function qi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Zi(t,e,i){const n=$i(e[0]-t[0]);return[t[0]+n*i,t[1]+(e[1]-t[1])*i]}function $i(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class Ki{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const o=t-1>>1,r=e[o];if(i(n,r)>=0)break;e[t]=r,t=o}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,o=e[t];for(;t<n;){let n=1+(t<<1);const r=n+1;if(r<this.length&&i(e[r],e[n])<0&&(n=r),i(e[n],o)>=0)break;e[t]=e[n],t=n}e[t]=o}}var Yi=8192;function Ji(t,e){return e.dist-t.dist}const Xi=100,Qi=50;function tn(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function en(t){return t[1]-t[0]+1}function nn(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function on(t,e){if(t[0]>t[1])return[null,null];const i=en(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===i)return[t,null];const e=Math.floor(i/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function rn(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!nn(e,t.length))return i;for(let n=e[0];n<=e[1];++n)wi(i,t[n]);return i}function sn(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let n=0;n<t[i].length;++n)wi(e,t[i][n]);return e}function an(t,e,i){if(tn(t)||tn(e))return NaN;let n=0,o=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(o=t[1]-e[3]),t[3]<e[1]&&(o=e[1]-t[3]),i.distance([0,0],[n,o])}function ln(t){return 360*t-180}function un(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function cn(t,e){const i=Math.pow(2,e.z),n=(t.y/Yi+e.y)/i;return[ln((t.x/Yi+e.x)/i),un(n)]}function hn(t,e){const i=[];for(let n=0;n<t.length;++n)i.push(cn(t[n],e));return i}function dn(t,e,i){const n=i.pointOnLine(e,t).point;return i.distance(t,n)}function fn(t,e,i,n,o){const r=i.slice(n[0],n[1]+1);let s=1/0;for(let a=e[0];a<=e[1];++a)if(0===(s=Math.min(s,dn(t[a],r,o))))return 0;return s}function pn(t,e,i,n,o){const r=Math.min(o.pointToSegmentDistance(t,i,n),o.pointToSegmentDistance(e,i,n)),s=Math.min(o.pointToSegmentDistance(i,t,e),o.pointToSegmentDistance(n,t,e));return Math.min(r,s)}function mn(t,e,i,n,o){if(!nn(e,t.length)||!nn(n,i.length))return NaN;let r=1/0;for(let s=e[0];s<e[1];++s)for(let e=n[0];e<n[1];++e){if(Ii(t[s],t[s+1],i[e],i[e+1]))return 0;r=Math.min(r,pn(t[s],t[s+1],i[e],i[e+1],o))}return r}function gn(t,e,i,n,o){if(!nn(e,t.length)||!nn(n,i.length))return NaN;let r=1/0;for(let s=e[0];s<=e[1];++s)for(let e=n[0];e<=n[1];++e)if(0===(r=Math.min(r,o.distance(t[s],i[e]))))return r;return r}function yn(t,e,i){if(Ai(t,e,!0))return 0;let n=1/0;for(const o of e){const e=o.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(o[0]!==o[e-1]&&0===(n=Math.min(n,i.pointToSegmentDistance(t,o[e-1],o[0]))))return n;if(0===(n=Math.min(n,dn(t,o,i))))return n}return n}function _n(t,e,i,n){if(!nn(e,t.length))return NaN;for(let r=e[0];r<=e[1];++r)if(Ai(t[r],i,!0))return 0;let o=1/0;for(let r=e[0];r<e[1];++r)for(const e of i)for(let i=0,s=e.length,a=s-1;i<s;a=i++){if(Ii(t[r],t[r+1],e[a],e[i]))return 0;o=Math.min(o,pn(t[r],t[r+1],e[a],e[i],n))}return o}function vn(t,e){for(const i of t)for(let t=0;t<=i.length-1;++t)if(Ai(i[t],e,!0))return!0;return!1}function xn(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const o=sn(t),r=sn(e);if(n!==1/0&&an(o,r,i)>=n)return n;if(Si(o,r)){if(vn(t,e))return 0}else if(vn(e,t))return 0;let s=n;for(const a of t)for(let t=0,n=a.length,o=n-1;t<n;o=t++)for(const r of e)for(let e=0,n=r.length,l=n-1;e<n;l=e++){if(Ii(a[o],a[t],r[l],r[e]))return 0;s=Math.min(s,pn(a[o],a[t],r[l],r[e],i))}return s}function bn(t,e,i,n,o,r,s){if(null===r||null===s)return;const a=an(rn(n,r),rn(o,s),i);a<e&&t.push({dist:a,range1:r,range2:s})}function Cn(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,r=Math.min(n.distance(t[0],i[0][0]),o);if(0===r)return r;const s=new Ki([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Ji),a=e?Qi:Xi,l=sn(i);for(;s.length;){const o=s.pop();if(o.dist>=r)continue;const u=o.range1;if(en(u)<=a){if(!nn(u,t.length))return NaN;if(e){const e=_n(t,u,i,n);if(0===(r=Math.min(r,e)))return r}else for(let e=u[0];e<=u[1];++e){const o=yn(t[e],i,n);if(0===(r=Math.min(r,o)))return r}}else{const i=on(u,e);if(null!==i[0]){const e=an(rn(t,i[0]),l,n);e<r&&s.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=an(rn(t,i[1]),l,n);e<r&&s.push({dist:e,range1:i[1],range2:[0,0]})}}}return r}function wn(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=Math.min(r,o.distance(t[0],i[0]));if(0===s)return s;const a=new Ki([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Ji),l=e?Qi:Xi,u=n?Qi:Xi;for(;a.length;){const r=a.pop();if(r.dist>=s)continue;const c=r.range1,h=r.range2;if(en(c)<=l&&en(h)<=u){if(!nn(c,t.length)||!nn(h,i.length))return NaN;if(e&&n?s=Math.min(s,mn(t,c,i,h,o)):e||n?e&&!n?s=Math.min(s,fn(i,h,t,c,o)):!e&&n&&(s=Math.min(s,fn(t,c,i,h,o))):s=Math.min(s,gn(t,c,i,h,o)),0===s)return s}else{const r=on(c,e),l=on(h,n);bn(a,s,o,t,i,r[0],l[0]),bn(a,s,o,t,i,r[0],l[1]),bn(a,s,o,t,i,r[1],l[0]),bn(a,s,o,t,i,r[1],l[1])}}return s}function Sn(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const r=rn(t,[0,t.length-1]);for(const s of i)if(!(o!==1/0&&an(r,rn(s,[0,s.length-1]),n)>=o)&&(o=Math.min(o,wn(t,e,s,!0,n,o)),0===o))return o;return o}function Tn(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const r=rn(t,[0,t.length-1]);for(const s of i){if(o!==1/0&&an(r,sn(s),n)>=o)continue;const i=Cn(t,e,s,n,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function An(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Mn{constructor(t,e){this.type=Le,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ii(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(An(e.features[t].geometry.type))return new Mn(e,e.features[t].geometry)}else if("Feature"===e.type){if(An(e.geometry.type))return new Mn(e,e.geometry)}else if(An(e.type))return new Mn(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),i=t.canonicalID();if(null!=e&&null!=i){if("Point"===t.geometryType())return function(t,e,i){const n=[];for(const r of t)for(const t of r)n.push(cn(t,e));const o=new Wi(n[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?wn(n,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,o):"MultiLineString"===i.type?Sn(n,!1,i.coordinates,o):"Polygon"===i.type||"MultiPolygon"===i.type?Tn(n,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,o):null}(e,i,this.geometries);if("LineString"===t.geometryType())return function(t,e,i){const n=[];for(const r of t){const t=[];for(const i of r)t.push(cn(i,e));n.push(t)}const o=new Wi(n[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Sn("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,o);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const r=Sn(i.coordinates[e],!0,n,o,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}if("Polygon"===i.type||"MultiPolygon"===i.type){let t=1/0;for(let e=0;e<n.length;e++){const r=Tn(n[e],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,o,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}return null}(e,i,this.geometries);if("Polygon"===t.geometryType())return function(t,e,i){const n=[];for(const r of function(t){const e=t.length;if(e<=1)return[t];const i=[];let n,o;for(let r=0;r<e;r++){const e=Ci(t[r]);0!==e&&(t[r].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(n&&i.push(n),n=[t[r]]):n.push(t[r]))}return n&&i.push(n),i}(t)){const t=[];for(let i=0;i<r.length;++i)t.push(hn(r[i],e));n.push(t)}const o=new Wi(n[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Tn("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,o);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const r=Tn(i.coordinates[e],!0,n,o,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}return"Polygon"===i.type||"MultiPolygon"===i.type?function(t,e,i){let n=1/0;for(const o of t)for(const t of e){const e=xn(o,t,i,n);if(isNaN(e))return e;if(0===(n=Math.min(n,e)))return n}return n}("Polygon"===i.type?[i.coordinates]:i.coordinates,n,o):null}(e,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function In(t,e){switch(t){case"string":return oi(e);case"number":return+e;case"boolean":return!!e;case"color":return Ae.parse(e);case"formatted":return Xe.fromString(oi(e));case"resolvedImage":return ti.build(oi(e))}return e}function En(t,e,i,n){return void 0!==n&&(t=n*Math.round(t/n)),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t}class Pn{constructor(t,e,i){this.type=t,this.key=e,this.scope=i}static parse(t,e){let i=e.expectedType;if(null==i&&(i=Ne),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const n=e.parse(t[1],1);if(!(n instanceof ri))return e.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const o=e.parse(t[2],2);return o instanceof ri?new Pn(i,oi(n.value),oi(o.value)):e.error("Scope of 'config' expression must be a string literal.")}return new Pn(i,oi(n.value))}evaluate(t){const e=[this.key,this.scope,t.scope].filter(Boolean).join("\x1f"),i=t.getConfig(e);if(!i)return null;const{type:n,value:o,values:r,minValue:s,maxValue:a,stepValue:l}=i,u=i.default.evaluate(t);let c=u;if(o){const e=t.scope;t.scope=(e||"").split("\x1f").slice(1).join("\x1f"),c=o.evaluate(t),t.scope=e}return n&&(c=In(n,c)),void 0===c||void 0===s&&void 0===a&&void 0===l||("number"==typeof c?c=En(c,s,a,l):Array.isArray(c)&&(c=c.map((t=>"number"==typeof t?En(t,s,a,l):t)))),void 0!==o&&void 0!==c&&r&&!r.includes(c)&&(c=u,n&&(c=In(n,c))),(n&&n!==this.type||void 0!==c&&ni(c)!==this.type)&&(c=In(this.type.kind,c)),c}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function kn(t){if(t instanceof gi){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ni)return!1;if(t instanceof Mn)return!1;let e=!0;return t.eachChild((t=>{e&&!kn(t)&&(e=!1)})),e}function Bn(t){if(t instanceof gi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Bn(t)&&(e=!1)})),e}function Dn(t){if(t instanceof Pn)return new Set([t.key]);let e=new Set;return t.eachChild((t=>{e=new Set([...e,...Dn(t)])})),e}function Rn(t,e){if(t instanceof gi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Rn(t,e)&&(i=!1)})),i}class Ln{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Ln(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class zn{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new De,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;this.registry=t,this.path=e,this.key=e.map((t=>"string"==typeof t?`['${t}']`:`[${t}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=i,this._scope=r,this.options=s}parse(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e||i?this.concat(e,null,i,n)._parse(t,o):this._parse(t,o)}parseObjectValue(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(e,i,n,o)._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new li(e,[t]):"coerce"===i?new fi(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof t[0]?this.registry[t[0]]:void 0;if(n){let o=n.parse(t,this);if(!o)return null;if(this.expectedType){const t=this.expectedType,n=o.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(t,n))return null}else o=i(o,t,e.typeAnnotation||"coerce");else o=i(o,t,e.typeAnnotation||"assert")}if(!(o instanceof ri)&&"resolvedImage"!==o.type.kind&&Un(o)){const e=new mi(this._scope,this.options);try{o=new ri(o.type,o.evaluate(e))}catch(t){return this.error(t.message),null}}return o}return fi.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i,n){let o="number"==typeof t?this.path.concat(t):this.path;o="string"==typeof e?o.concat(e):o;const r=n?this.scope.concat(n):this.scope;return new zn(this.registry,o,i||null,r,this.errors,this._scope,this.options)}error(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];const o=`${this.key}${i.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Be(o,t))}checkSubtype(t,e){const i=Ze(t,e);return i&&this.error(i),i}}var On=zn;function Un(t){if(t instanceof Ln)return Un(t.boundExpression);if(t instanceof gi&&"error"===t.name)return!1;if(t instanceof _i)return!1;if(t instanceof Ni)return!1;if(t instanceof Mn)return!1;if(t instanceof Pn)return!1;const e=t instanceof fi||t instanceof li;let i=!0;return t.eachChild((t=>{i=e?i&&Un(t):i&&t instanceof ri})),!!i&&kn(t)&&Rn(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Fn(t,e){const i=t.length-1;let n,o,r=0,s=i,a=0;for(;r<=s;)if(a=Math.floor((r+s)/2),n=t[a],o=t[a+1],n<=e){if(a===i||e<o)return a;r=a+1}else{if(!(n>e))throw new si("Input is not a number.");s=a-1}return 0}class Nn{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[n,o]of i)this.labels.push(n),this.outputs.push(o)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Le);if(!i)return null;const n=[];let o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType);for(let r=1;r<t.length;r+=2){const i=1===r?-1/0:t[r],s=t[r+1],a=r,l=r+1;if("number"!=typeof i)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=i)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const u=e.parse(s,l,o);if(!u)return null;o=o||u.type,n.push([i,u])}return new Nn(o,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const o=e.length;return n>=e[o-1]?i[o-1].evaluate(t):i[Fn(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}const Vn=.95047,Hn=1.08883,jn=4/29,Gn=6/29,Wn=3*Gn*Gn,qn=Gn*Gn*Gn,Zn=Math.PI/180,$n=180/Math.PI;function Kn(t){return t>qn?Math.pow(t,1/3):t/Wn+jn}function Yn(t){return t>Gn?t*t*t:Wn*(t-jn)}function Jn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qn(t){const e=Xn(t.r),i=Xn(t.g),n=Xn(t.b),o=Kn((.4124564*e+.3575761*i+.1804375*n)/Vn),r=Kn((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*r-16,a:500*(o-r),b:200*(r-Kn((.0193339*e+.119192*i+.9503041*n)/Hn)),alpha:t.a}}function to(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Yn(e),i=Vn*Yn(i),n=Hn*Yn(n),new Ae(Jn(3.2404542*i-1.5371385*e-.4985314*n),Jn(-.969266*i+1.8760108*e+.041556*n),Jn(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function eo(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const io={forward:Qn,reverse:to,interpolate:function(t,e,i){return{l:Ie(t.l,e.l,i),a:Ie(t.a,e.a,i),b:Ie(t.b,e.b,i),alpha:Ie(t.alpha,e.alpha,i)}}},no={forward:function(t){const{l:e,a:i,b:n}=Qn(t),o=Math.atan2(n,i)*$n;return{h:o<0?o+360:o,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Zn,i=t.c;return to({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:eo(t.h,e.h,i),c:Ie(t.c,e.c,i),l:Ie(t.l,e.l,i),alpha:Ie(t.alpha,e.alpha,i)}}};var oo=Object.freeze({__proto__:null,hcl:no,lab:io});class ro{constructor(t,e,i,n,o,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.dynamicStops=o,this.labels=[],this.outputs=[];for(const[s,a]of r)this.labels.push(s),this.outputs.push(a)}static interpolationFactor(t,e,i,n){let o=0;if("exponential"===t.name)o=so(e,t.base,i,n);else if("linear"===t.name)o=so(e,1,i,n);else if("cubic-bezier"===t.name){const r=t.controlPoints;o=new V(r[0],r[1],r[2],r[3]).solve(so(e,1,i,n))}return o}static parse(t,e){let[i,n,o,...r]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<3)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(o=e.parse(o,2,Le),!o)return null;const s=[];let a=null;if("interpolate-hcl"===i||"interpolate-lab"===i?a=Ue:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType),t.length-1==3){const t=e.parse(r[0],3,Ne);return t?new ro(a,i,n,o,t,s):null}for(let l=0;l<r.length;l+=2){const t=r[l],i=r[l+1],n=l+3,o=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const u=e.parse(i,o,a);if(!u)return null;a=a||u.type,s.push([t,u])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new ro(a,i,n,o,null,s):e.error(`Type ${We(a)} is not interpolatable.`)}evaluate(t){let e=this.labels,i=this.outputs;if(this.dynamicStops){const n=this.dynamicStops.evaluate(t);if(n.length%2!=0)throw new si("Expected an even number of arguments.");e=[],i=[];for(let t=0;t<n.length;t+=2){const o=n[t],r=new ri(Le,n[t+1]);if("number"!=typeof o)throw new si('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(e.length&&e[e.length-1]>=o)throw new si('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');e.push(o),i.push(r)}if(0===e.length)throw new si("Expected at least one input/output pair.")}if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const o=e.length;if(n>=e[o-1])return i[o-1].evaluate(t);const r=Fn(e,n),s=ro.interpolationFactor(this.interpolation,n,e[r],e[r+1]),a=i[r].evaluate(t),l=i[r+1].evaluate(t);return"interpolate"===this.operator?Pe[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?no.reverse(no.interpolate(no.forward(a),no.forward(l),s)):io.reverse(io.interpolate(io.forward(a),io.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];if(this.dynamicStops)e.push(this.dynamicStops.serialize());else for(let i=0;i<this.labels.length;i++)e.push(this.labels[i],this.outputs[i].serialize());return e}}function so(t,e,i,n){const o=n-i,r=t-i;return 0===o?0:1===e?r/o:(Math.pow(e,r)-1)/(Math.pow(e,o)-1)}class ao{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const o=[];for(const s of t.slice(1)){const t=e.parse(s,1+o.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,o.push(t)}const r=n&&o.some((t=>Ze(n,t.type)));return new ao(r?Ne:i,o)}evaluate(t){let e,i=null,n=0;for(const o of this.args){if(n++,i=o.evaluate(t),i&&i instanceof ti&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class lo{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let o=1;o<t.length-1;o+=2){const n=t[o];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,o);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",o);const r=e.parse(t[o+1],o+1);if(!r)return null;i.push([n,r])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new lo(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}class uo{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Le),n=e.parse(t[2],2,Ge(e.expectedType||Ne));return i&&n?new uo(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new si(`Array index out of bounds: ${e} < 0.`);if(e>i.length-1)throw new si(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e===Math.floor(e))return i[e];const n=Math.floor(e),o=Math.ceil(e),r=i[n],s=i[o];if("number"!=typeof r||"number"!=typeof s)throw new si(`Cannot interpolate between non-number values at index ${e}.`);const a=e-n;return r*(1-a)+s*a}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class co{constructor(t,e){this.type=Oe,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ne),n=e.parse(t[2],2,Ne);return i&&n?$e(i.type,[Oe,ze,Le,Re,Ne])?new co(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${We(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!Ke(e,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${We(ni(e))} instead.`);if(!Ke(i,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${We(ni(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ho{constructor(t,e,i){this.type=Le,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ne),n=e.parse(t[2],2,Ne);if(!i||!n)return null;if(!$e(i.type,[Oe,ze,Le,Re,Ne]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${We(i.type)} instead`);if(4===t.length){const o=e.parse(t[3],3,Le);return o?new ho(i,n,o):null}return new ho(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Ke(e,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${We(ni(e))} instead.`);if(!Ke(i,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${We(ni(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fo{constructor(t,e,i,n,o,r){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=o,this.otherwise=r}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const o={},r=[];for(let l=2;l<t.length-1;l+=2){let s=t[l];const a=t[l+1];Array.isArray(s)||(s=[s]);const u=e.concat(l);if(0===s.length)return u.error("Expected at least one branch label.");for(const t of s){if("number"!=typeof t&&"string"!=typeof t)return u.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,ni(t)))return null}else i=ni(t);if(void 0!==o[String(t)])return u.error("Branch labels must be unique.");o[String(t)]=r.length}const c=e.parse(a,l,n);if(!c)return null;n=n||c.type,r.push(c)}const s=e.parse(t[1],1,Ne);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new fo(i,n,s,o,r,a):null}evaluate(t){const e=this.input.evaluate(t);return(ni(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const r of e){const t=n[this.cases[r]];void 0===t?(n[this.cases[r]]=i.length,i.push([this.cases[r],[r]])):i[t][1].push(r)}const o=t=>"number"===this.inputType.kind?Number(t):t;for(const[r,s]of i)t.push(1===s.length?o(s[0]):s.map(o)),t.push(this.outputs[r].serialize());return t.push(this.otherwise.serialize()),t}}class po{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,Oe);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const o=e.parse(t[t.length-1],t.length-1,i);return o?new po(i,n,o):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((t=>{let[e,i]=t;return i.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class mo{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ne),n=e.parse(t[2],2,Le);if(!i||!n)return null;if(!$e(i.type,[Ge(Ne),ze,Ne]))return e.error(`Expected first argument to be of type array or string, but found ${We(i.type)} instead`);if(4===t.length){const o=e.parse(t[3],3,Le);return o?new mo(i.type,i,n,o):null}return new mo(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Ke(e,["string","array"]))throw new si(`Expected first argument to be of type array or string, but found ${We(ni(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function go(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yo(t,e,i,n){return 0===n.compare(e,i)}function _o(t,e,i){const n="=="!==t&&"!="!==t;return class o{constructor(t,e,i){this.type=Oe,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let r=e.parse(t[1],1,Ne);if(!r)return null;if(!go(i,r.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${We(r.type)}'.`);let s=e.parse(t[2],2,Ne);if(!s)return null;if(!go(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${We(s.type)}'.`);if(r.type.kind!==s.type.kind&&"value"!==r.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${We(r.type)}' and '${We(s.type)}'.`);n&&("value"===r.type.kind&&"value"!==s.type.kind?r=new li(s.type,[r]):"value"!==r.type.kind&&"value"===s.type.kind&&(s=new li(r.type,[s])));let a=null;if(4===t.length){if("string"!==r.type.kind&&"string"!==s.type.kind&&"value"!==r.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Ve),!a)return null}return new o(r,s,a)}evaluate(o){const r=this.lhs.evaluate(o),s=this.rhs.evaluate(o);if(n&&this.hasUntypedArgument){const e=ni(r),i=ni(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new si(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=ni(r),i=ni(s);if("string"!==t.kind||"string"!==i.kind)return e(o,r,s)}return this.collator?i(o,r,s,this.collator.evaluate(o)):e(o,r,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const vo=_o("==",(function(t,e,i){return e===i}),yo),xo=_o("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!yo(0,e,i,n)})),bo=_o("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),Co=_o(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),wo=_o("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),So=_o(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class To{constructor(t,e,i,n,o,r){this.type=ze,this.number=t,this.locale=e,this.currency=i,this.unit=n,this.minFractionDigits=o,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Le);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let o=null;if(n.locale&&(o=e.parseObjectValue(n.locale,2,"locale",ze),!o))return null;let r=null;if(n.currency&&(r=e.parseObjectValue(n.currency,2,"currency",ze),!r))return null;let s=null;if(n.unit&&(s=e.parseObjectValue(n.unit,2,"unit",ze),!s))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parseObjectValue(n["min-fraction-digits"],2,"min-fraction-digits",Le),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=e.parseObjectValue(n["max-fraction-digits"],2,"max-fraction-digits",Le),!l)?null:new To(i,o,r,s,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ao{constructor(t){this.type=Le,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${We(i.type)} instead.`):new Ao(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new si(`Expected value to be of type string or array, but found ${We(ni(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}function Mo(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Io={"==":vo,"!=":xo,">":Co,"<":bo,">=":So,"<=":wo,array:li,at:uo,boolean:li,case:po,coalesce:ao,collator:_i,format:ui,image:ci,in:co,"index-of":ho,interpolate:ro,"interpolate-hcl":ro,"interpolate-lab":ro,length:Ao,let:lo,literal:ri,match:fo,number:li,"number-format":To,object:li,slice:mo,step:Nn,string:li,"to-boolean":fi,"to-color":fi,"to-number":fi,"to-string":fi,var:Ln,within:Ni,distance:Mn,config:Pn};function Eo(t,e){let[i,n,o,r]=e;i=i.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);const s=r?r.evaluate(t):1,a=ei(i,n,o,s);if(a)throw new si(a);return new Ae(i/255*s,n/255*s,o/255*s,s)}function Po(t,e){let[i,n,o,r]=e;i=i.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);const s=r?r.evaluate(t):1,a=function(t,e,i,n){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'h' must be between 0 and 360.`}(i,n,o,s);if(a)throw new si(a);const l=`hsla(${i}, ${n}%, ${o}%, ${s})`,u=Ae.parse(l);if(!u)throw new si(`Failed to parse HSLA color: ${l}`);return u}function ko(t,e){return t in e}function Bo(t,e){const i=e[t];return void 0===i?null:i}function Do(t){return{type:t}}function Ro(t){return{result:"success",value:t}}function Lo(t){return{result:"error",value:t}}function zo(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Oo(t){return"data-driven"===t["property-type"]}function Uo(t){return zo(t.expression,"measure-light")}function Fo(t){return zo(t.expression,"zoom")}function No(t){return!!t.expression&&t.expression.interpolated}function Vo(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ho(t){return t}function jo(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],o=n||!(n||void 0!==t.property),r=t.type||(No(e)?"exponential":"interval");if(i&&((t=ke({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],Ae.parse(t[1])]))),t.default=Ae.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!oo[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===r)s=Zo;else if("interval"===r)s=qo;else if("categorical"===r){s=Wo,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==r)throw new Error(`Unknown function type "${r}"`);s=$o}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const o=t.stops[e],r=o[0].zoom;void 0===i[r]&&(i[r]={zoom:r,type:t.type,property:t.property,default:t.default,stops:[]},n.push(r)),i[r].stops.push([o[0].value,o[1]])}const o=[];for(const t of n)o.push([i[t].zoom,jo(i[t],e)]);const r={name:"linear"};return{kind:"composite",interpolationType:r,interpolationFactor:ro.interpolationFactor.bind(void 0,r),zoomStops:o.map((t=>t[0])),evaluate:(i,n)=>{let{zoom:r}=i;return Zo({stops:o,base:t.base},e,r).evaluate(r,n)}}}if(o){const i="exponential"===r?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:ro.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:i=>{let{zoom:n}=i;return s(t,e,n,a,l)}}}return{kind:"source",evaluate(i,n){const o=n&&n.properties?n.properties[t.property]:void 0;return void 0===o?Go(t.default,e.default):s(t,e,o,a,l)}}}function Go(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Wo(t,e,i,n,o){return Go(typeof i===o?n[i]:void 0,t.default,e.default)}function qo(t,e,i){if("number"!==hi(i))return Go(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=Fn(t.stops.map((t=>t[0])),i);return t.stops[o][1]}function Zo(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==hi(i))return Go(t.default,e.default);const o=t.stops.length;if(1===o)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];const r=Fn(t.stops.map((t=>t[0])),i),s=function(t,e,i,n){const o=n-i,r=t-i;return 0===o?0:1===e?r/o:(Math.pow(e,r)-1)/(Math.pow(e,o)-1)}(i,n,t.stops[r][0],t.stops[r+1][0]),a=t.stops[r][1],l=t.stops[r+1][1];let u=Pe[e.type]||Ho;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=oo[t.colorSpace];u=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const n=a.evaluate.apply(void 0,e),o=l.evaluate.apply(void 0,e);if(void 0!==n&&void 0!==o)return u(n,o,s)}}:u(a,l,s)}function $o(t,e,i){return"color"===e.type?i=Ae.parse(i):"formatted"===e.type?i=Xe.fromString(i.toString()):"resolvedImage"===e.type?i=ti.build(i.toString()):hi(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Go(i,t.default,e.default)}gi.register(Io,{error:[{kind:"error"},[ze],(t,e)=>{let[i]=e;throw new si(i.evaluate(t))}],typeof:[ze,[Ne],(t,e)=>{let[i]=e;return We(ni(i.evaluate(t)))}],"to-rgba":[Ge(Le,4),[Ue],(t,e)=>{let[i]=e;return i.evaluate(t).toRenderColor(null).toArray()}],"to-hsla":[Ge(Le,4),[Ue],(t,e)=>{let[i]=e;return i.evaluate(t).toRenderColor(null).toHslaArray()}],rgb:[Ue,[Le,Le,Le],Eo],rgba:[Ue,[Le,Le,Le,Le],Eo],hsl:[Ue,[Le,Le,Le],Po],hsla:[Ue,[Le,Le,Le,Le],Po],has:{type:Oe,overloads:[[[ze],(t,e)=>{let[i]=e;return ko(i.evaluate(t),t.properties())}],[[ze,Fe],(t,e)=>{let[i,n]=e;return ko(i.evaluate(t),n.evaluate(t))}]]},get:{type:Ne,overloads:[[[ze],(t,e)=>{let[i]=e;return Bo(i.evaluate(t),t.properties())}],[[ze,Fe],(t,e)=>{let[i,n]=e;return Bo(i.evaluate(t),n.evaluate(t))}]]},"feature-state":[Ne,[ze],(t,e)=>{let[i]=e;return Bo(i.evaluate(t),t.featureState||{})}],properties:[Fe,[],t=>t.properties()],"geometry-type":[ze,[],t=>t.geometryType()],id:[Ne,[],t=>t.id()],zoom:[Le,[],t=>t.globals.zoom],pitch:[Le,[],t=>t.globals.pitch||0],"distance-from-center":[Le,[],t=>t.distanceFromCenter()],"measure-light":[Le,[ze],(t,e)=>{let[i]=e;return t.measureLight(i.evaluate(t))}],"heatmap-density":[Le,[],t=>t.globals.heatmapDensity||0],"line-progress":[Le,[],t=>t.globals.lineProgress||0],"raster-value":[Le,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Le,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Le,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ne,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Le,Do(Le),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Le,Do(Le),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Le,overloads:[[[Le,Le],(t,e)=>{let[i,n]=e;return i.evaluate(t)-n.evaluate(t)}],[[Le],(t,e)=>{let[i]=e;return-i.evaluate(t)}]]},"/":[Le,[Le,Le],(t,e)=>{let[i,n]=e;return i.evaluate(t)/n.evaluate(t)}],"%":[Le,[Le,Le],(t,e)=>{let[i,n]=e;return i.evaluate(t)%n.evaluate(t)}],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(t,e)=>{let[i,n]=e;return Math.pow(i.evaluate(t),n.evaluate(t))}],sqrt:[Le,[Le],(t,e)=>{let[i]=e;return Math.sqrt(i.evaluate(t))}],log10:[Le,[Le],(t,e)=>{let[i]=e;return Math.log(i.evaluate(t))/Math.LN10}],ln:[Le,[Le],(t,e)=>{let[i]=e;return Math.log(i.evaluate(t))}],log2:[Le,[Le],(t,e)=>{let[i]=e;return Math.log(i.evaluate(t))/Math.LN2}],sin:[Le,[Le],(t,e)=>{let[i]=e;return Math.sin(i.evaluate(t))}],cos:[Le,[Le],(t,e)=>{let[i]=e;return Math.cos(i.evaluate(t))}],tan:[Le,[Le],(t,e)=>{let[i]=e;return Math.tan(i.evaluate(t))}],asin:[Le,[Le],(t,e)=>{let[i]=e;return Math.asin(i.evaluate(t))}],acos:[Le,[Le],(t,e)=>{let[i]=e;return Math.acos(i.evaluate(t))}],atan:[Le,[Le],(t,e)=>{let[i]=e;return Math.atan(i.evaluate(t))}],min:[Le,Do(Le),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Le,Do(Le),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Le,[Le],(t,e)=>{let[i]=e;return Math.abs(i.evaluate(t))}],round:[Le,[Le],(t,e)=>{let[i]=e;const n=i.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Le,[Le],(t,e)=>{let[i]=e;return Math.floor(i.evaluate(t))}],ceil:[Le,[Le],(t,e)=>{let[i]=e;return Math.ceil(i.evaluate(t))}],"filter-==":[Oe,[ze,Ne],(t,e)=>{let[i,n]=e;return t.properties()[i.value]===n.value}],"filter-id-==":[Oe,[Ne],(t,e)=>{let[i]=e;return t.id()===i.value}],"filter-type-==":[Oe,[ze],(t,e)=>{let[i]=e;return t.geometryType()===i.value}],"filter-<":[Oe,[ze,Ne],(t,e)=>{let[i,n]=e;const o=t.properties()[i.value],r=n.value;return typeof o==typeof r&&o<r}],"filter-id-<":[Oe,[Ne],(t,e)=>{let[i]=e;const n=t.id(),o=i.value;return typeof n==typeof o&&n<o}],"filter->":[Oe,[ze,Ne],(t,e)=>{let[i,n]=e;const o=t.properties()[i.value],r=n.value;return typeof o==typeof r&&o>r}],"filter-id->":[Oe,[Ne],(t,e)=>{let[i]=e;const n=t.id(),o=i.value;return typeof n==typeof o&&n>o}],"filter-<=":[Oe,[ze,Ne],(t,e)=>{let[i,n]=e;const o=t.properties()[i.value],r=n.value;return typeof o==typeof r&&o<=r}],"filter-id-<=":[Oe,[Ne],(t,e)=>{let[i]=e;const n=t.id(),o=i.value;return typeof n==typeof o&&n<=o}],"filter->=":[Oe,[ze,Ne],(t,e)=>{let[i,n]=e;const o=t.properties()[i.value],r=n.value;return typeof o==typeof r&&o>=r}],"filter-id->=":[Oe,[Ne],(t,e)=>{let[i]=e;const n=t.id(),o=i.value;return typeof n==typeof o&&n>=o}],"filter-has":[Oe,[Ne],(t,e)=>{let[i]=e;return i.value in t.properties()}],"filter-has-id":[Oe,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Oe,[Ge(ze)],(t,e)=>{let[i]=e;return i.value.indexOf(t.geometryType())>=0}],"filter-id-in":[Oe,[Ge(Ne)],(t,e)=>{let[i]=e;return i.value.indexOf(t.id())>=0}],"filter-in-small":[Oe,[ze,Ge(Ne)],(t,e)=>{let[i,n]=e;return n.value.indexOf(t.properties()[i.value])>=0}],"filter-in-large":[Oe,[ze,Ge(Ne)],(t,e)=>{let[i,n]=e;return function(t,e,i,n){for(;i<=n;){const o=i+n>>1;if(e[o]===t)return!0;e[o]>t?n=o-1:i=o+1}return!1}(t.properties()[i.value],n.value,0,n.value.length-1)}],all:{type:Oe,overloads:[[[Oe,Oe],(t,e)=>{let[i,n]=e;return i.evaluate(t)&&n.evaluate(t)}],[Do(Oe),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Oe,overloads:[[[Oe,Oe],(t,e)=>{let[i,n]=e;return i.evaluate(t)||n.evaluate(t)}],[Do(Oe),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Oe,[Oe],(t,e)=>{let[i]=e;return!i.evaluate(t)}],"is-supported-script":[Oe,[ze],(t,e)=>{let[i]=e;const n=t.globals&&t.globals.isSupportedScript;return!n||n(i.evaluate(t))}],upcase:[ze,[ze],(t,e)=>{let[i]=e;return i.evaluate(t).toUpperCase()}],downcase:[ze,[ze],(t,e)=>{let[i]=e;return i.evaluate(t).toLowerCase()}],concat:[ze,Do(Ne),(t,e)=>e.map((e=>oi(e.evaluate(t)))).join("")],"resolved-locale":[ze,[Ve],(t,e)=>{let[i]=e;return i.evaluate(t).resolvedLocale()}],random:[Le,[Le,Le,Ne],(t,e)=>{const[i,n,o]=e.map((e=>e.evaluate(t)));if(i>n)return i;if(i===n)return i;let r;if("string"==typeof o)r=function(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}(o);else{if("number"!=typeof o)throw new si(`Invalid seed input: ${o}`);r=o}return i+Mo(r)()*(n-i)}]});class Ko{constructor(t,e,i,n){this.expression=t,this._warningHistory={},this._evaluator=new mi(i,n),this._defaultValue=e?function(t){return"color"===t.type&&(Vo(t.default)||Array.isArray(t.default))?new Ae(0,0,0,0):"color"===t.type?Ae.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null,this.configDependencies=Dn(t)}evaluateWithoutErrorHandling(t,e,i,n,o,r,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=r,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,o,r,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=r||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${t.message}`)),this._defaultValue}}}function Yo(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Io}function Jo(t,e,i,n){const o=new On(Io,[],e?function(t){const e={color:Ue,string:ze,number:Le,enum:ze,boolean:Oe,formatted:He,resolvedImage:je};return"array"===t.type?Ge(e[t.value]||Ne,t.length):e[t.type]}(e):void 0,void 0,void 0,i,n),r=o.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Ro(new Ko(r,e,i,n)):Lo(o.errors)}class Xo{constructor(t,e,i,n){this.kind=t,this._styleExpression=e,this.isLightConstant=i,this.isLineProgressConstant=n,this.isStateDependent="constant"!==t&&!Bn(e.expression),this.configDependencies=Dn(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,o,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,o,r)}evaluate(t,e,i,n,o,r){return this._styleExpression.evaluate(t,e,i,n,o,r)}}class Qo{constructor(t,e,i,n,o,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Bn(e.expression),this.isLightConstant=o,this.isLineProgressConstant=r,this.configDependencies=Dn(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,o,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,o,r)}evaluate(t,e,i,n,o,r){return this._styleExpression.evaluate(t,e,i,n,o,r)}interpolationFactor(t,e,i){return this.interpolationType?ro.interpolationFactor(this.interpolationType,t,e,i):0}}function tr(t,e,i,n){if("error"===(t=Jo(t,e,i,n)).result)return t;const o=t.value.expression,r=kn(o);if(!r&&!Oo(e))return Lo([new Be("","data expressions not supported")]);const s=Rn(o,["zoom","pitch","distance-from-center"]);if(!s&&!Fo(e))return Lo([new Be("","zoom expressions not supported")]);const a=Rn(o,["measure-light"]);if(!a&&!Uo(e))return Lo([new Be("","measure-light expression not supported")]);const l=Rn(o,["line-progress"]);if(!l&&!function(t){return zo(t.expression,"line-progress")}(e))return Lo([new Be("","line-progress expression not supported")]);const u=e.expression&&e.expression.relaxZoomRestriction,c=ir(o);return c||s||u?c instanceof Be?Lo([c]):c instanceof ro&&!No(e)?Lo([new Be("",'"interpolate" expressions cannot be used with this property')]):Ro(c?new Qo(r&&l?"camera":"composite",t.value,c.labels,c instanceof ro?c.interpolation:void 0,a,l):new Xo(r&&l?"constant":"source",t.value,a,l)):Lo([new Be("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class er{constructor(t,e){this._parameters=t,this._specification=e,ke(this,jo(this._parameters,this._specification))}static deserialize(t){return new er(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ir(t){let e=null;if(t instanceof lo)e=ir(t.result);else if(t instanceof ao){for(const i of t.args)if(e=ir(i),e)break}else(t instanceof Nn||t instanceof ro)&&t.input instanceof gi&&"zoom"===t.input.name&&(e=t);return e instanceof Be||t.eachChild((t=>{const i=ir(t);i instanceof Be?e=i:e&&i&&e!==i&&(e=new Be("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var nr,or,rr=function(){if(or)return nr;or=1,nr=e;var t=3;function e(e,i,n){var o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(i=r[1])+2*(n=r[2]);for(var s=0;s<this.d*this.d;s++){var a=r[t+s],l=r[t+s+1];o.push(a===l?null:r.subarray(a,l))}var u=r[t+o.length+1];this.keys=r.subarray(r[t+o.length],u),this.bboxes=r.subarray(u),this.insert=this._insertReadonly}else{this.d=i+2*n;for(var c=0;c<this.d*this.d;c++)o.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=n,this.scale=i/e,this.uid=0;var h=n/i*e;this.min=-h,this.max=e+h}return e.prototype.insert=function(t,e,i,n,o){this._forEachCell(e,i,n,o,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(o)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(t,e,i,n,o,r){this.cells[o].push(r)},e.prototype.query=function(t,e,i,n,o){var r=this.min,s=this.max;if(t<=r&&e<=r&&s<=i&&s<=n&&!o)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{},o),a},e.prototype._queryCell=function(t,e,i,n,o,r,s,a){var l=this.cells[o];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var f=4*d;(a?a(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&i>=c[f+0]&&n>=c[f+1])?(s[d]=!0,r.push(u[d])):s[d]=!1}}},e.prototype._forEachCell=function(t,e,i,n,o,r,s,a){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=c;d++)for(var f=u;f<=h;f++){var p=this.d*f+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(f),this._convertFromCellCoord(d+1),this._convertFromCellCoord(f+1)))&&o.call(this,t,e,i,n,p,r,s,a))return}},e.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},e.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,i=t+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var r=new Int32Array(i+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var s=i,a=0;a<e.length;a++){var l=e[a];r[t+a]=s,r.set(l,s),s+=l.length}return r[t+e.length]=s,r.set(this.keys,s),r[t+e.length+1]=s+=this.keys.length,r.set(this.bboxes,s),s+=this.bboxes.length,r.buffer},nr}(),sr=e(rr);const ar={};function lr(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ar[e]={klass:t,omit:i.omit||[]}}lr(Object,"Object"),sr.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},sr.deserialize=function(t){return new sr(t.buffer)},Object.defineProperty(sr,"name",{value:"Grid"}),lr(sr,"Grid"),"undefined"!=typeof DOMMatrix&&lr(DOMMatrix,"DOMMatrix"),lr(Ae,"Color"),lr(Error,"Error"),lr(Xe,"Formatted"),lr(Je,"FormattedSection"),lr(ee,"AJAXError"),lr(ti,"ResolvedImage"),lr(er,"StylePropertyFunction"),lr(Ko,"StyleExpression",{omit:["_evaluator"]}),lr(Qe,"ImageIdWithOptions"),lr(Qo,"ZoomDependentExpression"),lr(Xo,"ZoomConstantExpression"),lr(gi,"CompoundExpression",{omit:["_evaluate"]});for(const bv in Io)ar[Io[bv]._classRegistryKey]||lr(Io[bv],`Expression${bv}`);function ur(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function cr(t){return self.ImageBitmap&&t instanceof ImageBitmap}function hr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ur(t)||cr(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t))return e&&e.add(t.buffer),t;if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(hr(n,e));return i}if(t instanceof Map){const e={$name:"Map"};for(const[i,n]of t.entries())e[i]=hr(n);return e}if(t instanceof Set){const e={$name:"Set"};let i=0;for(const n of t.values())e[++i]=hr(n);return e}if("object"==typeof t){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`Can't serialize object of unregistered class "${n}".`);const o=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t)t.hasOwnProperty(i)&&(ar[n].omit.indexOf(i)>=0||(o[i]=hr(t[i],e)));t instanceof Error&&(o.message=t.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(o.$name=n),o}throw new Error("can't serialize object of type "+typeof t)}function dr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ur(t)||cr(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(dr);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const i of Object.keys(t))"$name"!==i&&e.set(i,dr(t[i]));return e}if("Set"===e){const e=new Set;for(const i of Object.keys(t))"$name"!==i&&e.add(dr(t[i]));return e}const{klass:i}=ar[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const o of Object.keys(t))"$name"!==o&&(n[o]=dr(t[o]));return n}throw new Error("can't deserialize object of type "+typeof t)}const fr={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,Osage:t=>t>=66736&&t<=66815,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function pr(t){for(const e of t)if(yr(e.charCodeAt(0)))return!0;return!1}function mr(t){for(const e of t)if(!gr(e.charCodeAt(0)))return!1;return!0}function gr(t){return!(fr.Arabic(t)||fr["Arabic Supplement"](t)||fr["Arabic Extended-A"](t)||fr["Arabic Presentation Forms-A"](t)||fr["Arabic Presentation Forms-B"](t))}function yr(t){return!(746!==t&&747!==t&&(t<4352||!(fr["Bopomofo Extended"](t)||fr.Bopomofo(t)||fr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||fr["CJK Compatibility Ideographs"](t)||fr["CJK Compatibility"](t)||fr["CJK Radicals Supplement"](t)||fr["CJK Strokes"](t)||!(!fr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||fr["CJK Unified Ideographs Extension A"](t)||fr["CJK Unified Ideographs"](t)||fr["Enclosed CJK Letters and Months"](t)||fr["Hangul Compatibility Jamo"](t)||fr["Hangul Jamo Extended-A"](t)||fr["Hangul Jamo Extended-B"](t)||fr["Hangul Jamo"](t)||fr["Hangul Syllables"](t)||fr.Hiragana(t)||fr["Ideographic Description Characters"](t)||fr.Kanbun(t)||fr["Kangxi Radicals"](t)||fr["Katakana Phonetic Extensions"](t)||fr.Katakana(t)&&12540!==t||!(!fr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!fr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||fr["Unified Canadian Aboriginal Syllabics"](t)||fr["Unified Canadian Aboriginal Syllabics Extended"](t)||fr["Vertical Forms"](t)||fr["Yijing Hexagram Symbols"](t)||fr["Yi Syllables"](t)||fr["Yi Radicals"](t))))}function _r(t){return!(yr(t)||function(t){return!!(fr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||fr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||fr["Letterlike Symbols"](t)||fr["Number Forms"](t)||fr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||fr["Control Pictures"](t)&&9251!==t||fr["Optical Character Recognition"](t)||fr["Enclosed Alphanumerics"](t)||fr["Geometric Shapes"](t)||fr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||fr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||fr["CJK Symbols and Punctuation"](t)||fr.Katakana(t)||fr["Private Use Area"](t)||fr["CJK Compatibility Forms"](t)||fr["Small Form Variants"](t)||fr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function vr(t){return t>=1424&&t<=2303||fr["Arabic Presentation Forms-A"](t)||fr["Arabic Presentation Forms-B"](t)}function xr(t,e){return!(!e&&vr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||fr.Khmer(t))}function br(t){for(const e of t)if(vr(e.charCodeAt(0)))return!0;return!1}const Cr="deferred",wr="loading",Sr="loaded";let Tr=null,Ar="unavailable",Mr=null;const Ir=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Ar="error"),Tr&&Tr(t)};function Er(){Pr.fire(new _e("pluginStateChange",{pluginStatus:Ar,pluginURL:Mr}))}const Pr=new Ce,kr=function(){return Ar},Br=function(){if(Ar!==Cr||!Mr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ar=wr,Er(),Mr&&oe({url:Mr},(t=>{t?Ir(t):(Ar=Sr,Er())}))},Dr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ar===Sr||null!=Dr.applyArabicShaping,isLoading:()=>Ar===wr,setState(t){Ar=t.pluginStatus,Mr=t.pluginURL},isParsed:()=>null!=Dr.applyArabicShaping&&null!=Dr.processBidirectionalText&&null!=Dr.processStyledBidirectionalText,getPluginURL:()=>Mr};class Rr{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!xr(i.charCodeAt(0),e))return!1;return!0}(t,Dr.isLoaded())}}class Lr{constructor(t,e,i,n){this.property=t,this.value=e,this.expression=function(t,e,i,n){if(Vo(t))return new er(t,e);if(Yo(t)||Array.isArray(t)&&t.length>0){const o=tr(t,e,i,n);if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return o.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=Ae.parse(t)),{kind:"constant",configDependencies:new Set,evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification,i,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class zr{constructor(t,e,i){this.property=t,this.value=new Lr(t,void 0,e,i)}transitioned(t,e){return new Ur(this.property,this.value,e,nt({},t.transition,this.transition),t.now)}untransitioned(){return new Ur(this.property,this.value,null,{},0)}}class Or{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=i,this.configDependencies=new Set}getValue(t){return ht(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zr(this._values[t].property,this._scope,this._options)),this._values[t].value=new Lr(this._values[t].property,null===e?void 0:ht(e),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,e){e&&(this._options=e);const i=this._properties.properties;if(t)for(const n in t){const e=t[n];if(lt(n,"-transition")){const t=n.slice(0,-11);i[t]&&this.setTransition(t,e)}else i.hasOwnProperty(n)&&this.setValue(n,e)}}getTransition(t){return ht(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zr(this._values[t].property)),this._values[t].transition=ht(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new Fr(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new Fr(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Ur{constructor(t,e,i,n,o){const r=n.delay||0,s=n.duration||0;o=o||0,this.property=t,this.value=e,this.begin=o+r,this.end=this.begin+s,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,o=this.value.possiblyEvaluate(t,e,i),r=this.prior;if(r){if(n>this.end)return this.prior=null,o;if(this.value.isDataDriven())return this.prior=null,o;if(n<this.begin)return r.possiblyEvaluate(t,e,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(r.possiblyEvaluate(t,e,i),o,Y(s))}}return o}}class Fr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new Hr(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Nr{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=i,this.configDependencies=new Set}getValue(t){return ht(this._values[t].value)}setValue(t,e){this._values[t]=new Lr(this._values[t].property,null===e?void 0:ht(e),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new Hr(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].possiblyEvaluate(t,e,i);return n}}class Vr{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class Hr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jr{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const n=Pe[this.specification.type];return n?n(t,e,i):t}}class Gr{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new Vr(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Vr(this,{kind:"constant",value:void 0},t.parameters);const n=Pe[this.specification.type];return n?new Vr(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,n,o,r){return"constant"===t.kind?t.value:t.evaluate(e,i,n,o,r)}}class Wr{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class qr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Rr(0,{});for(const i in t){const n=t[i];n.specification.overridable&&this.overridableProperties.push(i);const o=this.defaultPropertyValues[i]=new Lr(n,void 0),r=this.defaultTransitionablePropertyValues[i]=new zr(n);this.defaultTransitioningPropertyValues[i]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=o.possiblyEvaluate(e)}}}lr(Gr,"DataDrivenProperty"),lr(jr,"DataConstantProperty"),lr(Wr,"ColorRampProperty");var Zr=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function $r(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Kr(t){if(Array.isArray(t))return t.map(Kr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Kr(t[i]);return e}return $r(t)}function Yr(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Yr(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Jr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Yr(t)||(t=os(t));const o=t;let r=!0;try{r=function(t){if(!ts(t))return t;let e=Kr(t);return Qr(e),e=Xr(e),e}(o)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}let s=null,a=null;if("background"!==n&&"sky"!==n&&"slot"!==n){a=Zr[`filter_${n}`];const t=Jo(r,a,e,i);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(e,i,n)=>t.value.evaluate(e,i,{},n)}let l=null,u=null;if(r!==o){const t=Jo(o,a,e,i);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));l=(e,i,n,o,r)=>t.value.evaluate(e,i,{},n,void 0,void 0,o,r),u=!kn(t.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:ns(r),needFeature:!!u}}function Xr(t){if(!Array.isArray(t))return t;const e=function(t){if(es.has(t[0]))for(let e=1;e<t.length;e++)if(ts(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>Xr(t)))}function Qr(t){let e=!1;const i=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||ts(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||ts(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||ts(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let n=1;n<t.length;n++)Qr(t[n])}function ts(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(ts(t[i]))return!0;return!1}const es=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function is(t,e){return t<e?-1:t>e?1:0}function ns(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(ns(t[e]))return!0;return!1}function os(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?rs(t[1],t[2],"=="):"!="===e?ls(rs(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?rs(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(os))):"all"===e?["all"].concat(t.slice(1).map(os)):"none"===e?["all"].concat(t.slice(1).map(os).map(ls)):"in"===e?ss(t[1],t.slice(2)):"!in"===e?ls(ss(t[1],t.slice(2))):"has"===e?as(t[1]):"!has"!==e||ls(as(t[1]));var i}function rs(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function ss(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(is)]]:["filter-in-small",t,["literal",e]]}}function as(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ls(t){return["!",t]}const us="\x1f";function cs(t,e){return e?`${t}${us}${e}`:t}const hs="-transition",ds=new Set(["fill","line","background","hillshade","raster"]);class fs extends Ce{constructor(t,e,i,n,o){if(super(),this.id=t.id,this.fqid=cs(this.id,i),this.type=t.type,this.scope=i,this.lut=n,this.options=o,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==t.type){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const e=Jo(this.filter,Zr[`filter_${t.type}`]);"error"!==e.result&&(this.configDependencies=new Set([...this.configDependencies,...e.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new Nr(e.layout,this.scope,o),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),e.paint){this._transitionablePaint=new Or(e.paint,this.scope,o);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hr(e.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&ds.has(this.type)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const i=this._unevaluatedLayout;i._properties.properties[t]&&(i.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return lt(t,hs)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const i=this._transitionablePaint,n=i._properties.properties;if(lt(t,hs)){const o=t.slice(0,-11);return n[o]&&i.setTransition(o,e||void 0),!1}if(!n[t])return!1;const o=i._values[t],r=o.value.isDataDriven(),s=o.value;i.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const a=i._values[t].value,l=a.isDataDriven(),u=lt(t,"pattern")||"line-dasharray"===t;return l||r||u||this._handleOverridablePaintPropertyUpdate(t,s,a)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e,i){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return ct({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Vr&&Oo(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Jr(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,e,i,n,o,r,s,a,l){}}const ps={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ms{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ys(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=0,n=0;return{members:t.map((t=>{const o=ps[t.type].BYTES_PER_ELEMENT,r=i=_s(i,Math.max(e,o)),s=t.components||1;return n=Math.max(n,o),i+=o*s,{name:t.name,type:t.type,components:s,offset:r}})),size:_s(i,Math.max(n,e)),alignment:e}}function _s(t,e){return Math.ceil(t/e)*e}class vs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}vs.prototype.bytesPerElement=4,lr(vs,"StructArrayLayout2i4");class xs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const o=3*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,t}}xs.prototype.bytesPerElement=6,lr(xs,"StructArrayLayout3i6");class bs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n)}emplace(t,e,i,n,o){const r=4*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,this.int16[r+3]=o,t}}bs.prototype.bytesPerElement=8,lr(bs,"StructArrayLayout4i8");class Cs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,o)}emplace(t,e,i,n,o,r){const s=5*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=o,this.int16[s+4]=r,t}}Cs.prototype.bytesPerElement=10,lr(Cs,"StructArrayLayout5i10");class ws extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,o,r,s)}emplace(t,e,i,n,o,r,s,a){const l=6*t,u=12*t,c=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[u+4]=n,this.uint8[u+5]=o,this.uint8[u+6]=r,this.uint8[u+7]=s,this.float32[c+2]=a,t}}ws.prototype.bytesPerElement=12,lr(ws,"StructArrayLayout2i4ub1f12");class Ss extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const o=3*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,t}}Ss.prototype.bytesPerElement=12,lr(Ss,"StructArrayLayout3f12");class Ts extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,o)}emplace(t,e,i,n,o,r){const s=6*t,a=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=n,this.uint16[s+3]=o,this.float32[a+2]=r,t}}Ts.prototype.bytesPerElement=12,lr(Ts,"StructArrayLayout4ui1f12");class As extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n)}emplace(t,e,i,n,o){const r=4*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,this.uint16[r+3]=o,t}}As.prototype.bytesPerElement=8,lr(As,"StructArrayLayout4ui8");class Ms extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,o,r)}emplace(t,e,i,n,o,r,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=o,this.int16[a+4]=r,this.int16[a+5]=s,t}}Ms.prototype.bytesPerElement=12,lr(Ms,"StructArrayLayout6i12");class Is extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,o,r,s,a,l,u,c,h)}emplace(t,e,i,n,o,r,s,a,l,u,c,h,d){const f=12*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=o,this.uint16[f+4]=r,this.uint16[f+5]=s,this.uint16[f+6]=a,this.uint16[f+7]=l,this.int16[f+8]=u,this.int16[f+9]=c,this.int16[f+10]=h,this.int16[f+11]=d,t}}Is.prototype.bytesPerElement=24,lr(Is,"StructArrayLayout4i4ui4i24");class Es extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,o,r)}emplace(t,e,i,n,o,r,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=o,this.float32[l+3]=r,this.float32[l+4]=s,t}}Es.prototype.bytesPerElement=20,lr(Es,"StructArrayLayout3i3f20");class Ps extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n)}emplace(t,e,i,n,o){const r=4*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,this.float32[r+3]=o,t}}Ps.prototype.bytesPerElement=16,lr(Ps,"StructArrayLayout4f16");class ks extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}ks.prototype.bytesPerElement=4,lr(ks,"StructArrayLayout1ul4");class Bs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}Bs.prototype.bytesPerElement=4,lr(Bs,"StructArrayLayout2ui4");class Ds extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,e,i,n,o,r,s,a,l,u,c,h,d)}emplace(t,e,i,n,o,r,s,a,l,u,c,h,d,f){const p=20*t,m=10*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=o,this.int16[p+4]=r,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=u,this.int16[p+14]=c,this.uint32[m+8]=h,this.uint16[p+18]=d,this.uint16[p+19]=f,t}}Ds.prototype.bytesPerElement=40,lr(Ds,"StructArrayLayout5i4f1i1ul2ui40");class Rs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,o,r,s)}emplace(t,e,i,n,o,r,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=o,this.int16[l+5]=r,this.int16[l+6]=s,this.int16[l+7]=a,t}}Rs.prototype.bytesPerElement=16,lr(Rs,"StructArrayLayout3i2i2i16");class Ls extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,o)}emplace(t,e,i,n,o,r){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=o,this.int16[a+7]=r,t}}Ls.prototype.bytesPerElement=16,lr(Ls,"StructArrayLayout2f1f2i16");class zs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,o,r)}emplace(t,e,i,n,o,r,s){const a=20*t,l=5*t;return this.uint8[a+0]=e,this.uint8[a+1]=i,this.float32[l+1]=n,this.float32[l+2]=o,this.float32[l+3]=r,this.float32[l+4]=s,t}}zs.prototype.bytesPerElement=20,lr(zs,"StructArrayLayout2ub4f20");class Os extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const o=3*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=n,t}}Os.prototype.bytesPerElement=6,lr(Os,"StructArrayLayout3ui6");class Us extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x)}emplace(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b){const C=30*t,w=15*t,S=60*t;return this.int16[C+0]=e,this.int16[C+1]=i,this.int16[C+2]=n,this.float32[w+2]=o,this.float32[w+3]=r,this.uint16[C+8]=s,this.uint16[C+9]=a,this.uint32[w+5]=l,this.uint32[w+6]=u,this.uint32[w+7]=c,this.uint16[C+16]=h,this.uint16[C+17]=d,this.uint16[C+18]=f,this.float32[w+10]=p,this.float32[w+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=y,this.uint8[S+50]=_,this.uint32[w+13]=v,this.int16[C+28]=x,this.uint8[S+58]=b,t}}Us.prototype.bytesPerElement=60,lr(Us,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C,w,S,T,A,M,I,E,P,k){const B=this.length;return this.resize(B+1),this.emplace(B,t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C,w,S,T,A,M,I,E,P,k)}emplace(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C,w,S,T,A,M,I,E,P,k,B){const D=20*t,R=40*t,L=80*t;return this.float32[D+0]=e,this.float32[D+1]=i,this.int16[R+4]=n,this.int16[R+5]=o,this.int16[R+6]=r,this.int16[R+7]=s,this.int16[R+8]=a,this.int16[R+9]=l,this.int16[R+10]=u,this.int16[R+11]=c,this.int16[R+12]=h,this.uint16[R+13]=d,this.uint16[R+14]=f,this.uint16[R+15]=p,this.uint16[R+16]=m,this.uint16[R+17]=g,this.uint16[R+18]=y,this.uint16[R+19]=_,this.uint16[R+20]=v,this.uint16[R+21]=x,this.uint16[R+22]=b,this.uint16[R+23]=C,this.uint16[R+24]=w,this.uint16[R+25]=S,this.uint16[R+26]=T,this.uint16[R+27]=A,this.uint32[D+14]=M,this.float32[D+15]=I,this.float32[D+16]=E,this.float32[D+17]=P,this.float32[D+18]=k,this.uint8[L+76]=B,t}}Fs.prototype.bytesPerElement=80,lr(Fs,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ns extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Ns.prototype.bytesPerElement=4,lr(Ns,"StructArrayLayout1f4");class Vs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,o)}emplace(t,e,i,n,o,r){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=o,this.float32[s+4]=r,t}}Vs.prototype.bytesPerElement=20,lr(Vs,"StructArrayLayout5f20");class Hs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,o,r,s)}emplace(t,e,i,n,o,r,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=r,this.float32[l+5]=s,this.float32[l+6]=a,t}}Hs.prototype.bytesPerElement=28,lr(Hs,"StructArrayLayout7f28");class js extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,e,i,n,o,r,s,a,l,u,c)}emplace(t,e,i,n,o,r,s,a,l,u,c,h){const d=11*t;return this.float32[d+0]=e,this.float32[d+1]=i,this.float32[d+2]=n,this.float32[d+3]=o,this.float32[d+4]=r,this.float32[d+5]=s,this.float32[d+6]=a,this.float32[d+7]=l,this.float32[d+8]=u,this.float32[d+9]=c,this.float32[d+10]=h,t}}js.prototype.bytesPerElement=44,lr(js,"StructArrayLayout11f44");class Gs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,o,r,s,a,l)}emplace(t,e,i,n,o,r,s,a,l,u){const c=9*t;return this.float32[c+0]=e,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=o,this.float32[c+4]=r,this.float32[c+5]=s,this.float32[c+6]=a,this.float32[c+7]=l,this.float32[c+8]=u,t}}Gs.prototype.bytesPerElement=36,lr(Gs,"StructArrayLayout9f36");class Ws extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}Ws.prototype.bytesPerElement=8,lr(Ws,"StructArrayLayout2f8");class qs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n)}emplace(t,e,i,n,o){const r=6*t;return this.uint32[3*t+0]=e,this.uint16[r+2]=i,this.uint16[r+3]=n,this.uint16[r+4]=o,t}}qs.prototype.bytesPerElement=12,lr(qs,"StructArrayLayout1ul3ui12");class Zs extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Zs.prototype.bytesPerElement=2,lr(Zs,"StructArrayLayout1ui2");class $s extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m)}emplace(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g){const y=16*t;return this.float32[y+0]=e,this.float32[y+1]=i,this.float32[y+2]=n,this.float32[y+3]=o,this.float32[y+4]=r,this.float32[y+5]=s,this.float32[y+6]=a,this.float32[y+7]=l,this.float32[y+8]=u,this.float32[y+9]=c,this.float32[y+10]=h,this.float32[y+11]=d,this.float32[y+12]=f,this.float32[y+13]=p,this.float32[y+14]=m,this.float32[y+15]=g,t}}$s.prototype.bytesPerElement=64,lr($s,"StructArrayLayout16f64");class Ks extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,o,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,o,r,s)}emplace(t,e,i,n,o,r,s,a){const l=10*t,u=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=i,this.uint16[l+2]=n,this.uint16[l+3]=o,this.float32[u+2]=r,this.float32[u+3]=s,this.float32[u+4]=a,t}}Ks.prototype.bytesPerElement=20,lr(Ks,"StructArrayLayout4ui3f20");class Ys extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.int16[1*t+0]=e,t}}Ys.prototype.bytesPerElement=2,lr(Ys,"StructArrayLayout1i2");class Js extends gs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}Js.prototype.bytesPerElement=1,lr(Js,"StructArrayLayout1ub1");class Xs extends ms{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xs.prototype.size=40;class Qs extends Ds{get(t){return new Xs(this,t)}}lr(Qs,"CollisionBoxArray");class ta extends ms{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}ta.prototype.size=60;class ea extends Us{get(t){return new ta(this,t)}}lr(ea,"PlacedSymbolArray");class ia extends ms{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ia.prototype.size=80;class na extends Fs{get(t){return new ia(this,t)}}lr(na,"SymbolInstanceArray");class oa extends Ns{getoffsetX(t){return this.float32[1*t+0]}}lr(oa,"GlyphOffsetArray");class ra extends vs{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}lr(ra,"SymbolLineVertexArray");class sa extends ms{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sa.prototype.size=12;class aa extends qs{get(t){return new sa(this,t)}}lr(aa,"FeatureIndexArray");class la extends Bs{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}lr(la,"FillExtrusionCentroidArray");class ua extends ms{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ua.prototype.size=6;class ca extends xs{get(t){return new ua(this,t)}}lr(ca,"FillExtrusionWallArray");const ha=ys([{name:"a_pos",components:2,type:"Int16"}],4),da=ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=t}_prepareSegment(t,e,i,n){let o=this.segments[this.segments.length-1];return t>fa.MAX_VERTEX_ARRAY_LENGTH&&ft(`Max vertices per segment is ${fa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!o||o.vertexLength+t>fa.MAX_VERTEX_ARRAY_LENGTH||o.sortKey!==n)&&(o={vertexOffset:e,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==n&&(o.sortKey=n),this.segments.push(o)),o}prepareSegment(t,e,i,n){return this._prepareSegment(t,e.length,i.length,n)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new fa([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function pa(t,e){return 256*(t=Q(Math.floor(t),0,255))+Q(Math.floor(e),0,255)}fa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lr(fa,"SegmentVector");const ma=ys([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ga=ys([{name:"a_dash",components:4,type:"Uint16"}]);class ya{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(_a(t)),this.positions.push(e,i,n)}eachPosition(t,e){const i=_a(t);let n=0,o=this.ids.length-1;for(;n<o;){const t=n+o>>1;this.ids[t]>=i?o=t:n=t+1}for(;this.ids[n]===i;)e(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return va(i,n,0,i.length-1),e&&(e.add(i.buffer),e.add(n.buffer)),{ids:i,positions:n}}static deserialize(t){const e=new ya;let i;e.ids=t.ids,e.positions=t.positions;for(const n of e.ids)n!==i&&e.uniqueIds.push(n),i=n;return e.indexed=!0,e}}function _a(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ye(String(t))}function va(t,e,i,n){for(;i<n;){const o=t[i+n>>1];let r=i-1,s=n+1;for(;;){do{r++}while(t[r]<o);do{s--}while(t[s]>o);if(r>=s)break;xa(t,r,s),xa(e,3*r,3*s),xa(e,3*r+1,3*s+1),xa(e,3*r+2,3*s+2)}s-i<n-s?(va(t,e,i,s),i=s+1):(va(t,e,s+1,n),n=s)}}function xa(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}lr(ya,"FeaturePositionMap");class ba{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}set(t,e,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ca extends ba{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class wa extends ba{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Sa extends ba{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class Ta extends ba{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Aa extends ba{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Ma extends ba{constructor(t){super(t),this.current=Ae.transparent.toRenderColor(null)}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ia=new Float32Array(16);class Ea extends ba{constructor(t){super(t),this.current=Ia}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Pa=new Float32Array(9),ka=new Float32Array(4);class Ba extends ba{constructor(t){super(t),this.current=ka}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let n=0;n<4;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Da(t){return[pa(255*t.r,255*t.g),pa(255*t.b,255*t.a)]}class Ra{constructor(t,e,i,n){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i,this.context=n}setUniform(t,e,i,n,o){const r=n.constantOr(this.value);e.set(t,o,r instanceof Ae?r.toRenderColor(this.ignoreLut?null:this.context.lut):r)}getBinding(t,e){return"color"===this.type?new Ma(t):new wa(t)}}class La{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,n,o){const r="u_pattern"===o||"u_dash"===o?this.pattern:"u_pixel_ratio"===o?this.pixelRatio:null;r&&e.set(t,o,r)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new Aa(t):new wa(t)}}class za{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,o,r,s){const a=this.paintVertexArray.length,l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new Rr(0,{brightness:r}),e,{},o,n,s):"constant"===this.expression.kind&&this.expression.value;!this.lutExpression||"composite"!==this.lutExpression.kind&&"source"!==this.lutExpression.kind||(this.ignoreLut="none"===this.lutExpression.evaluate(new Rr(0,{brightness:r}),e,{},o,n,s)),this.paintVertexArray.resize(t),this._setPaintValue(a,t,l,this.context)}updatePaintArray(t,e,i,n,o,r,s){const a="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:s},i,n,void 0,o):"constant"===this.expression.kind&&this.expression.value;!this.lutExpression||"composite"!==this.lutExpression.kind&&"source"!==this.lutExpression.kind||(this.ignoreLut="none"===this.lutExpression.evaluate({zoom:0,brightness:s},i,n,void 0,o)),this._setPaintValue(t,e,a,this.context)}_setPaintValue(t,e,i,n){if("color"===this.type){const o=Da(i.toRenderColor(this.ignoreLut?null:n.lut));for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oa{constructor(t,e,i,n,o,r){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.context=o,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,n,o,r,s){const a=this.expression.evaluate(new Rr(this.context.zoom,{brightness:r}),e,{},o,n,s),l=this.expression.evaluate(new Rr(this.context.zoom+1,{brightness:r}),e,{},o,n,s);!this.lutExpression||"composite"!==this.lutExpression.kind&&"source"!==this.lutExpression.kind||(this.ignoreLut="none"===this.lutExpression.evaluate(new Rr(this.context.zoom,{brightness:r}),e,{},o,n,s));const u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(u,t,a,l,this.context)}updatePaintArray(t,e,i,n,o,r,s){const a=this.expression.evaluate({zoom:this.context.zoom,brightness:s},i,n,void 0,o),l=this.expression.evaluate({zoom:this.context.zoom+1,brightness:s},i,n,void 0,o);!this.lutExpression||"composite"!==this.lutExpression.kind&&"source"!==this.lutExpression.kind||(this.ignoreLut="none"===this.lutExpression.evaluate({zoom:this.context.zoom,brightness:s},i,n,void 0,o)),this._setPaintValue(t,e,a,l,this.context)}_setPaintValue(t,e,i,n,o){if("color"===this.type){const n=Da(i.toRenderColor(this.ignoreLut?null:o.lut)),r=Da(i.toRenderColor(this.ignoreLut?null:o.lut));for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],r[0],r[1])}else{for(let o=t;o<e;o++)this.paintVertexArray.emplace(o,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,n,o){const r=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=Q(this.expression.interpolationFactor(r,this.context.zoom,this.context.zoom+1),0,1);e.set(t,o,s)}getBinding(t,e){return new wa(t)}}class Ua{constructor(t,e,i,n,o){this.expression=t,this.layerId=o,this.paintVertexAttributes=("array"===i?ga:ma).members;for(let r=0;r<e.length;++r);this.paintVertexArray=new n}populatePaintArray(t,e,i,n){const o=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(o,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,o,r,s){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(t,e,i,n){if(!n||!i)return;const o=n[i];if(!o)return;const{tl:r,br:s,pixelRatio:a}=o;for(let l=t;l<e;l++)this.paintVertexArray.emplace(l,r[0],r[1],s[0],s[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fa{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=e;const n=[];for(const o in t.paint._values){const r=t.paint.get(o),s=t.paint.get(`${o}-use-theme`);if(o.endsWith("-use-theme"))continue;if(!i(o))continue;if(!(r instanceof Vr&&Oo(r.property.specification)))continue;const a=Ha(o,t.type),l=r.value,u=r.property.specification.type,c=!!r.property.useIntegerZoom,h="line-dasharray"===o||o.endsWith("pattern"),d="line-dasharray"===o&&"constant"!==t.layout.get("line-cap").value.kind||s&&"constant"!==s.value.kind;if("constant"!==l.kind||d)if("source"===l.kind||d||h){const e=Wa(o,u,"source");this.binders[o]=h?new Ua(l,a,u,e,t.id):new za(l,a,u,e),n.push(`/a_${o}`)}else{const t=Wa(o,u,"composite");this.binders[o]=new Oa(l,a,u,c,e,t),n.push(`/z_${o}`)}else this.binders[o]=h?new La(l.value,a):new Ra(l.value,a,u,e),n.push(`/u_${o}`);s&&(this.binders[o].ignoreLut="none"===s.constantOr("default"),this.binders[o].lutExpression=s.value,this.binders[o].checkUseTheme=!0)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof za||e instanceof Oa?e.maxValue:0}populatePaintArrays(t,e,i,n,o,r,s){for(const a in this.binders){const l=this.binders[a];l.context=this.context,l instanceof za||l instanceof Oa||l instanceof Ua?l.populatePaintArray(t,e,i,n,o,r,s):l.lutExpression&&l instanceof Ra&&l.lutExpression&&("composite"===l.lutExpression.kind||"source"===l.lutExpression.kind)&&(l.ignoreLut="none"===l.lutExpression.evaluate(new Rr(0,{brightness:r}),e,{},o,n,s))}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof La&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,n,o,r,s,a,l){let u=!1;const c=Object.keys(t),h=0!==c.length&&!a,d=h?c:e.uniqueIds;this.context.lut=o.lut;for(const f in this.binders){const a=this.binders[f];if(a.context=this.context,(a instanceof za||a instanceof Oa||a instanceof Ua)&&a.expression&&a.expression.kind&&"constant"!==a.expression.kind&&(!0===a.expression.isStateDependent||!1===a.expression.isLightConstant)){const c=o.paint.get(f);a.expression=c.value;for(const i of d){const o=t[i.toString()];e.eachPosition(i,((t,e,i)=>{const u=n.feature(t);a.updatePaintArray(e,i,u,o,r,s,l)}))}if(!h)for(const e of i.uniqueIds){const o=t[e.toString()];i.eachPosition(e,((t,e,i)=>{const u=n.feature(t);a.updatePaintArray(e,i,u,o,r,s,l)}))}u=!0}}return u}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ra||i instanceof La)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof za||i instanceof Oa||i instanceof Ua)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ra||i instanceof La||i instanceof Oa)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Ra||n instanceof La||n instanceof Oa)for(const o of n.uniformNames)e.push({name:o,property:i,binding:n.getBinding(t,o)})}return e}setUniforms(t,e,i,n,o){for(const{name:r,property:s,binding:a}of i){if(this.binders[s].checkUseTheme&&this.binders[s]instanceof Ra){const t=n.get(`${s}-use-theme`);t.isConstant()&&(this.binders[s].ignoreLut="none"===t.constantOr("default"))}this.binders[s].setUniform(t,a,o,n.get(s),r)}}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof za||e instanceof Oa||e instanceof Ua)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof za||i instanceof Oa||i instanceof Ua)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof za||e instanceof Oa||e instanceof Ua)&&e.destroy()}}}class Na{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new Fa(n,e,i);this.needsUpload=!1,this._featureMap=new ya,this._featureMapWithoutIds=new ya,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,i,n,o,r,s,a){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(t,e,n,o,r,s,a);void 0!==e.id?this._featureMap.add(e.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n,o,r,s){for(const a of i)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,a,n,o,r,s||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Va={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ha(t,e){return Va[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const ja={"line-pattern":{source:Ts,composite:Ts},"fill-pattern":{source:Ts,composite:Ts},"fill-extrusion-pattern":{source:Ts,composite:Ts},"line-dasharray":{source:As,composite:As}},Ga={color:{source:Ws,composite:Ps},number:{source:Ns,composite:Ws}};function Wa(t,e,i){const n=ja[t];return n&&n[i]||Ga[e][i]}lr(Ra,"ConstantBinder"),lr(La,"PatternConstantBinder"),lr(za,"SourceExpressionBinder"),lr(Ua,"PatternCompositeBinder"),lr(Oa,"CompositeExpressionBinder"),lr(Fa,"ProgramConfiguration",{omit:["_buffers"]}),lr(Na,"ProgramConfigurationSet");const qa=Yi/Math.PI/2,Za=5,$a=6,Ka=16383,Ya=64,Ja=[Ya,32,16],Xa=-qa,Qa=qa;function tl(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qa;return i=Z(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function el(t,e,i){return tl(Math.cos(Z(t)),Math.sin(Z(t)),e,i)}const il=6371008.8,nl=2*Math.PI*il;class ol{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ol(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,o=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return il*Math.acos(Math.min(o,1))}toBounds(){const t=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,e=t/Math.cos(Math.PI/180*this.lat);return new rl({lng:this.lng-e,lat:this.lat-t},{lng:this.lng+e,lat:this.lat+t})}toEcef(t){return el(this.lat,this.lng,qa+t*qa/il)}static convert(t){if(t instanceof ol)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new ol(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new ol(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class rl{constructor(t,e){if(t)if(e)this.setSouthWest(t).setNorthEast(e);else if(4===t.length){const e=t;this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]])}else{const e=t;this.setSouthWest(e[0]).setNorthEast(e[1])}}setNorthEast(t){return this._ne=t instanceof ol?new ol(t.lng,t.lat):ol.convert(t),this}setSouthWest(t){return this._sw=t instanceof ol?new ol(t.lng,t.lat):ol.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,o;if(t instanceof ol)n=t,o=t;else{if(!(t instanceof rl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(rl.convert(t)):this.extend(ol.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(ol.convert(t)):this;if(n=t._sw,o=t._ne,!n||!o)return this}return e||i?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)):(this._sw=new ol(n.lng,n.lat),this._ne=new ol(o.lng,o.lat)),this}getCenter(){return new ol((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ol(this.getWest(),this.getNorth())}getSouthEast(){return new ol(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=ol.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(t){if(t)return t instanceof rl?t:new rl(t)}}const sl=0,al=25.5;function ll(t){return nl*Math.cos(t*Math.PI/180)}function ul(t){return(180+t)/360}function cl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function hl(t,e){return t/ll(e)}function dl(t){return 360*t-180}function fl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function pl(t,e){return t*ll(fl(e))}const ml=85.051129;function gl(t){return Math.cos(Z(Q(t,-ml,ml)))}function yl(t,e){const i=Q(e,sl,al),n=Math.pow(2,i);return gl(t)*nl/(512*n)}function _l(t){return 1/Math.cos(t*Math.PI/180)}function vl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=Math.exp(Math.PI*(1-(t.y+e/Yi)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Yi/(1<<t.z)}class xl{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=ol.convert(t);return new xl(ul(i.lng),cl(i.lat),hl(e,i.lat))}toLngLat(){return new ol(dl(this.x),fl(this.y))}toAltitude(){return pl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nl*_l(fl(this.y))}}function bl(t,e,i,n,o,r,s,a,l){const u=(e+n)/2,c=(i+o)/2,h=new j(u,c);a(h),function(t,e,i,n,o,r){const s=i-o,a=n-r;return Math.abs((n-e)*s-(i-t)*a)/Math.hypot(s,a)}(h.x,h.y,r.x,r.y,s.x,s.y)>=l?(bl(t,e,i,u,c,r,h,a,l),bl(t,u,c,n,o,h,s,a,l)):t.push(s)}function Cl(t,e,i){let n=t[0],o=n.x,r=n.y;e(n);const s=[n];for(let a=1;a<t.length;a++){const l=t[a],{x:u,y:c}=l;e(l),bl(s,o,r,u,c,n,l,e,i),o=u,r=c,n=l}return s}function wl(t,e,i,n){if(n(e,i)){const o=e.add(i)._mult(.5);wl(t,e,o,n),wl(t,o,i,n)}else t.push(i)}function Sl(t,e){let i=t[0];const n=[i];for(let o=1;o<t.length;o++){const r=t[o];wl(n,i,r,e),i=r}return n}const Tl=Math.pow(2,14)-1,Al=-Tl-1;function Ml(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Q(i,Al,Tl),t.y=Q(n,Al,Tl),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Il(t,e,i){const n=t.loadGeometry(),o=t.extent,r=Yi/o;if(e&&i&&i.projection.isReprojectedInTileSpace){const r=1<<e.z,{scale:s,x:a,y:l,projection:u}=i,c=t=>{const i=dl((e.x+t.x/o)/r),n=fl((e.y+t.y/o)/r),c=u.project(i,n);t.x=(c.x*s-a)*o,t.y=(c.y*s-l)*o};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Cl(n[e],c,1);else{const t=[];for(const i of n[e])i.x<0||i.x>=o||i.y<0||i.y>=o||(c(i),t.push(i));n[e]=t}}for(const s of n)for(const t of s)Ml(t,r);return n}function El(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Il(t):[]}}function Pl(t,e,i,n,o){t.emplaceBack(2*e+(n+1)/2,2*i+(o+1)/2)}function kl(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class Bl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new vs,this.indexArray=new Os,this.segments=new fa,this.programConfigurations=new Na(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}updateFootprints(t,e){}populate(t,e,i,n){const o=this.layers[0],r=[];let s=null;"circle"===o.type&&(s=o.layout.get("circle-sort-key"));for(const{feature:l,id:u,index:c,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,e=El(l,t);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),e,i))continue;const o=s?s.evaluate(e,{},i):void 0,a={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:t?e.geometry:Il(l,i,n),patterns:{},sortKey:o};r.push(a)}s&&r.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Ms,a=n.projection);for(const l of r){const{geometry:n,index:o,sourceLayerIndex:r}=l,s=t[o].feature;this.addFeature(l,n,o,e.availableImages,i,a,e.brightness),e.featureIndex.insert(s,n,o,r,this.index)}}update(t,e,i,n,o,r,s){this.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ha.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,da.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,n,o,r,s){for(const a of e)for(const e of a){const i=e.x,n=e.y;if(i<0||i>=Yi||n<0||n>=Yi)continue;if(r){const t=r.projectTilePoint(i,n,o),e=r.upVector(o,i,n),s=this.globeExtVertexArray;kl(s,t,e),kl(s,t,e),kl(s,t,e),kl(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;Pl(this.layoutVertexArray,i,n,-1,-1),Pl(this.layoutVertexArray,i,n,1,-1),Pl(this.layoutVertexArray,i,n,1,1),Pl(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n,o,s)}}function Dl(t,e){for(let i=0;i<t.length;i++)if(Hl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Hl(t,e[i]))return!0;return!!Ol(t,e)}function Rl(t,e,i){return!!Hl(t,e)||!!Fl(e,t,i)}function Ll(t,e){if(1===t.length)return Vl(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(Hl(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(Vl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ol(t,e[i]))return!0;return!1}function zl(t,e,i){if(t.length>1){if(Ol(t,e))return!0;for(let n=0;n<e.length;n++)if(Fl(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(Fl(t[n],e,i))return!0;return!1}function Ol(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)if(Ul(n,o,e[t],e[t+1]))return!0}return!1}function Ul(t,e,i,n){return pt(t,i,n)!==pt(e,i,n)&&pt(t,e,i)!==pt(t,e,n)}function Fl(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let o=1;o<e.length;o++)if(Nl(t,e[o-1],e[o])<n)return!0;return!1}function Nl(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(o<0?e:o>1?i:i.sub(e)._mult(o)._add(e))}function Vl(t,e){let i,n,o,r=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)n=i[t],o=i[s],n.y>e.y!=o.y>e.y&&e.x<(o.x-n.x)*(e.y-n.y)/(o.y-n.y)+n.x&&(r=!r)}return r}function Hl(t,e){let i=!1;for(let n=0,o=t.length-1;n<t.length;o=n++){const r=t[n],s=t[o];r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(i=!i)}return i}function jl(t,e,i,n,o){for(const s of t)if(e<=s.x&&i<=s.y&&n>=s.x&&o>=s.y)return!0;const r=[new j(e,i),new j(e,o),new j(n,o),new j(n,i)];if(t.length>2)for(const s of r)if(Hl(t,s))return!0;for(let s=0;s<t.length-1;s++)if(Gl(t[s],t[s+1],r))return!0;return!1}function Gl(t,e,i){const n=i[0],o=i[2];if(t.x<n.x&&e.x<n.x||t.x>o.x&&e.x>o.x||t.y<n.y&&e.y<n.y||t.y>o.y&&e.y>o.y)return!1;const r=pt(t,e,i[0]);return r!==pt(t,e,i[1])||r!==pt(t,e,i[2])||r!==pt(t,e,i[3])}function Wl(t,e,i,n,o,r){let s=e.y-t.y,a=t.x-e.x;if(r=r||0){const t=s*s+a*a;if(0===t)return!0;const e=Math.sqrt(t);s/=e,a/=e}return!((i.x-t.x)*s+(i.y-t.y)*a-r<0||(n.x-t.x)*s+(n.y-t.y)*a-r<0||(o.x-t.x)*s+(o.y-t.y)*a-r<0)}function ql(t,e,i,n,o,r,s){return!(Wl(t,e,n,o,r,s)||Wl(e,i,n,o,r,s)||Wl(i,t,n,o,r,s)||Wl(n,o,t,e,i,s)||Wl(o,r,t,e,i,s)||Wl(r,n,t,e,i,s))}function Zl(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function $l(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Kl(t,e,i,n,o){if(!e[0]&&!e[1])return t;const r=j.convert(e)._mult(o);"viewport"===i&&r._rotate(-n);const s=[];for(let a=0;a<t.length;a++)s.push(t[a].sub(r));return s}function Yl(t,e,i,n){const o=j.convert(t)._mult(n);return"viewport"===e&&o._rotate(-i),o}let Jl,Xl;lr(Bl,"CircleBucket",{omit:["layers"]});var Ql,tu={exports:{}},eu=(Ql||(Ql=1,function(t,e){!function(t){function e(t,e,n){var o=i(256*t,256*(e=Math.pow(2,n)-e-1),n),r=i(256*(t+1),256*(e+1),n);return o[0]+","+o[1]+","+r[0]+","+r[1]}function i(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,i,n,o,r,s){return s=s||{},t+"?"+["bbox="+e(n,o,r),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,tu.exports)),tu.exports);class iu{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=ru(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=eu.getTileBBox(this.x,this.y,this.z),n=function(t,e,i){let n,o="";for(let r=t;r>0;r--)n=1<<r-1,o+=(e&n?1:0)+(i&n?2:0);return o}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class nu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=ru(t,e.z,e.z,e.x,e.y)}}class ou{constructor(t,e,i,n,o){this.overscaledZ=t,this.wrap=e,this.canonical=new iu(i,+n,+o),this.key=0===e&&t===i?this.canonical.key:ru(e,t,i,n,o)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new ou(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ou(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return ru(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return ru(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new ou(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new ou(e,this.wrap,e,i,n),new ou(e,this.wrap,e,i+1,n),new ou(e,this.wrap,e,i,n+1),new ou(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ou(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ou(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new nu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ru(t,e,i,n,o){const r=1<<Math.min(i,22);let s=r*(o%r)+n%r;return t&&i<22&&(s+=r*r*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}const su=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new ou(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new ou(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new ou(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new ou(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];lr(iu,"CanonicalTileID"),lr(ou,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const au=ys([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lu}=au,uu=ys([{name:"a_pos_3",components:3,type:"Int16"}]);var cu=ys([{name:"a_pos",type:"Int16",components:2}]);class hu{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const n=F.vec3.dot(e,this.dir);if(Math.abs(n)<1e-6)return!1;const o=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,i[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(t,e,i){if(F.vec3.equals(this.pos,t)||0===e)return i[0]=i[1]=i[2]=0,!1;const[n,o,r]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],l=this.pos[2]-t[2],u=n*n+o*o+r*r,c=2*(s*n+a*o+l*r),h=c*c-4*u*(s*s+a*a+l*l-e*e);if(h<0){const t=Math.max(-c/2,0),u=s+n*t,h=a+o*t,d=l+r*t,f=Math.hypot(u,h,d);return i[0]=u*e/f,i[1]=h*e/f,i[2]=d*e/f,!1}{const t=(-c-Math.sqrt(h))/(2*u);if(t<0){const t=Math.hypot(s,a,l);return i[0]=s*e/t,i[1]=a*e/t,i[2]=l*e/t,!1}return i[0]=s+n*t,i[1]=a+o*t,i[2]=l+r*t,!0}}}class du{constructor(t,e,i,n,o){this.TL=t,this.TR=e,this.BR=i,this.BL=n,this.horizon=o}static fromInvProjectionMatrix(t,e,i){const n=[-1,1,1],o=[1,1,1],r=[1,-1,1],s=[-1,-1,1],a=F.vec3.transformMat4(n,n,t),l=F.vec3.transformMat4(o,o,t),u=F.vec3.transformMat4(r,r,t),c=F.vec3.transformMat4(s,s,t);return new du(a,l,u,c,e/i)}}function fu(t,e,i){let n=1/0,o=-1/0;const r=[];for(const s of t){F.vec3.sub(r,s,e);const t=F.vec3.dot(r,i);n=Math.min(n,t),o=Math.max(o,t)}return[n,o]}function pu(t,e){let i=!0;for(let n=0;n<t.planes.length;n++){const o=t.planes[n];let r=0;for(let t=0;t<e.length;t++)r+=F.vec3.dot(o,e[t])+o[3]>=0;if(0===r)return 0;r!==e.length&&(i=!1)}return i?2:1}function mu(t,e){for(const i of t.projections){const n=fu(e,t.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function gu(t,e){let i=0;const n=[0,0,0,0];for(let o=0;o<t.length;o++)n[0]=t[o][0],n[1]=t[o][1],n[2]=t[o][2],n[3]=1,F.vec4.dot(n,e)>=0&&i++;return i}class yu{constructor(t,e){this.points=t||new Array(8).fill([0,0,0]),this.planes=e||new Array(6).fill([0,0,0,0]),this.bounds=_u.fromPoints(this.points),this.projections=[],this.frustumEdges=[F.vec3.sub([],this.points[2],this.points[3]),F.vec3.sub([],this.points[0],this.points[3]),F.vec3.sub([],this.points[4],this.points[0]),F.vec3.sub([],this.points[5],this.points[1]),F.vec3.sub([],this.points[6],this.points[2]),F.vec3.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const t=[0,-i[2],i[1]],e=[i[2],0,-i[0]];this.projections.push({axis:t,projection:fu(this.points,this.points[0],t)}),this.projections.push({axis:e,projection:fu(this.points,this.points[0],e)})}}static fromInvProjectionMatrix(t,e,i,n){const o=Math.pow(2,i),r=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const r=F.vec4.transformMat4([],i,t),s=1/r[3]/e*o;return F.vec4.mul(r,r,[s,s,n?1/r[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=F.vec3.sub([],r[t[0]],r[t[1]]),i=F.vec3.sub([],r[t[2]],r[t[1]]),n=F.vec3.normalize([],F.vec3.cross([],e,i)),o=-F.vec3.dot(n,r[t[1]]);return n.concat(o)})),a=[];for(let l=0;l<r.length;l++)a.push([r[l][0],r[l][1],r[l][2]]);return new yu(a,s)}intersectsPrecise(t,e,i){for(let n=0;n<e.length;n++)if(!gu(t,e[n]))return 0;for(let n=0;n<this.planes.length;n++)if(!gu(t,this.planes[n]))return 0;for(const n of i)for(const e of this.frustumEdges){const i=F.vec3.cross([],n,e),o=F.vec3.length(i);if(0===o)continue;F.vec3.scale(i,i,1/o);const r=fu(this.points,this.points[0],i),s=fu(t,this.points[0],i);if(r[0]>s[1]||s[0]>r[1])return 0}return 1}containsPoint(t){for(const e of this.planes){const i=e[3];if(F.vec3.dot([e[0],e[1],e[2]],t)+i<0)return!1}return!0}}class _u{static fromPoints(t){const e=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const n of t)F.vec3.min(e,e,n),F.vec3.max(i,i,n);return new _u(e,i)}static fromTileIdAndHeight(t,e,i){const n=1<<t.canonical.z,o=t.canonical.x,r=t.canonical.y;return new _u([o/n,r/n,e],[(o+1)/n,(r+1)/n,i])}static applyTransform(t,e){const i=t.getCorners();for(let n=0;n<i.length;++n)F.vec3.transformMat4(i[n],i[n],e);return _u.fromPoints(i)}static applyTransformFast(t,e){const i=[e[12],e[13],e[14]],n=[...i];for(let o=0;o<3;o++)for(let r=0;r<3;r++){const s=e[4*r+o],a=s*t.min[r],l=s*t.max[r];i[o]+=Math.min(a,l),n[o]+=Math.max(a,l)}return new _u(i,n)}static projectAabbCorners(t,e){const i=t.getCorners();for(let n=0;n<i.length;++n)F.vec3.transformMat4(i[n],i[n],e);return i}constructor(t,e){this.min=t,this.max=e,this.center=F.vec3.scale([],F.vec3.add([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],i=F.vec3.clone(this.min),n=F.vec3.clone(this.max);for(let o=0;o<e.length;o++)i[o]=e[o]?this.min[o]:this.center[o],n[o]=e[o]?this.center[o]:this.max[o];return n[2]=this.max[2],new _u(i,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?pu(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?pu(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?mu(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?mu(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function vu(t){return t*qa/il}lr(_u,"Aabb");const xu=[new _u([Xa,Xa,Xa],[Qa,Qa,Qa]),new _u([Xa,Xa,Xa],[0,0,Qa]),new _u([0,Xa,Xa],[Qa,0,Qa]),new _u([Xa,0,Xa],[0,Qa,Qa]),new _u([0,0,Xa],[Qa,Qa,Qa])];function bu(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=F.vec3.scale([],t._camera.position,t.worldSize),r=[e,i,1,1];F.vec4.transformMat4(r,r,t.pixelMatrixInverse),F.vec4.scale(r,r,1/r[3]);const s=F.vec3.sub([],r,o),a=F.vec3.normalize([],s),l=t.globeMatrix,u=[l[12],l[13],l[14]],c=F.vec3.sub([],u,o),h=F.vec3.length(c),d=F.vec3.normalize([],c),f=t.worldSize/(2*Math.PI),p=F.vec3.dot(d,a),m=Math.asin(f/h);if(m<Math.acos(p)){if(!n)return null;const t=[],e=[];F.vec3.scale(t,a,h/p),F.vec3.normalize(e,F.vec3.sub(e,t,c)),F.vec3.normalize(a,F.vec3.add(a,c,F.vec3.scale(a,e,Math.tan(m)*h)))}const g=[];new hu(o,a).closestPointOnSphere(u,f,g);const y=F.vec3.normalize([],xt(l,0)),_=F.vec3.normalize([],xt(l,1)),v=F.vec3.normalize([],xt(l,2)),x=F.vec3.dot(y,g),b=F.vec3.dot(_,g),C=F.vec3.dot(v,g),w=$(Math.asin(-b/f));let S=$(Math.atan2(x,C));S=t.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(t.center.lng,S);const T=ul(S),A=Q(cl(w),0,1);return new xl(T,A)}class Cu{constructor(t,e,i){this.a=F.vec3.sub([],t,i),this.b=F.vec3.sub([],e,i),this.center=i;const n=F.vec3.normalize([],this.a),o=F.vec3.normalize([],this.b);this.angle=Math.acos(F.vec3.dot(n,o))}}function wu(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,n){const o=Math.sin(i);return t*(Math.sin((1-n)*i)/o)+e*(Math.sin(n*i)/o)}(t.a[e],t.b[e],t.angle,Q(i,0,1))+t.center[e]}function Su(t){if(t.z<=1)return xu[t.z+2*t.y+t.x];const e=Eu(Iu(t));return _u.fromPoints(e)}function Tu(t,e,i){return F.vec3.scale(t,t,1-i),F.vec3.scaleAndAdd(t,t,e,i)}function Au(t,e,i){for(const n of t)F.vec3.transformMat4(n,n,e),F.vec3.scale(n,n,i)}function Mu(t,e,i,n){const o=e/t.worldSize,r=t.globeMatrix;if(i.z<=1){const t=Su(i).getCorners();return Au(t,r,o),_u.fromPoints(t)}const s=Iu(i,n),a=Eu(s,qa+vu(t._tileCoverLift));Au(a,r,o);const l=Number.MAX_VALUE,u=[-l,-l,-l],c=[l,l,l];if(s.contains(t.center)){for(const t of a)F.vec3.min(c,c,t),F.vec3.max(u,u,t);u[2]=0;const e=t.point,i=[e.x*o,e.y*o,0];return F.vec3.min(c,c,i),F.vec3.max(u,u,i),new _u(c,u)}if(t._tileCoverLift>0){for(const t of a)F.vec3.min(c,c,t),F.vec3.max(u,u,t);return new _u(c,u)}const h=[r[12]*o,r[13]*o,r[14]*o],d=s.getCenter(),f=Q(t.center.lat,-ml,ml),p=Q(d.lat,-ml,ml),m=ul(t.center.lng),g=cl(f);let y=m-ul(d.lng);const _=g-cl(p);y>.5?y-=1:y<-.5&&(y+=1);let v=0;if(Math.abs(y)>Math.abs(_))v=y>=0?1:3;else{v=_>=0?0:2;const t=[r[4]*o,r[5]*o,r[6]*o],e=-Math.sin(Z(_>=0?s.getSouth():s.getNorth()))*qa;F.vec3.scaleAndAdd(h,h,t,e)}const x=a[v],b=a[(v+1)%4],C=new Cu(x,b,h),w=[wu(C,0)||x[0],wu(C,1)||x[1],wu(C,2)||x[2]],S=Uu(t.zoom);if(S>0){const n=function(t,e,i,n,o){let{x:r,y:s,z:a}=t;const l=1/(1<<a);let u=r*l,c=u+l,h=s*l,d=h+l,f=0;const p=(u+c)/2-n;return p>.5?f=-1:p<-.5&&(f=1),u=((u+f)*e-(n*=e))*i+n,c=((c+f)*e-n)*i+n,h=(h*e-(o*=e))*i+o,d=(d*e-o)*i+o,[[u,d,0],[c,d,0],[c,h,0],[u,h,0]]}(i,e,t._pixelsPerMercatorPixel,m,g);for(let t=0;t<a.length;t++)Tu(a[t],n[t],S);const o=F.vec3.add([],n[v],n[(v+1)%4]);F.vec3.scale(o,o,.5),Tu(w,o,S)}for(const T of a)F.vec3.min(c,c,T),F.vec3.max(u,u,T);return c[2]=Math.min(x[2],b[2]),F.vec3.min(c,c,w),F.vec3.max(u,u,w),new _u(c,u)}function Iu(t){let{x:e,y:i,z:n}=t,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=1/(1<<n),s=new ol(dl(e*r),i===(1<<n)-1&&o?-90:fl((i+1)*r)),a=new ol(dl((e+1)*r),0===i&&o?90:fl(i*r));return new rl(s,a)}function Eu(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qa;const i=Z(t.getNorth()),n=Z(t.getSouth()),o=Math.cos(i),r=Math.cos(n),s=Math.sin(i),a=Math.sin(n),l=t.getWest(),u=t.getEast();return[tl(r,a,l,e),tl(r,a,u,e),tl(o,s,u,e),tl(o,s,l,e)]}function Pu(t,e,i,n){const o=1<<i.z,r=(t/Yi+i.x)/o;return el(fl((e/Yi+i.y)/o),dl(r),n)}function ku(t){let{min:e,max:i}=t;return Ka/Math.max(i[0]-e[0],i[1]-e[1],i[2]-e[2])}const Bu=new Float64Array(16);function Du(t){const e=ku(t),i=F.mat4.fromScaling(Bu,[e,e,e]);return F.mat4.translate(i,i,F.vec3.negate([],t.min))}function Ru(t){const e=F.mat4.fromTranslation(Bu,t.min),i=1/ku(t);return F.mat4.scale(e,e,[i,i,i])}function Lu(t){const e=Yi/(2*Math.PI);return t/(2*Math.PI)/e}function zu(t,e){return Yi/(512*Math.pow(2,t))*ku(Su(e))}function Ou(t,e,i,n,o){const r=Lu(i),s=[t,e,-i/(2*Math.PI)],a=F.mat4.identity(new Float64Array(16));return F.mat4.translate(a,a,s),F.mat4.scale(a,a,[r,r,r]),F.mat4.rotateX(a,a,Z(-o)),F.mat4.rotateY(a,a,Z(-n)),a}function Uu(t){return tt(Za,$a,t)}function Fu(t,e){const i=el(e.lat,e.lng),n=function(t){const e=el(t._center.lat,t._center.lng),i=F.vec3.fromValues(0,1,0);let n=F.vec3.cross([],i,e);const o=F.mat4.fromRotation([],-t.angle,e);n=F.vec3.transformMat4(n,n,o),F.mat4.fromRotation(o,-t._pitch,n);const r=F.vec3.normalize([],e);return F.vec3.scale(r,r,vu(t.cameraToCenterDistance/t.pixelsPerMeter)),F.vec3.transformMat4(r,r,o),F.vec3.add([],e,r)}(t),o=F.vec3.subtract([],n,i);return F.vec3.angle(o,i)}function Nu(t,e){return Fu(t,e)>Math.PI/2*1.01}const Vu=Z(85),Hu=Math.cos(Vu),ju=Math.sin(Vu),Gu=F.mat4.create(),Wu=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function qu(t,e,i,n,o,r,s,a,l){if(r&&t.queryGeometry.isAboveHorizon)return!1;r&&(l*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,c=i.projection.upVectorScale(u,i.center.lat,i.worldSize).metersToTile;for(const h of e)for(const e of h){const h=e.add(a),d=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(h.x,h.y,!0):0,f=i.projection.projectTilePoint(h.x,h.y,u);if(d>0){const t=i.projection.upVector(u,h.x,h.y);f.x+=t[0]*c*d,f.y+=t[1]*c*d,f.z+=t[2]*c*d}const p=r?h:Zu(f.x,f.y,f.z,n),m=r?t.tilespaceRays.map((t=>Yu(t,d))):t.queryGeometry.screenGeometry,g=F.vec4.transformMat4([],[f.x,f.y,f.z,1],n);if(!s&&r?l*=g[3]/i.cameraToCenterDistance:s&&!r&&(l*=i.cameraToCenterDistance/g[3]),r){const t=fl((e.y/Yi+u.y)/(1<<u.z));l/=i.projection.pixelsPerMeter(t,1)/hl(1,t)}if(Rl(m,p,l))return!0}return!1}function Zu(t,e,i,n){const o=F.vec4.transformMat4([],[t,e,i,1],n);return new j(o[0]/o[3],o[1]/o[3])}const $u=F.vec3.fromValues(0,0,0),Ku=F.vec3.fromValues(0,0,1);function Yu(t,e){const i=F.vec3.create();return $u[2]=e,t.intersectsPlane($u,Ku,i),new j(i[0],i[1])}class Ju extends Bl{}let Xu,Qu,tc,ec;function ic(t,e,i,n){let{width:o,height:r}=e;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==o*r*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(o*r*i);return t.width=o,t.height=r,t.data=n,t}function nc(t,e,i){const{width:n,height:o}=e;n===t.width&&o===t.height||(oc(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,o)},i,null),t.width=n,t.height=o,t.data=e.data)}function oc(t,e,i,n,o,r,s,a){if(0===o.width||0===o.height)return e;if(o.width>t.width||o.height>t.height||i.x>t.width-o.width||i.y>t.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||n.x>e.width-o.width||n.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const l=t.data,u=e.data,c=4===r&&a;for(let h=0;h<o.height;h++){const a=((i.y+h)*t.width+i.x)*r,d=((n.y+h)*e.width+n.x)*r;if(c)for(let t=0;t<o.width;t++){const e=a+t*r+3,i=d+t*r;u[i+0]=255,u[i+1]=255,u[i+2]=255,u[i+3]=l[e]}else if(s)for(let t=0;t<o.width;t++){const e=a+t*r,i=d+t*r,n=l[e+3],o=new Ae(l[e+0]/255*n,l[e+1]/255*n,l[e+2]/255*n,n).toRenderColor(s).toArray();u[i+0]=o[0],u[i+1]=o[1],u[i+2]=o[2],u[i+3]=o[3]}else for(let t=0;t<o.width*r;t++)u[d+t]=l[a+t]}return e}lr(Ju,"HeatmapBucket",{omit:["layers"]});class rc{constructor(t,e){ic(this,t,1,e)}resize(t){nc(this,new rc(t),1)}clone(){return new rc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,o){oc(t,e,i,n,o,1,null)}}class sc{constructor(t,e){ic(this,t,4,e)}resize(t){nc(this,new sc(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,o,r,s){oc(t,e,i,n,o,4,r,s)}}class ac{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}function lc(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,o=t.image||new sc({width:i,height:n}),r=(i,n,r)=>{e[t.evaluationKey]=r;const s=t.expression.evaluate(e);s&&(o.data[i+n+0]=Math.floor(255*s.r/s.a),o.data[i+n+1]=Math.floor(255*s.g/s.a),o.data[i+n+2]=Math.floor(255*s.b/s.a),o.data[i+n+3]=Math.floor(255*s.a))};if(t.clips)for(let s=0,a=0;s<n;++s,a+=4*i)for(let e=0,n=0;e<i;e++,n+=4){const o=e/(i-1),{start:l,end:u}=t.clips[s];r(a,n,l*(1-o)+u*o)}else for(let s=0,a=0;s<i;s++,a+=4)r(0,a,s/(i-1));return o}lr(rc,"AlphaImage"),lr(sc,"RGBAImage");const uc=ys([{name:"a_pos",components:2,type:"Int16"}],4),{members:cc}=uc;function hc(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const n=e&&e.length,o=n?e[0]*i:t.length;let r=dc(t,0,o,i,!0);const s=[];if(!r||r.next===r.prev)return s;let a,l,u;if(n&&(r=function(t,e,i,n){const o=[];for(let r=0,s=e.length;r<s;r++){const i=dc(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1);i===i.next&&(i.steiner=!0),o.push(wc(i))}o.sort(vc);for(let r=0;r<o.length;r++)i=xc(o[r],i);return i}(t,e,r,i)),t.length>80*i){a=1/0,l=1/0;let e=-1/0,n=-1/0;for(let r=i;r<o;r+=i){const i=t[r],o=t[r+1];i<a&&(a=i),o<l&&(l=o),i>e&&(e=i),o>n&&(n=o)}u=Math.max(e-a,n-l),u=0!==u?32767/u:0}return pc(r,s,i,a,l,u,0),s}function dc(t,e,i,n,o){let r;if(o===function(t,e,i,n){let o=0;for(let r=e,s=i-n;r<i;r+=n)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}(t,e,i,n)>0)for(let s=e;s<i;s+=n)r=Dc(s/n|0,t[s],t[s+1],r);else for(let s=i-n;s>=e;s-=n)r=Dc(s/n|0,t[s],t[s+1],r);return r&&Mc(r,r.next)&&(Rc(r),r=r.next),r}function fc(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!Mc(n,n.next)&&0!==Ac(n.prev,n,n.next))n=n.next;else{if(Rc(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function pc(t,e,i,n,o,r,s){if(!t)return;!s&&r&&function(t,e,i,n){let o=t;do{0===o.z&&(o.z=Cc(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){let e,i=1;do{let n,o=t;t=null;let r=null;for(e=0;o;){e++;let s=o,a=0;for(let t=0;t<i&&(a++,s=s.nextZ,s);t++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||o.z<=s.z)?(n=o,o=o.nextZ,a--):(n=s,s=s.nextZ,l--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;o=s}r.nextZ=null,i*=2}while(e>1)}(o)}(t,n,o,r);let a=t;for(;t.prev!==t.next;){const l=t.prev,u=t.next;if(r?gc(t,n,o,r):mc(t))e.push(l.i,t.i,u.i),Rc(t),t=u.next,a=u.next;else if((t=u)===a){s?1===s?pc(t=yc(fc(t),e),e,i,n,o,r,2):2===s&&_c(t,e,i,n,o,r):pc(fc(t),e,i,n,o,r,1);break}}}function mc(t){const e=t.prev,i=t,n=t.next;if(Ac(e,i,n)>=0)return!1;const o=e.x,r=i.x,s=n.x,a=e.y,l=i.y,u=n.y,c=o<r?o<s?o:s:r<s?r:s,h=a<l?a<u?a:u:l<u?l:u,d=o>r?o>s?o:s:r>s?r:s,f=a>l?a>u?a:u:l>u?l:u;let p=n.next;for(;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&Sc(o,a,r,l,s,u,p.x,p.y)&&Ac(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function gc(t,e,i,n){const o=t.prev,r=t,s=t.next;if(Ac(o,r,s)>=0)return!1;const a=o.x,l=r.x,u=s.x,c=o.y,h=r.y,d=s.y,f=a<l?a<u?a:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,m=a>l?a>u?a:u:l>u?l:u,g=c>h?c>d?c:d:h>d?h:d,y=Cc(f,p,e,i,n),_=Cc(m,g,e,i,n);let v=t.prevZ,x=t.nextZ;for(;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==o&&v!==s&&Sc(a,c,l,h,u,d,v.x,v.y)&&Ac(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==o&&x!==s&&Sc(a,c,l,h,u,d,x.x,x.y)&&Ac(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==o&&v!==s&&Sc(a,c,l,h,u,d,v.x,v.y)&&Ac(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==o&&x!==s&&Sc(a,c,l,h,u,d,x.x,x.y)&&Ac(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function yc(t,e){let i=t;do{const n=i.prev,o=i.next.next;!Mc(n,o)&&Ic(n,i,i.next,o)&&kc(n,o)&&kc(o,n)&&(e.push(n.i,i.i,o.i),Rc(i),Rc(i.next),i=t=o),i=i.next}while(i!==t);return fc(i)}function _c(t,e,i,n,o,r){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&Tc(s,t)){let a=Bc(s,t);return s=fc(s,s.next),a=fc(a,a.next),pc(s,e,i,n,o,r,0),void pc(a,e,i,n,o,r,0)}t=t.next}s=s.next}while(s!==t)}function vc(t,e){return t.x-e.x}function xc(t,e){const i=function(t,e){let i=e;const n=t.x,o=t.y;let r,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){const t=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>s&&(s=t,r=i.x<i.next.x?i:i.next,t===n))return r}i=i.next}while(i!==e);if(!r)return null;const a=r,l=r.x,u=r.y;let c=1/0;i=r;do{if(n>=i.x&&i.x>=l&&n!==i.x&&Sc(o<u?n:s,o,l,u,o<u?s:n,o,i.x,i.y)){const e=Math.abs(o-i.y)/(n-i.x);kc(i,t)&&(e<c||e===c&&(i.x>r.x||i.x===r.x&&bc(r,i)))&&(r=i,c=e)}i=i.next}while(i!==a);return r}(t,e);if(!i)return e;const n=Bc(i,t);return fc(n,n.next),fc(i,i.next)}function bc(t,e){return Ac(t.prev,t,e.prev)<0&&Ac(e.next,t,t.next)<0}function Cc(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wc(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Sc(t,e,i,n,o,r,s,a){return(o-s)*(e-a)>=(t-s)*(r-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(r-a)>=(o-s)*(n-a)}function Tc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ic(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(kc(t,e)&&kc(e,t)&&function(t,e){let i=t,n=!1;const o=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&o<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Ac(t.prev,t,e.prev)||Ac(t,e.prev,e))||Mc(t,e)&&Ac(t.prev,t,t.next)>0&&Ac(e.prev,e,e.next)>0)}function Ac(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Mc(t,e){return t.x===e.x&&t.y===e.y}function Ic(t,e,i,n){const o=Pc(Ac(t,e,i)),r=Pc(Ac(t,e,n)),s=Pc(Ac(i,n,t)),a=Pc(Ac(i,n,e));return o!==r&&s!==a||!(0!==o||!Ec(t,i,e))||!(0!==r||!Ec(t,n,e))||!(0!==s||!Ec(i,t,n))||!(0!==a||!Ec(i,e,n))}function Ec(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Pc(t){return t>0?1:t<0?-1:0}function kc(t,e){return Ac(t.prev,t,t.next)<0?Ac(t,e,t.next)>=0&&Ac(t,t.prev,e)>=0:Ac(t,e,t.prev)<0||Ac(t,t.next,e)<0}function Bc(t,e){const i=Lc(t.i,t.x,t.y),n=Lc(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Dc(t,e,i,n){const o=Lc(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Rc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lc(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zc(t,e){const i=t.length;if(i<=1)return[t];const n=[];let o,r;for(let s=0;s<i;s++){const e=mt(t[s]);0!==e&&(t[s].area=Math.abs(e),void 0===r&&(r=e<0),r===e<0?(o&&n.push(o),o=[t[s]]):o.push(t[s]))}if(o&&n.push(o),e>1)for(let s=0;s<n.length;s++)n[s].length<=e||(vi(n[s],e,1,n[s].length-1,Oc),n[s]=n[s].slice(0,e));return n}function Oc(t,e){return e.area-t.area}function Uc(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t)return null;const n="string"==typeof t?t:t.getPrimary().id;e[n]||(e[n]=[]);const o=ti.from(n).getPrimary().scaleSelf(i);return e[n].push(o),o.serialize()}function Fc(t,e,i,n){const o=n.patternDependencies;let r=!1;for(const s of e){const e=s.paint.get(`${t}-pattern`);e.isConstant()||(r=!0),Uc(e.constantOr(null),o,i)&&(r=!0)}return r}function Nc(t,e,i,n,o,r){const s=r.patternDependencies;for(const a of e){const e=a.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n},i,{},r.availableImages);t=t&&t.name?t.name:t;const l=Uc(t,s,o);l&&(i.patterns[a.id]=l)}}return i}class Vc{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vs,this.indexArray=new Os,this.indexArray2=new Bs,this.programConfigurations=new Na(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new fa,this.segments2=new fa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}updateFootprints(t,e){}populate(t,e,i,n){this.hasPattern=Fc("fill",this.layers,this.pixelRatio,e);const o=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:u}of t){const t=this.layers[0]._featureFilter.needGeometry,c=El(s,t);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),c,i))continue;const h=o?o.evaluate(c,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:u,index:l,geometry:t?c.geometry:Il(s,i,n),patterns:{},sortKey:h};r.push(d)}o&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const s of r){const{geometry:n,index:o,sourceLayerIndex:r}=s;if(this.hasPattern){const t=Nc("fill",this.layers,s,this.zoom,this.pixelRatio,e);this.patternFeatures.push(t)}else this.addFeature(s,n,o,i,{},e.availableImages,e.brightness,e.elevationFeatures);e.featureIndex.insert(t[o].feature,n,o,r,this.index)}}update(t,e,i,n,o,r,s){this.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s)}addFeatures(t,e,i,n,o,r){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,e,i,n,r,t.elevationFeatures)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0;for(const a of zc(e,500)){let t=0;for(const s of a)t+=s.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),i=e.vertexLength,n=[],o=[];for(const s of a){if(0===s.length)continue;s!==a[0]&&o.push(n.length/2);const t=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(e+s.length-1,e),n.push(s[0].x),n.push(s[0].y);for(let i=1;i<s.length;i++)this.layoutVertexArray.emplaceBack(s[i].x,s[i].y),this.indexArray2.emplaceBack(e+i-1,e+i),n.push(s[i].x),n.push(s[i].y);t.vertexLength+=s.length,t.primitiveLength+=s.length}const r=hc(n,o);for(let s=0;s<r.length;s+=3)this.indexArray.emplaceBack(i+r[s],i+r[s+1],i+r[s+2]);e.vertexLength+=t,e.primitiveLength+=r.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,o,r,n,s)}}let Hc,jc,Gc,Wc;lr(Vc,"FillBucket",{omit:["layers","patternFeatures"]});class qc{constructor(t,e,i,n){if(this.triangleCount=e.length/3,this.min=new j(0,0),this.max=new j(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length)return;const[o,r]=[t[0].clone(),t[0].clone()];for(let c=1;c<t.length;++c){const e=t[c];o.x=Math.min(o.x,e.x),o.y=Math.min(o.y,e.y),r.x=Math.max(r.x,e.x),r.y=Math.max(r.y,e.y)}if(n){const t=Math.ceil(Math.max(r.x-o.x,r.y-o.y)/n);i=Math.max(i,t)}if(0===i)return;this.min=o,this.max=r;const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/i;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let c=0;c<this.triangleCount;c++){const i=t[e[3*c+0]].sub(this.min),n=t[e[3*c+1]].sub(this.min),o=t[e[3*c+2]].sub(this.min),r=Zc(Math.floor(Math.min(i.x,n.x,o.x)),this.xScale,this.cellsX),s=Zc(Math.floor(Math.max(i.x,n.x,o.x)),this.xScale,this.cellsX),u=Zc(Math.floor(Math.min(i.y,n.y,o.y)),this.yScale,this.cellsY),h=Zc(Math.floor(Math.max(i.y,n.y,o.y)),this.yScale,this.cellsY),d=new j(0,0),f=new j(0,0),p=new j(0,0),m=new j(0,0);for(let t=u;t<=h;++t){d.y=f.y=t*a,p.y=m.y=(t+1)*a;for(let e=r;e<=s;++e)d.x=p.x=e*a,f.x=m.x=(e+1)*a,(ql(i,n,o,d,f,m)||ql(i,n,o,d,m,p))&&l.push({cellIdx:t*this.cellsX+e,triIdx:c})}}if(0===l.length)return;l.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let u=0;for(;u<l.length;){const t=l[u].cellIdx,e={start:this.payload.length,len:0};for(;u<l.length&&l[u].cellIdx===t;)++e.len,this.payload.push(l[u++].triIdx);this.cells[t]=e}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,e){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const i=Zc(t.x-this.min.x,this.xScale,this.cellsX),n=Zc(t.y-this.min.y,this.yScale,this.cellsY),o=this.cells[n*this.cellsX+i];if(o){this._lazyInitLookup();for(let t=0;t<o.len;t++){const i=this.payload[o.start+t],n=Math.floor(i/8),r=1<<i%8;if(!(this.lookup[n]&r)&&(this.lookup[n]|=r,e.push(i),e.length===this.triangleCount))return}}}query(t,e,i){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this._lazyInitLookup();const n=Zc(t.x-this.min.x,this.xScale,this.cellsX),o=Zc(e.x-this.min.x,this.xScale,this.cellsX),r=Zc(t.y-this.min.y,this.yScale,this.cellsY),s=Zc(e.y-this.min.y,this.yScale,this.cellsY);for(let a=r;a<=s;a++)for(let t=n;t<=o;t++){const e=this.cells[a*this.cellsX+t];if(e)for(let t=0;t<e.len;t++){const n=this.payload[e.start+t],o=Math.floor(n/8),r=1<<n%8;if(!(this.lookup[o]&r)&&(this.lookup[o]|=r,i.push(n),i.length===this.triangleCount))return}}}}function Zc(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}lr(qc,"TriangleGridIndex");class $c{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.footprints=[]}updateFootprints(t,e){for(const i of this.footprints)e.push({footprint:i,id:t})}populate(t,e,i,n){const o=[];for(const{feature:r,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,e=El(r,t);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),e,i))continue;const u={id:s,properties:r.properties,type:r.type,sourceLayerIndex:l,index:a,geometry:t?e.geometry:Il(r,i,n),patterns:{}};o.push(u)}for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;this.addFeature(r,n,o,i,{},e.availableImages,e.brightness),e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(t){}update(t,e,i,n,o,r,s){}destroy(){}addFeature(t,e,i,n,o){for(const r of zc(e,2)){const t=[],e=[],i=[],n=new j(1/0,1/0),o=new j(-1/0,-1/0);for(const l of r)if(0!==l.length){l!==r[0]&&i.push(e.length/2);for(let i=0;i<l.length;i++)e.push(l[i].x),e.push(l[i].y),t.push(l[i]),n.x=Math.min(n.x,l[i].x),n.y=Math.min(n.y,l[i].y),o.x=Math.max(o.x,l[i].x),o.y=Math.max(o.y,l[i].y)}const s=hc(e,i),a=new qc(t,s,8,256);this.footprints.push({vertices:t,indices:s,grid:a,min:n,max:o})}}}lr($c,"ClipBucket",{omit:["layers"]});const Kc=ys([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Yc=ys([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Jc=ys([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Xc=ys([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Qc=ys([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),th=ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eh}=Kc;var ih,nh,oh,rh,sh,ah,lh,uh={};function ch(){if(nh)return ih;nh=1;var t=H();function e(t,e,n,o,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=r,t.readFields(i,this,e)}function i(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],o=e._values[t.readVarint()];e.properties[n]=o}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function n(t){for(var e,i,n=0,o=0,r=t.length,s=r-1;o<r;s=o++)n+=((i=t[s]).x-(e=t[o]).x)*(e.y+i.y);return n}return ih=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var i,n=e.readVarint()+e.pos,o=1,r=0,s=0,a=0,l=[];e.pos<n;){if(r<=0){var u=e.readVarint();o=7&u,r=u>>3}if(r--,1===o||2===o)s+=e.readSVarint(),a+=e.readSVarint(),1===o&&(i&&l.push(i),i=[]),i.push(new t(s,a));else{if(7!==o)throw new Error("unknown command "+o);i&&i.push(i[0].clone())}}return i&&l.push(i),l},e.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,o=0,r=0,s=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)(o+=t.readSVarint())<s&&(s=o),o>a&&(a=o),(r+=t.readSVarint())<l&&(l=r),r>u&&(u=r);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,u]},e.prototype.toGeoJSON=function(t,i,o){var r,s,a=this.extent*Math.pow(2,o),l=this.extent*t,u=this.extent*i,c=this.loadGeometry(),h=e.types[this.type];function d(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+u)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(r=0;r<c.length;r++)f[r]=c[r][0];d(c=f);break;case 2:for(r=0;r<c.length;r++)d(c[r]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var i,o,r=[],s=0;s<e;s++){var a=n(t[s]);0!==a&&(void 0===o&&(o=a<0),o===a<0?(i&&r.push(i),i=[t[s]]):i.push(t[s]))}return i&&r.push(i),r}(c),r=0;r<c.length;r++)for(s=0;s<c[r].length;s++)d(c[r][s])}1===c.length?c=c[0]:h="Multi"+h;var p={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p},ih}function hh(){if(rh)return oh;rh=1;var t=ch();function e(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(i,this,e),this.length=this._features.length}function i(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}return oh=e,e.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var i=this._pbf.readVarint()+this._pbf.pos;return new t(this._pbf,i,this.extent,this._keys,this._values)},oh}function dh(){return lh||(lh=1,uh.VectorTile=function(){if(ah)return sh;ah=1;var t=hh();function e(e,i,n){if(3===e){var o=new t(n,n.readVarint()+n.pos);o.length&&(i[o.name]=o)}}return sh=function(t,i){this.layers=t.readFields(e,{},i)},sh}(),uh.VectorTileFeature=ch(),uh.VectorTileLayer=hh()),uh}var fh=dh();class ph extends j{constructor(t,e,i){super(t,e),this.z=i}}class mh extends ph{constructor(t,e,i,n){super(t,e,i),this.w=n}}function gh(t,e,i,n){const o=[],r=0===n?(t,e,i,n,o,r)=>{t.push(new j(r,i+(r-e)/(n-e)*(o-i)))}:(t,e,i,n,o,r)=>{t.push(new j(e+(r-i)/(o-i)*(n-e),r))};for(const s of t){const t=[];for(const o of s){if(o.length<=2)continue;const s=[];for(let t=0;t<o.length-1;t++){const a=o[t].x,l=o[t].y,u=o[t+1].x,c=o[t+1].y,h=0===n?a:l,d=0===n?u:c;h<e?d>e&&r(s,a,l,u,c,e):h>i?d<i&&r(s,a,l,u,c,i):s.push(o[t]),d<e&&h>=e&&r(s,a,l,u,c,e),d>i&&h<=i&&r(s,a,l,u,c,i)}let a=o[o.length-1];const l=0===n?a.x:a.y;l>=e&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),t.push(s))}t.length&&o.push(t)}return o}function yh(t,e,i,n){const o="x"===i?"y":"x",r=(n-t[i])/(e[i]-t[i]);t[o]=t[o]+(e[o]-t[o])*r,t[i]=n,t.hasOwnProperty("z")&&(t.z=Ie(t.z,e.z,r)),t.hasOwnProperty("w")&&(t.w=Ie(t.w,e.w,r))}function _h(t,e,i,n){const o=i,r=n;for(const s of["x","y"]){let i=t,n=e;i[s]>=n[s]&&(i=e,n=t),i[s]<o&&n[s]>o&&yh(i,n,s,o),i[s]<r&&n[s]>r&&yh(n,i,s,r)}}const vh=Number.MAX_SAFE_INTEGER;function xh(t,e,i,n){return t.order<e||t.order===vh||!(t.clipMask&i)||function(t,e){return 0!==e.length&&void 0===e.find((e=>e===t))}(n,t.clipScope)}function bh(t,e){return t.x-e.x||t.y-e.y}function Ch(t,e){return 0===bh(t.min,e.min)&&0===bh(t.max,e.max)}function wh(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Sh(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!Ch(t[i],e[i])||t[i].order!==e[i].order||t[i].clipMask!==e[i].clipMask||!G(t[i].clipScope,e[i].clipScope))return!1;return!0}function Th(t,e,i){const n=1/Yi,o=1/(1<<i.canonical.z),r=(e.x*n+i.canonical.x)*o+i.wrap,s=(e.y*n+i.canonical.y)*o;return{min:new j((t.x*n+i.canonical.x)*o+i.wrap,(t.y*n+i.canonical.y)*o),max:new j(r,s)}}function Ah(t,e,i){const n=1<<i.canonical.z,o=((e.x-i.wrap)*n-i.canonical.x)*Yi,r=(e.y*n-i.canonical.y)*Yi;return{min:new j(((t.x-i.wrap)*n-i.canonical.x)*Yi,(t.y*n-i.canonical.y)*Yi),max:new j(o,r)}}function Mh(t,e,i,n,o,r,s){const a=t.indices,l=t.vertices,u=[];for(let c=n;c<n+o;c+=3){const n=e[i[c+0]+r],o=e[i[c+1]+r],h=e[i[c+2]+r],d=Math.min(n.x,o.x,h.x),f=Math.max(n.x,o.x,h.x),p=Math.min(n.y,o.y,h.y),m=Math.max(n.y,o.y,h.y);u.length=0,t.grid.query(new j(d,p),new j(f,m),u);for(let t=0;t<u.length;t++){const e=u[t];if(ql(l[a[3*e+0]],l[a[3*e+1]],l[a[3*e+2]],n,o,h,s))return!0}}return!1}function Ih(t,e,i,n){if(!t||!i)return!1;let o=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(i.vertices.length<t.vertices.length)return Ih(i,n,t,e);const r=e.canonical,s=n.canonical,a=Math.pow(2,s.z-r.z);o=t.vertices.map((t=>new j((t.x+r.x*Yi)*a-s.x*Yi,(t.y+r.y*Yi)*a-s.y*Yi)))}return Mh(i,o,t.indices,0,t.indices.length,0,0)}function Eh(t,e,i,n){const o=Math.pow(2,n.z-i.z);return new j((t+i.x*Yi)*o-n.x*Yi,(e+i.y*Yi)*o-n.y*Yi)}function Ph(t,e){const i=[];e.grid.queryPoint(t,i);const n=e.indices,o=e.vertices;for(let r=0;r<i.length;r++){const e=i[r];if(Hl([o[n[3*e+0]],o[n[3*e+1]],o[n[3*e+2]]],t))return!0}return!1}const kh=[new j(0,0),new j(Yi,0),new j(Yi,Yi),new j(0,Yi)];function Bh(t,e){const i=[];let n=[];if(!e||t.length<2)return[t];if(2===t.length)return Gl(t[0],t[1],kh)?[t]:[];for(let o=0;o<t.length+2;o++){const e=t[o%t.length],r=t[(o+1)%t.length],s=Gl(0===o?t[t.length-1]:t[(o-1)%t.length],e,kh),a=Gl(e,r,kh),l=s||a;l&&n.push(e),l&&a||n.length>0&&(n.length>1&&i.push(n),n=[])}return n.length>1&&i.push(n),i}const Dh=fh.VectorTileFeature.types,Rh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Lh=["fill-extrusion-flood-light-ground-radius"],zh=Math.pow(2,13),Oh=Math.pow(2,15)-1,Uh=new j(0,1),Fh=2147483648;function Nh(t,e,i,n,o,r,s,a){t.emplaceBack((e<<1)+s,(i<<1)+r,(Math.floor(n*zh)<<1)+o,Math.round(a))}function Vh(t,e,i){t.emplaceBack(e.x*Yi,e.y*Yi,i?1:0)}function Hh(t,e,i,n,o,r){t.emplaceBack(e.x,e.y,(i.x<<1)+n,(i.y<<1)+o,r)}function jh(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class Gh{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Wh{constructor(){this.centroidXY=new j(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new j(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new j(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new j(this.max.x-this.min.x,this.max.y-this.min.y)}}class qh{constructor(){this.acc=new j(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,i){this.accCount++,this.acc._add(e);let n=!!this.borders;e.x<t.min.x?(t.min.x=e.x,n=!0):e.x>t.max.x&&(t.max.x=e.x,n=!0),e.y<t.min.y?(t.min.y=e.y,n=!0):e.y>t.max.y&&(t.max.y=e.y,n=!0),((0===e.x||e.x===Yi)&&e.x===i.x)!=((0===e.y||e.y===Yi)&&e.y===i.y)&&this.processBorderOverlap(e,i),n&&this.checkBorderIntersection(e,i)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,Ie(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Yi!=t.x>Yi&&this.addBorderIntersection(1,Ie(e.y,t.y,(Yi-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,Ie(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Yi!=t.y>Yi&&this.addBorderIntersection(3,Ie(e.x,t.x,(Yi-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new j(0,0):new j(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function Zh(t,e){const i=t.add(e)._unit(),n=Q(t.x*i.x+t.y*i.y,-1,1);var o,r,s;return s=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(s)))/4*Oh*((o=t).x*(r=e).y-o.y*r.x<0?-1:1)}const $h=[t=>t.x<0,t=>t.x>Yi,t=>t.y<0,t=>t.y>Yi];function Kh(t,e,i,n){const o=[4];if(0===n)return o;i._mult(n);const r=t.sub(i),s=e.sub(i),a=[t,e,r,s];for(let l=0;l<4;l++)for(const t of a)if($h[l](t)){o.push(l);break}return o}class Yh{constructor(t){this.vertexArray=new Cs,this.indexArray=new Os,this.programConfigurations=new Na(t.layers,{zoom:t.zoom,lut:t.lut},(t=>Lh.includes(t))),this._segments=new fa,this.hiddenByLandmarkVertexArray=new Js,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new fa}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=t.length;if(o>2){let r=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*o,this.vertexArray.length,2*this._segmentToGroundQuads[r].length);let a;r!==this._segments.get().length-1&&(r++,this._segmentToGroundQuads[r]=[],this._segmentToRegionTriCounts[r]=[0,0,0,0,0]);{const e=t[0],i=t[1];a=Zh(e.sub(t[o-1])._perp()._unit(),i.sub(e)._perp()._unit())}for(let l=0;l<o;l++){const u=l===o-1?0:l+1,c=t[l],h=t[u],d=t[u===o-1?0:u+1],f=h.sub(c)._perp()._unit(),p=Zh(f,d.sub(h)._perp()._unit()),m=a,g=p;if(ed(c,h,e)||n&&id(c,e)&&id(h,e)){a=p;continue}const y=s.vertexLength;Hh(this.vertexArray,c,h,1,1,m),Hh(this.vertexArray,c,h,1,0,m),Hh(this.vertexArray,c,h,0,1,g),Hh(this.vertexArray,c,h,0,0,g),s.vertexLength+=4;const _=Kh(c,h,f,i);for(const t of _)this._segmentToGroundQuads[r].push({id:y,region:t}),this._segmentToRegionTriCounts[r][t]+=2,s.primitiveLength+=2;a=p}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let i=0;i<e;i++)this._segmentToGroundQuads[i].sort(((t,e)=>t.region-e.region));for(let i=0;i<e;i++){const e=this._segmentToGroundQuads[i],n=t[i],o=this._segmentToRegionTriCounts[i];o.reduce(((t,e)=>t+e),0);let r=0;for(let t=0;t<=4;t++){const e=o[t];if(0!==e){let i=this.regionSegments[t];i||(i=this.regionSegments[t]=new fa);const o={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+r,vertexLength:n.vertexLength,primitiveLength:e};i.get().push(o)}r+=e}for(let t=0;t<e.length;t++){const i=e[t].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,i,n,o,r){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,i,n,o,r)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Yc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,i,n,o,r,s){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,i,n,o,r,s)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&Fh?1:0;for(let n=t.groundVertexArrayOffset;n<e;++n)this.hiddenByLandmarkVertexArray.emplace(n,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,Qc.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class Jh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Os,this.footprintVertices=new vs,this.footprintSegments=[],this.layoutVertexArray=new bs,this.centroidVertexArray=new la,this.wallVertexArray=new ca,this.indexArray=new Os,this.programConfigurations=new Na(t.layers,{zoom:t.zoom,lut:t.lut},(t=>Rh.includes(t))),this.segments=new fa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new Yh(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,e){}populate(t,e,i,n){this.features=[],this.hasPattern=Fc("fill-extrusion",this.layers,this.pixelRatio,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=vl(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:o,id:r,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=El(o,t);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),l,i))continue;const u={id:r,sourceLayerIndex:a,index:s,geometry:t?l.geometry:Il(o,i,n),properties:o.properties,type:o.type,patterns:{}},c=this.layoutVertexArray.length,h="Polygon"===Dh[u.type];if(this.hasPattern)this.features.push(Nc("fill-extrusion",this.layers,u,this.zoom,this.pixelRatio,e));else if(this.wallMode)for(const o of u.geometry)for(const t of Bh(o,h))this.addFeature(u,[t],s,i,{},e.availableImages,n,e.brightness);else this.addFeature(u,u.geometry,s,i,{},e.availableImages,n,e.brightness);e.featureIndex.insert(o,u.geometry,s,a,this.index,c)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,i,n,o,r){for(const s of this.features){const t="Polygon"===Dh[s.type],{geometry:a}=s;if(this.wallMode)for(const l of a)for(const a of Bh(l,t))this.addFeature(s,[a],s.index,e,i,n,o,r);else this.addFeature(s,a,s.index,e,i,n,o,r)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,i,n,o,r,s){this.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s),this.groundEffect.update(t,e,o,i,n,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,Xc.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,th.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Jc.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,o,r,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new j(0,0),new j(Yi,Yi)],c=s.projection,h="globe"===c.name,d=this.wallMode||"Polygon"===Dh[t.type],f=new qh;f.centroidDataIndex=this.centroidData.length;const p=new Wh,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},n)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},n);let y;if(p.height=g,p.vertexArrayOffset=this.layoutVertexArray.length,p.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ms),this.wallMode){if(h)return void ft("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==e.length)return;y=function(t){const e=t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y,i=function(t){let e=0;const i=t.length;for(let n=0;n<i;n++)e+=(t[(n+1)%i].x-t[n].x)*(t[(n+1)%i].y+t[n].y);return e>=0}(t);i||(t=t.reverse());const n={geometry:[],joinNormals:[],indices:[]},o=[],r=[],s=[];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;if(a<(e?3:2))return n;let l,u,c,h,d,f=0;for(;f<a-1&&t[f].equals(t[f+1]);)f++;e&&(l=t[a-2],d=t[f].sub(l)._unit()._perp());for(let m=f;m<a;m++){if(c=m===a-1?e?t[f+1]:void 0:t[m+1],c&&t[m].equals(c))continue;d&&(h=d),l&&(u=l),l=t[m],d=c?c.sub(l)._unit()._perp():h,h=h||d;let i=h.add(d);0===i.x&&0===i.y||i._unit();const n=i.x*d.x+i.y*d.y,p=0!==n?1/n:1/0,g=h.x*d.y-h.y*d.x>0;let y="miter";const _=2;"miter"===y&&p>_&&(y="bevel"),"bevel"===y&&(p>100&&(y="flipbevel"),p<_&&(y="miter"));const v=(t,e,i,n)=>{const a=new j(t.x,t.y),l=new j(t.x,t.y);a.x+=e.x*n,a.y+=e.y*n,l.x-=e.x*Math.max(i,1),l.y-=e.y*Math.max(i,1),s.push(e),o.push(a),r.push(l)};if("miter"===y)i._mult(p),v(l,i,0,0);else if("flipbevel"===y)i=d.mult(-1),v(l,i,0,0),v(l,i.mult(-1),0,0);else{const t=-Math.sqrt(p*p-1),e=g?t:0,i=g?0:t;u&&v(l,h,e,i),c&&v(l,d,e,i)}}n.geometry=[...o,...r.reverse(),o[0]],n.joinNormals=[...s,...s.reverse(),s[s.length-1]];const p=n.geometry.length-1;for(let m=0;m<p/2;m++)if(m+1<p/2){let t=m,e=m+1,i=p-1-m,o=p-2-m;t=0===t?p-1:t-1,e=0===e?p-1:e-1,i=0===i?p-1:i-1,o=0===o?p-1:o-1,n.indices.push(i),n.indices.push(e),n.indices.push(t),n.indices.push(i),n.indices.push(o),n.indices.push(e)}return n}(e[0]),e=[y.geometry]}const _=(t,e)=>t<(e.length-1)/2||t===e.length-1,v=this.wallMode?[e]:zc(e,500);for(let T=v.length-1;T>=0;T--){const t=v[T];(0===t.length||(x=t[0]).every((t=>t.x<=0))||x.every((t=>t.x>=Yi))||x.every((t=>t.y<=0))||x.every((t=>t.y>=Yi)))&&v.splice(T,1)}var x;let b;if(h)b=sd(v,u,n);else{b=[];for(const t of v)b.push({polygon:t,bounds:u})}const C=d?this.edgeRadius:0,w=C>0&&this.zoom<17,S=(t,e)=>{if(0===t.length)return!1;const i=t[t.length-1];return e.x===i.x&&e.y===i.y};for(const{polygon:T,bounds:A}of b){let t=0,e=0;for(const n of T)d&&!n[0].equals(n[n.length-1])&&n.push(n[0]),e+=d?n.length-1:n.length;const i=this.segments.prepareSegment((d?5:4)*e,this.layoutVertexArray,this.indexArray);p.footprintSegIdx<0&&(p.footprintSegIdx=this.footprintSegments.length),p.polygonSegIdx<0&&(p.polygonSegIdx=this.polygonSegments.length);const o={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},r=new Gh;if(r.vertexOffset=this.footprintVertices.length,r.indexOffset=3*this.footprintIndices.length,r.ringIndices=[],d){const e=[],o=[];t=i.vertexLength;for(let t=0;t<T.length;t++){const s=T[t];s.length&&0!==t&&o.push(e.length/2);const a=[];let u,d;u=s[1].sub(s[0])._perp()._unit(),r.ringIndices.push(s.length-1);for(let t=1;t<s.length;t++){const o=s[t],r=s[t===s.length-1?1:t+1],l=o.clone();if(C){d=r.sub(o)._perp()._unit();const t=u.add(d)._unit(),e=C*Math.min(4,1/(u.x*t.x+u.y*t.y));l.x+=e*t.x,l.y+=e*t.y,l.x=Math.round(l.x),l.y=Math.round(l.y),u=d}if(!m||0!==C&&!w||S(a,l)||a.push(l),Nh(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),this.wallMode){const e=_(t,s);Vh(this.wallVertexArray,y.joinNormals[t],!e)}i.vertexLength++,this.footprintVertices.emplaceBack(o.x,o.y),e.push(o.x,o.y),h&&jh(this.layoutVertexExtArray,c.projectTilePoint(l.x,l.y,n),c.upVector(n,l.x,l.y))}m&&(0===C||w)&&(0!==a.length&&S(a,a[0])&&a.pop(),this.groundEffect.addData(a,A,l))}const s=this.wallMode?y.indices:hc(e,o);for(let n=0;n<s.length;n+=3)this.footprintIndices.emplaceBack(r.vertexOffset+s[n+0],r.vertexOffset+s[n+1],r.vertexOffset+s[n+2]),this.indexArray.emplaceBack(t+s[n],t+s[n+2],t+s[n+1]),i.primitiveLength++;r.indexCount+=s.length,r.vertexCount+=this.footprintVertices.length-r.vertexOffset}for(let s=0;s<T.length;s++){const e=T[s];f.startRing(p,e[0]);let o=e.length>4&&nd(e[e.length-2],e[0],e[1]),r=C?Qh(e[e.length-2],e[0],e[1],C):0;const a=[];let u,g,v;g=e[1].sub(e[0])._perp()._unit();let x=!0;for(let s=1,l=0;s<e.length;s++){let d=e[s-1],b=e[s];const w=e[s===e.length-1?1:s+1];if(f.appendEdge(p,b,d),ed(b,d,A)){C&&(g=w.sub(b)._perp()._unit(),x=!x);continue}const T=b.sub(d)._perp(),M=T.x/(Math.abs(T.x)+Math.abs(T.y)),I=T.y>0?1:0,E=d.dist(b);if(l+E>32768&&(l=0),C){v=w.sub(b)._perp()._unit();let t=td(d,b,w,Xh(g,v),C);isNaN(t)&&(t=0);const e=b.sub(d)._unit();d=d.add(e.mult(r))._round(),b=b.add(e.mult(-t))._round(),r=t,g=v,m&&this.zoom>=17&&(S(a,d)||a.push(d),S(a,b)||a.push(b))}const P=i.vertexLength,k=e.length>4&&nd(d,b,w);let B=od(l,o,x);if(Nh(this.layoutVertexArray,d.x,d.y,M,I,0,0,B),Nh(this.layoutVertexArray,d.x,d.y,M,I,0,1,B),this.wallMode){const t=_(s-1,e),i=y.joinNormals[s-1];Vh(this.wallVertexArray,i,t),Vh(this.wallVertexArray,i,t)}if(l+=E,B=od(l,k,!x),o=k,Nh(this.layoutVertexArray,b.x,b.y,M,I,0,0,B),Nh(this.layoutVertexArray,b.x,b.y,M,I,0,1,B),this.wallMode){const t=_(s,e),i=y.joinNormals[s];Vh(this.wallVertexArray,i,t),Vh(this.wallVertexArray,i,t)}if(i.vertexLength+=4,this.indexArray.emplaceBack(P+0,P+1,P+2),this.indexArray.emplaceBack(P+1,P+3,P+2),i.primitiveLength+=2,C){const n=t+(1===s?e.length-2:s-2),o=1===s?t:n+1;if(this.indexArray.emplaceBack(P+1,n,P+3),this.indexArray.emplaceBack(n,o,P+3),i.primitiveLength+=2,void 0===u&&(u=P),!ed(w,e[s],A)){const t=s===e.length-1?u:i.vertexLength;this.indexArray.emplaceBack(P+2,P+3,t),this.indexArray.emplaceBack(P+3,t+1,t),this.indexArray.emplaceBack(P+3,o,t+1),i.primitiveLength+=3}x=!x}if(h){const t=this.layoutVertexExtArray,e=c.projectTilePoint(d.x,d.y,n),i=c.projectTilePoint(b.x,b.y,n),o=c.upVector(n,d.x,d.y),r=c.upVector(n,b.x,b.y);jh(t,e,o),jh(t,e,o),jh(t,i,r),jh(t,i,r)}}d&&(t+=e.length-1),m&&C&&this.zoom>=17&&(0!==a.length&&S(a,a[0])&&a.pop(),this.groundEffect.addData(a,A,l,C>0))}this.footprintSegments.push(r),o.triangleCount=this.indexArray.length-o.triangleArrayOffset,this.polygonSegments.push(o),++p.footprintSegLen,++p.polygonSegLen}if(p.vertexCount=this.layoutVertexArray.length-p.vertexArrayOffset,p.groundVertexCount=this.groundEffect.vertexArray.length-p.groundVertexArrayOffset,0!==p.vertexCount){if(p.centroidXY=f.borders?Uh:this.encodeCentroid(f,p),this.centroidData.push(p),f.borders){this.featuresOnBorder.push(f);const t=this.featuresOnBorder.length-1;for(let e=0;e<f.borders.length;e++)f.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,o,r,n,a),this.groundEffect.addPaintPropertiesData(t,i,o,r,n,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}splitToSubtiles(){const t=[];for(let s=0;s<this.centroidData.length;s++){const e=this.centroidData[s],i=+(e.min.y+e.max.y>Yi),n=2*i+(+(e.min.x+e.max.x>Yi)^i);for(let o=0;o<e.polygonSegLen;o++){const i=e.polygonSegIdx+o;t.push({centroidIdx:s,subtile:n,polygonSegmentIdx:i,triangleSegmentIdx:this.polygonSegments[i].triangleSegIdx})}}const e=new Os;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let i=0,n=0,o=0;for(const s of t){if(s.triangleSegmentIdx!==i)break;o++}const r=t.length;for(;n!==t.length;){i=t[n].triangleSegmentIdx;let s=0,a=n,l=n;for(let e=a;e<o&&t[e].subtile===s;e++)l++;for(;a!==o;){const n=t[a];s=n.subtile;const r=this.centroidData[n.centroidIdx].min.clone(),u=this.centroidData[n.centroidIdx].max.clone(),c={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const n=t[i],o=this.polygonSegments[n.polygonSegmentIdx],s=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let t=o.triangleArrayOffset;t<o.triangleArrayOffset+o.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);c.primitiveLength+=o.triangleCount,r.x=Math.min(r.x,s.x),r.y=Math.min(r.y,s.y),u.x=Math.max(u.x,a.x),u.y=Math.max(u.y,a.y)}c.primitiveLength>0&&this.triangleSubSegments.push({segment:c,min:r,max:u}),a=l;for(let e=a;e<o&&t[e].subtile===t[a].subtile;e++)l++}n=o;for(let e=n;e<r&&t[e].triangleSegmentIdx===t[n].triangleSegmentIdx;e++)o++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,i){const n=new fa;if(this.wallMode){for(const t of this.triangleSubSegments)n.segments.push(t.segment);return n}let o=0,r=0;const s=1<<t.canonical.z;if(e){const i=e.getMinMaxForTile(t);i&&(o=i.min,r=i.max)}r+=this.maxHeight;const a=t.toUnwrapped();let l;const u=[a.canonical.x/s+a.wrap,a.canonical.y/s],c=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],h=(t,e,i)=>[t[0]*(1-i[0])+e[0]*i[0],t[1]*(1-i[1])+e[1]*i[1]],d=[],f=[];for(const p of this.triangleSubSegments){d[0]=p.min.x/Yi,d[1]=p.min.y/Yi,f[0]=p.max.x/Yi,f[1]=p.max.y/Yi;const t=h(u,c,d),e=h(u,c,f);if(0===new _u([t[0],t[1],o],[e[0],e[1],r]).intersectsPrecise(i)){l&&(n.segments.push(l),l=void 0);continue}const s=p.segment;l&&l.vertexOffset!==s.vertexOffset&&(n.segments.push(l),l=void 0),l?(l.vertexLength+=s.vertexLength,l.primitiveLength+=s.primitiveLength):l={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&n.segments.push(l),n}encodeCentroid(t,e){const i=t.centroid(),n=e.span(),o=Math.min(7,Math.round(n.x*this.tileToMeter/10)),r=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new j(Q(i.x,1,Yi-1)<<3|o,Q(i.y,1,Yi-1)<<3|r)}encodeBorderCentroid(t){if(!t.borders)return new j(0,0);const e=t.borders,i=Number.MAX_VALUE;if(e[0][0]!==i||e[1][0]!==i){const t=e[0][0]!==i?0:1;return new j(6|(e[0][0]!==i?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==i?2:3;return new j((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==i?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=Fh,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,n=t.flags&Fh?Uh:t.centroidXY,o=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==n.y||o!==n.x){for(let t=e;t<i;++t)this.centroidVertexArray.emplace(t,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e,i){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const n=e.getReplacementRegionsForTile(t.toUnwrapped());if(Sh(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const r of this.centroidData)r.flags&=2147483647;const o=[];for(const r of this.activeReplacements){if(r.order<i)continue;const e=Math.max(1,Math.pow(2,r.footprintTileId.canonical.z-t.canonical.z));for(const i of this.centroidData)if(!(i.flags&Fh||r.min.x>i.max.x||i.min.x>r.max.x||r.min.y>i.max.y||i.min.y>r.max.y))for(let n=0;n<i.footprintSegLen;n++){const s=this.footprintSegments[i.footprintSegIdx+n];if(o.length=0,ad(this.footprintVertices,s.vertexOffset,s.vertexCount,r.footprintTileId.canonical,t.canonical,o),Mh(r.footprint,o,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-e)){i.flags|=Fh;break}}}for(const r of this.centroidData)this.writeCentroidToBuffer(r);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,i){let n=!1;for(let o=0;o<i.footprintSegLen;o++){const r=this.footprintSegments[i.footprintSegIdx+o];let s=0;for(const i of r.ringIndices){for(let o=s,a=i+s-1;o<i+s;a=o++){const i=this.footprintVertices.int16[2*(o+r.vertexOffset)+0],s=this.footprintVertices.int16[2*(o+r.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+r.vertexOffset)+1];s>e!=l>e&&t<(this.footprintVertices.int16[2*(a+r.vertexOffset)+0]-i)*(e-s)/(l-s)+i&&(n=!n)}s=i}}return n}getHeightAtTileCoord(t,e){let i=Number.NEGATIVE_INFINITY,n=!0;const o=4*(t+Yi)*Yi+(e+Yi);if(this.partLookup.hasOwnProperty(o)){const t=this.partLookup[o];return t?{height:t.height,hidden:!!(t.flags&Fh)}:void 0}for(const r of this.centroidData)t>r.max.x||r.min.x>t||e>r.max.y||r.min.y>e||this.footprintContainsPoint(t,e,r)&&r&&r.height>i&&(i=r.height,this.partLookup[o]=r,n=!!(r.flags&Fh));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:n};this.partLookup[o]=void 0}}function Xh(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Qh(t,e,i,n){const o=e.sub(t)._perp()._unit(),r=i.sub(e)._perp()._unit();return td(t,e,i,Xh(o,r),n)}function td(t,e,i,n,o){const r=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,o*r/n)}function ed(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function id(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function nd(t,e,i){if(t.x<0||t.x>=Yi||e.x<0||e.x>=Yi||i.x<0||i.x>=Yi)return!1;const n=i.sub(e),o=n.perp(),r=t.sub(e);return(n.x*r.x+n.y*r.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(r.x*r.x+r.y*r.y))>-.866&&o.x*r.x+o.y*r.y<0}function od(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function rd(){const t=Math.PI/32,e=Math.tan(t),i=il;return i*Math.sqrt(1+2*e*e)-i}function sd(t,e,i){const n=1<<i.z,o=dl(i.x/n),r=dl((i.x+1)/n),s=fl(i.y/n),a=fl((i.y+1)/n);return function(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0;const s=[];if(!t.length||!i||!n)return s;const a=(t,e)=>{for(const i of t)s.push({polygon:i,bounds:e})},l=Math.ceil(Math.log2(i)),u=Math.ceil(Math.log2(n)),c=l-u,h=[];for(let p=0;p<Math.abs(c);p++)h.push(c>0?0:1);for(let p=0;p<Math.min(l,u);p++)h.push(0),h.push(1);let d=t;if(d=gh(d,e[0].y-o,e[1].y+o,1),d=gh(d,e[0].x-o,e[1].x+o,0),!d.length)return s;const f=[];for(h.length?f.push({polygons:d,bounds:e,depth:0}):a(d,e);f.length;){const t=f.pop(),e=t.depth,i=h[e],n=t.bounds[0],s=t.bounds[1],l=0===i?n.x:n.y,u=0===i?s.x:s.y,c=r?r(i,l,u):.5*(l+u),d=gh(t.polygons,l-o,c+o,i),p=gh(t.polygons,c-o,u+o,i);if(d.length){const t=[n,new j(0===i?c:s.x,1===i?c:s.y)];h.length>e+1?f.push({polygons:d,bounds:t,depth:e+1}):a(d,t)}if(p.length){const t=[new j(0===i?c:n.x,1===i?c:n.y),s];h.length>e+1?f.push({polygons:p,bounds:t,depth:e+1}):a(p,t)}}return s}(t,e,Math.ceil((r-o)/11.25),Math.ceil((s-a)/11.25),1,((t,e,o)=>{if(0===t)return.5*(e+o);{const t=fl((i.y+e/Yi)/n);return(cl(.5*(fl((i.y+o/Yi)/n)+t))*n-i.y)*Yi}}))}function ad(t,e,i,n,o,r){const s=Math.pow(2,n.z-o.z);for(let a=0;a<i;a++){let i=t.int16[2*(a+e)+0],l=t.int16[2*(a+e)+1];i=(i+o.x*Yi)*s-n.x*Yi,l=(l+o.y*Yi)*s-n.y*Yi,r.push(new j(i,l))}}let ld,ud;function cd(t,e){return t.x*e.x+t.y*e.y}function hd(t,e){if(1===t.length){let i=0;const n=e[i++];let o;for(;!o||n.equals(o);)if(o=e[i++],!o)return 1/0;for(;i<e.length;i++){const r=e[i],s=t[0],a=o.sub(n),l=r.sub(n),u=s.sub(n),c=cd(a,a),h=cd(a,l),d=cd(l,l),f=cd(u,a),p=cd(u,l),m=c*d-h*h,g=(d*f-h*p)/m,y=(c*p-h*f)/m,_=n.z*(1-g-y)+o.z*g+r.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function dd(t,e,i,n,o,r,s,a){const l=s*o.getElevationAt(t,e,!0,!0),u=0!==r[0],c=u?0===r[1]?s*(r[0]/7-450):s*function(t,e,i){const n=Math.floor(e[0]/8),o=Math.floor(e[1]/8),r=10*(e[0]-8*n),s=10*(e[1]-8*o),a=t.getElevationAt(n,o,!0,!0),l=t.getMeterToDEM(i),u=Math.floor(.5*(r*l-1)),c=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(n,o),d=2*u+1,f=2*c+1,p=function(t,e,i,n,o){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+o,i,!0),t.getElevationAtPixel(e,i+o,!0),t.getElevationAtPixel(e+n,i+o,!0)]}(t,h.x-u,h.y-c,d,f),m=Math.abs(p[0]-p[1]),g=Math.abs(p[2]-p[3]),y=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),_=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*y/f);return a+Math.max(_*r,v*s)}(o,r,a):l;return{base:l+(0===i?-1:i),top:u?Math.max(c+n,l+i+2):l+n}}lr(Jh,"FillExtrusionBucket",{omit:["layers","features"]}),lr(Wh,"PartData"),lr(Gh,"FootprintSegment"),lr(qh,"BorderCentroidData"),lr(Yh,"GroundEffect");const fd=ys([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),pd=ys([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:md}=fd,gd=ys([{name:"a_packed",components:3,type:"Float32"}]),{members:yd}=gd,_d=ys([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:vd}=_d;class xd{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new rc({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=st(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const n=[];let o=t.length%2==1?-t[t.length-1]*i:0,r=t[0]*i,s=!0;n.push({left:o,right:r,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let l=1;l<t.length;l++){s=!s;const e=t[l];o=a*i,a+=e,r=a*i,n.push({left:o,right:r,isDash:s,zeroLength:0===e})}return n}addRoundDash(t,e,i){const n=e/2;for(let o=-i;o<=i;o++){const e=this.width*(this.nextRow+i+o);let r=0,s=t[r];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++r]);const l=Math.abs(a-s.left),u=Math.abs(a-s.right),c=Math.min(l,u);let h;const d=o/i*(n+1);if(s.isDash){const t=n-Math.abs(d);h=Math.sqrt(c*c+t*t)}else h=n-Math.sqrt(c*c+d*d);this.image.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let a=t.length-1;a>=0;--a){const e=t[a],i=t[a+1];e.zeroLength?t.splice(a,1):i&&i.isDash===e.isDash&&(i.left=e.left,t.splice(a,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const o=this.width*this.nextRow;let r=0,s=t[r];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++r]);const i=Math.abs(a-s.left),n=Math.abs(a-s.right),l=Math.min(i,n);this.image.data[o+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const n="round"===e,o=n?7:0,r=2*o+1;if(this.nextRow+r>this.height)return ft("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let u=0;u<t.length;u++)t[u]<0&&(ft("Negative value is found in line dasharray, replacing values with 0"),t[u]=0),s+=t[u];if(0!==s){const i=this.width/s,r=this.getDashRanges(t,this.width,i);n?this.addRoundDash(r,i,o):this.addRegularDash(r,"square"===e?.5*i:0)}const a=this.nextRow+o;this.nextRow+=r;const l={tl:[a,o],br:[s,0]};return this.positions[i]=l,l}}lr(xd,"LineAtlas");const bd=fh.VectorTileFeature.types,Cd=Math.cos(Math.PI/180*37.5),wd=Math.cos(Math.PI/180*5);class Sd{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new ws,this.layoutVertexArray2=new Ss,this.patternVertexArray=new Ss,this.indexArray=new Os,this.programConfigurations=new Na(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new fa,this.maxLineLength=0,this.zOffsetVertexArray=new Ss,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:Yi/64}updateFootprints(t,e){}populate(t,e,i,n){this.hasPattern=Fc("line",this.layers,this.pixelRatio,e);const o=this.layers[0].layout.get("line-sort-key");this.tileToMeter=vl(i);const r=this.layers[0].layout.get("line-z-offset"),s=r.isConstant()&&!r.constantOr(0),a=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset="sea"===a||"ground"===a||!s&&"none"===a,this.hasZOffset&&"none"===a&&ft(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const l=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&void 0!==l;const u=[];for(const{feature:f,id:p,index:m,sourceLayerIndex:g}of t){const t=this.layers[0]._featureFilter.needGeometry,e=El(f,t);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),e,i))continue;const r=o?o.evaluate(e,{},i):void 0,s={id:p,properties:f.properties,type:f.type,sourceLayerIndex:g,index:m,geometry:t?e.geometry:Il(f,i,n),patterns:{},sortKey:r};u.push(s)}o&&u.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:c,featureIndex:h}=e,d=this.addConstantDashes(c);for(const f of u){const{geometry:n,index:o,sourceLayerIndex:r}=f;if(d&&this.addFeatureDashes(f,c),this.hasPattern){const t=Nc("line",this.layers,f,this.zoom,this.pixelRatio,e);this.patternFeatures.push(t)}else this.addFeature(f,n,o,i,c.positions,e.availableImages,e.brightness);h.insert(t[o].feature,n,o,r,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==o.kind)e=!0;else{const e=o.value,i=n.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const n of this.layers){const o=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"===o.kind&&"constant"===r.kind)continue;let s,a;if("constant"===o.kind){if(s=o.value,!s)continue}else s=o.evaluate({zoom:i},t);a="constant"===r.kind?r.value:r.evaluate({zoom:i},t),e.addDash(s,a),t.patterns[n.id]=e.getKey(s,a)}}update(t,e,i,n,o,r,s){this.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s)}addFeatures(t,e,i,n,o,r){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,e,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yd)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,vd)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,pd.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,md),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,o,r,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(t,{}),u=a.get("line-cap").evaluate(t,{}),c=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=a.get("line-z-offset").value;const d=this.layers[0].paint.get("line-width").value;"constant"!==d.kind&&!1===d.isLineProgressConstant&&(this.variableWidthValue=d);for(const f of e)this.addLine(f,t,n,l,u,c,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,o,r,n,s)}addLine(t,e,i,n,o,r,s){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const a="none"===n;if(this.patternJoinNone=this.hasPattern&&a,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===bd[e.type];let u=t.length;for(;u>=2&&t[u-1].equals(t[u-2]);)u--;let c=0;for(;c<u-1&&t[c].equals(t[c+1]);)c++;if(u<(l?3:2))return;"bevel"===n&&(r=1.05);const h=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);let d,f,p,m,g,y;this.e1=this.e2=-1,l&&(d=t[u-2],g=t[c].sub(d)._unit()._perp());for(let _=c;_<u;_++){if(p=_===u-1?l?t[c+1]:void 0:t[_+1],p&&t[_].equals(p))continue;g&&(m=g),d&&(f=d),d=t[_],y=this.evaluateLineProgressFeatures(f?f.dist(d):0),g=p?p.sub(d)._unit()._perp():m,m=m||g;const e=f&&p;let i=e?n:l||a?"butt":o;const v=m.x*g.x+m.y*g.y;if(a){const t=function(t){if(t.patternJoinNone){const e=t.segmentPoints.length/2,i=t.lineSoFar-t.segmentStart;for(let n=0;n<e;++n){const e=t.segmentPoints[2*n+1],o=Math.round(t.segmentPoints[2*n])+.5+.25*e;t.patternVertexArray.emplaceBack(o,i,t.segmentStart),t.patternVertexArray.emplaceBack(o,i,t.segmentStart)}t.segmentPoints.length=0}t.e1=t.e2=-1};if(e&&v<wd){this.updateDistance(f,d),this.addCurrentVertex(d,m,1,1,h,y),t(this),this.addCurrentVertex(d,g,-1,-1,h,y);continue}if(f){if(!p){this.updateDistance(f,d),this.addCurrentVertex(d,m,1,1,h,y),t(this);continue}i="miter"}}let x=m.add(g);0===x.x&&0===x.y||x._unit();const b=x.x*g.x+x.y*g.y,C=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),S=b<Cd&&f&&p,T=m.x*g.y-m.y*g.x>0,A=this.overscaling<=16?15*Yi/(512*this.overscaling):0;if(e&&"round"===i)if(C<s)i="miter";else if(C<=2){const t=Td(d,-10,Yi+10);i=this.hasZOffset&&(t||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===i&&C>r&&(i="bevel"),"bevel"===i&&(C>2&&(i="flipbevel"),C<r&&(i="miter")),f&&!("miter"===i&&S)&&this.updateDistance(f,d),"miter"===i)if(S){const t=d.dist(f);if(t>2*A){const e=d.sub(d.sub(f)._mult(A/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,m,0,0,h,y),f=e}this.updateDistance(f,d),x._mult(C),this.addCurrentVertex(d,x,0,0,h,y);const e=d.dist(p);if(e>2*A){const t=d.add(p.sub(d)._mult(A/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,g,0,0,h,y),d=t}}else x._mult(C),this.addCurrentVertex(d,x,0,0,h,y);else if("flipbevel"===i){if(C>100)x=g.mult(-1);else{const t=C*m.add(g).mag()/m.sub(g).mag();x._perp()._mult(t*(T?-1:1))}this.addCurrentVertex(d,x,0,0,h,y),this.addCurrentVertex(d,x.mult(-1),0,0,h,y)}else if("bevel"===i||"fakeround"===i){null!=y&&f&&this.addCurrentVertex(d,m,-1,-1,h,y);const t=d.dist(f)<=2*A&&"bevel"!==i,e=x.mult(T?1:-1);e._mult(C);const n=g.mult(T?-1:1),o=m.mult(T?-1:1),r=this.evaluateLineProgressFeatures(this.distance);if(null==y&&(this.addHalfVertex(d,e.x,e.y,!1,!T,0,h,r),t||this.addHalfVertex(d,e.x+2*o.x,e.y+2*o.y,!1,T,0,h,r)),"fakeround"===i){const t=Math.round(180*w/Math.PI/20);this.addHalfVertex(d,o.x,o.y,!1,T,0,h,r);for(let e=0;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*t*t+(.848013+v*(.215638*v-1.06021)))}const s=n.sub(o)._mult(i)._add(o)._unit();this.addHalfVertex(d,s.x,s.y,!1,T,0,h,r)}this.addHalfVertex(d,n.x,n.y,!1,T,0,h,r)}t||null!=y||this.addHalfVertex(d,e.x+2*n.x,e.y+2*n.y,!1,T,0,h,r),null!=y&&p&&this.addCurrentVertex(d,g,1,1,h,y)}else"butt"===i?this.addCurrentVertex(d,x,0,0,h,y):"square"===i?(f||this.addCurrentVertex(d,x,-1,-1,h,y),this.addCurrentVertex(d,x,0,0,h,y),f&&this.addCurrentVertex(d,x,1,1,h,y)):"round"===i&&(f&&(this.addCurrentVertex(d,m,0,0,h,y),this.addCurrentVertex(d,m,1,1,h,y,!0)),p&&(this.addCurrentVertex(d,g,-1,-1,h,y,!0),this.addCurrentVertex(d,g,0,0,h,y)))}}addVerticesTo(t,e,i,n,o,r,s,a,l,u){const c=(e.w-t.w)/this.tessellationStep|0;let h=0;const d=this.scaledDistance;if(c>1){this.lineSoFar=t.w;const d=(e.x-t.x)/c,f=(e.y-t.y)/c,p=(e.z-t.z)/c,m=(e.w-t.w)/c;for(let e=1;e<c;++e){t.x+=d,t.y+=f,t.z+=p,this.lineSoFar+=m,h+=m;const e=this.evaluateLineProgressFeatures(this.prevDistance+h);this.scaledDistance=(this.prevDistance+h)/this.totalDistance,this.addHalfVertex(t,i,n,u,!1,s,l,e),this.addHalfVertex(t,o,r,u,!0,-a,l,e)}}this.lineSoFar=e.w,this.scaledDistance=d;const f=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(e,i,n,u,!1,s,l,f),this.addHalfVertex(e,o,r,u,!0,-a,l,f)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):ft(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let e=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(e=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:e}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:e}:{zOffset:0,variableWidth:e}}addCurrentVertex(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=e.x+e.y*i,l=e.y-e.x*i,u=e.y*n-e.x,c=-e.y-e.x*n;if(null!=r){const e=this.hasZOffset,h=-10,d=Yi+10,f=r.zOffset,p=new mh(t.x,t.y,f,this.lineSoFar),m=!!e&&Td(t,h,d),g=this.lineSoFar,y=this.distance;if(this.currentVertex)if(m){const e=this.currentVertexIsOutside,r=this.currentVertex,m=new mh(t.x,t.y,f,this.lineSoFar);if(_h(r,m,h,d),!Td(m,h,d)){if(e){this.e1=this.e2=-1,this.distance-=r.dist(p),this.lineSoFar=r.w;const t=this.evaluateLineProgressFeatures(r.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(r,a,l,s,!1,i,o,t),this.addHalfVertex(r,u,c,s,!0,-n,o,t),this.prevDistance=this.distance}this.distance=this.prevDistance+r.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(r,m,a,l,u,c,i,n,o,s),this.distance=y,this.scaledDistance=this.distance/this.totalDistance}}else{const t=this.currentVertex;if(this.currentVertexIsOutside){_h(t,p,h,d),this.e1=this.e2=-1,this.distance-=t.dist(p),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t.w;const e=this.evaluateLineProgressFeatures(t.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(t,a,l,s,!1,i,o,e),this.addHalfVertex(t,u,c,s,!0,-n,o,e),this.prevDistance=this.distance,this.distance=y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(t,p,a,l,u,c,i,n,o,s)}else m||(this.addHalfVertex(t,a,l,s,!1,i,o,r),this.addHalfVertex(t,u,c,s,!0,-n,o,r));this.currentVertex=p,this.currentVertexIsOutside=m,this.lineSoFar=g}else this.addHalfVertex(t,a,l,s,!1,i,o,r),this.addHalfVertex(t,u,c,s,!0,-n,o,r)}addHalfVertex(t,e,i,n,o,r,s,a){let{x:l,y:u}=t;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),o||this.segmentPoints.push(this.lineSoFar-this.segmentStart,r)),this.layoutVertexArray.emplaceBack((l<<1)+(n?1:0),(u<<1)+(o?1:0),Math.round(63*e)+128,Math.round(63*i)+128,1+(0===r?0:r<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const t=Ie(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,t)}const c=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),s.primitiveLength++),o?this.e2=c:this.e1=c,null!=a&&this.zOffsetVertexArray.emplaceBack(a.zOffset,a.variableWidth,a.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,e){this.prevDistance=this.distance,this.distance+=t.dist(e),this.updateScaledDistance()}}function Td(t,e,i){return t.x<e||t.x>i||t.y<e||t.y>i}let Ad,Md;function Id(t,e,i){return e*(Yi/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}lr(Sd,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ed=(t,e,i)=>(1-i)*t+i*e;function Pd(t,e){return 1/Id(t,1,e.tileZoom)}function kd(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Bd=t=>{const e=[];Dd(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER");const n="none"===t.layout.get("line-join").constantOr("miter"),o=!!t.paint.get("line-pattern").constantOr(1);return n&&o&&e.push("LINE_JOIN_NONE"),e};function Dd(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}let Rd;const Ld=()=>Rd||(Rd={layout:Ad||(Ad=new qr({"line-cap":new Gr(Zr.layout_line["line-cap"]),"line-join":new Gr(Zr.layout_line["line-join"]),"line-miter-limit":new jr(Zr.layout_line["line-miter-limit"]),"line-round-limit":new jr(Zr.layout_line["line-round-limit"]),"line-sort-key":new Gr(Zr.layout_line["line-sort-key"]),"line-z-offset":new Gr(Zr.layout_line["line-z-offset"]),"line-elevation-reference":new jr(Zr.layout_line["line-elevation-reference"]),"line-cross-slope":new jr(Zr.layout_line["line-cross-slope"]),visibility:new jr(Zr.layout_line.visibility),"line-width-unit":new jr(Zr.layout_line["line-width-unit"])})),paint:Md||(Md=new qr({"line-opacity":new Gr(Zr.paint_line["line-opacity"]),"line-color":new Gr(Zr.paint_line["line-color"]),"line-translate":new jr(Zr.paint_line["line-translate"]),"line-translate-anchor":new jr(Zr.paint_line["line-translate-anchor"]),"line-width":new Gr(Zr.paint_line["line-width"]),"line-gap-width":new Gr(Zr.paint_line["line-gap-width"]),"line-offset":new Gr(Zr.paint_line["line-offset"]),"line-blur":new Gr(Zr.paint_line["line-blur"]),"line-dasharray":new Gr(Zr.paint_line["line-dasharray"]),"line-pattern":new Gr(Zr.paint_line["line-pattern"]),"line-gradient":new Wr(Zr.paint_line["line-gradient"]),"line-trim-offset":new jr(Zr.paint_line["line-trim-offset"]),"line-trim-fade-range":new jr(Zr.paint_line["line-trim-fade-range"]),"line-trim-color":new jr(Zr.paint_line["line-trim-color"]),"line-emissive-strength":new jr(Zr.paint_line["line-emissive-strength"]),"line-border-width":new Gr(Zr.paint_line["line-border-width"]),"line-border-color":new Gr(Zr.paint_line["line-border-color"]),"line-occlusion-opacity":new jr(Zr.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},Rd);class zd extends Gr{possiblyEvaluate(t,e){return e=new Rr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=nt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}let Od;function Ud(t,e){return e>0?e+2*t:t}const Fd=ys([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nd=ys([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vd=ys([{name:"a_projected_pos",components:4,type:"Float32"}],4);ys([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hd=ys([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),jd=ys([{name:"a_texb",components:2,type:"Uint16"}]),Gd=ys([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Wd=ys([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qd=ys([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zd=ys([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ys([{name:"triangle",components:3,type:"Uint16"}]),ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ys([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ys([{type:"Float32",name:"offsetX"}]),ys([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var $d=24;const Kd=128;function Yd(t,e,i,n,o){if("camera"===t.kind)return t.maxSize;if("composite"===t.kind){const n=e.possiblyEvaluate(new Rr(t.maxZoom),i).evaluate(o,{},i),r=e.possiblyEvaluate(new Rr(t.minZoom),i).evaluate(o,{},i);return Math.max(n,r)}return e.possiblyEvaluate(new Rr(n)).evaluate(o,{},i)}function Jd(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Rr(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let o=0;for(;o<e.length&&e[o]<=t;)o++;o=Math.max(0,o-1);let r=o;for(;r<e.length&&e[r]<t+1;)r++;r=Math.min(e.length-1,r);const s=e[o],a=e[r];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Rr(s)),maxSize:i.evaluate(new Rr(a)),interpolationType:n}}}function Xd(t,e,i){let{uSize:n,uSizeT:o}=e,{lowerSize:r,upperSize:s}=i;return"source"===t.kind?r/Kd:"composite"===t.kind?Ie(r/Kd,s/Kd,o):n}function Qd(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,o=0;if("constant"===t.kind)o=t.layoutSize*i;else if("source"!==t.kind){const{interpolationType:r,minZoom:s,maxZoom:a}=t,l=r?Q(ro.interpolationFactor(r,e,s,a),0,1):0;"camera"===t.kind?o=Ie(t.minSize,t.maxSize,l)*i:n=l*i}return{uSizeT:n,uSize:o}}var tf=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Kd,evaluateSizeForFeature:Xd,evaluateSizeForZoom:Qd,getRasterizedIconSize:Yd,getSizeData:Jd});function ef(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Dr.applyArabicShaping&&(t=Dr.applyArabicShaping(t)),t}(t.text,e,i)})),t}const nf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function of(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function rf(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var sf,af,lf,uf={};function cf(){return sf||(sf=1,uf.read=function(t,e,i,n,o){var r,s,a=8*o-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?o-1:0,d=i?-1:1,f=t[e+h];for(h+=d,r=f&(1<<-c)-1,f>>=-c,c+=a;c>0;r=256*r+t[e+h],h+=d,c-=8);for(s=r&(1<<-c)-1,r>>=-c,c+=n;c>0;s=256*s+t[e+h],h+=d,c-=8);if(0===r)r=1-u;else{if(r===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),r-=u}return(f?-1:1)*s*Math.pow(2,r-n)},uf.write=function(t,e,i,n,o,r){var s,a,l,u=8*r-o-1,c=(1<<u)-1,h=c>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:r-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,o),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,o),s=0));o>=8;t[i+f]=255&a,f+=p,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;t[i+f]=255&s,f+=p,s/=256,u-=8);t[i+f-p]|=128*m}),uf}function hf(){if(lf)return af;lf=1,af=e;var t=cf();function e(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,n=1/i,o="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function r(t){return t.type===e.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var o=i.pos-1;o>=t;o--)i.buf[o+n]=i.buf[o]}function l(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function _(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),o=n>>3,r=this.pos;this.type=7&n,t(o,e,this),this.pos===r&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=y(this.buf,this.pos)+y(this.buf,this.pos+4)*i;return this.pos+=8,t},readSFixed64:function(){var t=y(this.buf,this.pos)+v(this.buf,this.pos+4)*i;return this.pos+=8,t},readFloat:function(){var e=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,o,r=i.buf;if(n=(112&(o=r[i.pos++]))>>4,o<128)return s(t,n,e);if(n|=(127&(o=r[i.pos++]))<<3,o<128)return s(t,n,e);if(n|=(127&(o=r[i.pos++]))<<10,o<128)return s(t,n,e);if(n|=(127&(o=r[i.pos++]))<<17,o<128)return s(t,n,e);if(n|=(127&(o=r[i.pos++]))<<24,o<128)return s(t,n,e);if(n|=(1&(o=r[i.pos++]))<<31,o<128)return s(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&o?function(t,e,i){return o.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",o=e;o<i;){var r,s,a,l=t[o],u=null,c=l>239?4:l>223?3:l>191?2:1;if(o+c>i)break;1===c?l<128&&(u=l):2===c?128==(192&(r=t[o+1]))&&(u=(31&l)<<6|63&r)<=127&&(u=null):3===c?(s=t[o+2],128==(192&(r=t[o+1]))&&128==(192&s)&&((u=(15&l)<<12|(63&r)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(s=t[o+2],a=t[o+3],128==(192&(r=t[o+1]))&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&r)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),o+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,i){if(this.type!==e.Bytes)return t.push(this.readVarint(i));var n=r(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){if(this.type!==e.Bytes)return t.push(this.readSVarint());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==e.Bytes)return t.push(this.readBoolean());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==e.Bytes)return t.push(this.readFloat());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==e.Bytes)return t.push(this.readDouble());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed32());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed32());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed64());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed64());var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===e.Varint)for(;this.buf[this.pos++]>127;);else if(i===e.Bytes)this.pos=this.readVarint()+this.pos;else if(i===e.Fixed32)this.pos+=4;else{if(i!==e.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,o,r=0;r<e.length;r++){if((n=e.charCodeAt(r))>55295&&n<57344){if(!o){n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):o=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,o=n;continue}n=o-55296<<10|n-56320|65536,o=null}else o&&(t[i++]=239,t[i++]=191,t[i++]=189,o=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&a(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),t.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),t.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&a(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,i,n){this.writeTag(t,e.Bytes),this.writeRawMessage(i,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writeBytesField:function(t,i){this.writeTag(t,e.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,e.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,e.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,e.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},af}var df=e(hf());const ff=3;function pf(t,e,i){e.glyphs=[],1===t&&i.readMessage(mf,e)}function mf(t,e,i){if(3===t){const{id:t,bitmap:n,width:o,height:r,left:s,top:a,advance:l}=i.readMessage(gf,{});e.glyphs.push({id:t,bitmap:new rc({width:o+2*ff,height:r+2*ff},n),metrics:{width:o,height:r,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function gf(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const yf=ff,_f={horizontal:1,vertical:2,horizontalOnly:3};class vf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,e){const i=new vf;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new vf;return e.image=t,e}}class xf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new xf;for(let n=0;n<t.sections.length;n++){const o=t.sections[n];o.image?i.addImageSection(o):i.addTextSection(o,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let n=0;n<t.length;n++){const o=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;i+=!e&&(o&&_r(o)&&!nf[t[n+1]]||r&&_r(r)&&!nf[t[n-1]])||!nf[t[n]]?t[n]:nf[t[n]]}return i}(this.text,t)}trim(){let t=0;for(let i=0;i<this.text.length&&Cf[this.text.charCodeAt(i)];i++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Cf[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new xf;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(vf.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let n=0;n<t.text.length;++n)this.sectionIndex.push(i)}addImageSection(t){const e=t.image&&t.image.namePrimary?t.image.getPrimary():null;if(!e)return void ft("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(vf.forImage(e)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bf(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p){const m=xf.fromFeature(t,o);h===_f.vertical&&m.verticalizePunctuation(d);let g=[];const y=function(t,e,i,n,o,r){if(!t)return[];const s=[],a=function(t,e,i,n,o,r){let s=0;for(let a=0;a<t.length();a++){const i=t.getSection(a);s+=Sf(t.getCodePoint(a),i,n,o,e,r)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,n,o,r),l=t.text.indexOf("\u200b")>=0;let u=0;for(let h=0;h<t.length();h++){const i=t.getSection(h),d=t.getCodePoint(h);if(Cf[d]||(u+=Sf(d,i,n,o,e,r)),h<t.length()-1){const e=!((c=d)<11904||!(fr["Bopomofo Extended"](c)||fr.Bopomofo(c)||fr["CJK Compatibility Forms"](c)||fr["CJK Compatibility Ideographs"](c)||fr["CJK Compatibility"](c)||fr["CJK Radicals Supplement"](c)||fr["CJK Strokes"](c)||fr["CJK Symbols and Punctuation"](c)||fr["CJK Unified Ideographs Extension A"](c)||fr["CJK Unified Ideographs"](c)||fr["Enclosed CJK Letters and Months"](c)||fr["Halfwidth and Fullwidth Forms"](c)||fr.Hiragana(c)||fr["Ideographic Description Characters"](c)||fr["Kangxi Radicals"](c)||fr["Katakana Phonetic Extensions"](c)||fr.Katakana(c)||fr["Vertical Forms"](c)||fr["Yi Radicals"](c)||fr["Yi Syllables"](c)));(wf[d]||e||i.image)&&s.push(Mf(h+1,u,a,s,Af(d,t.getCodePoint(h+1),e&&l),!1))}}var c;return If(Mf(t.length(),u,a,s,0,!0))}(m,u,r,e,n,f),{processBidirectionalText:_,processStyledBidirectionalText:v}=Dr;if(_&&1===m.sections.length){const t=_(m.toString(),y);for(const e of t){const t=new xf;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);g.push(t)}}else if(v){const t=v(m.text,m.sectionIndex,y);for(const e of t){const t=new xf;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,g.push(t)}}else g=function(t,e){const i=[],n=t.text;let o=0;for(const r of e)i.push(t.substring(o,r)),o=r;return o<n.length&&i.push(t.substring(o,n.length)),i}(m,y);const x=[],b={positionedLines:x,text:m.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,n,o,r,s,a,l,u,c,h){let d=0,f=0,p=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const C of o){const t=C.getSections();for(const i of t){if(i.image)continue;const t=e[i.fontStack];if(t&&(g=void 0!==t.ascender&&void 0!==t.descender,!g))break}if(!g)break}let y=0;for(const C of o){C.trim();const o=C.getMaxScale(),s=(o-1)*$d,a={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!C.length()){f+=r,++y;continue}let b=0,w=0;for(let r=0;r<C.length();r++){const s=C.getSection(r),a=C.getSectionIndex(r),p=C.getCodePoint(r);let m=s.scale,y=null,S=null,T=null,A=$d,M=0;const I=!(l===_f.horizontal||!c&&!yr(p)||c&&(Cf[p]||(_=p,fr.Arabic(_)||fr["Arabic Supplement"](_)||fr["Arabic Extended-A"](_)||fr["Arabic Presentation Forms-A"](_)||fr["Arabic Presentation Forms-B"](_))));if(s.image){const e=n[s.image.serialize()];if(!e)continue;T=s.image.id,t.iconsInText=t.iconsInText||!0,S=e.paddedRect;const i=e.displaySize;m=m*$d/h,y={width:i[0],height:i[1],left:0,top:-yf,advance:I?i[1]:i[0],localGlyph:!1},M=g?-y.height*m:o*$d-17-i[1]*m,A=y.advance;const r=(I?i[0]:i[1])*m-$d*o;r>0&&r>x&&(x=r)}else{const t=i[s.fontStack];if(!t)continue;t[p]&&(S=t[p]);const n=e[s.fontStack];if(!n)continue;const r=n.glyphs[p];if(!r)continue;if(y=r.metrics,A=8203!==p?$d:0,g){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,i=(t+e)*m;b<i&&(b=i,w=(t-e)/2*m),M=-t*m}else M=(o-m)*$d-17}I?(t.verticalizable=!0,v.push({glyph:p,imageName:T,x:d,y:f+M,vertical:I,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:S}),d+=A*m+u):(v.push({glyph:p,imageName:T,x:d,y:f+M,vertical:I,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:S}),d+=y.advance*m+u)}0!==v.length&&(p=Math.max(d-u,p),g?Pf(v,m,x,w,r*o/2):Pf(v,m,x,0,r/2)),d=0;const S=r*o+x;a.lineOffset=Math.max(x,s),f+=S,++y}var _;const v=f,{horizontalAlign:x,verticalAlign:b}=Ef(s);(function(t,e,i,n,o,r){const s=(e-i)*o,a=-r*n;for(const l of t)for(const t of l.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,p,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*p,t.right=t.left+p,t.hasBaseline=g}(b,e,i,n,g,s,a,l,h,u,d,p),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const Cf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sf(t,e,i,n,o,r){if(e.image){const t=n[e.image.serialize()];return t?t.displaySize[0]*e.scale*$d/r+o:0}{const n=i[e.fontStack],r=n&&n.glyphs[t];return r?r.metrics.advance*e.scale+o:0}}function Tf(t,e,i,n){const o=Math.pow(t-e,2);return n?t<e?o/2:2*o:o+Math.abs(i)*i}function Af(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Mf(t,e,i,n,o,r){let s=null,a=Tf(e,i,o,r);for(const l of n){const t=Tf(e-l.x,i,o,r)+l.badness;t<=a&&(s=l,a=t)}return{index:t,x:e,priorBreak:s,badness:a}}function If(t){return t?If(t.priorBreak).concat(t.index):[]}function Ef(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Pf(t,e,i,n,o){if(!(e||i||n||o))return;const r=t.length-1,s=t[r],a=(s.x+s.metrics.advance*s.scale)*e;for(let l=0;l<=r;l++)t[l].x-=a,t[l].y+=i+n+o}function kf(t,e,i,n){const{horizontalAlign:o,verticalAlign:r}=Ef(n),s=i[0]-t.displaySize[0]*o,a=i[1]-t.displaySize[1]*r;return{imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function Bf(t,e,i,n,o,r){const s=t.imagePrimary;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*r,u=e.right*r;let c,h,d,f;"width"===i||"both"===i?(f=o[0]+l-n[3],h=o[0]+u+n[1]):(f=o[0]+(l+u-s.displaySize[0])/2,h=f+s.displaySize[0]);const p=e.top*r,m=e.bottom*r;return"height"===i||"both"===i?(c=o[1]+p-n[0],d=o[1]+m+n[2]):(c=o[1]+(p+m-s.displaySize[1])/2,d=c+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:c,right:h,bottom:d,left:f,collisionPadding:a}}class Df extends j{constructor(t,e,i,n,o){super(t,e),this.angle=n,this.z=i,void 0!==o&&(this.segment=o)}clone(){return new Df(this.x,this.y,this.z,this.angle,this.segment)}}function Rf(t,e,i,n,o){if(void 0===e.segment)return!0;let r=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(r),r=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let u=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let r=t[s-1].angleTo(e)-e.angleTo(i);for(r=Math.abs((r+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:r}),u+=r;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>o)return!1;s++,a+=e.dist(i)}return!0}function Lf(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function zf(t,e,i){return t?.6*e*i:0}function Of(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Uf(t,e,i,n,o,r){const s=zf(i,o,r),a=Of(i,n)*r;let l=0;const u=Lf(t)/2;for(let c=0;c<t.length-1;c++){const i=t[c],n=t[c+1],o=i.dist(n);if(l+o>u){const r=(u-l)/o,h=Ie(i.x,n.x,r),d=Ie(i.y,n.y,r),f=new Df(h,d,0,n.angleTo(i),c);return!s||Rf(t,f,a,s,e)?f:void 0}l+=o}}function Ff(t,e,i,n,o,r,s,a,l){const u=zf(n,r,s),c=Of(n,o),h=c*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Nf(t,d?e/2*a%e:(c/2+2*r)*s*a%e,e,u,i,h,d,!1,l)}function Nf(t,e,i,n,o,r,s,a,l){const u=r/2,c=Lf(t);let h=0,d=e-i,f=[];for(let p=0;p<t.length-1;p++){const e=t[p],s=t[p+1],a=e.dist(s),m=s.angleTo(e);for(;d+i<h+a;){d+=i;const g=(d-h)/a,y=Ie(e.x,s.x,g),_=Ie(e.y,s.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-u>=0&&d+u<=c){const e=new Df(y,_,0,m,p);n&&!Rf(t,e,r,n,o)||f.push(e)}}h+=a}return a||f.length||s||(f=Nf(t,h/2,i,n,o,r,s,!0,l)),f}function Vf(t,e,i,n,o){const r=[];for(let s=0;s<t.length;s++){const a=t[s];let l;for(let t=0;t<a.length-1;t++){let s=a[t],u=a[t+1];s.x<e&&u.x<e||(s.x<e?s=new j(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<e&&(u=new j(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new j(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new j(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=n&&u.x>=n||(s.x>=n?s=new j(n,s.y+(n-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=n&&(u=new j(n,s.y+(n-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=o&&u.y>=o||(s.y>=o?s=new j(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round():u.y>=o&&(u=new j(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round()),l&&s.equals(l[l.length-1])||(l=[s],r.push(l)),l.push(u)))))}}return r}function Hf(t){let e=0,i=0;for(const s of t)e+=s.w*s.h,i=Math.max(i,s.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let o=0,r=0;for(const s of t)for(let t=n.length-1;t>=0;t--){const e=n[t];if(!(s.w>e.w||s.h>e.h)){if(s.x=e.x,s.y=e.y,r=Math.max(r,s.y+s.h),o=Math.max(o,s.x+s.w),s.w===e.w&&s.h===e.h){const e=n.pop();t<n.length&&(n[t]=e)}else s.h===e.h?(e.x+=s.w,e.w-=s.w):s.w===e.w?(e.y+=s.h,e.h-=s.h):(n.push({x:e.x+s.w,y:e.y,w:e.w-s.w,h:s.h}),e.y+=s.h,e.h-=s.h);break}}return{w:o,h:r,fill:e/(o*r)||0}}lr(Df,"Anchor");const jf=1;class Gf{static getImagePositionScale(t,e,i){return e&&t&&t.options&&t.options.transform?{x:t.options.transform.a,y:t.options.transform.d}:{x:i,y:i}}constructor(t,e,i,n){let{pixelRatio:o,version:r,stretchX:s,stretchY:a,content:l,sdf:u,usvg:c}=e;this.paddedRect=t,this.pixelRatio=o,this.stretchX=s,this.stretchY=a,this.content=l,this.version=r,this.padding=i,this.sdf=u,this.scale=Gf.getImagePositionScale(n,c,o)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class Wf{constructor(t,e,i){const n={},o={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,jf,r),this.addImages(e,o,2,r);const{w:s,h:a}=Hf(r),l=new sc({width:s||1,height:a||1});for(const u in t){const e=t[u],o=n[u].paddedRect;sc.copy(e.data,l,{x:0,y:0},{x:o.x+jf,y:o.y+jf},e.data,i,e.sdf)}for(const u in e){const t=e[u],n=o[u].paddedRect;let r=o[u].padding;const s=n.x+r,a=n.y+r,c=t.data.width,h=t.data.height;r=r>1?r-1:r,sc.copy(t.data,l,{x:0,y:0},{x:s,y:a},t.data,i),sc.copy(t.data,l,{x:0,y:h-r},{x:s,y:a-r},{width:c,height:r},i),sc.copy(t.data,l,{x:0,y:0},{x:s,y:a+h},{width:c,height:r},i),sc.copy(t.data,l,{x:c-r,y:0},{x:s-r,y:a},{width:r,height:h},i),sc.copy(t.data,l,{x:0,y:0},{x:s+c,y:a},{width:r,height:h},i),sc.copy(t.data,l,{x:c-r,y:h-r},{x:s-r,y:a-r},{width:r,height:r},i),sc.copy(t.data,l,{x:0,y:h-r},{x:s+c,y:a-r},{width:r,height:r},i),sc.copy(t.data,l,{x:0,y:0},{x:s+c,y:a+h},{width:r,height:r},i),sc.copy(t.data,l,{x:c-r,y:0},{x:s-r,y:a+h},{width:r,height:r},i)}this.lut=i,this.image=l,this.iconPositions=n,this.patternPositions=o}addImages(t,e,i,n){for(const o in t){const r=t[o],s={x:0,y:0,w:r.data.width+2*i,h:r.data.height+2*i};n.push(s);const a=Qe.deserializeFromString(o);e[o]=new Gf(s,r,i,a),r.hasRenderCallback&&this.haveRenderCallbacks.push(a.id)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,i))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const n in t.getUpdatedImages(i)){for(const o of Object.keys(this.iconPositions))Qe.deserializeId(o)===n&&this.patchUpdatedImage(this.iconPositions[o],t.getImage(n,i),e);for(const o of Object.keys(this.patternPositions))Qe.deserializeId(o)===n&&this.patchUpdatedImage(this.patternPositions[o],t.getImage(n,i),e)}}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,o]=t.tl,r=t.sdf;if(this.lut||r){const t={width:e.data.width,height:e.data.height},s=new sc(t);sc.copy(e.data,s,{x:0,y:0},{x:0,y:0},t,this.lut,r),i.update(s,{position:{x:n,y:o}})}else i.update(e.data,{position:{x:n,y:o}})}}lr(Gf,"ImagePosition"),lr(Wf,"ImageAtlas");const qf=1e20;function Zf(t,e,i,n,o,r,s,a,l){for(let u=e;u<e+n;u++)$f(t,i*r+u,r,o,s,a,l);for(let u=i;u<i+o;u++)$f(t,u*r+e,1,n,s,a,l)}function $f(t,e,i,n,o,r,s){r[0]=0,s[0]=-qf,s[1]=qf,o[0]=t[e];for(let a=1,l=0,u=0;a<n;a++){o[a]=t[e+a*i];const n=a*a;do{const t=r[l];u=(o[a]-o[t]+n-t*t)/(a-t)/2}while(u<=s[l]&&--l>-1);l++,r[l]=a,s[l]=u,s[l+1]=qf}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=r[l],u=a-n;t[e+a*i]=o[n]+u*u}}const Kf=2,Yf={none:0,ideographs:1,all:2};class Jf{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,i){const n=[],o=this.urls[e]||Tt.GLYPHS_URL;for(const r in t)for(const e of t[r])n.push({stack:r,id:e});it(n,((t,e)=>{let{stack:i,id:n}=t,r=this.entries[i];r||(r=this.entries[i]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=r.glyphs[n];if(void 0!==s)return void e(null,{stack:i,id:n,glyph:s});if(s=this._tinySDF(r,i,n),s)return r.glyphs[n]=s,void e(null,{stack:i,id:n,glyph:s});const a=Math.floor(n/256);if(256*a>65535)return ft("glyphs > 65535 not supported"),void e(null,{stack:i,id:n,glyph:s});if(r.ranges[a])return void e(null,{stack:i,id:n,glyph:s});let l=r.requests[a];l||(l=r.requests[a]=[],Jf.loadGlyphRange(i,a,o,this.requestManager,((t,e)=>{if(e){r.ascender=e.ascender,r.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e.glyphs[+t]);r.ranges[a]=!0}for(const i of l)i(t,e);delete r.requests[a]}))),l.push(((t,o)=>{t?e(t):o&&e(null,{stack:i,id:n,glyph:o.glyphs[n]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:n,glyph:o}of e)void 0===t[i]&&(t[i]={}),void 0===t[i].glyphs&&(t[i].glyphs={}),t[i].glyphs[n]=o&&{id:o.id,bitmap:o.bitmap.clone(),metrics:o.metrics},t[i].ascender=this.entries[i].ascender,t[i].descender=this.entries[i].descender;i(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Yf.none&&(this.localGlyphMode===Yf.all?!!this.localFontFamily:!!this.localFontFamily&&(fr["CJK Unified Ideographs"](t)||fr["Hangul Syllables"](t)||fr.Hiragana(t)||fr.Katakana(t)||fr["CJK Symbols and Punctuation"](t)||fr["CJK Unified Ideographs Extension A"](t)||fr["CJK Unified Ideographs Extension B"](t)||fr.Osage(t)))}_tinySDF(t,e,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let o=t.tinySDF;if(!o){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),o=t.tinySDF=new Jf.TinySDF({fontFamily:n,fontWeight:i,fontSize:24*Kf,buffer:3*Kf,radius:8*Kf}),o.fontWeight=i}if(this.localGlyphs[o.fontWeight][i])return this.localGlyphs[o.fontWeight][i];const r=String.fromCodePoint(i),{data:s,width:a,height:l,glyphWidth:u,glyphHeight:c,glyphLeft:h,glyphTop:d,glyphAdvance:f}=o.draw(r);return this.localGlyphs[o.fontWeight][i]={id:i,bitmap:new rc({width:a,height:l},s),metrics:{width:u/Kf,height:c/Kf,left:h/Kf,top:d/Kf-27,advance:f/Kf,localGlyph:!0}}}}Jf.loadGlyphRange=function(t,e,i,n,o){const r=256*e,s=r+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${r}-${s}`),te.Glyphs);oe(a,((t,e)=>{if(t)o(t);else if(e){const t={},i=function(t){return new df(t).readFields(pf,{})}(e);for(const e of i.glyphs)t[e.id]=e;o(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},Jf.TinySDF=class{constructor(){let{fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:o="sans-serif",fontWeight:r="normal",fontStyle:s="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${r} ${t}px ${o}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:o,actualBoundingBoxRight:r}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(r-o))),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),u=a+2*this.buffer,c=l+2*this.buffer,h=Math.max(u*c,0),d=new Uint8ClampedArray(h),f={data:d,width:u,height:c,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:y}=this;p.clearRect(m,m,a,l),p.fillText(t,m,m+s);const _=p.getImageData(m,m,a,l);y.fill(qf,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let t=0;t<a;t++){const e=_.data[4*(v*a+t)+3]/255;if(0===e)continue;const i=(v+m)*u+t+m;if(1===e)y[i]=0,g[i]=qf;else{const t=.5-e;y[i]=t>0?t*t:0,g[i]=t<0?t*t:0}}Zf(y,0,0,u,c,u,this.f,this.v,this.z),Zf(g,m,m,a,l,u,this.f,this.v,this.z);for(let v=0;v<h;v++){const t=Math.sqrt(y[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}};const Xf=jf;function Qf(t,e){return t+e[1]-e[0]}function tp(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const r=[],s=t.imagePrimary,a=s.pixelRatio,l=s.paddedRect.w-2*Xf,u=s.paddedRect.h-2*Xf,c=(t.right-t.left)*o,h=(t.bottom-t.top)*o,d=s.stretchX||[[0,l]],f=s.stretchY||[[0,u]],p=d.reduce(Qf,0),m=f.reduce(Qf,0),g=l-p,y=u-m;let _=0,v=p,x=0,b=m,C=0,w=g,S=0,T=y;if(s.content&&n){const t=s.content;_=ep(d,0,t[0]),x=ep(f,0,t[1]),v=ep(d,t[0],t[2]),b=ep(f,t[1],t[3]),C=t[0]-_,S=t[1]-x,w=t[2]-t[0]-v,T=t[3]-t[1]-b}const A=(n,r,l,u)=>{const d=np(n.stretch-_,v,c,t.left*o),f=op(n.fixed-C,w,n.stretch,p),g=np(r.stretch-x,b,h,t.top*o),y=op(r.fixed-S,T,r.stretch,m),A=np(l.stretch-_,v,c,t.left*o),M=op(l.fixed-C,w,l.stretch,p),I=np(u.stretch-x,b,h,t.top*o),E=op(u.fixed-S,T,u.stretch,m),P=new j(d,g),k=new j(A,g),B=new j(A,I),D=new j(d,I),R=new j(f/a,y/a),L=new j(M/a,E/a),z=e*Math.PI/180;if(z){const t=Math.sin(z),e=Math.cos(z),i=[e,-t,t,e];P._matMult(i),k._matMult(i),D._matMult(i),B._matMult(i)}const O=n.stretch+n.fixed,U=l.stretch+l.fixed,F=r.stretch+r.fixed,N=u.stretch+u.fixed,V=t.imageSecondary;return{tl:P,tr:k,bl:D,br:B,texPrimary:{x:s.paddedRect.x+Xf+O,y:s.paddedRect.y+Xf+F,w:U-O,h:N-F},texSecondary:V?{x:V.paddedRect.x+Xf+O,y:V.paddedRect.y+Xf+F,w:U-O,h:N-F}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:L,minFontScaleX:w/a/c,minFontScaleY:T/a/h,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){const t=ip(d,g,p),e=ip(f,y,m);for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)r.push(A(n,e[t],o,e[t+1]))}}else r.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return r}function ep(t,e,i){let n=0;for(const o of t)n+=Math.max(e,Math.min(i,o[1]))-Math.max(e,Math.min(i,o[0]));return n}function ip(t,e,i){const n=[{fixed:-Xf,stretch:0}];for(const[o,r]of t){const t=n[n.length-1];n.push({fixed:o-t.stretch,stretch:t.stretch}),n.push({fixed:o-t.stretch,stretch:t.stretch+(r-o)})}return n.push({fixed:e+Xf,stretch:i}),n}function np(t,e,i,n){return t/e*i+n}function op(t,e,i,n){return t-e*i/n}function rp(t,e,i,n){const o=e+t.positionedLines[n].lineOffset;return 0===n?i+o/2:i+(o+(e+t.positionedLines[n-1].lineOffset))/2}function sp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=1/0,o=1/0,r=-1/0,s=-1/0;const a=t[0];for(let f=0;f<a.length;f++){const t=a[f];(!f||t.x<n)&&(n=t.x),(!f||t.y<o)&&(o=t.y),(!f||t.x>r)&&(r=t.x),(!f||t.y>s)&&(s=t.y)}const l=Math.min(r-n,s-o);let u=l/2;const c=new Ki([],ap);if(0===l)return new j(n,o);for(let f=n;f<r;f+=l)for(let e=o;e<s;e+=l)c.push(new lp(f+u,e+u,u,t));let h=function(t){let e=0,i=0,n=0;const o=t[0];for(let r=0,s=o.length,a=s-1;r<s;a=r++){const t=o[r],s=o[a],l=t.x*s.y-s.x*t.y;i+=(t.x+s.x)*l,n+=(t.y+s.y)*l,e+=3*l}return new lp(i/e,n/e,0,t)}(t),d=c.length;for(;c.length;){const n=c.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=e||(u=n.h/2,c.push(new lp(n.p.x-u,n.p.y-u,u,t)),c.push(new lp(n.p.x+u,n.p.y-u,u,t)),c.push(new lp(n.p.x-u,n.p.y+u,u,t)),c.push(new lp(n.p.x+u,n.p.y+u,u,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function ap(t,e){return e.max-t.max}class lp{constructor(t,e,i,n){this.p=new j(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let o=0;o<e.length;o++){const r=e[o];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(i=!i),n=Math.min(n,Nl(t,o,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const up=Number.POSITIVE_INFINITY,cp=Math.sqrt(2);function hp(t,e){let[i,n]=e,o=0,r=0;if(n===up){i<0&&(i=0);const e=i/cp;switch(t){case"top-right":case"top-left":r=e-7;break;case"bottom-right":case"bottom-left":r=7-e;break;case"bottom":r=7-i;break;case"top":r=i-7}switch(t){case"top-right":case"bottom-right":o=-e;break;case"top-left":case"bottom-left":o=e;break;case"left":o=i;break;case"right":o=-i}}else{switch(i=Math.abs(i),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":o=-i;break;case"top-left":case"bottom-left":case"left":o=i}}return[o,r]}function dp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fp(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p){let m=r.textMaxSize.evaluate(e,{},h);void 0===m?m=s*r.textScaleFactor:m*=r.textScaleFactor;const g=t.layers[0].layout,y=g.get("icon-offset").evaluate(e,{},h),_=yp(i.horizontal)||i.vertical,v="globe"===d.name,x=$d,b=s*r.textScaleFactor/x,C=t.tilePixelRatio*m/x,w=(k=t.overscaling,t.zoom>18&&k>2&&(k>>=1),Math.max(Yi/(512*k),1)*g.get("symbol-spacing")),S=g.get("text-padding")*t.tilePixelRatio,T=g.get("icon-padding")*t.tilePixelRatio,A=Z(g.get("text-max-angle")),M="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),I="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),E=g.get("symbol-placement"),P=w/2;var k;const B=g.get("icon-text-fit").evaluate(e,{},h),D=g.get("icon-text-fit-padding").evaluate(e,{},h),R="none"!==B;let L;!1===t.hasAnyIconTextFit&&R&&(t.hasAnyIconTextFit=!0),n&&R&&(t.allowVerticalPlacement&&i.vertical&&(L=Bf(n,i.vertical,B,D,y,b)),_&&(n=Bf(n,_,B,D,y,b)));const z=(s,a,m)=>{if(a.x<0||a.x>=Yi||a.y<0||a.y>=Yi)return;let g=null;if(v){const{x:t,y:e,z:i}=d.projectTilePoint(a.x,a.y,m);g={anchor:new Df(t,e,i,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C,w,S,T,A){const M=t.addToLineVertexArray(e,n);let I,E,P,k,B,D,R,L=0,z=0,O=0,U=0,F=-1,N=-1;const V={};let H=ye("");const j=i?i.anchor:e,G="none"!==l.layout.get("icon-text-fit").evaluate(x,{},S);let W=0,q=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[W,q]=l.layout.get("text-offset").evaluate(x,{},S).map((t=>t*$d)):(W=l.layout.get("text-radial-offset").evaluate(x,{},S)*$d,q=up),t.allowVerticalPlacement&&o.vertical){const t=o.vertical;if(p)D=vp(t),a&&(R=vp(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},S)+90;P=_p(u,j,e,c,h,d,t,f,i,m),a&&(k=_p(u,j,e,c,h,d,a,y,i))}}if(r){const n=t.iconSizeData,o=l.layout.get("icon-rotate").evaluate(x,{},S),s=tp(r,o,C,G,b.iconScaleFactor),f=a?tp(a,o,C,G,b.iconScaleFactor):void 0;E=_p(u,j,e,c,h,d,r,y,o,null),L=4*s.length;let p=null;"source"===n.kind?(p=[Kd*l.layout.get("icon-size").evaluate(x,{},S)*b.iconScaleFactor],p[0]>mp&&ft(`${t.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)):"composite"===n.kind&&(p=[Kd*b.compositeIconSizes[0].evaluate(x,{},S)*b.iconScaleFactor,Kd*b.compositeIconSizes[1].evaluate(x,{},S)*b.iconScaleFactor],(p[0]>mp||p[1]>mp)&&ft(`${t.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,p,v,_,x,!1,i,e,M.lineStartIndex,M.lineLength,-1,w,S,T,A),F=t.icon.placedSymbolArray.length-1,f&&(z=4*f.length,t.addSymbols(t.icon,f,p,v,_,x,_f.vertical,i,e,M.lineStartIndex,M.lineLength,-1,w,S,T,A),N=t.icon.placedSymbolArray.length-1)}for(const Y in o.horizontal){const n=o.horizontal[Y];I||(H=ye(n.text),p?B=vp(n):I=_p(u,j,e,c,h,d,n,f,l.layout.get("text-rotate").evaluate(x,{},S),m));const r=1===n.positionedLines.length;if(O+=gp(t,i,e,n,s,l,p,x,m,M,o.vertical?_f.horizontal:_f.horizontalOnly,r?Object.keys(o.horizontal):[Y],V,F,b,w,S,T),r)break}o.vertical&&(U+=gp(t,i,e,o.vertical,s,l,p,x,m,M,_f.vertical,["vertical"],V,N,b,w,S,T));let Z=-1;const $=(t,e)=>t?Math.max(t,e):e;Z=$(B,Z),Z=$(D,Z),Z=$(R,Z);const K=Z>-1?1:0;t.glyphOffsetArray.length>=65535&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,j.x,j.y,j.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,F,N,H,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,void 0!==P?P:t.collisionBoxArray.length,void 0!==P?P+1:t.collisionBoxArray.length,void 0!==E?E:t.collisionBoxArray.length,void 0!==E?E+1:t.collisionBoxArray.length,k||t.collisionBoxArray.length,k?k+1:t.collisionBoxArray.length,c,O,U,L,z,K,0,W,q,Z,0,G?1:0)}(t,a,g,s,i,n,o,L,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,S,M,l,0,T,I,y,e,r,u,c,h,f,p)};if("line"===E)for(const O of Vf(e.geometry,0,0,Yi,Yi)){const e=Ff(O,w,A,i.vertical||_,n,x,C,t.overscaling,Yi);for(const i of e)_&&xp(t,_.text,P,i)||z(O,i,h)}else if("line-center"===E){for(const O of e.geometry)if(O.length>1){const t=Uf(O,A,i.vertical||_,n,x,C);t&&z(O,t,h)}}else if("Polygon"===e.type)for(const O of zc(e.geometry,0)){const t=sp(O,16);z(O[0],new Df(t.x,t.y,0,0,void 0),h)}else if("LineString"===e.type)for(const O of e.geometry)z(O,new Df(O[0].x,O[0].y,0,0,void 0),h);else if("Point"===e.type)for(const O of e.geometry)for(const t of O)z([t],new Df(t.x,t.y,0,0,void 0),h)}const pp=255,mp=pp*Kd;function gp(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y){const _=function(t,e,i,n,o,r,s,a){const l=[];if(0===e.positionedLines.length)return l;const u=n.layout.get("text-rotate").evaluate(r,{})*Math.PI/180,c=function(t){const e=t[0],i=t[1],n=e*i;return n>0?[e,-i]:n<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let h=Math.abs(e.top-e.bottom);for(const m of e.positionedLines)h-=m.lineOffset;const d=e.positionedLines.length,f=h/d;let p=e.top-i[1];for(let m=0;m<d;++m){const t=e.positionedLines[m];p=rp(e,f,p,m);for(const n of t.positionedGlyphs){if(!n.rect)continue;const t=n.rect||{};let r=yf+1,h=!0,d=1,f=0;if(n.imageName){const t=s[ti.build(n.imageName).getSerializedPrimary()];if(!t)continue;if(t.sdf){ft("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,r=jf/d}const m=(o||a)&&n.vertical,g=n.metrics.advance*n.scale/2,y=n.metrics,_=n.rect;if(null===_)continue;a&&e.verticalizable&&(f=n.imageName?g-n.metrics.width*n.scale/2:0);const v=o?[n.x+g,n.y]:[0,0];let x=[0,0],b=[0,0],C=!1;o||(m?(b=[n.x+g+c[0],n.y+c[1]-f],C=!0):x=[n.x+g+i[0],n.y+i[1]-f]);const w=_.w*n.scale/(d*(n.localGlyph?Kf:1)),S=_.h*n.scale/(d*(n.localGlyph?Kf:1));let T,A,M,I;if(m){const t=n.y-p,e=new j(-g,g-t),i=-Math.PI/2,o=new j(...b);T=new j(-g+x[0],x[1]),T._rotateAround(i,e)._add(o),T.x+=-t+g,T.y-=(y.left-r)*n.scale;const s=n.imageName?y.advance*n.scale:$d*n.scale,a=String.fromCodePoint(n.glyph);of(a)?T.x+=(1-r)*n.scale:rf(a)?T.x+=s-y.height*n.scale+(-r-1)*n.scale:T.x+=n.imageName||y.width+2*r===_.w&&y.height+2*r===_.h?(s-S)/2:(s-(y.height+2*r)*n.scale)/2,A=new j(T.x,T.y-w),M=new j(T.x+S,T.y),I=new j(T.x+S,T.y-w)}else{const t=(y.left-r)*n.scale-g+x[0],e=(-y.top-r)*n.scale+x[1],i=t+w,o=e+S;T=new j(t,e),A=new j(i,e),M=new j(t,o),I=new j(i,o)}if(u){let t;t=o?new j(0,0):C?new j(c[0],c[1]):new j(i[0],i[1]),T._rotateAround(u,t),A._rotateAround(u,t),M._rotateAround(u,t),I._rotateAround(u,t)}const E=new j(0,0),P=new j(0,0);l.push({tl:T,tr:A,bl:M,br:I,texPrimary:t,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:v,sectionIndex:n.sectionIndex,isSDF:h,pixelOffsetTL:E,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,r,s,a,o,t.allowVerticalPlacement),v=t.textSizeData;let x=null;"source"===v.kind?(x=[Kd*r.layout.get("text-size").evaluate(a,{},g)*p.textScaleFactor],x[0]>mp&&ft(`${t.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Kd*p.compositeTextSizes[0].evaluate(a,{},g)*p.textScaleFactor,Kd*p.compositeTextSizes[1].evaluate(a,{},g)*p.textScaleFactor],(x[0]>mp||x[1]>mp)&&ft(`${t.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)),t.addSymbols(t.text,_,x,l,s,a,c,e,i,u.lineStartIndex,u.lineLength,f,m,g,y,!1);for(const b of h)d[b]=t.text.placedSymbolArray.length-1;return 4*_.length}function yp(t){for(const e in t)return t[e];return null}function _p(t,e,i,n,o,r,s,a,l,u){let c=s.top,h=s.bottom,d=s.left,f=s.right;const p=s.collisionPadding;if(p&&(d-=p[0],c-=p[1],f+=p[2],h+=p[3]),l){const t=new j(d,c),e=new j(f,c),i=new j(d,h),n=new j(f,h),o=Z(l);let r=new j(0,0);u&&(r=new j(u[0],u[1])),t._rotateAround(o,r),e._rotateAround(o,r),i._rotateAround(o,r),n._rotateAround(o,r),d=Math.min(t.x,e.x,i.x,n.x),f=Math.max(t.x,e.x,i.x,n.x),c=Math.min(t.y,e.y,i.y,n.y),h=Math.max(t.y,e.y,i.y,n.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,d,c,f,h,a,n,o,r),t.length-1}function vp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function xp(t,e,i,n){const o=t.compareText;if(e in o){const t=o[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else o[e]=[];return o[e].push(n),!1}function bp(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,o=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),r=Math.sin(i)*o/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01));let s=Math.sin(t._pitch)*r+o;const a=o*(1/t._horizonShift);if(!t.elevation||0===t.elevation.exaggeration()){let e=Math.max(t.zoom-17,0);t.isOrthographic&&(e/=10),s*=1+e}return Math.min(1.01*s,a)}function Cp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,o=(t.x+1)*i,r=t.y*i,s=(t.y+1)*i,a=dl(n),l=dl(o),u=fl(r),c=fl(s),h=e.project(a,u),d=e.project(l,u),f=e.project(l,c),p=e.project(a,c);let m=Math.min(h.x,d.x,f.x,p.x),g=Math.min(h.y,d.y,f.y,p.y),y=Math.max(h.x,d.x,f.x,p.x),_=Math.max(h.y,d.y,f.y,p.y);const v=i/16;function x(t,i,n,o,r,s){const a=(n+r)/2,l=(o+s)/2,u=e.project(dl(a),fl(l)),c=Math.max(0,m-u.x,g-u.y,u.x-y,u.y-_);m=Math.min(m,u.x),y=Math.max(y,u.x),g=Math.min(g,u.y),_=Math.max(_,u.y),c>v&&(x(t,u,n,o,a,l),x(u,i,a,l,r,s))}x(h,d,n,r,o,r),x(d,f,o,r,o,s),x(f,p,o,s,n,s),x(p,h,n,s,n,r),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:e}}function wp(t,e){let{x:i,y:n}=e;return new j(((i-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*t.scale-t.x)*Yi,(n*t.scale-t.y)*Yi)}const Sp=F.mat4.identity(new Float32Array(16));class Tp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new ol(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return hl(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return bp(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,n){const o=t.horizonLineFromTop(!1),r=new j(e,Math.max(o,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(r,n))}pointCoordinate3D(t,e,i){const n=new j(e,i);if(t.elevation)return t.elevation.pointCoordinate(n);{const e=this.pointCoordinate(t,n.x,n.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return Sp}createTileMatrix(t,e,i){let n,o,r;const s=i.canonical,a=F.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Cp(s,this);n=1,o=l.x+i.wrap*l.scale,r=l.y,F.mat4.scale(a,a,[n/l.scale,n/l.scale,t.pixelsPerMeter/e])}else n=e/t.zoomScale(s.z),o=(s.x+Math.pow(2,s.z)*i.wrap)*n,r=s.y*n;return F.mat4.translate(a,a,[o,r,0]),F.mat4.scale(a,a,[n/Yi,n/Yi,1]),a}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class Ap extends Tp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],n=Math.sin(Z(e));this.n=(n+Math.sin(Z(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:n,r0:o}=this,r=Z(t-this.center[0]),s=Z(e),a=Math.sqrt(n-2*i*Math.sin(s))/i;return{x:a*Math.sin(r*i),y:a*Math.cos(r*i)-o,z:0}}unproject(t,e){const{n:i,c:n,r0:o}=this,r=o+e;let s=Math.atan2(t,Math.abs(r))*Math.sign(r);r*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(r));const a=Z(this.center[0])*i;s=et(s,-Math.PI-a,Math.PI-a);const l=Q($(s/i)+this.center[0],-180,180),u=Math.asin(Q((n-(t*t+r*r)*i*i)/(2*i),-1,1)),c=Q($(u),-ml,ml);return new ol(l,c)}}const Mp=1.340264,Ip=-.081106,Ep=893e-6,Pp=.003796,kp=Math.sqrt(3)/2;class Bp extends Tp{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(kp*Math.sin(e)),n=i*i,o=n*n*n;return{x:.5*(t*Math.cos(i)/(kp*(Mp+3*Ip*n+o*(7*Ep+9*Pp*n)))/Math.PI+.5),y:1-.5*(i*(Mp+Ip*n+o*(Ep+Pp*n))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=i*i,o=n*n*n;for(let u,c,h,d=0;d<12&&(c=i*(Mp+Ip*n+o*(Ep+Pp*n))-e,h=Mp+3*Ip*n+o*(7*Ep+9*Pp*n),u=c/h,i=Q(i-u,-Math.PI/3,Math.PI/3),n=i*i,o=n*n*n,!(Math.abs(u)<1e-12));++d);const r=kp*t*(Mp+3*Ip*n+o*(7*Ep+9*Pp*n))/Math.cos(i),s=Math.asin(Math.sin(i)/kp),a=Q(180*r/Math.PI,-180,180),l=Q(180*s/Math.PI,-ml,ml);return new ol(a,l)}}class Dp extends Tp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),n=Q(360*(.5-e),-ml,ml);return new ol(i,n)}}const Rp=Math.PI/2;function Lp(t){return Math.tan((Rp+t)/2)}class zp extends Tp{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let n=Z(e),o=Z(i);this.southernCenter=n+o<0,this.southernCenter&&(n=-n,o=-o);const r=Math.cos(n),s=Lp(n);this.n=n===o?Math.sin(n):Math.log(r/Math.cos(o))/Math.log(Lp(o)/s),this.f=r*Math.pow(Lp(n),this.n)/this.n}project(t,e){e=Z(e),this.southernCenter&&(e=-e),t=Z(t-this.center[0]);const i=1e-6,{n:n,f:o}=this;o>0?e<-Rp+i&&(e=-Rp+i):e>Rp-i&&(e=Rp-i);const r=o/Math.pow(Lp(e),n);let s=r*Math.sin(n*t),a=o-r*Math.cos(n*t);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:n}=this,o=n-e,r=Math.sign(o),s=Math.sign(i)*Math.sqrt(t*t+o*o);let a=Math.atan2(t,Math.abs(o))*r;o*i<0&&(a-=Math.PI*Math.sign(t)*r);const l=Q($(a/i)+this.center[0],-180,180),u=Q($(2*Math.atan(Math.pow(n/s,1/i))-Rp),-ml,ml);return new ol(l,this.southernCenter?-u:u)}}class Op extends Tp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:ul(t),y:cl(e),z:0}}unproject(t,e){const i=dl(t),n=fl(e);return new ol(i,n)}}const Up=Z(ml);class Fp extends Tp{project(t,e){const i=(e=Z(e))*e,n=i*i;return{x:.5*((t=Z(t))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=25,o=0,r=i*i;do{r=i*i;const t=r*r;o=(i*(1.007226+r*(.015085+t*(.028874*r-.044475-.005916*t)))-e)/(1.007226+r*(.045255+t*(.259866*r-.311325-.005916*11*t))),i=Q(i-o,-Up,Up)}while(Math.abs(o)>1e-6&&--n>0);r=i*i;const s=Q($(t/(.8707+r*(r*(r*r*r*(.003971-.001529*r)-.013791)-.131979))),-180,180),a=$(i);return new ol(s,a)}}const Np=Z(ml);class Vp extends Tp{project(t,e){e=Z(e),t=Z(t);const i=Math.cos(e),n=2/Math.PI,o=Math.acos(i*Math.cos(t/2)),r=Math.sin(o)/o,s=.5*(t*n+2*i*Math.sin(t/2)/r)||0,a=.5*(e+Math.sin(e)/r)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,o=25;const r=1e-6;let s=0,a=0;do{const o=Math.cos(n),r=Math.sin(n),l=2*r*o,u=r*r,c=o*o,h=Math.cos(i/2),d=Math.sin(i/2),f=2*h*d,p=d*d,m=1-c*h*h,g=m?1/m:0,y=m?Math.acos(o*h)*Math.sqrt(1/m):0,_=.5*(2*y*o*d+2*i/Math.PI)-t,v=.5*(y*r+n)-e,x=.5*g*(c*p+y*o*h*u)+1/Math.PI,b=g*(f*l/4-y*r*d),C=.125*g*(l*d-y*r*c*f),w=.5*g*(u*h+y*p*o)+.5,S=b*C-w*x;s=(v*b-_*w)/S,a=(_*C-v*x)/S,i=Q(i-s,-Math.PI,Math.PI),n=Q(n-a,-Np,Np)}while((Math.abs(s)>r||Math.abs(a)>r)&&--o>0);return new ol($(i),$(n))}}class Hp extends Tp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:n}=this;return{x:Z(t)*n*i+.5,y:-Math.sin(Z(e))/n*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:n}=this,o=-(e-.5)/i,r=Q($((t-.5)/i)/n,-180,180),s=Math.asin(Q(o*n,-1,1)),a=Q($(s),-ml,ml);return new ol(r,a)}}class jp extends Op{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,e,i){const n=Pu(t,e,i),o=Du(Su(i));return F.vec3.transformMat4(n,n,o),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,e){const i=el(e.lat,e.lng),n=F.vec3.normalize([],i),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude,r=hl(1,0)*Yi*o;F.vec3.scaleAndAdd(i,i,n,r);const s=F.mat4.identity(new Float64Array(16));return F.mat4.multiply(s,t.pixelMatrix,t.globeMatrix),F.vec3.transformMat4(i,i,s),new j(i[0],i[1])}pixelsPerMeter(t,e){return hl(1,0)*e}pixelSpaceConversion(t,e,i){const n=hl(1,t)*e,o=Ie(hl(1,45)*e,n,i);return this.pixelsPerMeter(t,e)/o}createTileMatrix(t,e,i){const n=Ru(Su(i.canonical));return F.mat4.multiply(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,e){const{center:i}=t,n=Du(Su(e));return F.mat4.rotateY(n,n,Z(i.lng)),F.mat4.rotateX(n,n,Z(i.lat)),F.mat4.scale(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(t,e,i,n){return bu(t,e,i,!0)||new xl(0,0)}pointCoordinate3D(t,e,i){const n=this.pointCoordinate(t,e,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(t,e){return!bu(t,e.x,e.y,!1)}farthestPixelDistance(t){const e=function(t,e){const i=t.cameraToCenterDistance,n=t._centerAltitude*e,o=t._camera,r=t._camera.forward(),s=F.vec3.add([],F.vec3.scale([],r,-i),[0,0,n]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],u=t.width/t.height,c=Math.tan(t.fovAboveCenter),h=F.vec3.scale([],o.up(),c),d=F.vec3.scale([],o.right(),c*u),f=F.vec3.normalize([],F.vec3.add([],F.vec3.add([],r,h),d)),p=[];let m;if(new hu(s,f).closestPointOnSphere(l,a,p)){const e=F.vec3.add([],p,l),i=F.vec3.sub([],e,s);m=Math.cos(t.fovAboveCenter)*F.vec3.length(i)}else{const t=F.vec3.sub([],s,l),e=F.vec3.sub([],l,s);F.vec3.normalize(e,e);const i=F.vec3.length(t)-a;m=Math.sqrt(i*(i+2*a));const n=Math.acos(m/(a+i))-Math.acos(F.vec3.dot(r,e));m*=Math.cos(n)}return 1.01*m}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=Uu(t.zoom);if(i>0){const n=bp(t,hl(1,t.center.lat)*t.worldSize),o=t.worldSize/(2*Math.PI),r=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ie(e,n+o*(1-Math.cos(r)),Math.pow(i,10))}return e}upVector(t,e,i){return Pu(e,i,t,1)}upVectorScale(t){return{metersToTile:vu(ku(Su(t)))}}}function Gp(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Op(t);case"equirectangular":return new Dp(t);case"naturalEarth":return new Fp(t);case"equalEarth":return new Bp(t);case"winkelTripel":return new Vp(t);case"albers":return i?new Hp(t):new Ap(t);case"lambertConformalConic":return i?new Hp(t):new zp(t);case"globe":return new jp(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Wp=fh.VectorTileFeature.types,qp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zp(t,e,i,n,o,r,s,a,l,u,c,h,d){const f=a?Math.min(mp,Math.round(a[0])):0,p=a?Math.min(mp,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*o),r,s,(f<<1)+(l?1:0),p,16*u,16*c,256*h,256*d)}function $p(t,e,i){t.emplaceBack(e,i)}function Kp(t,e,i,n,o,r,s){t.emplaceBack(e,i,n,o,r,s)}function Yp(t,e,i,n,o){t.emplaceBack(e,i,n,o),t.emplaceBack(e,i,n,o),t.emplaceBack(e,i,n,o),t.emplaceBack(e,i,n,o)}function Jp(t){for(const e of t.sections)if(br(e.text))return!0;return!1}class Xp{constructor(t){this.layoutVertexArray=new Is,this.indexArray=new Os,this.programConfigurations=t,this.segments=new fa,this.dynamicLayoutVertexArray=new Ps,this.opacityVertexArray=new ks,this.placedSymbolArray=new ea,this.iconTransitioningVertexArray=new Bs,this.globeExtVertexArray=new Es,this.zOffsetVertexArray=new Ns}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,i,n,o){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,qp,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,jd.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Nd.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||o)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Hd.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}lr(Xp,"SymbolBuffers");class Qp{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new fa,this.collisionVertexArray=new zs,this.collisionVertexArrayExt=new Ps}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gd.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Wd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}lr(Qp,"CollisionBuffers");class tm{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=F.mat4.identity([]),this.placementViewportMatrix=F.mat4.identity([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jd(this.zoom,e["text-size"]),this.iconSizeData=Jd(this.zoom,e["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((t=>_f[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Xp(new Na(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("text")||t.startsWith("symbol")))),this.icon=new Xp(new Na(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("icon")||t.startsWith("symbol")))),this.glyphOffsetArray=new oa,this.lineVertexArray=new ra,this.symbolInstances=new na}calculateGlyphDependencies(t,e,i,n,o){for(const r of t){const t=r.codePointAt(0);if(void 0===t)break;if(e[t]=!0,n&&o&&t<=65535){const t=nf[r];t&&(e[t.charCodeAt(0)]=!0)}}}updateFootprints(t,e){}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Sh(this.activeReplacements,i)&&(this.activeReplacements=i,!0)}populate(t,e,i,n){const o=this.layers[0],r=o.layout,s="globe"===this.projection.name,a=r.get("text-font"),l=r.get("text-field"),u=r.get("icon-image"),[c,h]=r.get("icon-size-scale-range"),d=Q(e.scaleFactor||1,c,h),f=("constant"!==l.value.kind||l.value.value instanceof Xe&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),p="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,m=r.get("symbol-sort-key");if(this.features=[],!f&&!p)return;const g=e.iconDependencies,y=e.glyphDependencies,_=e.availableImages,v=new Rr(this.zoom);for(const{feature:x,id:b,index:C,sourceLayerIndex:w}of t){const t=o._featureFilter.needGeometry,e=El(x,t);if(!o._featureFilter.filter(v,e,i))continue;if(t||(e.geometry=Il(x,i,n)),s&&1!==x.type&&i.z<=5){const t=e.geometry,n=.98078528056,o=(t,e)=>{const o=Pu(t.x,t.y,i,1),r=Pu(e.x,e.y,i,1);return F.vec3.dot(o,r)<n};for(let e=0;e<t.length;e++)t[e]=Sl(t[e],o)}let l,u;if(f){const t=o.getValueAndResolveTokens("text-field",e,i,_),n=Xe.factory(t);Jp(n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===kr()||this.hasRTLText&&Dr.isParsed())&&(l=ef(n,o,e))}if(p){const t=o.getValueAndResolveTokens("icon-image",e,i,_);u=t instanceof ti?t:ti.build(t)}if(!l&&!u)continue;const c=this.sortFeaturesByKey?m.evaluate(e,{},i):void 0,h={id:b,text:l,icon:u,index:C,sourceLayerIndex:w,geometry:e.geometry,properties:x.properties,type:Wp[x.type],sortKey:c};if(this.features.push(h),u){const t=Yd(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],i,this.zoom,h)*d*this.pixelRatio,e=u.getPrimary().scaleSelf(t);if(g[e.id]=g[e.id]||[],g[e.id].push(e),u.nameSecondary){const e=u.getSecondary().scaleSelf(t);g[e.id]=g[e.id]||[],g[e.id].push(e)}}if(l){const t=a.evaluate(e,{},i).join(","),n="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_f.vertical)>=0;for(const e of l.sections)if(e.image){const t=e.image.getPrimary().scaleSelf(this.pixelRatio);g[t.id]=g[t.id]||[],g[t.id].push(t)}else{const i=pr(l.toString()),o=e.fontStack||t,r=y[o]=y[o]||{};this.calculateGlyphDependencies(e.text,r,n,this.allowVerticalPlacement,i)}}}"line"===r.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let o=0;function r(e){n.push(t[e]),o++}function s(t,e,o){const r=i[t];return delete i[t],i[e]=r,n[r].geometry[0].pop(),n[r].geometry[0]=n[r].geometry[0].concat(o[0]),r}function a(t,i,o){const r=e[i];return delete e[i],e[t]=r,n[r].geometry[0].shift(),n[r].geometry[0]=o[0].concat(n[r].geometry[0]),r}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let u=0;u<t.length;u++){const c=t[u],h=c.geometry,d=c.text?c.text.toString():null;if(!d){r(u);continue}const f=l(d,h),p=l(d,h,!0);if(f in i&&p in e&&i[f]!==e[p]){const t=a(f,p,h),o=s(f,p,n[t].geometry);delete e[f],delete i[p],i[l(d,n[o].geometry,!0)]=o,n[t].geometry=null}else f in i?s(f,p,h):p in e?a(f,p,h):(r(u),e[f]=o-1,i[p]=o-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,n,o,r,s){this.text.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s),this.icon.programConfigurations.updatePaintArrays(t,e,o,i,n,r,s)}updateZOffset(){const t=(t,e,n)=>{i+=e,i>t.length&&t.resize(i);for(let o=-e;o<0;o++)t.emplace(o+i,n)},e=(t,e,i)=>{n+=e,n>t.length&&t.resize(n);for(let o=-e;o<0;o++)t.emplace(o+n,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,n=0;for(let o=0;o<this.symbolInstances.length;o++){const i=this.symbolInstances.get(o),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:r,numIconVertices:s}=i,a=i.zOffset,l=s>0;if((n>0||r>0)&&(t(this.text.zOffsetVertexArray,n,a),t(this.text.zOffsetVertexArray,r,a)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:n}=i;t>=0&&e(this.icon.zOffsetVertexArray,s,a),n>=0&&e(this.icon.zOffsetVertexArray,i.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Gp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:n,y:o}of e)this.lineVertexArray.emplaceBack(n,o);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m){const g=t.indexArray,y=t.layoutVertexArray,_=t.globeExtVertexArray,v=t.segments.prepareSegment(4*e.length,y,g,this.canOverlap?r.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,C=this.allowVerticalPlacement&&s===_f.vertical?Math.PI/2:0,w=r.text&&r.text.sections;for(let T=0;T<e.length;T++){const{tl:n,tr:o,bl:s,br:u,texPrimary:c,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:S,minFontScaleY:A,glyphOffset:M,isSDF:I,sectionIndex:E}=e[T],P=v.vertexLength,k=M[1];if(Zp(y,l.x,l.y,n.x,k+n.y,c.x,c.y,i,I,x.x,x.y,S,A),Zp(y,l.x,l.y,o.x,k+o.y,c.x+c.w,c.y,i,I,b.x,x.y,S,A),Zp(y,l.x,l.y,s.x,k+s.y,c.x,c.y+c.h,i,I,x.x,b.y,S,A),Zp(y,l.x,l.y,u.x,k+u.y,c.x+c.w,c.y+c.h,i,I,b.x,b.y,S,A),a){const{x:e,y:i,z:n}=a.anchor,[o,r,s]=a.up;Kp(_,e,i,n,o,r,s),Kp(_,e,i,n,o,r,s),Kp(_,e,i,n,o,r,s),Kp(_,e,i,n,o,r,s),Yp(t.dynamicLayoutVertexArray,e,i,n,C)}else Yp(t.dynamicLayoutVertexArray,l.x,l.y,l.z,C);if(m){const e=h||c;$p(t.iconTransitioningVertexArray,e.x,e.y),$p(t.iconTransitioningVertexArray,e.x+e.w,e.y),$p(t.iconTransitioningVertexArray,e.x,e.y+e.h),$p(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),T!==e.length-1&&E===e[T+1].sectionIndex||t.programConfigurations.populatePaintArrays(y.length,r,r.index,{},d,f,p,w&&w[E])}const S=a?a.anchor:l;t.placedSymbolArray.emplaceBack(S.x,S.y,S.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,u,c,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,n,o,r,s){t.emplaceBack(e,i,n,o,r,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,n,o,r,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,u=s.tileAnchorX,c=s.tileAnchorY;for(let d=0;d<4;d++)i.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,e,t.padding,s.zOffset),this._commitLayoutVertex(i.layoutVertexArray,n,o,r,u,c,new j(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,r,u,c,new j(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,r,u,c,new j(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,o,r,u,c,new j(t.x1,t.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,n,o,r){for(let s=n;s<o;s++){const n=i.get(s),o=this.getSymbolInstanceTextSize(t,r,e,s);this._addCollisionDebugVertices(n,o,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,r)}}_addIconDebugCollisionBoxes(t,e,i,n,o,r){for(let s=n;s<o;s++){const n=i.get(s),o=this.getSymbolInstanceIconSize(t,e,r.placedIconSymbolIndex);this._addCollisionDebugVertices(n,o,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,r)}}generateCollisionDebugBuffers(t,e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qp(Rs,qd.members,Bs),this.iconCollisionBox=new Qp(Rs,qd.members,Bs);const n=Qd(this.iconSizeData,t),o=Qd(this.textSizeData,t,i);for(let r=0;r<this.symbolInstances.length;r++){const i=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(o,t,e,i.textBoxStartIndex,i.textBoxEndIndex,i),this._addTextDebugCollisionBoxes(o,t,e,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i),this._addIconDebugCollisionBoxes(n,t,e,i.iconBoxStartIndex,i.iconBoxEndIndex,i),this._addIconDebugCollisionBoxes(n,t,e,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i)}}getSymbolInstanceTextSize(t,e,i,n){const o=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),r=Xd(this.textSizeData,t,o)/$d;return this.tilePixelRatio*r}getSymbolInstanceIconSize(t,e,i){const n=this.icon.placedSymbolArray.get(i),o=Xd(this.iconSizeData,t,n);return this.tilePixelRatio*o}_commitDebugCollisionVertexUpdate(t,e,i,n){t.emplaceBack(e,-i,-i,n),t.emplaceBack(e,i,-i,n),t.emplaceBack(e,i,i,n),t.emplaceBack(e,-i,i,n)}_updateTextDebugCollisionBoxes(t,e,i,n,o,r,s){for(let a=n;a<o;a++){const n=i.get(a),o=this.getSymbolInstanceTextSize(t,r,e,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,o,n.padding,r.zOffset)}}_updateIconDebugCollisionBoxes(t,e,i,n,o,r,s){for(let a=n;a<o;a++){const n=i.get(a),o=this.getSymbolInstanceIconSize(t,e,r.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,o,n.padding,r.zOffset)}}updateCollisionDebugBuffers(t,e,i,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=Qd(this.iconSizeData,t,n),r=Qd(this.textSizeData,t,i);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(r,t,e,a.textBoxStartIndex,a.textBoxEndIndex,a,i),this._updateTextDebugCollisionBoxes(r,t,e,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,i),this._updateIconDebugCollisionBoxes(o,t,e,a.iconBoxStartIndex,a.iconBoxEndIndex,a,n),this._updateIconDebugCollisionBoxes(o,t,e,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,n)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,n,o,r,s,a,l){const u={};if(e<i){const{x1:i,y1:n,x2:o,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=t.get(e);u.textBox={x1:i,y1:n,x2:o,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d},u.textFeatureIndex=f}if(n<o){const{x1:e,y1:i,x2:o,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=t.get(n);u.verticalTextBox={x1:e,y1:i,x2:o,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d},u.verticalTextFeatureIndex=f}if(r<s){const{x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=t.get(r);u.iconBox={x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d},u.iconFeatureIndex=f}if(a<l){const{x1:e,y1:i,x2:n,y2:o,padding:r,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=t.get(a);u.verticalIconBox={x1:e,y1:i,x2:n,y2:o,padding:r,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:d},u.verticalIconFeatureIndex=f}return u}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let o=i.vertexStartIndex;o<n;o+=4)t.indexArray.emplaceBack(o,o+1,o+2),t.indexArray.emplaceBack(o+1,o+2,o+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],o=[],r=[];for(let s=0;s<this.symbolInstances.length;++s){r.push(s);const t=this.symbolInstances.get(s);n.push(0|Math.round(e*t.tileAnchorX+i*t.tileAnchorY)),o.push(t.featureIndex)}return r.sort(((t,e)=>n[t]-n[e]||o[e]-o[t])),r}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:r,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&o!==n&&o!==i&&this.addIndicesForPlacedSymbol(this.text,o),r>=0&&this.addIndicesForPlacedSymbol(this.text,r),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let em,im,nm;lr(tm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tm.addDynamicAttributes=Yp;class om{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Re,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lr(om,"FormatSectionOverride",{omit:["defaultValue"]});const rm=()=>nm||(nm={layout:em||(em=new qr({"symbol-placement":new jr(Zr.layout_symbol["symbol-placement"]),"symbol-spacing":new jr(Zr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jr(Zr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gr(Zr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jr(Zr.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new jr(Zr.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new jr(Zr.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new jr(Zr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jr(Zr.layout_symbol["icon-ignore-placement"]),"icon-optional":new jr(Zr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jr(Zr.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gr(Zr.layout_symbol["icon-size"]),"icon-size-scale-range":new jr(Zr.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Gr(Zr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gr(Zr.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gr(Zr.layout_symbol["icon-image"]),"icon-rotate":new Gr(Zr.layout_symbol["icon-rotate"]),"icon-padding":new jr(Zr.layout_symbol["icon-padding"]),"icon-keep-upright":new jr(Zr.layout_symbol["icon-keep-upright"]),"icon-offset":new Gr(Zr.layout_symbol["icon-offset"]),"icon-anchor":new Gr(Zr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jr(Zr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jr(Zr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jr(Zr.layout_symbol["text-rotation-alignment"]),"text-field":new Gr(Zr.layout_symbol["text-field"]),"text-font":new Gr(Zr.layout_symbol["text-font"]),"text-size":new Gr(Zr.layout_symbol["text-size"]),"text-size-scale-range":new jr(Zr.layout_symbol["text-size-scale-range"]),"text-max-width":new Gr(Zr.layout_symbol["text-max-width"]),"text-line-height":new Gr(Zr.layout_symbol["text-line-height"]),"text-letter-spacing":new Gr(Zr.layout_symbol["text-letter-spacing"]),"text-justify":new Gr(Zr.layout_symbol["text-justify"]),"text-radial-offset":new Gr(Zr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jr(Zr.layout_symbol["text-variable-anchor"]),"text-anchor":new Gr(Zr.layout_symbol["text-anchor"]),"text-max-angle":new jr(Zr.layout_symbol["text-max-angle"]),"text-writing-mode":new jr(Zr.layout_symbol["text-writing-mode"]),"text-rotate":new Gr(Zr.layout_symbol["text-rotate"]),"text-padding":new jr(Zr.layout_symbol["text-padding"]),"text-keep-upright":new jr(Zr.layout_symbol["text-keep-upright"]),"text-transform":new Gr(Zr.layout_symbol["text-transform"]),"text-offset":new Gr(Zr.layout_symbol["text-offset"]),"text-allow-overlap":new jr(Zr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jr(Zr.layout_symbol["text-ignore-placement"]),"text-optional":new jr(Zr.layout_symbol["text-optional"]),visibility:new jr(Zr.layout_symbol.visibility)})),paint:im||(im=new qr({"icon-opacity":new Gr(Zr.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gr(Zr.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gr(Zr.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gr(Zr.paint_symbol["text-emissive-strength"]),"icon-color":new Gr(Zr.paint_symbol["icon-color"]),"icon-halo-color":new Gr(Zr.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gr(Zr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gr(Zr.paint_symbol["icon-halo-blur"]),"icon-translate":new jr(Zr.paint_symbol["icon-translate"]),"icon-translate-anchor":new jr(Zr.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gr(Zr.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gr(Zr.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gr(Zr.paint_symbol["text-occlusion-opacity"]),"text-color":new Gr(Zr.paint_symbol["text-color"],{runtimeType:Ue,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Gr(Zr.paint_symbol["text-halo-color"]),"text-halo-width":new Gr(Zr.paint_symbol["text-halo-width"]),"text-halo-blur":new Gr(Zr.paint_symbol["text-halo-blur"]),"text-translate":new jr(Zr.paint_symbol["text-translate"]),"text-translate-anchor":new jr(Zr.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new jr(Zr.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new jr(Zr.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new jr(Zr.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new jr(Zr.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gr(Zr.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},nm);class sm extends fs{constructor(t,e,i,n){super(t,rm(),e,i,n),this._colorAdjustmentMatrix=F.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==t.paint&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,e,i,n){return this._saturation===t&&this._contrast===e&&this._brightnessMin===i&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(t,e,i,n){t=St(t),e=wt(e);const o=F.mat4.create(),r=t/3,s=1-2*r,a=[s,r,r,0,r,s,r,0,r,r,s,0,0,0,0,1],l=.5-.5*e,u=n-i;return F.mat4.multiply(o,[u,0,0,0,0,u,0,0,0,0,u,0,i,i,i,1],[e,0,0,0,0,e,0,0,0,0,e,0,l,l,l,1]),F.mat4.multiply(o,o,a),o}(t,e,i,n),this._saturation=t,this._contrast=e,this._brightnessMin=i,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,e,i,n){const o=this.layout.get(t).evaluate(e,{},i,n),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||Yo(r.value)||!o?o:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,o)}createBucket(t){return new tm(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of rm().paint.overridableProperties){if(!sm.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new om(e),n=new Ko(i,e.property.specification,this.scope,this.options);let o=null;o="constant"===e.value.kind||"source"===e.value.kind?new Xo("source",n):new Qo("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Vr(e.property,o,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&sm.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=rm().paint.properties[e];let o=!1;const r=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(o=!0)};if("constant"===i.value.kind&&i.value.value instanceof Xe)r(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{o||(e instanceof ri&&ni(e.value)===He?r(e.value.sections):e instanceof ui?r(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return o}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,e,i){return{config:new Fa(this,{zoom:e,lut:i}),overrideFog:!1}}}let am,lm,um,cm;var hm=ys([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function dm(t){switch(t){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function fm(t){switch(t){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class pm{constructor(t,e,i,n){this.context=t,this.format=i,this.useMipmap=n&&n.useMipmap,this.texture=t.gl.createTexture(),this.update(e,{premultiply:n&&n.premultiply})}update(t,e){const i=t&&t instanceof HTMLVideoElement&&0===t.width?t.videoWidth:t.width,n=t&&t instanceof HTMLVideoElement&&0===t.height?t.videoHeight:t.height,{context:o}=this,{gl:r}=o,{x:s,y:a}=e&&e.position?e.position:{x:0,y:0},l=s+i,u=a+n;!this.size||this.size[0]===l&&this.size[1]===u||(r.bindTexture(r.TEXTURE_2D,null),r.deleteTexture(this.texture),this.texture=r.createTexture(),this.size=null),r.bindTexture(r.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===r.RGBA8&&(!e||!1!==e.premultiply));const c=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&l>0&&u>0){const t=this.useMipmap?Math.floor(Math.log2(Math.max(l,u)))+1:1;r.texStorage2D(r.TEXTURE_2D,t,this.format,l,u),this.size=[l,u]}if(this.size)if(c)r.texSubImage2D(r.TEXTURE_2D,0,s,a,dm(this.format),fm(this.format),t);else{const e=t.data;e&&r.texSubImage2D(r.TEXTURE_2D,0,s,a,i,n,dm(this.format),fm(this.format),e)}this.useMipmap&&r.generateMipmap(r.TEXTURE_2D)}bind(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap&&!i?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,i,n){const{context:o}=this,{gl:r}=o;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.magFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,i),this.wrapS=i),n!==this.wrapT&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class mm{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}}function gm(t,e,i,n,o,r,s,a){const l=[t,e,1,i,n,1,o,r,1],u=[s,a,1],c=F.mat3.adjoint([],l),[h,d,f]=F.vec3.transformMat3(u,u,c);return F.mat3.multiply(l,l,[h,0,0,0,d,0,0,0,f])}function ym(t,e,i,n,o,r,s,a){const l=function(t,e,i,n,o,r,s,a){const l=gm(0,0,1,0,1,1,0,1),u=gm(t,e,i,n,o,r,s,a),c=F.mat3.adjoint([],l);return F.mat3.multiply(u,u,c)}(t,e,i,n,o,r,s,a);return[l[2]/l[8]/Yi,l[5]/l[8]/Yi]}function _m(t){return[t[0],Math.min(Math.max(t[1],-ml),ml)]}class vm extends Ce{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new _e("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=ue(this.map._requestManager.transformRequest(this.url,te.Image),((e,i)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new ve(e)):i&&(this.image=i instanceof HTMLImageElement?Lt.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new mm(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _e("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof mm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],i=t[0][1];for(const o of t)o[1]>i&&(i=o[1]),o[1]<e&&(e=o[1]);const n=(i+e)/2;if(n>ml?this.onNorthPole=!0:n<-ml&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(xl.fromLngLat);this.tileID=function(t){let e=1/0,i=1/0,n=-1/0,o=-1/0;for(const u of t)e=Math.min(e,u.x),i=Math.min(i,u.y),n=Math.max(n,u.x),o=Math.max(o,u.y);const r=Math.max(n-e,o-i),s=Math.max(0,Math.floor(-Math.log(r)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((e+n)/2*a);return l>1&&(l-=1),new iu(s,l,Math.floor((i+o)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _e("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const g in this.tiles){const t=this.tiles[g];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const e=Cp(new iu(0,0,0),this.map.transform.projection),i=[e.projection.project(this.coordinates[0][0],this.coordinates[0][1]),e.projection.project(this.coordinates[1][0],this.coordinates[1][1]),e.projection.project(this.coordinates[2][0],this.coordinates[2][1]),e.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,i=t[1].y-t[0].y,n=t[2].x-t[1].x,o=t[2].y-t[1].y,r=t[3].x-t[2].x,s=t[3].y-t[2].y,a=t[0].x-t[3].x,l=t[0].y-t[3].y,u=e*o-n*i,c=n*s-r*o,h=r*l-a*s,d=a*i-e*l;return u>0&&c>0&&h>0&&d>0||u<0&&c<0&&h<0&&d<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=Cp(this.tileID,this.map.transform.projection),[o,r,s,a]=this.coordinates.map((t=>{const e=n.projection.project(t[0],t[1]);return wp(n,e)._round()}));this.perspectiveTransform=ym(o.x,o.y,r.x,r.y,s.x,s.y,a.x,a.y);const l=this._boundsArray=new bs;l.emplaceBack(o.x,o.y,0,0),l.emplaceBack(r.x,r.y,Yi,0),l.emplaceBack(a.x,a.y,0,Yi),l.emplaceBack(s.x,s.y,Yi,Yi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(l,hm.members),this.boundsSegments=fa.simpleSegment(0,0,4,2);const u=[],c=[_m((h=this.coordinates)[0]),_m(h[1]),_m(h[2]),_m(h[3])];var h;const[d,f,p,m]=function(t){let e=t[0][0],i=e,n=t[0][1],o=n;for(let r=1;r<t.length;r++)t[r][0]<e?e=t[r][0]:t[r][0]>i&&(i=t[r][0]),t[r][1]<n?n=t[r][1]:t[r][1]>o&&(o=t[r][1]);return[e,n,i-e,o-n]}(c);{const n=new bs,[o,r,s,a]=function(t){let e=t[0].x,i=e,n=t[0].y,o=n;for(let r=1;r<t.length;r++)t[r].x<e?e=t[r].x:t[r].x>i&&(i=t[r].x),t[r].y<n?n=t[r].y:t[r].y>o&&(o=t[r].y);return[e,n,i-e,o-n]}(i),l=t=>[(t.x-o)/s,(t.y-r)/a],[c,h,g,y]=i.map(l),_=function(t,e,i,n,o,r,s,a){const l=gm(0,0,1,0,1,1,0,1),u=gm(t,e,i,n,o,r,s,a),c=F.mat3.adjoint([],u);return F.mat3.multiply(l,l,c)}(c[0],c[1],h[0],h[1],g[0],g[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=ym(c[0],c[1],h[0],h[1],g[0],g[1],y[0],y[1]);const v=(t,e)=>{u.push(t.lng);const i=Math.round((t.lng-d)/p*Yi),o=Math.round((t.lat-f)/m*Yi),r=l(e),s=F.vec3.transformMat3([],[r[0],r[1],1],_),a=Math.round(s[0]/s[2]*Yi),c=Math.round(s[1]/s[2]*Yi);n.emplaceBack(i,o,a,c)},x=i[3].x-i[0].x,b=i[3].y-i[0].y,C=i[2].x-i[1].x,w=i[2].y-i[1].y;for(let t=0;t<65;t++){const n=t/64,o=[i[0].x+n*x,i[0].y+n*b],r=[i[1].x+n*C,i[1].y+n*w],s=r[0]-o[0],a=r[1]-o[1];for(let t=0;t<65;t++){const i=t/64,n={x:o[0]+s*i,y:o[1]+a*i,z:0};v(e.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,hm.members)}{this.maxLongitudeTriangleSize=0;let e=[],i=new Os;const n=(t,n,o)=>{i.emplaceBack(t,n,o);const r=u[t],s=u[n],a=u[o],l=Math.min(Math.min(r,s),a),c=Math.max(Math.max(r,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,o=i+1,r=i+65,s=r+1;n(i,r,o),n(o,r,s)}[e,i]=function(t,e){const i=Array.from({length:t.length},((t,e)=>e));i.sort(((e,i)=>t[e]-t[i]));const n=[],o=new Os;for(let r=0;r<i.length;r++){const s=i[r];n.push(t[s]);const a=3*s,l=a+1;o.emplaceBack(e.uint16[a],e.uint16[l],e.uint16[l+1])}return[n,o]}(e,i),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(i)}this.elevatedGlobeSegments=fa.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,p/Yi,0,m/Yi,0,0,f,d,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,i=e.gl;!this._dirty||this.texture instanceof mm||(this.texture?this.texture.update(this.image):(this.texture=new pm(e,this.image,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let n=(o=t+180)+360*Math.round((i[0]-o)/360);var o;const r=new fa,s=(t,i)=>{r.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-n)<=a){const t=Ct(i,0,i.length,n+a);return t===i.length||s(t,bt(i,t+1,i.length,n+360-a)-t),r}n<i[0]&&(n+=360);const l=bt(i,0,i.length,n-a);if(l===i.length)return s(0,i.length),r;s(0,l-0);const u=Ct(i,l+1,i.length,n+a);return u!==i.length&&s(u,i.length-u),r}}const xm=(Math.pow(256,2)-1)/16907520;class bm extends fs{constructor(t,e,i,n){super(t,{layout:um||(um=new qr({visibility:new jr(Zr.layout_raster.visibility)})),paint:cm||(cm=new qr({"raster-opacity":new jr(Zr.paint_raster["raster-opacity"]),"raster-color":new Wr(Zr.paint_raster["raster-color"]),"raster-color-mix":new jr(Zr.paint_raster["raster-color-mix"]),"raster-color-range":new jr(Zr.paint_raster["raster-color-range"]),"raster-hue-rotate":new jr(Zr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jr(Zr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jr(Zr.paint_raster["raster-brightness-max"]),"raster-saturation":new jr(Zr.paint_raster["raster-saturation"]),"raster-contrast":new jr(Zr.paint_raster["raster-contrast"]),"raster-resampling":new jr(Zr.paint_raster["raster-resampling"]),"raster-fade-duration":new jr(Zr.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new jr(Zr.paint_raster["raster-emissive-strength"]),"raster-array-band":new jr(Zr.paint_raster["raster-array-band"]),"raster-elevation":new jr(Zr.paint_raster["raster-elevation"]),"raster-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof vm&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[i,n]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(n)||i===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=lc({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,n])}}let Cm,wm,Sm,Tm,Am;class Mm extends fs{constructor(t,e,i,n){super(t,{layout:Cm||(Cm=new qr({visibility:new jr(Zr["layout_raster-particle"].visibility)})),paint:wm||(wm=new qr({"raster-particle-array-band":new jr(Zr["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new jr(Zr["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Wr(Zr["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new jr(Zr["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new jr(Zr["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new jr(Zr["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new jr(Zr["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new jr(Zr["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this._updateColorRamp(),this.lastInvalidatedAt=Lt.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=lc({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Lt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Im extends fs{constructor(t,e){super(t,{},e,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Em(t,e,i){const n=[0,0,1],o=F.quat.identity([]);return F.quat.rotateY(o,o,i?-Z(t)+Math.PI:Z(t)),F.quat.rotateX(o,o,-Z(e)),F.vec3.transformQuat(n,n,o),F.vec3.normalize(n,n)}function Pm(t,e){const i=Bm(t.projection,t.zoom,t.width,t.height),n=function(t,e,i,n,o){const r=new ol(i.lng-180*Dm,i.lat),s=new ol(i.lng+180*Dm,i.lat),a=t.project(r.lng,r.lat),l=t.project(s.lng,s.lat),u=-Math.atan2(l.y-a.y,l.x-a.x),c=xl.fromLngLat(i);c.y=Q(c.y,-1+Dm,1-Dm);const h=c.toLngLat(),d=t.project(h.lng,h.lat),f=xl.fromLngLat(h);f.x+=Dm;const p=f.toLngLat(),m=t.project(p.lng,p.lat),g=Lm(m.x-d.x,m.y-d.y,u),y=xl.fromLngLat(h);y.y+=Dm;const _=y.toLngLat(),v=t.project(_.lng,_.lat),x=Lm(v.x-d.x,v.y-d.y,u),b=Math.abs(g.x)/Math.abs(x.y),C=F.mat4.identity([]);F.mat4.rotateZ(C,C,-u*(1-(o?0:n)));const w=F.mat4.identity([]);return F.mat4.scale(w,w,[1,1-(1-b)*n,1]),w[4]=-x.x/x.y*n,F.mat4.rotateZ(w,w,u),F.mat4.multiply(w,C,w),w}(t.projection,0,t.center,i,e),o=km(t);return F.mat4.scale(n,n,[o,o,1]),n}function km(t){const e=t.projection,i=Bm(t.projection,t.zoom,t.width,t.height),n=Rm(e,t.center),o=Rm(e,ol.convert(e.center));return Math.pow(2,n*i+(1-i)*o)}function Bm(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const r=t.range;if(!r)return 0;const s=Math.min(o,Math.max(i,n)),a=Math.log(s/1024)/Math.LN2;return tt(r[0]+a,r[1]+a,e)}const Dm=1/4e4;function Rm(t,e){const i=Q(e.lat,-ml,ml),n=new ol(e.lng-180*Dm,i),o=new ol(e.lng+180*Dm,i),r=t.project(n.lng,i),s=t.project(o.lng,i),a=xl.fromLngLat(n),l=xl.fromLngLat(o),u=s.x-r.x,c=s.y-r.y,h=l.x-a.x,d=l.y-a.y,f=Math.sqrt((h*h+d*d)/(u*u+c*c));return Math.log(f)/Math.LN2}function Lm(t,e,i){const n=Math.cos(i),o=Math.sin(i);return{x:t*n-e*o,y:t*o+e*n}}function zm(t,e,i){F.mat4.identity(t),F.mat4.rotateZ(t,t,Z(e[2])),F.mat4.rotateX(t,t,Z(e[0])),F.mat4.rotateY(t,t,Z(e[1])),F.mat4.scale(t,t,i),F.mat4.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Om(t,e,i,n,o,r,s,a){const l=[i[0]-e[0],i[1]-e[1],0],u=[n[0]-e[0],n[1]-e[1],0];if(F.vec3.length(l)<1e-12||F.vec3.length(u)<1e-12)return F.quat.identity(t);const c=F.vec3.cross([],l,u);F.vec3.normalize(c,c),F.vec3.subtract(u,n,e),l[2]=(r-o)*a,u[2]=(s-o)*a;const h=l;return F.vec3.cross(h,l,u),F.vec3.normalize(h,h),F.quat.rotationTo(t,c,h)}function Um(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Uu(e.zoom),o=function(t,e,i){const n=e.worldSize,o=[t[12],t[13],t[14]],r=fl(o[1]/n),s=dl(o[0]/n),a=F.mat4.identity([]),l=hl(1,r)*n,u=hl(1,0)*n*yl(r,e.zoom),c=1/Lu(n);let h=u*c;if(i){const t=Bm(e.projection,e.zoom,e.width,e.height,1024);h=c*e.projection.pixelSpaceConversion(e.center.lat,n,t)}const d=el(r,s);F.vec3.add(d,d,F.vec3.scale([],F.vec3.normalize([],d),l*h*o[2]));const f=function(t){const e=[t[0],t[1],t[2]];let i=[0,1,0];const n=F.vec3.cross([],i,e);return F.vec3.cross(i,e,n),0===F.vec3.squaredLength(i)&&(i=[0,1,0],F.vec3.cross(n,e,i)),F.vec3.normalize(n,n),F.vec3.normalize(i,i),F.vec3.normalize(e,e),[n[0],n[1],n[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],0,t[0],t[1],t[2],1]}(d);F.mat4.scale(a,a,[h,h,h*l]),F.mat4.translate(a,a,[-o[0],-o[1],-o[2]]);const p=F.mat4.multiply([],e.globeMatrix,f);return F.mat4.multiply(p,p,a),F.mat4.multiply(p,p,t),p}(t,e,i);if(n>0){const i=function(t,e){const i=e.worldSize,n=hl(1,0)*i*yl(e.center.lat,e.zoom)/Lu(i),o=hl(1,e.center.lat)*i,r=F.mat4.identity([]);return F.mat4.rotateY(r,r,Z(e.center.lng)),F.mat4.rotateX(r,r,Z(e.center.lat)),F.mat4.translate(r,r,[0,0,qa]),F.mat4.scale(r,r,[n,n,n*o]),F.mat4.translate(r,r,[e.point.x-.5*i,e.point.y-.5*i,0]),F.mat4.multiply(r,r,t),F.mat4.multiply(r,e.globeMatrix,r)}(t,e);return function(t,e,i){const n=(t,e,i)=>{const n=F.vec3.length(t),o=F.vec3.length(e),r=Tu(t,e,i);return F.vec3.scale(r,r,1/F.vec3.length(r)*Ie(n,o,i))},o=n([t[0],t[1],t[2]],[e[0],e[1],e[2]],i),r=n([t[4],t[5],t[6]],[e[4],e[5],e[6]],i),s=n([t[8],t[9],t[10]],[e[8],e[9],e[10]],i),a=Tu([t[12],t[13],t[14]],[e[12],e[13],e[14]],i);return[o[0],o[1],o[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(o,i,n)}return o}function Fm(t,e,i,n){const o=_u.projectAabbCorners(n,i);let r=Number.MAX_VALUE,s=-1;for(let u=0;u<o.length;++u){const t=o[u];t[0]=(.5*t[0]+.5)*e.width,t[1]=(.5-.5*t[1])*e.height,t[2]<r&&(s=u,r=t[2])}const a=t=>new j(o[t][0],o[t][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Dl(t,l))return r}const Nm=ys([{name:"a_pos_3f",components:3,type:"Float32"}]),Vm=ys([{name:"a_color_3f",components:3,type:"Float32"}]),Hm=ys([{name:"a_color_4f",components:4,type:"Float32"}]),jm=ys([{name:"a_uv_2f",components:2,type:"Float32"}]),Gm=ys([{name:"a_normal_3f",components:3,type:"Float32"}]),Wm=ys([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qm=ys([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Zm={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class $m{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function Km(t,e){const i=-1===t.indexOf("://");try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch(t){return!1}}class Ym{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Jm{constructor(){this.instancedDataArray=new $s,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Xm{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,e){}populate(t,e,i,n){this.tileToMeter=vl(i);const o=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:r,id:s,index:a,sourceLayerIndex:l}of t){const t=null!=s?s:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0,u=El(r,o);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),u,i))continue;const c={id:t,sourceLayerIndex:l,index:a,geometry:o?u.geometry:Il(r,i,n),properties:r.properties,type:r.type,patterns:{}},h=this.addFeature(c,c.geometry,u);h&&e.featureIndex.insert(r,c.geometry,a,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Yi/32)}this.lookup=null}update(t,e,i,n){for(const o in this.instancesPerModel){const e=this.instancesPerModel[o];for(const i in t)e.idToFeaturesIndex.hasOwnProperty(i)&&(this.evaluate(e.features[e.idToFeaturesIndex[i]],t[i],e,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e of i.features){const n=this.layers[0],o=e.feature,r=this.canonical,s=n.paint.get("model-rotation").evaluate(o,{},r),a=n.paint.get("model-scale").evaluate(o,{},r),l=n.paint.get("model-translation").evaluate(o,{},r);F.vec3.exactEquals(e.rotation,s)&&F.vec3.exactEquals(e.scale,a)&&F.vec3.exactEquals(e.translation,l)||(this.evaluate(e,e.featureStates,i,!0),t=!0)}}return t}updateReplacement(t,e,i,n){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const o=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Sh(this.activeReplacements,o))return!1;this.activeReplacements=o;let r=!1;for(const s in this.instancesPerModel){const e=this.instancesPerModel[s],o=e.instancedDataArray;for(const s of e.features){const e=s.instancedDataOffset,a=s.instancedDataCount;for(let s=0;s<a;s++){const a=16*(s+e);let l=o.float32[a+0];const u=l>Yi;l=u?l-Yi:l;const c=Math.floor(l),h=o.float32[a+1];let d=!1;for(const e of this.activeReplacements)if(!xh(e,i,Zm.Model,n)&&!(e.min.x>c||c>e.max.x||e.min.y>h||h>e.max.y)&&(d=Ph(Eh(c,h,t.canonical,e.footprintTileId.canonical),e.footprint),d))break;o.float32[a]=d?l+Yi:l,r=r||d!==u}}}return r}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,Wm.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const e of this.modelUris)t.removeModel(e,"")}addFeature(t,e,i){const n=this.layers[0],o=n.layout.get("model-id").evaluate(i,{},this.canonical);if(!o)return ft(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),o;Km(o,!1)&&(this.modelUris.includes(o)||this.modelUris.push(o)),this.instancesPerModel[o]||(this.instancesPerModel[o]=new Jm);const r=this.instancesPerModel[o],s=r.instancedDataArray,a=new Ym(i,s.length);for(const l of e)for(const t of l){if(t.x<0||t.x>=Yi||t.y<0||t.y>=Yi)continue;const e=(this.lookupDim-1)/Yi,i=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const n=s.length;s.resize(n+1),r.instancesEvaluatedElevation.push(0),s.float32[16*n]=t.x,s.float32[16*n+1]=t.y}return a.instancedDataCount=r.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(r.idToFeaturesIndex[t.id]=r.features.length),r.features.push(a),this.evaluate(a,{},r,!1)),o}getModelUris(){return this.modelUris}evaluate(t,e,i,n){const o=this.layers[0],r=t.feature,s=this.canonical,a=t.rotation=o.paint.get("model-rotation").evaluate(r,e,s),l=t.scale=o.paint.get("model-scale").evaluate(r,e,s),u=t.translation=o.paint.get("model-translation").evaluate(r,e,s),c=o.paint.get("model-color").evaluate(r,e,s);c.a=o.paint.get("model-color-mix-intensity").evaluate(r,e,s);const h=[];this.maxVerticalOffset<u[2]&&(this.maxVerticalOffset=u[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),zm(h,a,l);const d=Math.round(100*c.a)+c.b/1.05;for(let f=0;f<t.instancedDataCount;++f){const e=t.instancedDataOffset+f,o=16*e,r=i.instancedDataArray.float32;let a=0;n&&(a=r[o+6]-i.instancesEvaluatedElevation[e]);const l=0|r[o+1];r[o]=(0|r[o])+c.r/1.05,r[o+1]=l+c.g/1.05,r[o+2]=d,r[o+3]=1/(s.z>10?this.tileToMeter:vl(s,l)),r[o+4]=u[0],r[o+5]=u[1],r[o+6]=u[2]+a,r[o+7]=h[0],r[o+8]=h[1],r[o+9]=h[2],r[o+10]=h[4],r[o+11]=h[5],r[o+12]=h[6],r[o+13]=h[8],r[o+14]=h[9],r[o+15]=h[10],i.instancesEvaluatedElevation[e]=u[2]}}}let Qm,tg;lr(Xm,"ModelBucket",{omit:["layers"]}),lr(Jm,"PerModelAttributes"),lr(Ym,"ModelFeature");const eg=64,ig={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function ng(t,e,i,n,o,r,s,a,l){let u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const c=i.zoom,h=i.project(n),d=yl(n.lat,c),f=1/d;F.mat4.identity(t),F.mat4.translate(t,t,[h.x+s[0]*f,h.y+s[1]*f,s[2]]);let p=1,m=1;const g=i.worldSize;if(u){if("mercator"===i.projection.name){let t=0;i.elevation&&(t=i.elevation.getAtPointOrZero(new xl(h.x/g,h.y/g),0));const e=F.vec4.transformMat4([],[h.x,h.y,t,1],i.projMatrix)[3]/i.cameraToCenterDistance;p=e,m=e*yl(i.center.lat,c)}else if("globe"===i.projection.name){const e=Um(t,i),o=F.mat4.multiply([],i.projMatrix,e),r=[0,0,0,1];F.vec4.transformMat4(r,r,o);const s=r[3]/i.cameraToCenterDistance,a=Uu(c),l=i.projection.pixelsPerMeter(n.lat,g)*yl(n.lat,c),u=i.projection.pixelsPerMeter(i.center.lat,g)*yl(i.center.lat,c);p=s/Ie(l,gl(i.center.lat),a),m=s*d/l,p*=u,m*=u}}else p=f;F.mat4.scale(t,t,[p,p,m]);const y=[...t],_=e.orientation,v=[];if(zm(v,[_[0]+o[0],_[1]+o[1],_[2]+o[2]],r),F.mat4.multiply(t,y,v),a&&i.elevation){let o=0;const r=[];if(l&&i.elevation){o=function(t,e,i,n,o){const r=e.elevation;if(!r)return 0;const s=_u.projectAabbCorners(i,n),a=hl(1,o.lat)*e.worldSize,l=function(t,e){const i=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of n){const n=t[o.corners[0]],r=t[o.corners[1]],s=t[o.corners[2]],a=[r[0]-n[0],r[1]-n[1],e*(r[2]-n[2])],l=F.vec3.cross(a,a,[s[0]-n[0],s[1]-n[1],e*(s[2]-n[2])]);F.vec3.normalize(l,l),o.dotProductWithUp=F.vec3.dot(l,i)}return n.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),n[0].corners}(s,a),u=s[l[0]],c=s[l[1]],h=s[l[2]],d=s[l[3]],f=r.getAtPointOrZero(new xl(u[0]/e.worldSize,u[1]/e.worldSize),0),p=r.getAtPointOrZero(new xl(c[0]/e.worldSize,c[1]/e.worldSize),0),m=r.getAtPointOrZero(new xl(h[0]/e.worldSize,h[1]/e.worldSize),0),g=r.getAtPointOrZero(new xl(d[0]/e.worldSize,d[1]/e.worldSize),0),y=(f+g)/2,_=(p+m)/2;return y>_?p<m?Om(t,c,d,u,p,g,f,a):Om(t,h,u,d,m,f,g,a):f<g?Om(t,u,c,h,f,p,m,a):Om(t,d,h,c,g,m,p,a),Math.max(y,_)}(r,i,e.aabb,t,n);const s=F.mat4.fromQuat([],r),a=F.mat4.multiply([],s,v);F.mat4.multiply(t,y,a)}else o=i.elevation.getAtPointOrZero(new xl(h.x/g,h.y/g),0);0!==o&&(t[14]+=o)}}function og(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.uploaded||(t.gfxTexture=new pm(e,t.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function rg(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Nm.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Gm.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,jm.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?Vm:Hm).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,qm.members,!0)),t.segments=fa.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&og(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&og(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&og(n.normalTexture,e),n.occlusionTexture&&og(n.occlusionTexture,e,i),n.emissionTexture&&og(n.emissionTexture,e)}function sg(t,e,i){if(t.meshes)for(const n of t.meshes)rg(n,e,i);if(t.children)for(const n of t.children)sg(n,e,i)}function ag(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)ag(e)}function lg(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)lg(i)}class ug{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const n=i||t.findDEMTileFor(e);if(!n||!n.dem)return;const o=n.dem,r=n.tileID,s=1<<e.canonical.z-r.canonical.z;return new ug(n,o.dim/Yi/s,[(e.canonical.x/s-r.canonical.x)*o.dim,(e.canonical.y/s-r.canonical.y)*o.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(i);return new j(n,o)}getElevationAt(t,e,i,n){const o=t*this._scale+this._offset[0],r=e*this._scale+this._offset[1],s=Math.floor(o),a=Math.floor(r),l=this._dem;return n=!!n,i?Ie(Ie(l.get(s,a,n),l.get(s,a+1,n),r-a),Ie(l.get(s+1,a,n),l.get(s+1,a+1,n),r-a),o-s):l.get(s,a,n)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*hl(1,t)*this._dem.stride}}const cg=new Float32Array(262144),hg=new Uint8Array(262144);function dg(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,dg(i));return e}function fg(t,e,i){if(t.meshes)for(const n of t.meshes){if(n.aabb.min[0]===1/0)continue;const o=_u.applyTransform(n.aabb,t.matrix);i.insert(e,o.min[0],o.min[1],o.max[0],o.max[1])}if(t.children)for(const n of t.children)fg(n,e,i)}const pg=["","wall","door","roof","window","lamp","logo"];class mg{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:dg(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new _u([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new _u([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==t&&(i.transformedAabb=_u.applyTransformFast(i.aabb,this.node.matrix),e.encapsulate(i.transformedAabb)),t++;this.aabb=e}return this.aabb}}class gg{constructor(t,e,i,n,o,r,s){this.id=i,this.layers=t,this.layerIds=this.layers.map((t=>t.fqid)),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.modelTraits|=ig.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=ig.HasMapboxMeshFeatures),o&&(this.modelTraits|=ig.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const a of e)this.nodesInfo.push(new mg(a)),fg(a,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,e){for(const i of this.getNodesInfo()){const n=i.node;n.footprint&&e.push({footprint:n.footprint,id:t})}}update(t){const e=0!==Object.keys(t).length;if(e&&!this.stateDependentLayers.length)return;const i=e?this.stateDependentLayers:this.layers;if(!G(t,this.states))for(const n of i)this.evaluate(n,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const i of e){const e=i.node;this.uploaded?this.updatePbrBuffer(e):sg(e,t,!0)}for(const i of e)ag(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),e=!0);return e}needsReEvaluation(t,e,i){const n=t.transform.projectionOptions,o=t.style.getBrightness(),r=this.brightness!==o;if(!this.uploaded||this.dirty||n.name!==this.projection.name||yg(i.paint.get("model-color").value,r)||yg(i.paint.get("model-color-mix-intensity").value,r)||yg(i.paint.get("model-roughness").value,r)||yg(i.paint.get("model-emissive-strength").value,r)||yg(i.paint.get("model-height-based-emissive-strength-multiplier").value,r)){this.projection=n,this.brightness=o;const t=this.getNodesInfo();for(const e of t)e.state=null;return!0}return!1}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),n=this.id.canonical;for(const o of i){const t=o.feature;o.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},n)}}evaluate(t,e){const i=this.getNodesInfo();for(const n of i){if(!n.node.meshes)continue;const i=n.feature,o=e&&e[i.id];if(G(o,n.state))continue;n.state=structuredClone(o);const r=n.node.meshes&&n.node.meshes[0].featureData,s=n.evaluatedColor[2],a=n.evaluatedRMEA[2],l=this.id.canonical;if(n.hasTranslucentParts=!1,r){for(let e=0;e<pg.length;e++){const r=pg[e];r.length&&(i.properties.part=r);const s=t.paint.get("model-color").evaluate(i,o,l).toRenderColor(null),a=t.paint.get("model-color-mix-intensity").evaluate(i,o,l);n.evaluatedColor[e]=[s.r,s.g,s.b,a],n.evaluatedRMEA[e][0]=t.paint.get("model-roughness").evaluate(i,o,l),n.evaluatedRMEA[e][2]=t.paint.get("model-emissive-strength").evaluate(i,o,l),n.evaluatedRMEA[e][3]=s.a,n.emissionHeightBasedParams[e]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(i,o,l),!n.hasTranslucentParts&&s.a<1&&(n.hasTranslucentParts=!0)}delete i.properties.part,vg(n,s!==n.evaluatedColor[2]||a!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(i,o,l);n.evaluatedScale=t.paint.get("model-scale").evaluate(i,o,l),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,i,n){const o=t.findDEMTileFor(i);if(o&&(o.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(o.dem&&o.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=o.tileID.overscaledZ;const e=ug.create(t,i,o);if(!e)return;this.modelTraits&ig.HasMapboxMeshFeatures&&this.updateDEM(t,e,i,n);for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const n=i.footprint.vertices;let o=e.getElevationAt(n[0].x,n[0].y,!0,!0);for(let t=1;t<n.length;t++)o=Math.min(o,e.getElevationAt(n[t].x,n[t].y,!0,!0));i.elevation=o}}this.terrainTile=o.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,i,n){let o=e._dem._modifiedForSources[n];if(void 0===o&&(e._dem._modifiedForSources[n]=[],o=e._dem._modifiedForSources[n]),o.includes(i.canonical))return;const r=e._dem.dim;o.push(i.canonical);let s=!1;for(const a of this.getNodesInfo()){const t=a.node;if(!t.footprint||!t.footprint.grid)continue;const i=t.footprint.grid,n=e.tileCoordToPixel(i.min.x,i.min.y),o=e.tileCoordToPixel(i.max.x,i.max.y),l=Math.min(Math.min(r-o.y,n.x),Math.min(n.y,r-o.x));if(l<0)continue;const u=Q(l,2,5);let c=Math.max(0,n.x-u),h=Math.max(0,n.y-u),d=Math.min(o.x+u,r-1),f=Math.min(o.y+u,r-1);for(let e=h;e<=f;++e)for(let t=c;t<=d;++t)hg[e*r+t]=255;let p=0,m=0;for(let s=0;s<i.cellsY;++s)for(let t=0;t<i.cellsX;++t){if(!i.cells[s*i.cellsX+t])continue;const n=e.tileCoordToPixel(i.min.x+t/i.xScale,i.min.y+s/i.yScale),o=e.tileCoordToPixel(i.min.x+(t+1)/i.xScale,i.min.y+(s+1)/i.yScale);for(let t=n.y;t<=Math.min(o.y+1,r-1);++t)for(let i=n.x;i<=Math.min(o.x+1,r-1);++i)255===hg[t*r+i]&&(hg[t*r+i]=0,p+=e.getElevationAtPixel(i,t),m++)}const g=p/m;c=Math.max(1,n.x-u),h=Math.max(1,n.y-u),d=Math.min(o.x+u,r-2),f=Math.min(o.y+u,r-2),s=!0;for(let s=h;s<=f;++s)for(let t=c;t<=d;++t)0===hg[s*r+t]&&(cg[s*r+t]=e._dem.set(t,s,g));for(let s=1;s<u;++s){c=Math.max(1,n.x-s),h=Math.max(1,n.y-s),d=Math.min(o.x+s,r-2),f=Math.min(o.y+s,r-2);for(let t=h;t<=f;++t)for(let i=c;i<=d;++i){const n=t*r+i;if(255===hg[n]){let o=0,a=0,l=-1,c=-1;for(let e=-1;e<=1;++e)for(let n=-1;n<=1;++n){const u=(t+e)*r+i+n;if(hg[u]>=s)continue;const h=cg[u],d=Math.abs(h);d>a&&(o=h,a=d,l=n,c=e)}if(a>.1){const r=1-(s+.5*Math.abs(l*c))/u;let a=e._dem.get(i,t)+o*r;const h=e._dem.get(i+l,t+c),d=e._dem.get(i-l,t-c,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),cg[n]=e._dem.set(i,t,a),hg[n]=s}}}}}s&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=Lt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)ag(e.node),lg(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped()),n=this.getNodesInfo();for(let o=0;o<this.nodesInfo.length;o++){const t=n[o].node;n[o].hiddenByReplacement=!!t.footprint&&!i.find((e=>e.footprint===t.footprint))}}getHeightAtTileCoord(t,e){const i=this.getNodesInfo(),n=[],o=[0,0,0],r=F.mat4.identity([]);for(let s=0;s<this.nodesInfo.length;s++){const a=i[s],l=a.node.meshes[0],u=l.transformedAabb;if(t<u.min[0]||e<u.min[1]||t>u.max[0]||e>u.max[1])continue;if(!0===a.node.hidden)return{height:1/0,maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]};F.mat4.invert(r,a.node.matrix),o[0]=t,o[1]=e,F.vec3.transformMat4(o,o,r);const c=(o[0]-l.aabb.min[0])/(l.aabb.max[0]-l.aabb.min[0])*eg|0,h=Math.min(63,(o[1]-l.aabb.min[1])/(l.aabb.max[1]-l.aabb.min[1])*eg|0)*eg+Math.min(63,c),d=l.heightmap[h];if(!(d<0&&a.node.footprint)){if(a.hiddenByReplacement)return;return{height:d,maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]}}if(a.node.footprint.grid.query(new j(t,e),new j(t,e),n),n.length>0)return{height:void 0,maxHeight:a.feature.properties.height,hidden:a.hiddenByReplacement,verticalScale:a.evaluatedScale[2]}}}}function yg(t,e){return!t.isLightConstant&&e}function _g(t,e,i,n,o,r,s,a){let l=(61440&e|(61440&e)>>4)>>8,u=(3840&e|(3840&e)>>4)>>4,c=240&e|(240&e)>>4;i[3]>0&&(l=Ie(l,255*i[0],i[3]),u=Ie(u,255*i[1],i[3]),c=Ie(c,255*i[2],i[3]));const h=l<<8|u,d=c<<8|Math.floor(255*n[3]),f=function(t){const e=Q(t,0,2);return Math.min(Math.round(.5*e*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],p=Q(o[0],0,1),m=Q(o[1],0,1),g=Q(o[2],0,1),y=Q(o[3],0,1);let _,v,x,b;if(p!==m&&s!==r&&m!==p){const t=s-r;v=1/(t*(m-p)),x=-(r+t*p)/(t*(m-p));const e=Q(o[4],-1,1);b=Math.pow(10,e),_=255*g<<8|255*y}else _=65535,v=0,x=1,b=1;if(t.emplaceBack(h,d,f,_,v,x,b),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(h,d,f,_,v,x,b)}}function vg(t,e,i){const n=t.node;let o=0;const r=i&ig.HasMeshoptCompression;for(const s of n.meshes){if(n.lights&&n.lightMeshIndex===o)continue;if(!s.featureData)continue;s.featureArray=new Ks,s.featureArray.reserve(s.featureData.length);let i=e;for(const e of s.featureData){const o=r?65535&e:e>>16&65535,a=r?e>>16&65535:65535&e,l=(15&a)<8?15&a:0,u=t.evaluatedRMEA[l],c=t.evaluatedColor[l],h=t.emissionHeightBasedParams[l];let d;if(i&&2===l&&n.lights&&(d=new Ks,d.resize(10*n.lights.length)),_g(s.featureArray,o,c,u,h,s.aabb.min[2],s.aabb.max[2],d),d&&i){i=!1;const t=n.meshes[n.lightMeshIndex];t.featureArray=d,t.featureArray._trim()}}s.featureArray._trim(),o++}}function xg(t,e,i,n){const o=1<<t.z;e.lat=fl((n/Yi+t.y)/o),e.lng=dl((i/Yi+t.x)/o)}lr(gg,"Tiled3dModelBucket",{omit:["layers"]}),lr(mg,"Tiled3dModelFeature");const bg={circle:class extends fs{constructor(t,e,i,n){super(t,{layout:Jl||(Jl=new qr({"circle-sort-key":new Gr(Zr.layout_circle["circle-sort-key"]),"circle-elevation-reference":new jr(Zr.layout_circle["circle-elevation-reference"]),visibility:new jr(Zr.layout_circle.visibility)})),paint:Xl||(Xl=new qr({"circle-radius":new Gr(Zr.paint_circle["circle-radius"]),"circle-color":new Gr(Zr.paint_circle["circle-color"]),"circle-blur":new Gr(Zr.paint_circle["circle-blur"]),"circle-opacity":new Gr(Zr.paint_circle["circle-opacity"]),"circle-translate":new jr(Zr.paint_circle["circle-translate"]),"circle-translate-anchor":new jr(Zr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jr(Zr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jr(Zr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gr(Zr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gr(Zr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gr(Zr.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new jr(Zr.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n)}createBucket(t){return new Bl(t)}queryRadius(t){const e=t;return Zl("circle-radius",this,e)+Zl("circle-stroke-width",this,e)+$l(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,o,r,s,a){const l=Yl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return qu(t,n,r,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,i){const n=Wu(this);return{config:new Fa(this,{zoom:e,lut:i}),defines:n,overrideFog:!1}}},heatmap:class extends fs{createBucket(t){return new Ju(t)}constructor(t,e,i,n){super(t,{layout:Xu||(Xu=new qr({visibility:new jr(Zr.layout_heatmap.visibility)})),paint:Qu||(Qu=new qr({"heatmap-radius":new Gr(Zr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gr(Zr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jr(Zr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wr(Zr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jr(Zr.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Zl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,o,r,s,a){const l=this.paint.get("heatmap-radius").evaluate(e,i);return qu(t,n,r,s,a,!0,!0,new j(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,i){return"heatmap"===t?{config:new Fa(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends fs{constructor(t,e,i,n){super(t,{layout:tc||(tc=new qr({visibility:new jr(Zr.layout_hillshade.visibility)})),paint:ec||(ec=new qr({"hillshade-illumination-direction":new jr(Zr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jr(Zr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jr(Zr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jr(Zr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jr(Zr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jr(Zr.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new jr(Zr.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},fill:class extends fs{constructor(t,e,i,n){super(t,{layout:Hc||(Hc=new qr({"fill-sort-key":new Gr(Zr.layout_fill["fill-sort-key"]),visibility:new jr(Zr.layout_fill.visibility),"fill-elevation-reference":new jr(Zr.layout_fill["fill-elevation-reference"])})),paint:jc||(jc=new qr({"fill-antialias":new jr(Zr.paint_fill["fill-antialias"]),"fill-opacity":new Gr(Zr.paint_fill["fill-opacity"]),"fill-color":new Gr(Zr.paint_fill["fill-color"]),"fill-outline-color":new Gr(Zr.paint_fill["fill-outline-color"]),"fill-translate":new jr(Zr.paint_fill["fill-translate"]),"fill-translate-anchor":new jr(Zr.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gr(Zr.paint_fill["fill-pattern"]),"fill-emissive-strength":new jr(Zr.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gr(Zr.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e,i){return{config:new Fa(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vc(t)}queryRadius(){return $l(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,o,r){return!t.queryGeometry.isAboveHorizon&&Ll(Kl(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}is3D(){return 0!==this.paint.get("fill-z-offset").constantOr(1)}},"fill-extrusion":class extends fs{constructor(t,e,i,n){super(t,{layout:ld||(ld=new qr({visibility:new jr(Zr["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new jr(Zr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ud||(ud=new qr({"fill-extrusion-opacity":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gr(Zr["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new jr(Zr["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Jh(t)}queryRadius(){return $l(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,n,o,r,s,a,l){const u=Yl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=[0,0],f=a&&r.elevation,p=r.elevation?r.elevation.exaggeration():1,m=t.tile.getBucket(this);if(f&&m instanceof Jh){const t=m.centroidVertexArray,e=l+1;e<t.length&&(d[0]=t.geta_centroid_pos0(e),d[1]=t.geta_centroid_pos1(e))}if(0===d[0]&&1===d[1])return!1;"globe"===r.projection.name&&(n=sd([n],[new j(0,0),new j(Yi,Yi)],t.tileID.canonical).map((t=>t.polygon)).flat());const g=f?a:null,[y,_]=function(t,e,i,n,o,r,s,a,l,u,c){return"globe"===t.projection.name?function(t,e,i,n,o,r,s,a,l,u,c){const h=[],d=[],f=t.projection.upVectorScale(c,t.center.lat,t.worldSize).metersToTile,p=[0,0,0,1],m=[0,0,0,1],g=(t,e,i,n)=>{t[0]=e,t[1]=i,t[2]=n,t[3]=1},y=rd();i>0&&(i+=y),n+=y;for(const _ of e){const e=[],y=[];for(const h of _){const d=h.x+o.x,_=h.y+o.y,v=t.projection.projectTilePoint(d,_,c),x=t.projection.upVector(c,h.x,h.y);let b=i,C=n;if(s){const t=dd(d,_,i,n,s,a,l,u);b+=t.base,C+=t.top}0!==i?g(p,v.x+x[0]*f*b,v.y+x[1]*f*b,v.z+x[2]*f*b):g(p,v.x,v.y,v.z),g(m,v.x+x[0]*f*C,v.y+x[1]*f*C,v.z+x[2]*f*C),F.vec3.transformMat4(p,p,r),F.vec3.transformMat4(m,m,r),e.push(new ph(p[0],p[1],p[2])),y.push(new ph(m[0],m[1],m[2]))}h.push(e),d.push(y)}return[h,d]}(t,e,i,n,o,r,s,a,l,u,c):s?function(t,e,i,n,o,r,s,a,l){const u=[],c=[],h=[0,0,0,1];for(const d of t){const t=[],f=[];for(const u of d){const c=u.x+n.x,d=u.y+n.y,p=dd(c,d,e,i,r,s,a,l);h[0]=c,h[1]=d,h[2]=p.base,h[3]=1,F.vec4.transformMat4(h,h,o),h[3]=Math.max(h[3],1e-5);const m=new ph(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=c,h[1]=d,h[2]=p.top,h[3]=1,F.vec4.transformMat4(h,h,o),h[3]=Math.max(h[3],1e-5);const g=new ph(h[0]/h[3],h[1]/h[3],h[2]/h[3]);t.push(m),f.push(g)}u.push(t),c.push(f)}return[u,c]}(e,i,n,o,r,s,a,l,u):function(t,e,i,n,o){const r=[],s=[],a=o[8]*e,l=o[9]*e,u=o[10]*e,c=o[11]*e,h=o[8]*i,d=o[9]*i,f=o[10]*i,p=o[11]*i;for(const m of t){const t=[],e=[];for(const i of m){const r=i.x+n.x,s=i.y+n.y,m=o[0]*r+o[4]*s+o[12],g=o[1]*r+o[5]*s+o[13],y=o[2]*r+o[6]*s+o[14],_=o[3]*r+o[7]*s+o[15],v=m+a,x=g+l,b=y+u,C=Math.max(_+c,1e-5),w=m+h,S=g+d,T=y+f,A=Math.max(_+p,1e-5);t.push(new ph(v/C,x/C,b/C)),e.push(new ph(w/A,S/A,T/A))}r.push(t),s.push(e)}return[r,s]}(e,i,n,o,r)}(r,n,h,c,u,s,g,d,p,r.center.lat,t.tileID.canonical),v=t.queryGeometry;return function(t,e,i){let n=1/0;Ll(i,e)&&(n=hd(i,e[0]));for(let o=0;o<e.length;o++){const r=e[o],s=t[o];for(let t=0;t<r.length-1;t++){const e=r[t],o=[e,r[t+1],s[t+1],s[t],e];Dl(i,o)&&(n=Math.min(n,hd(i,o)))}}return n!==1/0&&n}(y,_,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends fs{constructor(t,e,i,n){const o=Ld();super(t,o,e,i,n),o.layout&&(this.layout=new Hr(o.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Nn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=(()=>{if(Od)return Od;const t=Ld();return Od=new zd(t.paint.properties["line-width"].specification),Od.useIntegerZoom=!0,Od})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Sd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,i){const n=Bd(this);return{config:new Fa(this,{zoom:e,lut:i}),defines:n,overrideFog:!1}}queryRadius(t){const e=t,i=Ud(Zl("line-width",this,e),Zl("line-gap-width",this,e)),n=Zl("line-offset",this,e);return i/2+Math.abs(n)+$l(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,o,r){if(t.queryGeometry.isAboveHorizon)return!1;const s=Kl(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*Ud(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(n=function(t,e){const i=[],n=new j(0,0);for(let o=0;o<t.length;o++){const r=t[o],s=[];for(let t=0;t<r.length;t++){const i=r[t],o=r[t+1],a=0===t?n:i.sub(r[t-1])._unit()._perp(),l=t===r.length-1?n:o.sub(i)._unit()._perp(),u=a._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),s.push(u._mult(e)._add(i))}i.push(s)}return i}(n,l*t.pixelToTileUnitsFactor)),function(t,e,i){for(let n=0;n<e.length;n++){const o=e[n];if(t.length>=3)for(let e=0;e<o.length;e++)if(Hl(t,o[e]))return!0;if(zl(t,o,i))return!0}return!1}(s,n,a)}isTileClipped(){return!0}isDraped(t){return!this.hasElevatedBuckets}},symbol:sm,background:class extends fs{constructor(t,e,i,n){super(t,{layout:am||(am=new qr({visibility:new jr(Zr.layout_background.visibility)})),paint:lm||(lm=new qr({"background-pitch-alignment":new jr(Zr.paint_background["background-pitch-alignment"]),"background-color":new jr(Zr.paint_background["background-color"]),"background-pattern":new jr(Zr.paint_background["background-pattern"]),"background-opacity":new jr(Zr.paint_background["background-opacity"]),"background-emissive-strength":new jr(Zr.paint_background["background-emissive-strength"]),"background-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}is3D(){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:bm,"raster-particle":Mm,sky:class extends fs{constructor(t,e,i,n){super(t,{layout:Sm||(Sm=new qr({visibility:new jr(Zr.layout_sky.visibility)})),paint:Tm||(Tm=new qr({"sky-type":new jr(Zr.paint_sky["sky-type"]),"sky-atmosphere-sun":new jr(Zr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jr(Zr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jr(Zr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jr(Zr.paint_sky["sky-gradient-radius"]),"sky-gradient":new Wr(Zr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jr(Zr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jr(Zr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jr(Zr.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,o=t.style.light,r=o.properties.get("position");return n&&"viewport"===o.properties.get("anchor")&&ft("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Em(r.azimuthal,90-r.polar,e):Em(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return Em(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends fs{constructor(t,e,i,n){super(t,{paint:Am||(Am=new qr({}))},e,null)}},model:class extends fs{constructor(t,e,i,n){super(t,{layout:Qm||(Qm=new qr({visibility:new jr(Zr.layout_model.visibility),"model-id":new Gr(Zr.layout_model["model-id"])})),paint:tg||(tg=new qr({"model-opacity":new Gr(Zr.paint_model["model-opacity"]),"model-rotation":new Gr(Zr.paint_model["model-rotation"]),"model-scale":new Gr(Zr.paint_model["model-scale"]),"model-translation":new Gr(Zr.paint_model["model-translation"]),"model-color":new Gr(Zr.paint_model["model-color"]),"model-color-mix-intensity":new Gr(Zr.paint_model["model-color-mix-intensity"]),"model-type":new jr(Zr.paint_model["model-type"]),"model-cast-shadows":new jr(Zr.paint_model["model-cast-shadows"]),"model-receive-shadows":new jr(Zr.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new jr(Zr.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gr(Zr.paint_model["model-emissive-strength"]),"model-roughness":new Gr(Zr.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gr(Zr.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new jr(Zr.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new jr(Zr.paint_model["model-front-cutoff"]),"model-color-use-theme":new Gr({type:"string",default:"default","property-type":"data-driven"})}))},e,i,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Xm(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof gg?Yi-1:0}queryIntersectsFeature(t,e,i,n,o,r){if(!this.modelManager)return!1;const s=this.modelManager,a=t.tile.getBucket(this);if(!(a&&a instanceof Xm))return!1;for(const l in a.instancesPerModel){const i=a.instancesPerModel[l],n=void 0!==e.id?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(i.idToFeaturesIndex.hasOwnProperty(n)){const e=i.features[i.idToFeaturesIndex[n]],o=s.getModel(l,this.scope);if(!o)return!1;let u=F.mat4.create();const c=new ol(0,0),h=a.canonical;let d=Number.MAX_VALUE;for(let n=0;n<e.instancedDataCount;++n){const s=16*(e.instancedDataOffset+n),a=i.instancedDataArray.float32,l=[a[s+4],a[s+5],a[s+6]];xg(h,c,a[s],0|a[s+1]),ng(u,o,r,c,e.rotation,e.scale,l,!1,!1,!1),"globe"===r.projection.name&&(u=Um(u,r));const f=F.mat4.multiply([],r.projMatrix,u),p=t.queryGeometry,m=Fm(p.isPointQuery()?p.screenBounds:p.screenGeometry,r,f,o.aabb);null!=m&&(d=Math.min(m,d))}return d!==Number.MAX_VALUE&&d}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Qo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends fs{constructor(t,e,i,n){super(t,{layout:Gc||(Gc=new qr({"clip-layer-types":new jr(Zr.layout_clip["clip-layer-types"]),"clip-layer-scope":new jr(Zr.layout_clip["clip-layer-scope"])})),paint:Wc||(Wc=new qr({}))},e,i,n)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new $c(t)}isTileClipped(){return!0}is3D(){return!0}}};class Cg{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class wg{constructor(){this.tasks={},this.taskQueue=[],at(["process"],this),this.invoker=new Cg(this.process),this.nextId=0}add(t,e){const i=this.nextId++,n=function(t){let{type:e,isSymbolTile:i,zoom:n}=t;return n=n||0,"message"===e?0:"maybePrepare"!==e||i?"parseTile"!==e||i?"parseTile"===e&&i?300-n:"maybePrepare"===e&&i?400-n:500:200-n:100-n}(e);if(0===n){try{t()}finally{}return null}return this.tasks[i]={fn:t,metadata:e,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let n=0;n<this.taskQueue.length;n++){const i=this.tasks[this.taskQueue[n]];i.priority<e&&(e=i.priority,t=n)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class Sg{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},at(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new wg}send(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5?arguments[5]:void 0;const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=r,this.callbacks[s]=i);const a=new Set;return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:n,mustQueue:o,sourceMapId:this.mapId,data:hr(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||yt()){const t=this.callbacks[i],n=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"});n&&(this.cancelCallbacks[i]=n)}else this.processTask(i,e)}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(dr(e.error)):i(null,dr(e.data)))}else{const i=new Set,n=e.hasCallback?(e,n)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?hr(e):null,data:hr(n,i)},i)}:()=>{},o=dr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,o,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],o.source,o.scope)[t[1]](o,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Tg={workerUrl:"",workerClass:null,workerParams:void 0};const Ag="mapboxgl_preloaded_worker_pool";class Mg{constructor(){this.active={}}acquire(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mg.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<e;)this.workers.push(null!=Tg.workerClass?new Tg.workerClass:new self.Worker(Tg.workerUrl,Tg.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ag]}numActive(){return Object.keys(this.active).length}}Mg.workerCount=2;class Ig{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mg.workerCount;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=rt();const o=this.workerPool.acquire(this.id,n);for(let r=0;r<o.length;r++){const t=new Ig.Actor(o[r],e,this.id);t.name=`${i} ${r}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,e,i){it(this.actors,((i,n)=>{i.send(t,e,n)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Eg,Pg;function kg(){return Eg||(Eg=new Mg),Eg}Ig.Actor=Sg;const Bg=new Ae(0,0,0);var Dg=(t=>(t[t.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",t[t.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",t[t.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",t))(Dg||{}),Rg=(t=>(t[t.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",t[t.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",t[t.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",t[t.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",t))(Rg||{}),Lg=(t=>(t[t.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",t[t.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",t[t.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",t[t.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",t[t.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",t))(Lg||{}),zg=(t=>(t[t.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",t[t.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",t[t.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",t))(zg||{}),Og=(t=>(t[t.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",t[t.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",t[t.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",t[t.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",t[t.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",t[t.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",t))(Og||{}),Ug=(t=>(t[t.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",t[t.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",t[t.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",t))(Ug||{});function Fg(t,e,i){1===t&&e.icons.push(function(t,e){return function(t){if(t.usvg_tree.height||(t.usvg_tree.height=t.usvg_tree.width),!t.metadata)return t;const{metadata:e}=t;if(e.content_area){const{content_area:i}=e;null==i.top&&(i.top=i.left),null==i.width&&(i.width=t.usvg_tree.width),null==i.height&&(i.height=i.width)}return e.stretch_x&&e.stretch_x.length&&Ng(e,"x"),e.stretch_y&&e.stretch_y.length&&Ng(e,"y"),t}(t.readFields(Vg,{name:void 0},e))}(i,i.readVarint()+i.pos))}function Ng(t,e){const i=[],n=t[`stretch_${e}`];let o=null;for(let r=0;r<n.length;r++)null===o?o=0===i.length?n[0]:i[i.length-1][1]+n[r]:(i.push([o,o+n[r]]),o=null);t[`stretch_${e}_areas`]=i}function Vg(t,e,i){1===t?e.name=i.readString():2===t?e.metadata=function(t,e){return t.readFields(Hg,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},e)}(i,i.readVarint()+i.pos):3===t&&(e.usvg_tree=function(t,e){return t.readFields(Wg,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},e)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function Hg(t,e,i){1===t?e.stretch_x=i.readPackedVarint():2===t?e.stretch_y=i.readPackedVarint():3===t?e.content_area=function(t,e){return t.readFields(jg,{left:0},e)}(i,i.readVarint()+i.pos):4===t&&e.variables.push(function(t,e){return t.readFields(Gg,{name:void 0},e)}(i,i.readVarint()+i.pos))}function jg(t,e,i){1===t?e.left=i.readVarint():2===t?e.width=i.readVarint():3===t?e.top=i.readVarint():4===t&&(e.height=i.readVarint())}function Gg(t,e,i){1===t?e.name=i.readString():2===t&&(e.rgb_color=Qg(i.readVarint()),e.value="rgb_color")}function Wg(t,e,i){1===t?e.width=e.height=i.readVarint():2===t?e.height=i.readVarint():3===t?e.children.push(qg(i,i.readVarint()+i.pos)):4===t?e.linear_gradients.push(function(t,e){return t.readFields(ey,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},e)}(i,i.readVarint()+i.pos)):5===t?e.radial_gradients.push(function(t,e){return t.readFields(oy,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},e)}(i,i.readVarint()+i.pos)):7===t?e.clip_paths.push(function(t,e){return t.readFields(ry,{children:[]},e)}(i,i.readVarint()+i.pos)):8===t&&e.masks.push(function(t,e){const i=t.readFields(sy,{left:0,width:20,mask_type:1,children:[]},e);return null==i.height&&(i.height=i.width),null==i.top&&(i.top=i.left),i}(i,i.readVarint()+i.pos))}function qg(t,e){return t.readFields(Zg,{},e)}function Zg(t,e,i){1===t?(e.group=function(t,e){return t.readFields($g,{opacity:255,children:[]},e)}(i,i.readVarint()+i.pos),e.node="group"):2===t&&(e.path=function(t,e){return t.readFields(Jg,{paint_order:1,commands:[],step:1,diffs:[],rule:1},e)}(i,i.readVarint()+i.pos),e.node="path")}function $g(t,e,i){1===t?e.transform=Kg(i,i.readVarint()+i.pos):2===t?e.opacity=i.readVarint():5===t?e.clip_path_idx=i.readVarint():6===t?e.mask_idx=i.readVarint():7===t&&e.children.push(qg(i,i.readVarint()+i.pos))}function Kg(t,e){return t.readFields(Yg,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Yg(t,e,i){1===t?e.sx=i.readFloat():2===t?e.ky=i.readFloat():3===t?e.kx=i.readFloat():4===t?e.sy=i.readFloat():5===t?e.tx=i.readFloat():6===t&&(e.ty=i.readFloat())}function Jg(t,e,i){1===t?e.fill=function(t,e){return t.readFields(Xg,{rgb_color:Bg,paint:"rgb_color",opacity:255},e)}(i,i.readVarint()+i.pos):2===t?e.stroke=function(t,e){return t.readFields(ty,{rgb_color:Bg,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},e)}(i,i.readVarint()+i.pos):3===t?e.paint_order=i.readVarint():5===t?i.readPackedVarint(e.commands):6===t?e.step=i.readFloat():7===t?i.readPackedSVarint(e.diffs):8===t&&(e.rule=i.readVarint())}function Xg(t,e,i){1===t?(e.rgb_color=Qg(i.readVarint()),e.paint="rgb_color"):2===t?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):3===t?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):5===t&&(e.opacity=i.readVarint())}function Qg(t){return new Ae((t>>16&255)/255,(t>>8&255)/255,(255&t)/255,1)}function ty(t,e,i){1===t?(e.rgb_color=Qg(i.readVarint()),e.paint="rgb_color"):2===t?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):3===t?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):5===t?i.readPackedFloat(e.dasharray):6===t?e.dashoffset=i.readFloat():7===t?e.miterlimit=i.readFloat():8===t?e.opacity=i.readVarint():9===t?e.width=i.readFloat():10===t?e.linecap=i.readVarint():11===t&&(e.linejoin=i.readVarint())}function ey(t,e,i){1===t?e.transform=Kg(i,i.readVarint()+i.pos):2===t?e.spread_method=i.readVarint():3===t?e.stops.push(iy(i,i.readVarint()+i.pos)):4===t?e.x1=i.readFloat():5===t?e.y1=i.readFloat():6===t?e.x2=i.readFloat():7===t&&(e.y2=i.readFloat())}function iy(t,e){return t.readFields(ny,{offset:0,opacity:255,rgb_color:Bg},e)}function ny(t,e,i){1===t?e.offset=i.readFloat():2===t?e.opacity=i.readVarint():3===t&&(e.rgb_color=Qg(i.readVarint()))}function oy(t,e,i){1===t?e.transform=Kg(i,i.readVarint()+i.pos):2===t?e.spread_method=i.readVarint():3===t?e.stops.push(iy(i,i.readVarint()+i.pos)):4===t?e.cx=i.readFloat():5===t?e.cy=i.readFloat():6===t?e.r=i.readFloat():7===t?e.fx=i.readFloat():8===t?e.fy=i.readFloat():9===t&&(e.fr=i.readFloat())}function ry(t,e,i){1===t?e.transform=Kg(i,i.readVarint()+i.pos):2===t?e.clip_path_idx=i.readVarint():3===t&&e.children.push(qg(i,i.readVarint()+i.pos))}function sy(t,e,i){1===t?e.left=e.top=i.readFloat():2===t?e.width=e.height=i.readFloat():3===t?e.top=i.readFloat():4===t?e.height=i.readFloat():5===t?e.mask_type=i.readVarint():6===t?e.mask_idx=i.readVarint():7===t&&e.children.push(qg(i,i.readVarint()+i.pos))}class ay{static calculate(t,e){const i=new Map,n=new Map;if(0===Object.keys(t).length)return i;e.forEach((t=>{n.set(t.name,t.rgb_color||new Ae(0,0,0))}));for(const[o,r]of Object.entries(t))n.has(o)?i.set(n.get(o).toStringPremultipliedAlpha(),r):console.warn(`Ignoring unknown image variable "${o}"`);return i}}function ly(t){let e=arguments.length>2?arguments[2]:void 0;const i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,n=t.toStringPremultipliedAlpha(),o=e.has(n)?e.get(n).clone():t.clone();return o.a=i,o.toString()}function uy(t,e){if(!Rt()){const i=document.createElement("canvas");return i.width=t,i.height=e,i}return new OffscreenCanvas(t,e)}function cy(t,e){const i=ay.calculate(e.params,t.metadata?t.metadata.variables:[]),n=t.usvg_tree,o=n.width,r=n.height,s=e.transform?e.transform:new DOMMatrix,a=Math.max(1,Math.round(o*s.a)),l=Math.max(1,Math.round(r*s.d)),u=new DOMMatrix([a/o,0,0,l/r,0,0]),c=uy(a,l).getContext("2d");return hy(c,u,n,n,i),c.getImageData(0,0,a,l)}function hy(t,e,i,n,o){for(const r of n.children)dy(t,e,i,r,o)}function dy(t,e,i,n,o){n.group?(t.save(),function(t,e,i,n,o){const r=null!=n.mask_idx?i.masks[n.mask_idx]:null,s=null!=n.clip_path_idx?i.clip_paths[n.clip_path_idx]:null;if(n.transform&&(e=by(n.transform).preMultiplySelf(e)),!function(t,e,i){return 255!==t.opacity||e||i}(n,null!=s,null!=r))return void hy(t,e,i,n,o);const a=uy(t.canvas.width,t.canvas.height),l=a.getContext("2d");hy(l,e,i,n,o),s&&vy(l,e,i,s),r&&xy(l,e,i,r,o),t.globalAlpha=n.opacity/255,t.drawImage(a,0,0)}(t,e,i,n.group,o),t.restore()):n.path&&(t.save(),function(t,e,i,n,o){const r=Cy(n);t.setTransform(e),n.paint_order===zg.PAINT_ORDER_FILL_AND_STROKE?(fy(t,i,n,r,o),my(t,i,n,r,o)):(my(t,i,n,r,o),fy(t,i,n,r,o))}(t,e,i,n.path,o),t.restore())}function fy(t,e,i,n,o){const r=i.fill;if(!r)return;const s=r.opacity/255;switch(r.paint){case"rgb_color":t.fillStyle=ly(r.rgb_color,r.opacity,o);break;case"linear_gradient_idx":t.fillStyle=gy(t,e.linear_gradients[r.linear_gradient_idx],s,o);break;case"radial_gradient_idx":t.fillStyle=yy(t,e.radial_gradients[r.radial_gradient_idx],s,o)}t.fill(n,py(i))}function py(t){return t.rule===Dg.PATH_RULE_NON_ZERO?"nonzero":t.rule===Dg.PATH_RULE_EVEN_ODD?"evenodd":void 0}function my(t,e,i,n,o){const r=i.stroke;if(!r)return;t.lineWidth=r.width,t.miterLimit=r.miterlimit,t.setLineDash(r.dasharray),t.lineDashOffset=r.dashoffset;const s=r.opacity/255;switch(r.paint){case"rgb_color":t.strokeStyle=ly(r.rgb_color,r.opacity,o);break;case"linear_gradient_idx":t.strokeStyle=gy(t,e.linear_gradients[r.linear_gradient_idx],s,o);break;case"radial_gradient_idx":t.strokeStyle=yy(t,e.radial_gradients[r.radial_gradient_idx],s,o)}switch(r.linejoin){case Lg.LINE_JOIN_MITER_CLIP:case Lg.LINE_JOIN_MITER:t.lineJoin="miter";break;case Lg.LINE_JOIN_ROUND:t.lineJoin="round";break;case Lg.LINE_JOIN_BEVEL:t.lineJoin="bevel"}switch(r.linecap){case Rg.LINE_CAP_BUTT:t.lineCap="butt";break;case Rg.LINE_CAP_ROUND:t.lineCap="round";break;case Rg.LINE_CAP_SQUARE:t.lineCap="square"}t.stroke(n)}function gy(t,e,i,n){if(1===e.stops.length){const t=e.stops[0];return ly(t.rgb_color,t.opacity*i,n)}const o=by(e.transform),{x1:r,y1:s,x2:a,y2:l}=e,u=o.transformPoint(new DOMPoint(r,s)),c=o.transformPoint(new DOMPoint(a,l)),h=t.createLinearGradient(u.x,u.y,c.x,c.y);for(const d of e.stops)h.addColorStop(d.offset,ly(d.rgb_color,d.opacity*i,n));return h}function yy(t,e,i,n){if(1===e.stops.length){const t=e.stops[0];return ly(t.rgb_color,t.opacity*i,n)}const o=by(e.transform),{fx:r,fy:s,cx:a,cy:l}=e,u=o.transformPoint(new DOMPoint(r,s)),c=o.transformPoint(new DOMPoint(a,l)),h=t.createRadialGradient(u.x,u.y,0,c.x,c.y,e.r*((o.a+o.d)/2));for(const d of e.stops)h.addColorStop(d.offset,ly(d.rgb_color,d.opacity*i,n));return h}function _y(t,e,i,n){const o=n.transform?by(n.transform).preMultiplySelf(e):e,r=uy(t.canvas.width,t.canvas.height),s=r.getContext("2d");for(const l of n.children)if(l.group)_y(s,o,i,l.group);else if(l.path){const t=l.path,e=new Path2D;e.addPath(Cy(t),o),s.fill(e,py(t))}const a=null!=n.clip_path_idx?i.clip_paths[n.clip_path_idx]:null;a&&vy(s,o,i,a),t.globalCompositeOperation="source-over",t.drawImage(r,0,0)}function vy(t,e,i,n){const o=uy(t.canvas.width,t.canvas.height);_y(o.getContext("2d"),e,i,n),t.globalCompositeOperation="destination-in",t.drawImage(o,0,0)}function xy(t,e,i,n,o){if(0===n.children.length)return;const r=null!=n.mask_idx?i.masks[n.mask_idx]:null;r&&xy(t,e,i,r,o);const s=t.canvas.width,a=t.canvas.height,l=uy(s,a),u=l.getContext("2d"),c=n.width,h=n.height,d=n.left,f=n.top,p=new Path2D,m=new Path2D;m.rect(d,f,c,h),p.addPath(m,e),u.clip(p);for(const _ of n.children)dy(u,e,i,_,o);const g=u.getImageData(0,0,s,a),y=g.data;if(n.mask_type===Ug.MASK_TYPE_LUMINANCE)for(let _=0;_<y.length;_+=4)y[_+3]=y[_+3]/255*(.2126*y[_]+.7152*y[_+1]+.0722*y[_+2]);u.putImageData(g,0,0),t.globalCompositeOperation="destination-in",t.drawImage(l,0,0)}function by(t){return t?new DOMMatrix([t.sx,t.ky,t.kx,t.sy,t.tx,t.ty]):new DOMMatrix}function Cy(t){const e=new Path2D,i=t.step;let n=t.diffs[0]*i,o=t.diffs[1]*i;e.moveTo(n,o);for(let r=0,s=2;r<t.commands.length;r++)switch(t.commands[r]){case Og.PATH_COMMAND_MOVE:n+=t.diffs[s++]*i,o+=t.diffs[s++]*i,e.moveTo(n,o);break;case Og.PATH_COMMAND_LINE:n+=t.diffs[s++]*i,o+=t.diffs[s++]*i,e.lineTo(n,o);break;case Og.PATH_COMMAND_QUAD:{const r=n+t.diffs[s++]*i,a=o+t.diffs[s++]*i;n=r+t.diffs[s++]*i,o=a+t.diffs[s++]*i,e.quadraticCurveTo(r,a,n,o);break}case Og.PATH_COMMAND_CUBIC:{const r=n+t.diffs[s++]*i,a=o+t.diffs[s++]*i,l=r+t.diffs[s++]*i,u=a+t.diffs[s++]*i;n=l+t.diffs[s++]*i,o=u+t.diffs[s++]*i,e.bezierCurveTo(r,a,l,u,n,o);break}case Og.PATH_COMMAND_CLOSE:e.closePath()}return e}class wy{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}put(t,e){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,e)}delete(t){this.cache.delete(t)}}class Sy{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new sc(t,t.data)}getFromCache(t,e,i){return this.cacheMap.has(i)||this.cacheMap.set(i,new wy(150)),this.cacheMap.get(i).get(cs(t.serialize(),e))}setInCache(t,e,i,n){this.cacheDependenciesMap.has(n)||this.cacheDependenciesMap.set(n,new Map),this.cacheMap.has(n)||this.cacheMap.set(n,new wy(150));const o=this.cacheDependenciesMap.get(n);o.get(cs(t.id,i))||o.set(cs(t.id,i),new Set);const r=this.cacheMap.get(n),s=t.serialize();o.get(cs(t.id,i)).add(s),r.put(cs(t.serialize(),i),e)}removeImagesFromCacheByIds(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!this.cacheMap.has(i)||!this.cacheDependenciesMap.has(i))return;const n=this.cacheMap.get(i),o=this.cacheDependenciesMap.get(i);for(const r of t)if(o.has(cs(r,e))){for(const t of o.get(cs(r,e)))n.delete(t);o.delete(cs(r,e))}}rasterize(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cy;const r=this.getFromCache(t,i,n);if(r)return r.clone();const s=o(e.icon,t.options),a=Sy._getImage(s);return this.setInCache(t,a,i,n),a.clone()}}class Ty{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Ay(t,e,i,n){let o=0,r=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/n[s];let l=(t[s]-i[s])*a,u=(e[s]-i[s])*a;if(l>u){const t=l;l=u,u=t}if(l>o&&(o=l),u<r&&(r=u),o>r)return null}return o}function My(t,e,i,n,o,r,s,a,l,u,c){const h=n-t,d=o-e,f=r-i,p=s-t,m=a-e,g=l-i,y=c[1]*g-c[2]*m,_=c[2]*p-c[0]*g,v=c[0]*m-c[1]*p,x=h*y+d*_+f*v;if(Math.abs(x)<1e-15)return null;const b=1/x,C=u[0]-t,w=u[1]-e,S=u[2]-i,T=(C*y+w*_+S*v)*b;if(T<0||T>1)return null;const A=w*f-S*d,M=S*h-C*f,I=C*d-w*h,E=(c[0]*A+c[1]*M+c[2]*I)*b;return E<0||T+E>1?null:(p*A+m*M+g*I)*b}function Iy(t,e,i){return(t-e)/(i-e)}function Ey(t,e,i,n,o,r,s,a,l){const u=1<<i,c=r-n,h=s-o,d=(t+1)/u*c+n,f=(e+0)/u*h+o,p=(e+1)/u*h+o;a[0]=(t+0)/u*c+n,a[1]=f,l[0]=d,l[1]=p}class Py{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let n=Math.ceil(Math.pow(2,e));const o=1/n,r=(t,e,i,n,o)=>{const r=n?1:0,s=(t+1)*i-r,a=e*i,l=(e+1)*i-r;o[0]=t*i,o[1]=a,o[2]=s,o[3]=l};let s=new Ty(n);const a=[];for(let l=0;l<n*n;l++){r(l%n,Math.floor(l/n),o,!1,a);const e=By(a[0],a[1],t),i=By(a[2],a[1],t),u=By(a[2],a[3],t),c=By(a[0],a[3],t);s.minimums.push(Math.min(e,i,u,c)),s.maximums.push(Math.max(e,i,u,c)),s.leaves.push(1)}for(i.push(s),n/=2;n>=1;n/=2){const t=i[i.length-1];s=new Ty(n);for(let e=0;e<n*n;e++){r(e%n,Math.floor(e/n),2,!0,a);const i=t.getElevation(a[0],a[1]),o=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),u=t.getElevation(a[0],a[3]),c=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),f=t.isLeaf(a[0],a[3]),p=Math.min(i.min,o.min,l.min,u.min),m=Math.max(i.max,o.max,l.max,u.max),g=c&&h&&d&&f;s.maximums.push(m),s.minimums.push(p),s.leaves.push(m-p<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,n=e[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Ay([t,e,-100],[i,n,this.maximums[0]*s],o,r)}raycast(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,i,n,o,r,s);if(null==a)return null;const l=[],u=[],c=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:f,nodex:p,nodey:m,depth:g}=d.pop();if(this.leaves[a]){Ey(p,m,g,t,e,i,n,c,h);const a=1<<g,l=(p+0)/a,u=(p+1)/a,d=(m+0)/a,y=(m+1)/a,_=By(l,d,this.dem)*s,v=By(u,d,this.dem)*s,x=By(u,y,this.dem)*s,b=By(l,y,this.dem)*s,C=My(c[0],c[1],_,h[0],c[1],v,h[0],h[1],x,o,r),w=My(h[0],h[1],x,c[0],h[1],b,c[0],c[1],_,o,r),S=Math.min(null!==C?C:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=F.vec3.scaleAndAdd([],o,r,f);if(ky(_,v,b,x,Iy(t[0],c[0],h[0]),Iy(t[1],c[1],h[1]))>=t[2])return f}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){Ey((p<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,t,e,i,n,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const f=Ay(c,h,o,r);if(null!=f){const t=f;l[d]=t;let e=!1;for(let i=0;i<y&&!e;i++)t>=l[u[i]]&&(u.splice(i,0,d),e=!0);e||(u[y]=d),y++}}for(let t=0;t<y;t++){const e=u[t];d.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(p<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,n,o){if(1===t[n].isLeaf(e,i))return;this.childOffsets[o]||(this.childOffsets[o]=this.nodeCount);const r=n-1,s=t[r];let a=0,l=0;for(let u=0;u<this._siblingOffset.length;u++){const t=2*e+this._siblingOffset[u][0],n=2*i+this._siblingOffset[u][1],o=s.getElevation(t,n),r=s.isLeaf(t,n),c=this._addNode(o.min,o.max,r);r&&(a|=1<<u),l||(l=c)}for(let u=0;u<this._siblingOffset.length;u++)a&1<<u||this._construct(t,2*e+this._siblingOffset[u][0],2*i+this._siblingOffset[u][1],r,l+u)}}function ky(t,e,i,n,o,r){return Ie(Ie(t,i,r),Ie(e,n,r),o)}function By(t,e,i){const n=i.dim,o=Q(t*n-.5,0,n-1),r=Q(e*n-.5,0,n-1),s=Math.floor(o),a=Math.floor(r),l=Math.min(s+1,n-1),u=Math.min(a+1,n-1);return ky(i.get(s,a),i.get(l,a),i.get(s,u),i.get(l,u),o-s,r-a)}const Dy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Ry(t,e,i){return(256*t*256+256*e+i)/10-1e4}function Ly(t,e,i){return 256*t+e+i/256-32768}class zy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return void ft(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2,r=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let t=0;t<o;t++)r[this._idx(-1,t)]=r[this._idx(0,t)],r[this._idx(o,t)]=r[this._idx(o-1,t)],r[this._idx(t,-1)]=r[this._idx(t,0)],r[this._idx(t,o)]=r[this._idx(t,o-1)];r[this._idx(-1,-1)]=r[this._idx(0,0)],r[this._idx(o,-1)]=r[this._idx(o-1,0)],r[this._idx(-1,o)]=r[this._idx(0,o-1)],r[this._idx(o,o)]=r[this._idx(o-1,o-1)]}const s="terrarium"===i?Ly:Ry;for(let a=0;a<r.length;++a){const t=4*a;this.floatView[a]=s(this.pixels[t],this.pixels[t+1],this.pixels[t+2])}this._timestamp=Lt.now()}_buildQuadTree(){this._tree=new Py(this)}get(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(t=Q(t,-1,this.dim),e=Q(e,-1,this.dim));const i=this._idx(t,e);return this.floatView[i]}set(t,e,i){const n=this._idx(t,e),o=this.floatView[n];return this.floatView[n]=i,i-o}static getUnpackVector(t){return Dy[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],n=zy.getUnpackVector(e);let o=Math.floor((t+n[3])/n[2]);return i[2]=o%256,o=Math.floor(o/256),i[1]=o%256,o=Math.floor(o/256),i[0]=o,i}getPixels(){return new ac({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,o=e*this.dim+this.dim,r=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:n=o-1;break;case 1:o=n+1}switch(i){case-1:r=s-1;break;case 1:s=r+1}const a=-e*this.dim,l=-i*this.dim;for(let u=r;u<s;u++)for(let e=n;e<o;e++){const i=4*this._idx(e,u),n=4*this._idx(e+a,u+l);this.pixels[i+0]=t.pixels[n+0],this.pixels[i+1]=t.pixels[n+1],this.pixels[i+2]=t.pixels[n+2],this.pixels[i+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Oy(t,e,i){1===t?e.headerLength=i.readFixed32():2===t?e.x=i.readVarint():3===t?e.y=i.readVarint():4===t?e.z=i.readVarint():5===t&&e.layers.push(function(t,e){return t.readFields(Hy,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},e)}(i,i.readVarint()+i.pos))}function Uy(t,e,i){1===t?(e.delta_filter=function(t,e){return t.readFields(Fy,{blockSize:0},e)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):2===t?(i.readVarint(),e.filter="zigzag_filter"):3===t?(i.readVarint(),e.filter="bitshuffle_filter"):4===t&&(i.readVarint(),e.filter="byteshuffle_filter")}function Fy(t,e,i){1===t&&(e.blockSize=i.readVarint())}function Ny(t,e,i){1===t?(i.readVarint(),e.codec="gzip_data"):2===t?(i.readVarint(),e.codec="jpeg_image"):3===t?(i.readVarint(),e.codec="webp_image"):4===t&&(i.readVarint(),e.codec="png_image")}function Vy(t,e,i){let n=0,o=0;1===t?e.firstByte=i.readFixed64():2===t?e.lastByte=i.readFixed64():3===t?e.filters.push(function(t,e){return t.readFields(Uy,{},e)}(i,i.readVarint()+i.pos)):4===t?e.codec=function(t,e){return t.readFields(Ny,{},e)}(i,i.readVarint()+i.pos):5===t?o=i.readFloat():6===t?n=i.readFloat():7===t?e.bands.push(i.readString()):8===t?e.offset=i.readDouble():9===t&&(e.scale=i.readDouble()),0===e.offset&&(e.offset=o),0===e.scale&&(e.scale=n)}function Hy(t,e,i){1===t?e.version=i.readVarint():2===t?e.name=i.readString():3===t?e.units=i.readString():4===t?e.tileSize=i.readVarint():5===t?e.buffer=i.readVarint():6===t?e.pixelFormat=i.readVarint():7===t&&e.dataIndex.push(function(t,e){return t.readFields(Vy,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)}(i,i.readVarint()+i.pos))}function jy(t,e,i){if(2===t)!function(t,e,i){t.readFields(Gy,i,e)}(i,i.readVarint()+i.pos,e);else if(3===t)throw new Error("Not implemented")}function Gy(t,e,i){if(1===t){let t=0;const n=i.readVarint()+i.pos;for(;i.pos<n;)e[t++]=i.readVarint()}}function Wy(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let n=2;n>=1;n--){const o=1===n?1:0,r=2===n?1:0;for(let n=0;n<e[0];n++){const s=e[1]*n;for(let n=o;n<e[1];n++){const o=e[2]*(n+s);for(let n=r;n<e[2];n++){const r=e[3]*(n+o);for(let n=0;n<e[3];n++){const e=r+n;t[e]+=t[e-i]}}}}i*=e[n]}return t}function qy(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function Zy(t,e){switch(e){case"uint32":return t;case"uint16":for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];t[e]=(240&i)>>4|(61440&i)>>8|(240&n)<<4|61440&n,t[e+1]=15&i|(3840&i)>>4|(15&n)<<8|(3840&n)<<4}return t;case"uint8":for(let e=0;e<t.length;e+=4){const i=t[e],n=t[e+1],o=t[e+2],r=t[e+3];t[e+0]=(192&i)>>6|(192&n)>>4|(192&o)>>2|192&r,t[e+1]=(48&i)>>4|(48&n)>>2|48&o|(48&r)<<2,t[e+2]=(12&i)>>2|12&n|(12&o)<<2|(12&r)<<4,t[e+3]=3&i|(3&n)<<2|(3&o)<<4|(3&r)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}lr(zy,"DEMData"),lr(Py,"DemMinMaxQuadTree",{omit:["dem"]});var $y=Uint8Array,Ky=Uint16Array,Yy=Int32Array,Jy=new $y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xy=new $y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qy=new $y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t_=function(t,e){for(var i=new Ky(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var o=new Yy(i[30]);for(n=1;n<30;++n)for(var r=i[n];r<i[n+1];++r)o[r]=r-i[n]<<5|n;return{b:i,r:o}},e_=t_(Jy,2),i_=e_.b,n_=e_.r;i_[28]=258,n_[258]=28;for(var o_=t_(Xy,0).b,r_=new Ky(32768),s_=0;s_<32768;++s_){var a_=(43690&s_)>>1|(21845&s_)<<1;r_[s_]=((65280&(a_=(61680&(a_=(52428&a_)>>2|(13107&a_)<<2))>>4|(3855&a_)<<4))>>8|(255&a_)<<8)>>1}var l_=function(t,e,i){for(var n=t.length,o=0,r=new Ky(e);o<n;++o)t[o]&&++r[t[o]-1];var s,a=new Ky(e);for(o=1;o<e;++o)a[o]=a[o-1]+r[o-1]<<1;s=new Ky(1<<e);var l=15-e;for(o=0;o<n;++o)if(t[o])for(var u=o<<4|t[o],c=e-t[o],h=a[t[o]-1]++<<c,d=h|(1<<c)-1;h<=d;++h)s[r_[h]>>l]=u;return s},u_=new $y(288);for(s_=0;s_<144;++s_)u_[s_]=8;for(s_=144;s_<256;++s_)u_[s_]=9;for(s_=256;s_<280;++s_)u_[s_]=7;for(s_=280;s_<288;++s_)u_[s_]=8;var c_=new $y(32);for(s_=0;s_<32;++s_)c_[s_]=5;var h_=l_(u_,9),d_=l_(c_,5),f_=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},p_=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},m_=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},g_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y_=function(t,e,i){var n=new Error(e||g_[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,y_),!i)throw n;return n},__=new $y(0),v_="undefined"!=typeof TextDecoder&&new TextDecoder;try{v_.decode(__,{stream:!0})}catch(t){}const x_={gzip_data:"gzip"};class b_ extends Error{constructor(t){super(t),this.name="MRTError"}}const C_={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},w_={uint32:1,uint16:2,uint8:4},S_={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let T_;class A_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const e=this.layers[t];if(!e)throw new b_(`Layer '${t}' not found`);return e}getHeaderLength(t){const e=new Uint8Array(t),i=new DataView(t);if(13!==e[0])throw new b_("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),i=this.getHeaderLength(t);if(e.length<i)throw new b_(`Expected header with length >= ${i} but got buffer of length ${e.length}`);const n=function(t){return t.readFields(Oy,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new T_(e.subarray(0,i)));if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new b_(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const o of n.layers)this.layers[o.name]=new M_(o,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],i=this.getLayer(t.layerName);for(let n of t.blockIndices){const o=i.dataIndex[n],r=o.firstByte-t.firstByte,s=o.lastByte-t.firstByte;if(i._blocksInProgress.has(n))continue;const a={layerName:i.name,firstByte:r,lastByte:s,pixelFormat:i.pixelFormat,blockIndex:n,blockShape:[o.bands.length].concat(i.bandShape),buffer:i.buffer,codec:o.codec.codec,filters:o.filters.map((t=>t.filter))};i._blocksInProgress.add(n),e.push(a)}return new I_(e,(()=>{e.forEach((t=>i._blocksInProgress.delete(t.blockIndex)))}),((t,n)=>{if(e.forEach((t=>i._blocksInProgress.delete(t.blockIndex))),t)throw t;n.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t)}))}))}}class M_{constructor(t,e){let{version:i,name:n,units:o,tileSize:r,pixelFormat:s,buffer:a,dataIndex:l}=t;if(this.version=i,1!==this.version)throw new b_(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=n,this.units=o,this.tileSize=r,this.buffer=a,this.pixelFormat=C_[s],this.dataIndex=l,this.bandShape=[r+2*a,r+2*a,w_[this.pixelFormat]],this._decodedBlocks=new wy(e?e.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return w_[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((t=>{let{bands:e}=t;return e})).flat()}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.put(e,t.data)}getBlockForBand(t){let e=0;switch(typeof t){case"string":for(const[i,n]of this.dataIndex.entries()){for(const[o,r]of n.bands.entries())if(r===t)return{bandIndex:e+o,blockIndex:i,blockBandIndex:o};e+=n.bands.length}break;case"number":for(const[i,n]of this.dataIndex.entries()){if(t>=e&&t<e+n.bands.length)return{bandIndex:t,blockIndex:i,blockBandIndex:t-e};e+=n.bands.length}break;default:throw new b_(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new b_(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let e=1/0,i=-1/0;const n=[],o=new Set;for(const r of t){const{blockIndex:t}=this.getBlockForBand(r);if(t<0)throw new b_(`Invalid band: ${JSON.stringify(r)}`);const s=this.dataIndex[t];n.includes(t)||n.push(t),o.add(t),e=Math.min(e,s.firstByte),i=Math.max(i,s.lastByte)}if(o.size>this.cacheSize)throw new b_(`Number of blocks to decode (${o.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:e,lastByte:i,blockIndices:n}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:i}=this.getBlockForBand(t),n=this._decodedBlocks.get(e.toString());if(!n)throw new b_(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const o=this.dataIndex[e],r=this.bandShape.reduce(((t,e)=>t*e),1),s=i*r,a=n.subarray(s,s+r);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:o.offset,scale:o.scale}}}A_.setPbf=function(t){T_=t};class I_{constructor(t,e,i){this.tasks=t,this._onCancel=e,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0)}}A_.performDecoding=function(t,e){const i=new Uint8Array(t);return Promise.all(e.tasks.map((t=>{const{layerName:e,firstByte:n,lastByte:o,pixelFormat:r,blockShape:s,blockIndex:a,filters:l,codec:u}=t,c=i.subarray(n,o+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==u)throw new b_(`Unhandled codec: ${u}`);return d=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((r=function(t){31==t[0]&&139==t[1]&&8==t[2]||y_(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[i++]);return i+(2&e)}(o=t))+8>o.length&&y_(6,"invalid gzip data"),function(t,e,i){var n=t.length;if(!n||e.f&&!e.l)return i||new $y(0);var o=!i,r=o||2!=e.i,s=e.i;o&&(i=new $y(3*n));var a,l,u=function(t){var e=i.length;if(t>e){var n=new $y(Math.max(2*e,t));n.set(i),i=n}},c=e.f||0,h=e.p||0,d=e.b||0,f=e.l,p=e.d,m=e.m,g=e.n,y=8*n;do{if(!f){c=p_(t,h,1);var _=p_(t,h+1,3);if(h+=3,!_){var v=t[(P=4+((h+7)/8|0))-4]|t[P-3]<<8,x=P+v;if(x>n){s&&y_(0);break}r&&u(d+v),i.set(t.subarray(P,x),d),e.b=d+=v,e.p=h=8*x,e.f=c;continue}if(1==_)f=h_,p=d_,m=9,g=5;else if(2==_){var b=p_(t,h,31)+257,C=p_(t,h+10,15)+4,w=b+p_(t,h+5,31)+1;h+=14;for(var S=new $y(w),T=new $y(19),A=0;A<C;++A)T[Qy[A]]=p_(t,h+3*A,7);h+=3*C;var M=f_(T),I=(1<<M)-1,E=l_(T,M);for(A=0;A<w;){var P,k=E[p_(t,h,I)];if(h+=15&k,(P=k>>4)<16)S[A++]=P;else{var B=0,D=0;for(16==P?(D=3+p_(t,h,3),h+=2,B=S[A-1]):17==P?(D=3+p_(t,h,7),h+=3):18==P&&(D=11+p_(t,h,127),h+=7);D--;)S[A++]=B}}var R=S.subarray(0,b),L=S.subarray(b);m=f_(R),g=f_(L),f=l_(R,m),p=l_(L,g)}else y_(1);if(h>y){s&&y_(0);break}}r&&u(d+131072);for(var z=(1<<m)-1,O=(1<<g)-1,U=h;;U=h){var F=(B=f[m_(t,h)&z])>>4;if((h+=15&B)>y){s&&y_(0);break}if(B||y_(2),F<256)i[d++]=F;else{if(256==F){U=h,f=null;break}var N=F-254;F>264&&(N=p_(t,h,(1<<(j=Jy[A=F-257]))-1)+i_[A],h+=j);var V=p[m_(t,h)&O],H=V>>4;if(V||y_(3),h+=15&V,L=o_[H],H>3){var j=Xy[H];L+=m_(t,h)&(1<<j)-1,h+=j}if(h>y){s&&y_(0);break}r&&u(d+131072);var G=d+N;if(d<L){var W=0-L,q=Math.min(L,G);for(W+d<0&&y_(3);d<q;++d)i[d]=(void 0)[W+d]}for(;d<G;++d)i[d]=i[d-L]}}e.l=f,e.p=U,e.b=d,e.f=c,f&&(c=1,e.m=m,e.d=p,e.n=g)}while(!c);return d!=i.length&&o?(a=i,(null==(l=d)||l>a.length)&&(l=a.length),new $y(a.subarray(0,l))):i.subarray(0,d)}(o.subarray(r,-8),{i:2},new $y(((i=o)[(n=i.length)-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0))));var i,n,o,r;const s=x_[e];if(!s)throw new Error(`Unhandled codec: ${e}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([t]).stream().pipeThrough(a)).arrayBuffer().then((t=>new Uint8Array(t)))}(c,u).then((t=>(function(t,e){t.readFields(jy,e)}(new T_(t),h),new(0,S_[r])(h.buffer)))),d.then((t=>{for(let e=l.length-1;e>=0;e--)switch(l[e]){case"delta_filter":Wy(t,s);break;case"zigzag_filter":qy(t);break;case"bitshuffle_filter":Zy(t,r);break;default:throw new b_(`Unhandled filter "${l[e]}"`)}return{layerName:e,blockIndex:a,data:t}})).catch((t=>{throw t}))})))},lr(I_,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let E_,P_,k_,B_,D_,R_=null;function L_(){return yt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:P_||Tt.DRACO_URL}function z_(){if(yt()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(B_)return B_;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return B_=WebAssembly.validate(t)?Tt.MESHOPT_SIMD_URL:Tt.MESHOPT_URL,B_}const O_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},U_={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},F_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function N_(t,e,i){const n=i.json.bufferViews.length,o=i.buffers.length;e.bufferView=n,i.json.bufferViews[n]={buffer:o,byteLength:t.byteLength},i.buffers[o]=t}const V_="KHR_draco_mesh_compression";function H_(t,e){const i=t.extensions&&t.extensions[V_];if(!i)return;const n=new k_.Decoder,o=K_(e,i.bufferView),r=new k_.Mesh;if(!n.DecodeArrayToMesh(o,o.byteLength,r))throw new Error("Failed to decode Draco mesh");const s=e.json.accessors[t.indices],a=O_[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,u=k_._malloc(l);a===Uint16Array?n.GetTrianglesUInt16Array(r,l,u):n.GetTrianglesUInt32Array(r,l,u),N_(k_.memory.buffer.slice(u,u+l),s,e),k_._free(u);for(const c of Object.keys(i.attributes)){const o=n.GetAttributeByUniqueId(r,i.attributes[c]),s=e.json.accessors[t.attributes[c]],a=U_[s.componentType],l=s.count*F_[s.type]*O_[s.componentType].BYTES_PER_ELEMENT,u=k_._malloc(l);n.GetAttributeDataArrayForAllPoints(r,o,k_[a],l,u),N_(k_.memory.buffer.slice(u,u+l),s,e),k_._free(u)}n.destroy(),r.destroy(),delete t.extensions[V_]}const j_="EXT_meshopt_compression";function G_(t,e){if(!t.extensions||!t.extensions[j_])return;const i=t.extensions[j_],n=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),o=new Uint8Array(i.count*i.byteStride);D_.decodeGltfBuffer(o,i.count,i.byteStride,n,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=o.buffer,delete t.extensions[j_]}const W_=1179937895,q_=new TextDecoder("utf8");function Z_(t,e){return new URL(t,e).href}function $_(t,e,i,n){return fetch(Z_(t.uri,n)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[i]=t}))}function K_(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Y_(t,e,i,n){if(t.uri){const o=Z_(t.uri,n);return fetch(o).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[i]=t}))}if(void 0!==t.bufferView){const n=K_(e,t.bufferView),o=new Blob([n],{type:t.mimeType});return createImageBitmap(o).then((t=>{e.images[i]=t}))}}function J_(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===W_){const i=new Uint32Array(t,e);let o=2;const r=(i[o++]>>2)-3,s=i[o++]>>2;if(o++,n.json=JSON.parse(q_.decode(i.subarray(o,o+s))),o+=s,o<r){const r=i[o++];o++;const s=e+(o<<2);n.buffers[0]=t.slice(s,s+r)}}else n.json=JSON.parse(q_.decode(new Uint8Array(t,e)));const{buffers:o,images:r,meshes:s,extensionsUsed:a,bufferViews:l}=n.json;let u=Promise.resolve();if(o){const t=[];for(let e=0;e<o.length;e++){const r=o[e];r.uri?t.push($_(r,n,e,i)):n.buffers[e]||(n.buffers[e]=null)}u=Promise.all(t)}return u.then((()=>{const t=[],e=a&&a.includes(V_),o=a&&a.includes(j_);if(e&&t.push(function(){if(!k_)return null!=E_?E_:(E_=function(t){let e,i=null;function n(){e=new Uint8Array(i.buffer)}function o(){throw new Error("Unexpected Draco error.")}const r={a:{a:o,d:function(t,i,n){return e.copyWithin(t,i,i+n)},c:function(t){const o=e.length,r=Math.max(t>>>0,Math.ceil(1.2*o)),s=Math.ceil((r-o)/65536);try{return i.grow(s),n(),!0}catch(t){return!1}},b:o}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,r):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,r)))).then((t=>{const{Rb:o,Qb:r,P:s,T:a,X:l,Ja:u,La:c,Qa:h,Va:d,Wa:f,eb:p,jb:m,f:g,e:y,yb:_,zb:v,Ab:x,Bb:b,Db:C,Gb:w}=t.instance.exports;i=y;const S=(()=>{let t=0,i=0,n=0,s=0;return a=>{n&&(o(s),o(t),i+=n,n=t=0),t||(i+=128,t=r(i));const l=a.length+7&-8;let u=t;l>=i&&(n=l,u=s=r(l));for(let t=0;t<a.length;t++)e[u+t]=a[t];return u}})();return n(),g(),{memory:y,_free:o,_malloc:r,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=u()}destroy(){m(this.ptr)}DecodeArrayToMesh(t,e,i){const n=S(t),o=c(this.ptr,n,e,i.ptr);return!!l(o)}GetAttributeByUniqueId(t,e){return{ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,i){d(this.ptr,t.ptr,e,i)}GetTrianglesUInt32Array(t,e,i){f(this.ptr,t.ptr,e,i)}GetAttributeDataArrayForAllPoints(t,e,i,n,o){p(this.ptr,t.ptr,e.ptr,i,n,o)}},DT_INT8:_(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:C(),DT_FLOAT32:w()}}))}(fetch(L_())),E_.then((t=>{k_=t,E_=void 0})))}()),o&&t.push(function(){if(D_)return;const t=function(t){let e;const i=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors()})),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(t,i,r,s,a,l){!function(t,e,i,n,o,r,s){const a=t.exports.sbrk,l=n+3&-4,u=a(l*o),c=a(r.length),h=new Uint8Array(t.exports.memory.buffer);h.set(r,c);const d=e(u,n,o,c,r.length);if(0===d&&s&&s(u,l,o),i.set(h.subarray(u,u+n*o)),a(u-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(e,e.exports[o[a]],t,i,r,s,e.exports[n[l]])}}}(fetch(z_()));return t.ready.then((()=>{D_=t}))}()),r)for(let s=0;s<r.length;s++)t.push(Y_(r[s],n,s,i));return(t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&s)for(const{primitives:t}of s)for(const e of t)H_(e,n);if(o&&s&&l)for(const t of l)G_(t,n);return n}))}))}function X_(t,e){const i=t.json.bufferViews[e.bufferView],n=O_[e.componentType];return new n(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==F_[e.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:F_[e.type]))}function Q_(t,e,i,n){const o=O_[e.componentType],r=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(o),s=t.json.bufferViews[e.bufferView],a=s.byteStride?s.byteStride/o.BYTES_PER_ELEMENT:F_[e.type],l=i.float32,u=l.length/i.capacity;for(let c=0,h=0;c<e.count*a;c+=a,h+=u)for(let t=0;t<u;t++)l[h+t]=n[c+t]*r;i._trim()}function tv(t,e,i){const n=t.indices,o=t.attributes,r={};r.indexArray=new Os;const s=e.json.accessors[n],a=s.count/3;r.indexArray.reserve(a);const l=X_(e,s);for(let d=0;d<a;d++)r.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);r.indexArray._trim(),r.vertexArray=new Ss;const u=e.json.accessors[o.POSITION];r.vertexArray.reserve(u.count);const c=X_(e,u);for(let d=0;d<u.count;d++)r.vertexArray.emplaceBack(c[3*d],c[3*d+1],c[3*d+2]);if(r.vertexArray._trim(),r.aabb=new _u(u.min,u.max),r.centroid=function(t,e){const i=[0,0,0],n=t.length;if(n>0){for(let o=0;o<n;o++){const n=3*t[o];i[0]+=e[n],i[1]+=e[n+1],i[2]+=e[n+2]}i[0]/=n,i[1]/=n,i[2]/=n}return i}(l,c),void 0!==o.COLOR_0){const t=e.json.accessors[o.COLOR_0],i=F_[t.type],n=X_(e,t);r.colorArray=3===i?new Ss:new Ps,r.colorArray.resize(t.count),Q_(e,t,r.colorArray,n)}if(void 0!==o.NORMAL){r.normalArray=new Ss;const t=e.json.accessors[o.NORMAL];r.normalArray.resize(t.count);const i=X_(e,t);Q_(e,t,r.normalArray,i)}if(void 0!==o.TEXCOORD_0&&i.length>0){r.texcoordArray=new Ws;const t=e.json.accessors[o.TEXCOORD_0];r.texcoordArray.resize(t.count);const i=X_(e,t);Q_(e,t,r.texcoordArray,i)}if(void 0!==o._FEATURE_ID_RGBA4444){const t=e.json.accessors[o._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(r.featureData=X_(e,t))}void 0!==o._FEATURE_RGBA4444&&(r.featureData=new Uint32Array(X_(e,e.json.accessors[o._FEATURE_RGBA4444]).buffer));const h=t.material;return r.material=function(t,e){const{emissiveFactor:i=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:o=.5,normalTexture:r,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=t,{baseColorFactor:u=[1,1,1,1],metallicFactor:c=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:f}=t.pbrMetallicRoughness||{},p=s?e[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&p){const t=s.extensions.KHR_texture_transform;p.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ae(...u),metallicFactor:c,roughnessFactor:h,baseColorTexture:d?e[d.index]:void 0,metallicRoughnessTexture:f?e[f.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:n,alphaCutoff:o,normalTexture:r?e[r.index]:void 0,occlusionTexture:p,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},i),r}function ev(t,e,i){const{matrix:n,rotation:o,translation:r,scale:s,mesh:a,extras:l,children:u}=t,c={};if(c.matrix=n||F.mat4.fromRotationTranslationScale([],o||[0,0,0,1],r||[0,0,0],s||[1,1,1]),void 0!==a){c.meshes=i[a];const t=c.anchor=[0,0];for(const e of c.meshes){const{min:i,max:n}=e.aabb;t[0]+=i[0]+n[0],t[1]+=i[1]+n[1]}t[0]=Math.floor(t[0]/c.meshes.length/2),t[1]=Math.floor(t[1]/c.meshes.length/2)}if(l&&(l.id&&(c.id=l.id),l.lights&&(c.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let n=0;n<e.length;n++)i[n]=e.codePointAt(n);return i}(t),i=[],n=e.length/24,o=new Uint16Array(e.buffer),r=new Float32Array(e.buffer);for(let s=0;s<n;s++){const t=o[2*s*6]/30,e=o[2*s*6+1]/30,n=o[2*s*6+10]/100,a=r[6*s+1],l=r[6*s+2],u=r[6*s+3],c=r[6*s+4],h=u-a,d=c-l,f=Math.hypot(h,d);i.push({pos:[a+.5*h,l+.5*d,e],normal:[d/f,-h/f,0],width:f,height:t,depth:n,points:[a,l,u,c]})}return i}(l.lights))),u){const t=[];for(const n of u)t.push(ev(e.json.nodes[n],e,i));c.children=t}return c}function iv(t){if(0===t.vertices.length||0===t.indices.length)return null;const e=new qc(t.vertices,t.indices,8,256),[i,n]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:n}}function nv(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const i=e[0];if(!i||!Array.isArray(i)||0===i.length)return null;const n=[];for(const s of i){if(!Array.isArray(s)||2!==s.length)continue;const t=s[0],e=s[1];"number"==typeof t&&"number"==typeof e&&n.push(new j(t,e))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let o=0;for(let s=0;s<n.length;s++){const t=n[s],e=n[(s+1)%n.length],i=n[(s+2)%n.length];o+=(t.x-e.x)*(i.y-e.y)-(i.x-e.x)*(t.y-e.y)}o>0&&n.reverse();const r=hc(n.flatMap((t=>[t.x,t.y])),[]);return 0===r.length?null:{vertices:n,indices:r}}function ov(t,e){const i=[],n=[];let o=0;const r=[];for(const s of t){o=i.length;const t=s.vertexArray.float32,a=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)r[0]=t[3*n+0],r[1]=t[3*n+1],r[2]=t[3*n+2],F.vec3.transformMat4(r,r,e),i.push(new j(r[0],r[1]));for(let e=0;e<3*s.indexArray.length;e++)n.push(a[e]+o)}if(n.length%3!=0)return null;for(let s=0;s<n.length;s+=3){const t=i[n[s+0]],e=i[n[s+1]],o=i[n[s+2]];(t.x-e.x)*(o.y-e.y)-(o.x-e.x)*(t.y-e.y)>0&&([n[s+1],n[s+2]]=[n[s+2],n[s+1]])}return{vertices:i,indices:n}}function rv(t){const e=function(t,e){const i=[],n=WebGL2RenderingContext;if(t.json.textures)for(const o of t.json.textures){const r={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==o.sampler&&Object.assign(r,t.json.samplers[o.sampler]),i.push({image:e[o.source],sampler:r,uploaded:!1})}return i}(t,t.images),i=function(t,e){const i=[];for(const n of t.json.meshes){const o=[];for(const i of n.primitives)o.push(tv(i,t,e));i.push(o)}return i}(t,e),{scenes:n,scene:o,nodes:r}=t.json,s=n?n[o||0].nodes:r,a=[];for(const l of s)a.push(ev(r[l],t,i));return function(t,e,i){const n={},o=new Set;for(let r=0;r<t.length;r++){const t=i[e[r]];if(!t.extras)continue;const s=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(s||a)&&o.add(r),"1.0.0"===s&&a&&(n[a]=r)}for(let r=0;r<t.length;r++){if(o.has(r))continue;const s=t[r],a=i[e[r]];if(!a.extras)continue;let l=null;s.id in n&&(l=ov(t[n[s.id]].meshes,s.matrix)),l||(l=nv(a)),l&&(s.footprint=iv(l))}if(o.size>0){const e=Array.from(o.values()).sort(((t,e)=>t-e));for(let i=e.length-1;i>=0;i--)t.splice(e[i],1)}}(a,s,t.json.nodes),a}function sv(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,n=t.aabb.min[1]-1,o=eg/(t.aabb.max[0]-i+2),r=eg/(t.aabb.max[1]-n+2);for(let s=0;s<e.length;s+=3){const a=e[s+2],l=(e[s+0]-i)*o|0,u=(e[s+1]-n)*r|0;a>t.heightmap[u*eg+l]&&(t.heightmap[u*eg+l]=a)}}function av(t,e){const i={};i.indexArray=new Os,i.indexArray.reserve(4*t.length),i.vertexArray=new Ss,i.vertexArray.reserve(10*t.length),i.colorArray=new Ps,i.vertexArray.reserve(10*t.length);let n=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*e,o=[-s.normal[1],s.normal[0],0],r=Math.min(.29,.1*s.width/s.depth),a=s.width-2*s.depth*e*(r+.01),l=F.vec3.scaleAndAdd([],s.pos,o,a/2),u=F.vec3.scaleAndAdd([],s.pos,o,-a/2),c=[l[0],l[1],l[2]+s.height],h=[u[0],u[1],u[2]+s.height],d=F.vec3.scaleAndAdd([],s.normal,o,r);F.vec3.scale(d,d,t);const f=F.vec3.scaleAndAdd([],s.normal,o,-r);F.vec3.scale(f,f,t),F.vec3.add(d,l,d),F.vec3.add(f,u,f),l[2]+=.1,u[2]+=.1,i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]);const p=a/t/2;i.colorArray.emplaceBack(-p-r,-1,p,.8),i.colorArray.emplaceBack(p+r,-1,p,.8),i.colorArray.emplaceBack(-p,0,p,1.3),i.colorArray.emplaceBack(p,0,p,1.3),i.colorArray.emplaceBack(p+r,-.8,p,.7),i.colorArray.emplaceBack(p+r,-.8,p,.7),i.colorArray.emplaceBack(0,0,p,1.3),i.colorArray.emplaceBack(0,0,p,1.3),i.colorArray.emplaceBack(p+r,-1.2,p,.8),i.colorArray.emplaceBack(p+r,-1.2,p,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const o={defined:!0,emissiveFactor:[0,0,0]},r={};return r.baseColorFactor=Ae.white,o.pbrMetallicRoughness=r,i.material=o,i.aabb=new _u([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class lv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const uv=["id","tile","layer","source","sourceLayer","state"];class cv{constructor(t,e,i,n,o){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=n,this.properties=t.properties,this.id=o}clone(){const t=new cv(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const e of uv)void 0!==this[e]&&(t[e]=this[e]);return t}}class hv{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new sr(Yi,16,0),this.featureIndexArray=new aa,this.promoteId=e,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,o,r);const l=this.grid;for(let u=0;u<e.length;u++){const t=e[u],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const n=t[e];i[0]=Math.min(i[0],n.x),i[1]=Math.min(i[1],n.y),i[2]=Math.max(i[2],n.x),i[3]=Math.max(i[3],n.y)}0!==s&&(i[0]-=s,i[1]-=s,i[2]+=s,i[3]+=s),i[0]<Yi&&i[1]<Yi&&i[2]>=0&&i[3]>=0&&l.insert(a,i[0],i[1],i[2],i[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fh.VectorTile(new df(this.rawTileData)).layers,this.sourceLayerCoder=new lv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e){var i=this;const{tilespaceGeometry:n,transform:o,tileTransform:r,pixelPosMatrix:s,availableImages:a}=e;this.loadVTLayers(),this.serializedLayersCache.clear();const l=n.bufferedTilespaceBounds,u=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,i,o)=>jl(n.bufferedTilespaceGeometry,t,e,i,o)));u.sort(fv);let c=null;o.elevation&&u.length>0&&(c=ug.create(o.elevation,this.tileID));const h={};let d;for(let f=0;f<u.length;f++){const e=u[f];if(e===d)continue;d=e;const l=this.featureIndexArray.get(e);let p=null;this.is3DTile?this.loadMatchingModelFeature(h,l,t,n,o):this.loadMatchingFeature(h,l,t,a,(function(t,e,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return p||(p=Il(t,i.tileID.canonical,r)),e.queryIntersectsFeature(n,t,a,p,i.z,o,s,c,l)}))}return h}loadMatchingFeature(t,e,i,n,o){const{featureIndex:r,bucketIndex:s,sourceLayerIndex:a,layoutVertexArrayOffset:l}=e,u=this.bucketLayerIDs[s],c=i.layers,h=Object.keys(c);if(h.length&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(h,u))return;const d=i.sourceCache,f=this.sourceLayerCoder.decode(a),p=this.vtLayers[f].feature(r),m=this.getId(p,f);for(let g=0;g<u.length;g++){const e=u[g];if(!c[e])continue;const{styleLayer:i,targets:s}=c[e];let a={};void 0!==m&&(a=d.getFeatureState(i.sourceLayer,m));const h=!o||o(p,i,a,l);if(!h)continue;const f=new cv(p,this.z,this.x,this.y,m);f.tile=this.tileID.canonical,f.state=a;let y=this.serializedLayersCache.get(e);y||(y=i.serialize(),y.id=e,this.serializedLayersCache.set(e,y)),f.source=y.source,f.sourceLayer=y["source-layer"],f.layer=nt({},y),f.layer.paint=dv(y.paint,i.paint,p,a,n),f.layer.layout=dv(y.layout,i.layout,p,a,n);let _=!1;for(const t of s){this.updateFeatureProperties(f,t);const{filter:e}=t;if(e)if(p.properties=f.properties,e.needGeometry){const t=El(p,!0);if(!e.filter(new Rr(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!e.filter(new Rr(this.tileID.overscaledZ),p))continue;_=!0,t.targetId&&this.addFeatureVariant(f,t)}_&&this.appendToResult(t,e,r,f,h)}}loadMatchingModelFeature(t,e,i,n,o){const r=this.bucketLayerIDs[0][0],s=i.layers;if(!s[r])return;const{styleLayer:a,targets:l}=s[r];if("model"!==a.type)return;const u=n.tile,c=e.featureIndex,h=u.getBucket(a);if(!(h&&h instanceof gg))return;const d=function(t,e,i,n){const o=t.getNodesInfo()[e];if(o.hiddenByReplacement||!o.node.meshes)return;let r=Number.MAX_VALUE;const s=o.node,a=i.tile,l=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),u=o.evaluatedScale;let c=0;n.elevation&&s.elevation&&(c=s.elevation*n.elevation.exaggeration()),F.mat4.translate(l,l,[(s.anchor?s.anchor[0]:0)*(u[0]-1),(s.anchor?s.anchor[1]:0)*(u[1]-1),c]),F.mat4.scale(l,l,u);const h=i.queryGeometry,d=h.isPointQuery()?h.screenBounds:h.screenGeometry,f=function(t){const e=F.mat4.multiply([],l,t.matrix);F.mat4.multiply(e,n.expandedFarZProjMatrix,e);for(let i=0;i<t.meshes.length;++i){const o=t.meshes[i];if(i===t.lightMeshIndex)continue;const s=Fm(d,n,e,o.aabb);null!=s&&(r=Math.min(s,r))}if(t.children)for(const i of t.children)f(i)};if(f(s),r===Number.MAX_VALUE)return;const p=new ol(0,0);return xg(a.tileID.canonical,p,o.node.anchor[0],o.node.anchor[1]),{intersectionZ:r,position:p,feature:o.feature}}(h,c,n,o);if(!d)return;const{z:f,x:p,y:m}=u.tileID.canonical,{feature:g,intersectionZ:y,position:_}=d;let v={};void 0!==g.id&&(v=i.sourceCache.getFeatureState(a.sourceLayer,g.id));const x=new cv({},f,p,m,g.id);x.tile=this.tileID.canonical,x.state=v,x.properties=g.properties,x.geometry={type:"Point",coordinates:[_.lng,_.lat]};let b=this.serializedLayersCache.get(r);b||(b=a.serialize(),b.id=r,this.serializedLayersCache.set(r,b)),x.source=b.source,x.sourceLayer=b["source-layer"],x.layer=nt({},b);let C=!1;for(const w of l){this.updateFeatureProperties(x,w);const{filter:t}=w;if(t)if(g.properties=x.properties,t.needGeometry){if(!t.filter(new Rr(this.tileID.overscaledZ),g,this.tileID.canonical))continue}else if(!t.filter(new Rr(this.tileID.overscaledZ),g))continue;C=!0,w.targetId&&this.addFeatureVariant(x,w)}C&&this.appendToResult(t,r,c,x,y)}updateFeatureProperties(t,e,i){if(e.properties){const n={};for(const o in e.properties){const r=e.properties[o].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,i);null!=r&&(n[o]=r)}t.properties=n}}addFeatureVariant(t,e,i){const n={target:e.target,namespace:e.namespace,uniqueFeatureID:e.uniqueFeatureID};e.properties&&(n.properties=t.properties),t.variants=t.variants||{},t.variants[e.targetId]=t.variants[e.targetId]||[],t.variants[e.targetId].push(n)}appendToResult(t,e,i,n,o){let r=t[e];void 0===r&&(r=t[e]=[]),r.push({featureIndex:i,feature:n,intersectionZ:o})}lookupSymbolFeatures(t,e,i,n,o){const r={};this.loadVTLayers();for(const s of t)this.loadMatchingFeature(r,{bucketIndex:e,sourceLayerIndex:i,featureIndex:s,layoutVertexArrayOffset:0},n,o);return r}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),o=this.vtFeatures[n];if(o[e])return o[e];const r=this.vtLayers[n].feature(e);return o[e]=r,r}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const n=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[e];if(null!=n)if(Array.isArray(n)){if(!this.promoteIdExpression){const t=Jo(n);if("success"!==t.result)return void ft(`Failed to create expression for promoteId: ${t.value.map((t=>`${t.key}: ${t.message}`)).join(", ")}`);this.promoteIdExpression=t.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new mi),i=this.promoteIdExpression.evaluate({zoom:0},t)}else i=t.properties[n];"boolean"==typeof i&&(i=Number(i))}return i}}function dv(t,e,i,n,o){return ut(t,((t,r)=>{const s=e instanceof Hr?e.get(r):null;return s&&s.evaluate?s.evaluate(i,n,o):s}))}function fv(t,e){return e-t}lr(hv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const o=pv[15&i];if(!o)throw new Error("Unrecognized array type.");const[r]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new mv(s,r,o,t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,n=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const o=pv.indexOf(this.ArrayType),r=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+r+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+o]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:r,nodeSize:s}=this,a=[0,o.length-1,0],l=[];for(;a.length;){const u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=s){for(let s=h;s<=c;s++){const a=r[2*s],u=r[2*s+1];a>=t&&a<=i&&u>=e&&u<=n&&l.push(o[s])}continue}const d=h+c>>1,f=r[2*d],p=r[2*d+1];f>=t&&f<=i&&p>=e&&p<=n&&l.push(o[d]),(0===u?t<=f:e<=p)&&(a.push(h),a.push(d-1),a.push(1-u)),(0===u?i>=f:n>=p)&&(a.push(d+1),a.push(c),a.push(1-u))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:r}=this,s=[0,n.length-1,0],a=[],l=i*i;for(;s.length;){const u=s.pop()||0,c=s.pop()||0,h=s.pop()||0;if(c-h<=r){for(let i=h;i<=c;i++)xv(o[2*i],o[2*i+1],t,e)<=l&&a.push(n[i]);continue}const d=h+c>>1,f=o[2*d],p=o[2*d+1];xv(f,p,t,e)<=l&&a.push(n[d]),(0===u?t-i<=f:e-i<=p)&&(s.push(h),s.push(d-1),s.push(1-u)),(0===u?t+i>=f:e+i>=p)&&(s.push(d+1),s.push(c),s.push(1-u))}return a}}function gv(t,e,i,n,o,r){if(o-n<=i)return;const s=n+o>>1;yv(t,e,s,n,o,r),gv(t,e,i,n,s-1,1-r),gv(t,e,i,s+1,o,1-r)}function yv(t,e,i,n,o,r){for(;o>n;){if(o-n>600){const s=o-n+1,a=i-n+1,l=Math.log(s),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(s-u)/s)*(a-s/2<0?-1:1);yv(t,e,i,Math.max(n,Math.floor(i-a*u/s+c)),Math.min(o,Math.floor(i+(s-a)*u/s+c)),r)}const s=e[2*i+r];let a=n,l=o;for(_v(t,e,n,i),e[2*o+r]>s&&_v(t,e,n,o);a<l;){for(_v(t,e,a,l),a++,l--;e[2*a+r]<s;)a++;for(;e[2*l+r]>s;)l--}e[2*n+r]===s?_v(t,e,n,l):(l++,_v(t,e,l,o)),l<=i&&(n=l+1),i<=l&&(o=l-1)}}function _v(t,e,i,n){vv(t,i,n),vv(e,2*i,2*n),vv(e,2*i+1,2*n+1)}function vv(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function xv(t,e,i,n){const o=t-i,r=e-n;return o*o+r*r}t.$=Yr,t.A=ti,t.B=2,t.C=Gf,t.D=Ig,t.E=Ce,t.F=Hf,t.G=class extends $m{},t.H=hi,t.I=Sy,t.J=ke,t.K=$r,t.L=No,t.M=Oo,t.N=Fo,t.O=Yo,t.P=j,t.Q=Kr,t.R=te,t.S=tr,t.T=pm,t.U=Jo,t.V=$m,t.W=Bn,t.X=Rn,t.Y=kn,t.Z=gi,t._=Te,t.a=function(t){return Tt.API_CDN_URL_REGEX.test(t)},t.a$=cv,t.a0=Vo,t.a1=Uo,t.a2=function(t){const e=t.value;let i=[];if(!e)return i;const n=hi(e);return"string"!==n?(i=i.concat([new $m(t.key,e,`string expected, "${n}" found`)]),i):(Km(e,!0)||(i=i.concat([new $m(t.key,e,`invalid url "${e}"`)])),i)},t.a3=Zr,t.a4=Or,t.a5=qr,t.a6=jr,t.a7=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return gt(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ie(t.x,e.x,i),y:Ie(t.y,e.y,i),z:Ie(t.z,e.z,i),azimuthal:Ie(t.azimuthal,e.azimuthal,i),polar:Ie(t.polar,e.polar,i)}}},t.a8=Rr,t.a9=Qo,t.aA=cl,t.aB=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const o=this.entries[t]=this.entries[t]||{callbacks:[]};if(o.result){const[t,i]=o.result;return this.scheduler?this.scheduler.add((()=>{n(t,i)}),e):n(t,i),()=>{}}return o.callbacks.push(n),o.cancel||(o.cancel=i(((i,n)=>{o.result=[i,n];for(const t of o.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,n)}),e):t(i,n);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{o.result||(o.callbacks=o.callbacks.filter((t=>t!==n)),o.callbacks.length||(o.cancel(),delete this.entries[t]))}}},t.aC=cs,t.aD=function(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const n=oe(t.request,((t,n,o,r)=>{t?e(t):n&&e(null,{vectorTile:i?void 0:new fh.VectorTile(new df(n)),rawData:n,cacheControl:o,expires:r})}));return()=>{n.cancel(),e()}}),e)},t.aE=function(t){qt++,qt>Nt&&(t.getActor().send("enforceCacheSizeLimit",Ft),qt=0)},t.aF=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.aG=ou,t.aH=bm,t.aI=Mm,t.aJ=vm,t.aK=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const e=document.createElement("source");re(t[n])||(i.crossOrigin="Anonymous"),e.src=t[n],i.appendChild(e)}return{cancel:()=>{}}},t.aL=mm,t.aM=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>J_(e,0,t)))},t.aN=rv,t.aO=class{constructor(t,e,i,n){this.id=t,this.position=null!=e?new ol(e[0],e[1]):new ol(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new _u([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(F.mat4.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const e=_u.applyTransformFast(i.aabb,t.matrix);this.aabb.encapsulate(e)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=F.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];ng(this.matrix,this,t.transform,this.position,e,i,n,o,r,s)}upload(t){if(!this.uploaded){for(const e of this.nodes)sg(e,t);for(const t of this.nodes)ag(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)lg(t)}},t.aP=at,t.aQ=Cp,t.aR=dl,t.aS=fl,t.aT=bs,t.aU=Os,t.aV=rt,t.aW=Qs,t.aX=tm,t.aY=function(){Dr.isLoading()||Dr.isLoaded()||"deferred"!==kr()||Br()},t.aZ=Jr,t.a_=El,t.aa=xl,t.ab=F,t.ac=tt,t.ad=Hr,t.ae=Uu,t.af=Ie,t.ag=Yi,t.ah=Ee,t.ai=Z,t.aj=Ae,t.ak=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function(t){let[e,i]=t;const n=gt([1,e,i]);return{x:n.x,y:n.y,z:n.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ie(t.x,e.x,i),y:Ie(t.y,e.y,i),z:Ie(t.z,e.z,i)}}},t.al=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=new j(i,i),r=t.sub(o),s=e.add(o),a=[r,new j(s.x,r.y),s,new j(r.x,s.y)];return n&&a.push(r.clone()),a},t.am=function(t,e){const i=[];for(let n=0;n<t.length;n++){const o=et(n-1,-1,t.length-1),r=et(n+1,-1,t.length-1),s=t[n],a=t[r],l=t[o].sub(s).unit(),u=a.sub(s).unit(),c=u.angleWithSep(l.x,l.y),h=l.add(u).unit().mult(-1*e/Math.sin(c/2));i.push(s.add(h))}return i},t.an=wp,t.ao=jl,t.ap=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return F.vec3.fromValues(((e.x-i)*t.scale-t.x)*Yi,(e.y*t.scale-t.y)*Yi,pl(e.z,e.y))},t.aq=hu,t.ar=Id,t.as=function(t){let e=1/0,i=1/0,n=-1/0,o=-1/0;for(const r of t)e=Math.min(e,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),o=Math.max(o,r.y);return{min:new j(e,i),max:new j(n,o)}},t.at=ul,t.au=Hl,t.av=Cl,t.aw=Q,t.ax=qa,t.ay=function(t,e){const i={};for(let n=0;n<e.length;n++){const o=e[n];o in t&&(i[o]=t[o])}return i},t.az=rl,t.b=function(t){return Tt.API_FONTS_REGEX.test(t)},t.b$=Bm,t.b0=_t,t.b1=Sd,t.b2=Vc,t.b3=Il,t.b4=vs,t.b5=Zs,t.b6=cu,t.b7=fa,t.b8=hc,t.b9=hm,t.bA=Ph,t.bB=dp,t.bC=hp,t.bD=Ef,t.bE=mv,t.bF=et,t.bG=xt,t.bH=hl,t.bI=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.bJ=Ea,t.bK=Sa,t.bL=Ta,t.bM=wa,t.bN=Ca,t.bO=ol,t.bP=Gp,t.bQ=nu,t.bR=yu,t.bS=km,t.bT=iu,t.bU=Mu,t.bV=function(t,e,i,n,o,r,s,a,l){if("globe"===l.name)return Mu(t,e,new iu(i,n,o),!1);const u=Cp({z:i,x:n,y:o},l);return new _u([(r+u.x/u.scale)*e,e*(u.y/u.scale),s],[(r+u.x2/u.scale)*e,e*(u.y2/u.scale),a])},t.bW=function(t,e,i){let n=0;for(let o=0;o<2;++o){const i=0;t[o]>i&&(n+=(t[o]-i)*(t[o]-i)),e[o]<i&&(n+=(i-e[o])*(i-e[o]))}return n},t.bX=ml,t.bY=$a,t.bZ=function(t){const e=F.mat4.identity(new Float64Array(16));F.mat4.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,Xa,0],n=[0,Qa,0];return F.vec3.transformMat4(i,i,e),F.vec3.transformMat4(n,n,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Nu(t,new ol(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Nu(t,new ol(t.center.lat,-90))]},t.b_=function(t,e){const{scale:i}=t.tileTransform,n=i*Yi/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return F.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},t.ba=function(t,e){const i=Uu(e.zoom);if(0===i)return Su(t);const n=Iu(t),o=Eu(n),r=ul(n.getWest())*e.worldSize,s=ul(n.getEast())*e.worldSize,a=cl(n.getNorth())*e.worldSize,l=cl(n.getSouth())*e.worldSize,u=[r,a,0],c=[s,a,0],h=[r,l,0],d=[s,l,0],f=F.mat4.invert([],e.globeMatrix);return F.vec3.transformMat4(u,u,f),F.vec3.transformMat4(c,c,f),F.vec3.transformMat4(h,h,f),F.vec3.transformMat4(d,d,f),o[0]=Tu(o[0],h,i),o[1]=Tu(o[1],d,i),o[2]=Tu(o[2],c,i),o[3]=Tu(o[3],u,i),_u.fromPoints(o)},t.bb=Du,t.bc=Pu,t.bd=Tu,t.be=xs,t.bf=uu,t.bg=A_,t.bh=df,t.bi=oe,t.bj=function(t){const e=[];for(const i in t)e.push(t[i]);return e},t.bk=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},t.bl=it,t.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.bn=G,t.bo=function(t,e){const{x:i,y:n}=t.point,o=Ou(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return F.mat4.multiply(o,o,Ru(Su(e)))},t.bp=Qd,t.bq=_f,t.br=Xd,t.bs=function(t,e,i,n,o){const r=5*e+2;t.float32[r+0]=i,t.float32[r+1]=n,t.float32[r+2]=o},t.bt=Yp,t.bu=Vf,t.bv=Dl,t.bw=$d,t.bx=xh,t.by=Zm,t.bz=Eh,t.c=Mt,t.c$=(t,e,i,n,o,r,s,a)=>{const l=t.transform,u=l.pitch<15?Ed(.07,.7,Q((14-l.zoom)/5,0,1)):.07,c="none"===i.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:kd(t,e,i,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:o,u_width_scale:r,u_floor_width_scale:s,u_image:0,u_tile_units_to_pixels:Pd(e,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(c?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:u,u_tile_to_meter:vl(e.tileID.canonical,0)}},t.c0=Pm,t.c1=function(t){const e=Pm(t,!0);return F.mat2.invert([],[e[0],e[1],e[4],e[5]])},t.c2=du,t.c3=function(t){const{x:e,y:i}=t.point,{lng:n,lat:o}=t._center;return Ou(e,i,t.worldSize,n,o)},t.c4=$,t.c5=ru,t.c6=Za,t.c7=function(t){const e=Math.round((t+45+360)%360/90)%4;return K[e]},t.c8=45,t.c9=ll,t.cA=class extends ba{constructor(t){super(t),this.current=Pa}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},t.cB=Y,t.cC=function(t,e,i){const n=Uu(i.zoom),o=t.style.map._antialias,r=t.terrain&&t.terrain.exaggeration()>0;return 0===n&&!o&&!r},t.cD=function(t){const e=t.pixelsPerMeter,i=e/hl(1,t.center.lat),n=F.mat4.identity(new Float64Array(16));return F.mat4.translate(n,n,[t.point.x,t.point.y,0]),F.mat4.scale(n,n,[i,i,e]),Float32Array.from(n)},t.cE=Iu,t.cF=function(t){const e=ml-5;t=Q(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Z(t))),3);return Math.round(i*(Ja.length-1))},t.cG=function(t,e,i,n){const o=e.getNorth(),r=e.getSouth(),s=e.getWest(),a=e.getEast(),l=1<<t.z,u=a-s,c=o-r,h=u/Ya,d=-c/Ja[i],f=[0,h,0,d,0,0,o,s,0];if(t.z>0){const t=180/n;F.mat3.multiply(f,f,[t/u+1,0,0,0,t/c+1,0,-.5*t/h,.5*t/d,1])}return f[2]=l,f[5]=t.x,f[8]=t.y,f},t.cH=Su,t.cI=function(t,e,i){const n=F.mat4.identity(new Float64Array(16)),o=(e/(1<<t)-.5)*Math.PI*2;return F.mat4.rotateY(n,i.globeMatrix,o),Float32Array.from(n)},t.cJ=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,o=Math.floor(t.x),r=Math.floor((t.x-o)*n),s=Math.floor(t.y*n),a=this.findDEMTileFor(new ou(i,o,i,r,s));return!(!a||!a.dem)}getAtPointOrZero(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(t,e)||0}getAtPoint(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const o=n.getSource().maxzoom,r=1<<o,s=Math.floor(t.x),a=t.x-s,l=new ou(o,s,o,Math.floor(a*r),Math.floor(t.y*r)),u=this.findDEMTileFor(l);if(!u||!u.dem)return e;const c=u.dem,h=1<<u.tileID.canonical.z,d=(a*h-u.tileID.canonical.x)*c.dim,f=(t.y*h-u.tileID.canonical.y)*c.dim,p=Math.floor(d),m=Math.floor(f);return(i?this.exaggeration():1)*Ie(Ie(c.get(p,m),c.get(p,m+1),f-m),Ie(c.get(p+1,m),c.get(p+1,m+1),f-m),d-p)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new xl(t.wrap+(t.canonical.x+e/Yi)/n,(t.canonical.y+i/Yi)/n))}getAtTileOffsetFunc(t,e,i,n){return o=>{const r=this.getAtTileOffset(t,o.x,o.y),s=n.upVector(t.canonical,o.x,o.y),a=n.upVectorScale(t.canonical,e,i).metersToTile;return F.vec3.scale(s,s,r*a),s}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const o=ug.create(this,t,n);return!!o&&(e.forEach((t=>{t[2]=this.exaggeration()*o.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,o=1<<t.canonical.z-n.canonical.z;let r=t.canonical.x/o-n.canonical.x,s=t.canonical.y/o-n.canonical.y,a=0;for(let l=0;l<t.canonical.z-n.canonical.z&&!i.leaves[a];l++){r*=2,s*=2;const t=2*Math.floor(s)+Math.floor(r);a=i.childOffsets[a]+t,r%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const o of t){const t=this.getMinMaxForTile(o.tileID);t&&(i=Math.min(i,t.min),n=Math.max(n,t.max),e=!0)}return e?{min:i,max:n}:null}},t.cK=ac,t.cL=vu,t.cM=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.cN=zu,t.cO=St,t.cP=wt,t.cQ=256,t.cR=function(t,e){const i=[0,0,0],n=Du(Su(e.canonical));return F.vec3.transformMat4(i,i,n),F.vec3.transformMat4(i,i,t),i},t.cS=t=>({u_camera_to_center_distance:new wa(t),u_extrude_scale:new Ba(t),u_device_pixel_ratio:new wa(t),u_matrix:new Ea(t),u_inv_rot_matrix:new Ea(t),u_merc_center:new Sa(t),u_tile_id:new Ta(t),u_zoom_transition:new wa(t),u_up_dir:new Ta(t),u_emissive_strength:new wa(t)}),t.cT=t=>({u_matrix:new Ea(t),u_pixels_to_tile_units:new Ba(t),u_device_pixel_ratio:new wa(t),u_width_scale:new wa(t),u_floor_width_scale:new wa(t),u_units_to_pixels:new Sa(t),u_dash_image:new Ca(t),u_gradient_image:new Ca(t),u_image_height:new wa(t),u_texsize:new Sa(t),u_tile_units_to_pixels:new wa(t),u_alpha_discard_threshold:new wa(t),u_trim_offset:new Sa(t),u_trim_fade_range:new Sa(t),u_trim_color:new Aa(t),u_emissive_strength:new wa(t),u_zbias_factor:new wa(t),u_tile_to_meter:new wa(t)}),t.cU=t=>({u_matrix:new Ea(t),u_texsize:new Sa(t),u_pixels_to_tile_units:new Ba(t),u_device_pixel_ratio:new wa(t),u_width_scale:new wa(t),u_floor_width_scale:new wa(t),u_image:new Ca(t),u_units_to_pixels:new Sa(t),u_tile_units_to_pixels:new wa(t),u_alpha_discard_threshold:new wa(t),u_trim_offset:new Sa(t),u_trim_fade_range:new Sa(t),u_trim_color:new Aa(t),u_emissive_strength:new wa(t),u_zbias_factor:new wa(t),u_tile_to_meter:new wa(t)}),t.cV=Ls,t.cW=Zd,t.cX=tf,t.cY=Wu,t.cZ=(t,e,i,n,o,r)=>{const s=t.transform,a="globe"===s.projection.name;let l;if("map"===r.paint.get("circle-pitch-alignment"))if(a){const t=zu(s.zoom,e.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(s.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Lt.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Gu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:r.paint.get("circle-emissive-strength")};if(a){u.u_inv_rot_matrix=n,u.u_merc_center=o,u.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],u.u_zoom_transition=Uu(s.zoom);const t=o[0]*Yi,i=o[1]*Yi;u.u_up_dir=s.projection.upVector(new iu(0,0,0),t,i)}return u},t.c_=Bd,t.ca=Aa,t.cb=function(t,e,i){const n=Math.sqrt(t*t+e*e+i*i),o=n>0?Math.acos(i/n)*q:0;let r=0!==t||0!==e?Math.atan2(-e,-t)*q+90:0;return r<0&&(r+=360),[n,r,o]},t.cc=vl,t.cd=_u,t.ce=gt,t.cf=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.cg=function(t,e){return t.readFields(Fg,{icons:[]},e)},t.ch=function(t){return t({pluginStatus:Ar,pluginURL:Mr}),Pr.on("pluginStateChange",t),t},t.ci=kg,t.cj=Jf,t.ck=Yf,t.cl=ie,t.cm=Ir,t.cn=Ot,t.co=ye,t.cp=ht,t.cq=function(t){const e=t.indexOf(us);return e>=0?t.slice(0,e):t},t.cr=function(t){return t.indexOf(us)>=0},t.cs=function(t){const e=t.indexOf(us);return e>=0?t.slice(e+1):""},t.ct=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cu=function(t,e,i,n){return"custom"===t.type?new Im(t,e):new bg[t.type](t,e,i,n)},t.cv=ct,t.cw=class extends cv{constructor(t,e){super(t._vectorTileFeature,t._z,t._x,t._y,t.id),t.state&&(this.state=Object.assign({},t.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=t.source,this.sourceLayer=t.sourceLayer,this.layer=t.layer)}toJSON(){const t=super.toJSON();return t.target=this.target,t.namespace=this.namespace,t}},t.cx=Pr,t.cy=ne,t.cz=Ma,t.d=function(t){return Tt.API_TILEJSON_REGEX.test(t)},t.d$=hv,t.d0=(t,e,i,n,o,r,s,a,l)=>{const u=t.transform,c=u.calculatePixelsToTileUnitsMatrix(e),h="none"===i.paint.get("line-trim-color-use-theme").constantOr("default"),d=u.pitch<15?Ed(.07,.7,Q((14-u.zoom)/5,0,1)):.07;return{u_matrix:kd(t,e,i,n),u_pixels_to_tile_units:c,u_device_pixel_ratio:r,u_width_scale:s,u_floor_width_scale:a,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:Dd(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Pd(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(h?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:d,u_tile_to_meter:vl(e.tileID.canonical,0)}},t.d1=st,t.d2=lc,t.d3=rd,t.d4=su,t.d5=Jh,t.d6=Fh,t.d7=450,t.d8=7,t.d9=xm,t.dA=X,t.dB=_l,t.dC=el,t.dD=function(t){let[e,i,n]=t;const o=Math.hypot(e,i,n),r=Math.atan2(e,n),s=.5*Math.PI-Math.acos(-i/o);return new ol($(r),$(s))},t.dE=Rm,t.dF=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==vt){const e=t.navigator?t.navigator.userAgent:null;vt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return vt}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.dG=function(t,e){Ft=t,Nt=e},t.dH=Nu,t.dI=Fu,t.dJ=function(t){const e=[0,0,0],i=F.mat4.identity(new Float64Array(16));return F.mat4.multiply(i,t.pixelMatrix,t.globeMatrix),F.vec3.transformMat4(e,e,i),new j(e[0],e[1])},t.dK=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ar===Cr||Ar===wr||Ar===Sr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mr=Lt.resolveURL(t),Ar=Cr,Tr=e,Er(),i||Br()},t.dL=kr,t.dM=function(){kg().acquire(Ag)},t.dN=function(){const t=Eg;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ag),Eg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dO=Mg,t.dP=function(t){const e=Gt();if(!e)return;const i=e.delete(Ut);t&&i.catch(t).then((()=>t()))},t.dQ=Tg,t.dR=L_,t.dS=function(t){P_=Lt.resolveURL(t),R_||(R_=new Ig(kg(),new Ce)),R_.broadcast("setDracoUrl",P_)},t.dT=z_,t.dU=function(t){B_=Lt.resolveURL(t),R_||(R_=new Ig(kg(),new Ce)),R_.broadcast("setMeshoptUrl",B_)},t.dV=lr,t.dW=rc,t.dX=Kf,t.dY=fh,t.dZ=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const n=F.vec2.dot(e,this.dir);if(Math.abs(n)<1e-6)return!1;const o=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1])/n;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,!0}},t.d_=lv,t.da=ys,t.db=Ys,t.dc=256,t.dd=Ru,t.de=Ss,t.df=Vs,t.dg=Hs,t.dh=function(t,e,i,n,o){return Q((t-e)/(i-e)*(o-n)+n,n,o)},t.di=Mo,t.dj=yl,t.dk=class{constructor(t,e,i,n){this.context=t,this.format=n,this.size=i,this.texture=t.gl.createTexture();const[o,r,s]=this.size,{gl:a}=t;a.bindTexture(a.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1),a.texImage3D(a.TEXTURE_3D,0,this.format,o,r,s,0,dm(this.format),fm(this.format),e.data)}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_3D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},t.dl=Um,t.dm=[1,1,1],t.dn=ug,t.dp=ig,t.dq=Bs,t.dr=Ws,t.ds=il,t.dt=Gs,t.du=js,t.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new j(1/0,1/0),max:new j(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Th(new j(0,0),new j(Yi,Yi),t),n=[];if(e&&!wh(i,this._globalClipBounds))return n;for(const o of this._activeRegions){if(o.hiddenByOverlap)continue;if(!wh(i,o))continue;const e=Ah(o.min,o.max,t);n.push({min:e.min,max:e.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId,order:o.order,clipMask:o.clipMask,clipScope:o.clipScope})}return n}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const i of t.cache.getVisibleCoordinates()){const n=t.cache.getTile(i).buckets[t.layer];n&&n.updateFootprints(i.toUnwrapped(),e)}return e},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope}))))}_addSource(t){const e=t.getFootprints();if(0===e.length)return;const i=t.getOrder(),n=t.getClipMask(),o=t.getClipScope();for(const r of e){if(!r.footprint)continue;const t=Th(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint,order:i,clipMask:n,clipScope:o})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||bh(t.min,e.min)||bh(t.max,e.max)||t.order-e.order||t.clipMask-e.clipMask||function(t,e){const i=(t,e)=>t+e;return t.length-e.length||t.reduce(i,"").localeCompare(e.reduce(i,""))}(t.clipScope,e.clipScope)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const i=this._activeRegions[e],n=this._prevRegions[e];t=i.priority!==n.priority||!Ch(i,n)||i.order!==n.order||i.clipMask!==n.clipMask||!G(i.clipScope,n.clipScope),++e}}if(t){++this._updateTime;for(const e of this._activeRegions)e.order!==vh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,e.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,e.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,e.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,e.max.y));const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const i=e[t].priority;for(;t<e.length&&e[t].priority===i;)++t;return t};if(this._sourceIds.length>1){let e=0,i=t(e);for(;e!==i;){let n=e;const o=e;for(;n!==i;){const t=this._activeRegions[n];t.hiddenByOverlap=!1;for(let e=0;e<o;e++){const i=this._activeRegions[e];if(!i.hiddenByOverlap&&t.order===vh&&wh(t,i)&&(t.hiddenByOverlap=Ih(t.footprint,t.tileId,i.footprint,i.tileId),t.hiddenByOverlap))break}++n}e=i,i=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},t.dw=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new vs,n=new Os,o=[],r=t+1+2,s=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,i)=>{let n=t===r-1?t-2:0===t?t:t-1;return n+=i?24575:0,[n,e]};for(let u=0;u<r;++u)i.emplaceBack(...l(u,0,!0));for(let u=0;u<s;++u)for(let t=0;t<r;++t)i.emplaceBack(...l(t,u,(0===t||t===r-1)&&!0));for(let u=0;u<e.length;++u){const t=e[u];for(let e=0;e<r;++e)i.emplaceBack(...l(e,t,!0))}for(let u=0;u<e.length;++u){const t=n.length,s=e[u]+1+2,l=new Os;for(let i=0;i<s-1;i++){const t=i===s-2,o=t?r*(a-e.length+u-i):r;for(let e=0;e<r-1;e++){const s=i*r+e;0===i||t||0===e||e===r-2?(l.emplaceBack(s+1,s,s+o),l.emplaceBack(s+o,s+o+1,s+1)):(n.emplaceBack(s+1,s,s+o),n.emplaceBack(s+o,s+o+1,s+1))}}const c=fa.simpleSegment(0,t,i.length,n.length-t);for(let e=0;e<l.uint16.length;e+=3)n.emplaceBack(l.uint16[e],l.uint16[e+1],l.uint16[e+2]);const h=fa.simpleSegment(0,t,i.length,n.length-t);o.push({withoutSkirts:c,withSkirts:h})}return{vertices:i,indices:n,segments:o}}_createGrid(t){const e=this._fillGridMeshWithLods(Ya,Ja);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,cu.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Os;for(let s=0;s<=Ya;s++)e.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Vs,n=new Vs,o=new Vs,r=new Vs;this._poleSegments=[];for(let s=0,a=0;s<Za;s++){const t=360/(1<<s);i.emplaceBack(0,-qa,0,.5,0),n.emplaceBack(0,-qa,0,.5,1),o.emplaceBack(0,-qa,0,.5,.5),r.emplaceBack(0,-qa,0,.5,.5);for(let e=0;e<=Ya;e++){let s=e/Ya,a=0;const l=Ie(0,t,s),[u,c,h]=tl(Hu,ju,l,qa);i.emplaceBack(u,c,h,s,a),n.emplaceBack(u,c,h,s,1-a);const d=Z(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),o.emplaceBack(u,c,h,s,a),r.emplaceBack(u,c,h,s,1-a)}this._poleSegments.push(fa.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,lu,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,lu,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(o,lu,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(r,lu,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.dx=vh,t.dy=J,t.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.e=Tt,t.e0=xd,t.e1=ut,t.e2=Qe,t.e3=Wf,t.e4=function(t,e,i,n,o,r,s,a,l,u){let c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0;t.createArrays(),t.tilePixelRatio=Yi/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const f=t.layers[0].layout,p=t.layers[0]._unevaluatedLayout._values,m={};m.scaleFactor=c,m.textSizeScaleRange=f.get("text-size-scale-range"),m.iconSizeScaleRange=f.get("icon-size-scale-range");const[g,y]=m.textSizeScaleRange,[_,v]=m.iconSizeScaleRange;if(m.textScaleFactor=Q(m.scaleFactor,g,y),m.iconScaleFactor=Q(m.scaleFactor,_,v),"composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;m.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Rr(e),a),p["text-size"].possiblyEvaluate(new Rr(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;m.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Rr(e),a),p["icon-size"].possiblyEvaluate(new Rr(i),a)]}m.layoutTextSize=p["text-size"].possiblyEvaluate(new Rr(l+1),a),m.layoutIconSize=p["icon-size"].possiblyEvaluate(new Rr(l+1),a),m.textMaxSize=p["text-size"].possiblyEvaluate(new Rr(18),a);const x="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),b=f.get("text-size");let C=!1;for(const w of t.features)if(w.icon&&w.icon.nameSecondary){C=!0;break}for(const w of t.features){const r=f.get("text-font").evaluate(w,{},a).join(","),l=b.evaluate(w,{},a)*m.textScaleFactor,c=m.layoutTextSize.evaluate(w,{},a)*m.textScaleFactor,g=(m.layoutIconSize.evaluate(w,{},a),{horizontal:{},vertical:void 0}),y=w.text;let _,v=[0,0];if(y){const n=y.toString(),s=f.get("text-letter-spacing").evaluate(w,{},a)*$d,u=f.get("text-line-height").evaluate(w,{},a)*$d,h=mr(n)?s:0,d=f.get("text-anchor").evaluate(w,{},a),p=f.get("text-variable-anchor");if(!p){const t=f.get("text-radial-offset").evaluate(w,{},a);v=t?hp(d,[t*$d,up]):f.get("text-offset").evaluate(w,{},a).map((t=>t*$d))}let m=x?"center":f.get("text-justify").evaluate(w,{},a);const _="point"===f.get("symbol-placement"),b=_?f.get("text-max-width").evaluate(w,{},a)*$d:1/0,C=s=>{t.allowVerticalPlacement&&pr(n)&&(g.vertical=bf(y,e,i,o,r,b,u,d,s,h,v,_f.vertical,!0,c,l))};if(!x&&p){const t="auto"===m?p.map((t=>dp(t))):[m];let n=!1;for(let s=0;s<t.length;s++){const a=t[s];if(!g.horizontal[a])if(n)g.horizontal[a]=g.horizontal[0];else{const t=bf(y,e,i,o,r,b,u,"center",a,h,v,_f.horizontal,!1,c,l);t&&(g.horizontal[a]=t,n=1===t.positionedLines.length)}}C("left")}else{if("auto"===m&&(m=dp(d)),_||f.get("text-writing-mode").indexOf("horizontal")>=0||!pr(n)){const t=bf(y,e,i,o,r,b,u,d,m,h,v,_f.horizontal,!1,c,l);t&&(g.horizontal[m]=t)}C(_?"left":m)}}let S=!1;if(w.icon&&w.icon.namePrimary){const e=Yd(t.iconSizeData,p["icon-size"],a,t.zoom,w)*m.iconScaleFactor*h,i=w.icon.getPrimary().scaleSelf(e).serialize(),r=n[i];r&&(_=kf(o[i],w.icon.nameSecondary?o[w.icon.getSecondary().scaleSelf(e).serialize()]:void 0,f.get("icon-offset").evaluate(w,{},a),f.get("icon-anchor").evaluate(w,{},a)),S=r.sdf,void 0===t.sdfIcons?t.sdfIcons=r.sdf:t.sdfIcons!==r.sdf&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(r.pixelRatio!==t.pixelRatio||0!==f.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const T=yp(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!T&&T.iconsInText),(T||_)&&fp(t,w,g,_,n,m,c,0,v,S,s,a,u,d,C)}r&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray,m.textScaleFactor)},t.e5=zy,t.e6=H,t.e7=dh,t.e8=hf,t.e9=e,t.ea=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==W_){const i=new Uint32Array(t,0,7),[,,n,o,r,s]=i;e=i.byteLength+o+r+s+r,(n!==t.byteLength||e>=t.byteLength)&&ft("Invalid b3dm header information.")}return J_(t,e)},t.eb=function(t,e){const i=rv(t);for(const n of i){for(const t of n.meshes)sv(t);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(av(n.lights,e)))}return i},t.ec=gg,t.ed=Sg,t.ee=Dr,t.ef=function(t){Wt(),null!=Ht&&Ht.then((e=>{e.keys().then((i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])}))}))},t.f=function(t){return 0===t.indexOf("mapbox:")},t.g=function(t,e){return ne(nt(t,{method:"GET"}),e)},t.h=At,t.i=function(t){return Tt.API_STYLE_REGEX.test(t)&&!Mt(t)},t.j=function(t){return decodeURIComponent(atob(t).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join(""))},t.k=function(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e)))))},t.l=nt,t.m=Zt,t.n=function(t,e){return ne(nt(t,{type:"json"}),e)},t.o=ue,t.p=function(t,e){return ne(nt(t,{method:"POST"}),e)},t.q=Lt,t.r=sc,t.s=function(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}},t.t=Rt,t.u=function(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()},t.v=function(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)},t.w=ft,t.x=function(){return Pg||(Pg=new Mg),Pg},t.y=ve,t.z=_e})),n(["./shared"],(function(t){function e(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function i(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+=`${i(n)},`;return`${e}]`}let e="{";for(const n of Object.keys(t).sort())e+=`${n}:${i(t[n])},`;return`${e}}`}function n(e){let n="";for(const o of t.bm)("model"!==e.type||"minzoom"!==o&&"maxzoom"!==o)&&(n+=`/${i(e[o])}`);return n}class o{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,o,r){this._options=r;for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.cu(i,this.scope,null,this._options)).compileFilter(r),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of o)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const s=function(t,e){const o={};for(let s=0;s<t.length;s++){const r=t[s];let a=e&&e[r.id];!a&&(a=n(r),"line"===r.type&&r.paint)&&function t(e){return"string"==typeof e&&"line-progress"===e||(Array.isArray(e)?e.some(t):!(!e||"object"!=typeof e)&&Object.values(e).some(t))}(r.paint["line-width"])&&(a+=`/${i(r.paint["line-width"])}`),e&&(e[r.id]=a);let l=o[a];l||(l=o[a]=[]),l.push(r)}const r=[];for(const i in o)r.push(o[i]);return r}(t.bj(this._layerConfigs),this.keyCache);for(const t of s){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let o=this.familiesBySource[n];o||(o=this.familiesBySource[n]={});const r=i.sourceLayer||"_geojsonTileLayer";let s=o[r];s||(s=o[r]=[]),s.push(e)}}}const r=1*t.dX;class s{constructor(e){const i={},n=[];for(const t in e){const o=e[t],s=i[t]={};for(const t in o.glyphs){const e=o.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i=e.metrics.localGlyph?r:1,a={x:0,y:0,w:e.bitmap.width+2*i,h:e.bitmap.height+2*i};n.push(a),s[t]=a}}const{w:o,h:s}=t.F(n),a=new t.dW({width:o||1,height:s||1});for(const l in e){const n=e[l];for(const e in n.glyphs){const o=n.glyphs[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const s=i[l][e],u=o.metrics.localGlyph?r:1;t.dW.copy(o.bitmap,a,{x:0,y:0},{x:s.x+u,y:s.y+u},o.bitmap)}}this.image=a,this.positions=i}}t.dV(s,"GlyphAtlas");const a="3d_elevation_id",l="hd_road_elevation";class u{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(t,e){return this._valid&&t(e(this._geometry)),this}require(t,e,i){return this.get(t,!0,e,i)}optional(t,e,i){return this.get(t,!1,e,i)}success(){return this._valid}get(t,e,i,n){const o=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&void 0!==o?i(n?n(o):o):e&&(this._valid=!1),this}}class c{constructor(t,e){this.featureFunc=t,this.vertexFunc=e}parseFeature(t,e,i){return this.featureFunc(t,e,i)}parseVertex(t,e,i){return this.vertexFunc(t,e,i)}}const h=new c(((t,e,i)=>t.reset(e).require(a,(t=>{i.id=t})).optional("fixed_height_relative",(t=>{i.constantHeight=t}),f.decodeRelativeHeight).geometry((t=>{i.bounds=t}),f.computeBounds).success()),((t,e,i)=>t.reset(e).require(a,(t=>{i.id=t})).require("elevation_idx",(t=>{i.idx=t})).require("extent",(t=>{i.extent=t})).require("height_relative",(t=>{i.height=t}),f.decodeRelativeHeight).geometry((t=>{i.position=t}),f.getPoint).success())),d=new c(((t,e,i)=>t.reset(e).require(a,(t=>{i.id=t})).optional("fixed_height",(t=>{i.constantHeight=t}),f.decodeMetricHeight).geometry((t=>{i.bounds=t}),f.computeBounds).success()),((t,e,i)=>t.reset(e).require(a,(t=>{i.id=t})).require("elevation_idx",(t=>{i.idx=t})).require("extent",(t=>{i.extent=t})).require("height",(t=>{i.height=t}),f.decodeMetricHeight).geometry((t=>{i.position=t}),f.getPoint).success()));class f{static computeBounds(e){const i=new t.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new t.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const t of e[0])i.x>t.x&&(i.x=t.x),i.y>t.y&&(i.y=t.y),n.x<t.x&&(n.x=t.x),n.y<t.y&&(n.y=t.y);return{min:i,max:n}}static getPoint(e){return t.ab.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static parse(e){const i=[],n=[],o=e.length,r=new u;for(let a=0;a<o;a++){const o=e.feature(a),l=o.properties.hasOwnProperty("version")?String(o.properties.version):void 0,u=(s=l)?"1.0.1"===s?d:void 0:h;if(void 0===u){t.w(`Unknown elevation feature version number ${l||"(unknown)"}`);continue}const c=o.properties.hasOwnProperty("type")?o.properties.type:void 0;if(c)if("Point"===t.dY.VectorTileFeature.types[o.type]&&"curve_point"===c){const t={};u.parseVertex(r,o,t)&&i.push(t)}else if("Polygon"===t.dY.VectorTileFeature.types[o.type]&&"curve_meta"===c){const t={};u.parseFeature(r,o,t)&&n.push(t)}}var s;return{vertices:i,features:n}}}class p{constructor(e,i,n,o,r,s){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:n,max:n},this.safeArea=i,this.constantHeight=n,null==this.constantHeight&&(null!=this.constantHeight||0!==o.length)){this.vertices=o,this.edges=r,this.edges=this.edges.filter((e=>e.a<this.vertices.length&&e.b<this.vertices.length&&!t.ab.vec2.exactEquals(this.vertices[e.a].position,this.vertices[e.b].position))),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:t.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const i=this.vertices[e.a].position,n=this.vertices[e.b].position,o=t.ab.vec2.subtract(t.ab.vec2.create(),n,i),r=t.ab.vec2.length(o),s=t.ab.vec2.scale(t.ab.vec2.create(),o,1/r);this.edgeProps.push({vec:o,dir:s,len:r});const a=this.vertexProps[e.a].dir,l=this.vertexProps[e.b].dir;t.ab.vec2.add(a,a,s),t.ab.vec2.add(l,l,s)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||t.ab.vec2.normalize(e.dir,e.dir);this.tessellate(s)}}pointElevation(t){if(null!=this.constantHeight)return this.constantHeight;const e=this.getClosestEdge(t);if(null==e)return 0;const[i,n]=e;return(1-(o=n))*this.vertices[this.edges[i].a].height+o*this.vertices[this.edges[i].b].height;var o}getClosestEdge(e){if(0===this.edges.length)return;let i=0,n=Number.POSITIVE_INFINITY,o=0;const r=t.ab.vec2.fromValues(e.x,e.y);for(let s=0;s<this.edges.length;s++){const e=this.edges[s],a=this.edgeProps[s].dir,l=new t.dZ(r,this.edgeProps[s].dir),u=this.vertices[e.a].position,c=this.vertices[e.b].position,h=t.ab.vec2.create(),d=t.ab.vec2.create(),f=l.intersectsPlane(u,this.vertexProps[e.a].dir,h),p=l.intersectsPlane(c,this.vertexProps[e.b].dir,d);if(!f||!p)continue;const m=t.ab.vec2.subtract(t.ab.vec2.create(),d,h),g=t.ab.vec2.subtract(t.ab.vec2.create(),r,h),y=t.ab.vec2.dot(m,m),_=y>0?t.ab.vec2.dot(g,m)/y:0,v=t.aw(_,0,1),x=Math.abs((_-v)*this.edgeProps[s].len),b=t.ab.vec2.subtract(t.ab.vec2.create(),r,u),C=x+Math.abs(t.ab.vec2.dot(b,t.ab.vec2.fromValues(a[1],-a[0])));C<n&&(i=s,n=C,o=v)}return[i,o]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const n=this.edges[i].a,o=this.edges[i].b,{position:r,height:s,extent:a}=this.vertices[n],{position:l,height:u,extent:c}=this.vertices[o],h=this.vertexProps[n].dir,d=this.vertexProps[o].dir,f=t.ab.vec3.fromValues(r[0]/e,r[1]/e,s),p=t.ab.vec3.fromValues(l[0]/e,l[1]/e,u),m=t.ab.vec3.fromValues(h[1],-h[0],0);t.ab.vec3.scale(m,m,a);const g=t.ab.vec3.fromValues(d[1],-d[0],0);if(t.ab.vec3.scale(g,g,c),this.distSqLines(t.ab.vec3.fromValues(f[0]+.5*m[0],f[1]+.5*m[1],f[2]+.5*m[2]),t.ab.vec3.fromValues(p[0]-.5*g[0],p[1]-.5*g[1],p[2]-.5*g[2]),t.ab.vec3.fromValues(f[0]-.5*m[0],f[1]-.5*m[1],f[2]-.5*m[2]),t.ab.vec3.fromValues(p[0]+.5*g[0],p[1]+.5*g[1],p[2]+.5*g[2]))<=.05*.05)continue;const y=this.vertices.length,_=t.ab.vec2.add(t.ab.vec2.create(),r,l);this.vertices.push({position:t.ab.vec2.scale(_,_,.5),height:.5*(s+u),extent:.5*(a+c)});const v=t.ab.vec2.add(t.ab.vec2.create(),h,d);this.vertexProps.push({dir:t.ab.vec2.normalize(v,v)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:n,b:y}),this.edges.push({a:y,b:o});const x=t.ab.vec2.subtract(t.ab.vec2.create(),this.vertices[y].position,r),b=t.ab.vec2.length(x),C={vec:x,dir:t.ab.vec2.scale(t.ab.vec2.create(),x,1/b),len:b};this.edgeProps.push(C),this.edgeProps.push(C)}}distSqLines(e,i,n,o){const r=t.ab.vec3.subtract(t.ab.vec3.create(),i,e),s=t.ab.vec3.subtract(t.ab.vec3.create(),o,n),a=t.ab.vec3.subtract(t.ab.vec3.create(),e,n),l=t.ab.vec3.dot(r,r),u=t.ab.vec3.dot(r,s),c=t.ab.vec3.dot(r,a),h=t.ab.vec3.dot(s,s),d=t.ab.vec3.dot(s,a),f=l*h-u*u;if(0===f){const i=t.ab.vec3.dot(a,s)/t.ab.vec3.dot(s,s),r=t.ab.vec3.lerp(t.ab.vec3.create(),n,o,i);return t.ab.vec3.squaredDistance(r,e)}const p=(u*d-c*h)/f,m=(l*d-u*c)/f,g=t.ab.vec3.lerp(t.ab.vec3.create(),e,i,p),y=t.ab.vec3.lerp(t.ab.vec3.create(),n,o,m);return t.ab.vec3.squaredDistance(g,y)}}class m{static parseFrom(e,i){const n=f.parse(e);if(!n)return[];let{vertices:o,features:r}=n;const s=1/t.cc(i);r.sort(((t,e)=>t.id-e.id)),o.sort(((t,e)=>t.id-e.id||t.idx-e.idx)),o=o.filter(((t,e,i)=>e===i.findIndex((e=>e.id===t.id&&e.idx===t.idx))));const a=new Array;let l=0;const u=o.length;for(const t of r){if(t.constantHeight){a.push(new p(t.id,t.bounds,t.constantHeight));continue}for(;l!==u&&o[l].id<t.id;)l++;if(l===u||o[l].id!==t.id)continue;const e=new Array,i=new Array,n=l;for(;l!==u&&o[l].id===t.id;){const t=o[l];if(e.push({position:t.position,height:t.height,extent:t.extent}),l!==n&&o[l-1].idx===t.idx-1){const t=l-n;i.push({a:t-1,b:t})}l++}a.push(new p(t.id,t.bounds,void 0,e,i,s))}return a}}t.dV(p,"ElevationFeature");class g{constructor(e){this.tileID=new t.aG(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.lut=e.lut,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.request&&e.request.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=t.aQ(e.tileID.canonical,e.projection),this.projection=e.projection,this.worldview=e.worldview,this.localizableLayerIds=e.localizableLayerIds,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster,this.tessellationStep=e.tessellationStep,this.scaleFactor=e.scaleFactor}parse(e,i,n,o,r){this.status="parsing",this.data=e,this.collisionBoxArray=new t.aW;const u=new t.d_(Object.keys(e.layers).sort()),c=new t.d$(this.tileID,this.promoteId);c.bucketLayerIDs=[];const h={},d=new t.e0(256,256),f={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:d,availableImages:n,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},p=i.familiesBySource[this.source];for(const s in p){const i=e.layers[s];if(!i)continue;let o=!1,r=!1,d=!1;for(const t of p[s])"symbol"===t[0].type?o=!0:r=!0,t[0].is3D()&&"model"!==t[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!r)continue;1===i.version&&t.w(`Vector tile source "${this.source}" layer "${s}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const g=u.encode(s),_=[];let v=!1;for(let t=0,e=0;t<i.length;t++){const n=i.feature(t),o=c.getId(n,s);if(this.localizableLayerIds&&this.localizableLayerIds.has(s)){const t=n.properties?n.properties.worldview:null;if(this.worldview&&"string"==typeof t)if("all"===t)n.properties.$localized=!0;else{if(!t.split(",").includes(this.worldview))continue;n.properties.$localized=!0,n.properties.worldview=this.worldview}}!v&&n.properties&&n.properties.hasOwnProperty(a)&&(v=!0),_.push({feature:n,id:o,index:e,sourceLayerIndex:g}),e++}v&&e.layers.hasOwnProperty(l)&&(f.elevationFeatures=m.parseFrom(e.layers[l],this.canonical));for(const e of p[s]){const i=e[0];(!this.extraShadowCaster||i.is3D()&&"model"!==i.type)&&(void 0!==this.isSymbolTile&&"symbol"===i.type!==this.isSymbolTile||i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(y(e,this.zoom,f.brightness,n),(h[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:g,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(_,f,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>t.aC(e.id,e.scope))))))}}let g,_,v,x;d.trim();const b={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},C=()=>{if(g)return this.status="done",r(g);if(this.extraShadowCaster)this.status="done",r(null,{buckets:t.bj(h).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:f.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_&&v&&x){const e=new s(_),i=new t.e3(v,x,this.lut);for(const o in h){const r=h[o];r instanceof t.aX?(y(r.layers,this.zoom,f.brightness,n),t.e4(r,_,e.positions,v,i.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):r.hasPattern&&(r instanceof t.b1||r instanceof t.b2||r instanceof t.d5)&&(y(r.layers,this.zoom,f.brightness,n),r.addFeatures(f,this.tileID.canonical,i.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",r(null,{buckets:t.bj(h).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:d,imageAtlas:i,brightness:f.brightness})}};if(!this.extraShadowCaster){const e=t.e1(f.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(e).length?o.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((t,e)=>{g||(g=t,_=e,C())}),void 0,!1,b):_={};const i=Object.keys(f.iconDependencies);i.length?o.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((t,e)=>{if(g)return;g=t;const i={};Object.values(e).some((t=>t.usvg))?this.rasterize(o,i,e,f.iconDependencies,(()=>{v=i,C()})):(this.fillImageMap(i,f.iconDependencies,e),v=i,C())}),void 0,!1,b):v={};const n=Object.keys(f.patternDependencies);n.length?o.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((t,e)=>{if(!g){g=t;const i={};Object.values(e).some((t=>t.usvg))?this.rasterize(o,i,e,f.patternDependencies,(()=>{x=i,C()})):(this.fillImageMap(i,f.patternDependencies,e),x=i,C())}}),void 0,!1,b):x={}}C()}fillImageMap(t,e,i){for(const n in i){const o=e[n]||[];for(const e of o)i[e.id].usvg||(t[e.serialize()]=i[e.id])}}getImageTaskQueue(t,e,i){const n={};for(const o in e){const r=i[o]||[];for(const i of r){const o=i.serialize();e[i.id].usvg?n[o]||(n[o]=i):t[o]=e[i.id]}}return n}rasterize(e,i,n,o,r){const s=this.getImageTaskQueue(i,n,o);this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,imageTasks:s},((e,o)=>{if(!e)for(const r in o){const{id:e}=t.e2.deserializeFromString(r);i[r]=Object.assign({},n[e],{data:o[r]})}r()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function y(e,i,n,o){const r=new t.a8(i,{brightness:n});for(const t of e)t.recalculate(r,o)}class _ extends t.E{constructor(e,i,n,o,r,s){super(),this.actor=e,this.layerIndex=i,this.availableImages=n,this.loadVectorData=r||t.aD,this.loading={},this.loaded={},this.deduped=new t.aB(e.scheduler),this.isSpriteLoaded=o,this.scheduler=e.scheduler,this.brightness=s}loadTile(i,n){const o=i.uid,r=i&&i.request,s=r&&r.collectResourceTiming,a=this.loading[o]=new g(i);a.abort=this.loadVectorData(i,((l,u)=>{const c=!this.loading[o];if(delete this.loading[o],a.cancelRasterize(),c||l||!u)return a.status="done",c||(this.loaded[o]=a),n(l);const h=u.rawData,d={};u.expires&&(d.expires=u.expires),u.cacheControl&&(d.cacheControl=u.cacheControl),a.vectorTile=u.vectorTile||new t.dY.VectorTile(new t.bh(h));const f=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,o)=>{if(i||!o)return n(i);const a={};if(s){const t=e(r);t.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(t)))}n(null,t.l({rawTileData:h.slice(0)},o,d,a))}))};this.isSpriteLoaded?f():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):f()})),this.loaded=this.loaded||{},this.loaded[o]=a}))}reloadTile(e,i){const n=this.loaded,o=e.uid;if(n&&n[o]){const r=n[o];r.scaleFactor=e.scaleFactor,r.showCollisionBoxes=e.showCollisionBoxes,r.projection=e.projection,r.brightness=e.brightness,r.tileTransform=t.aQ(e.tileID.canonical,e.projection),r.extraShadowCaster=e.extraShadowCaster,r.lut=e.lut;const s=(t,e)=>{const n=r.reloadCallback;n&&(delete r.reloadCallback,r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,n)),i(t,e)};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&(r.vectorTile?r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else i(null,void 0)}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class v{loadTile(e,i){const{uid:n,encoding:o,rawImageData:r,padding:s}=e,a=ImageBitmap&&r instanceof ImageBitmap?this.getImageData(r,s):r;i(null,new t.e5(n,a,o,s<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}t.bg.setPbf(t.bh);class x{decodeRasterArray(e,i){let{task:n,buffer:o}=e;t.bg.performDecoding(o,n).then((t=>{i(null,t)}),(t=>{i(t)}))}}const b=t.dY.VectorTileFeature.prototype.toGeoJSON;class C{constructor(e){this._feature=e,this.extent=t.ag,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return b.call(this,t,e,i)}}class w{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.ag,this.length=e.length,this._features=e}feature(t){return new C(this._features[t])}}const S=64/4096,T=128;class A{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;for(const i of t){const t=i.id;if(null==t)continue;let n=this.features.get(t);n&&this.updateCache(n,e),i.geometry?(n=I(i),this.updateCache(n,e),this.features.set(t,n)):this.features.delete(t),this.updateCache(n,e)}}updateCache(t,e){for(const{canonical:i,uid:n}of Object.values(e)){const{z:o,x:r,y:s}=i;M(t,Math.pow(2,o),r,s)&&delete e[n]}}getTile(t,e,i){const n=Math.pow(2,t),o=[];for(const r of this.features.values())M(r,n,e,i)&&o.push(B(r,n,e,i));return{features:o}}getFeatures(){return[...this.features.values()]}}function M(t,e,i,n){let{minX:o,minY:r,maxX:s,maxY:a}=t;return o<(i+1+S)/e&&r<(n+1+S)/e&&s>(i-S)/e&&a>(n-S)/e}function I(t){const{id:e,geometry:i,properties:n}=t;if(!i)return;if("GeometryCollection"===i.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:o,coordinates:r}=i,s={id:e,type:1,geometry:[],tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=s.geometry;if("Point"===o)E(r,a,s);else if("MultiPoint"===o)for(const l of r)E(l,a,s);else if("LineString"===o)s.type=2,P(r,a,s);else if("MultiLineString"===o)s.type=2,k(r,a,s);else if("Polygon"===o)s.type=3,k(r,a,s,!0);else{if("MultiPolygon"!==o)throw new Error("Input data is not a valid GeoJSON object.");s.type=3;for(const t of r)k(t,a,s,!0)}return s}function E(e,i,n){let[o,r]=e;const s=t.at(o);let a=t.aA(r);a=a<0?0:a>1?1:a,i.push(s,a),n.minX=Math.min(n.minX,s),n.minY=Math.min(n.minY,a),n.maxX=Math.max(n.maxX,s),n.maxY=Math.max(n.maxY,a)}function P(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=[];for(const s of t)E(s,r,i);e.push(r),n&&function(t,e){let i=0;for(let n=0,o=t.length,r=o-2;n<o;r=n,n+=2)i+=(t[n]-t[r])*(t[n+1]+t[r+1]);if(i>0===e)for(let n=0,o=t.length;n<o/2;n+=2){const e=t[n],i=t[n+1];t[n]=t[o-2-n],t[n+1]=t[o-1-n],t[o-2-n]=e,t[o-1-n]=i}}(r,o)}function k(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let o=0;o<t.length;o++)P(t[o],e,i,n,0===o)}function B(e,i,n,o){const{id:r,type:s,geometry:a,tags:l}=e,u=[];if(1===s)!function(e,i,n,o,r){for(let s=0;s<e.length;s+=2){const a=Math.round(t.ag*(e[s+0]*i-n)),l=Math.round(t.ag*(e[s+1]*i-o));r.push([a,l])}}(a,i,n,o,u);else for(const t of a)D(t,i,n,o,u);return{id:r,type:s,geometry:u,tags:l}}function D(e,i,n,o,r){const s=-T,a=t.ag+T;let l;for(let u=0;u<e.length-2;u+=2){let c=Math.round(t.ag*(e[u+0]*i-n)),h=Math.round(t.ag*(e[u+1]*i-o)),d=Math.round(t.ag*(e[u+2]*i-n)),f=Math.round(t.ag*(e[u+3]*i-o));const p=d-c,m=f-h;c<s&&d<s||(c<s?(h+=Math.round(m*((s-c)/p)),c=s):d<s&&(f=h+Math.round(m*((s-c)/p)),d=s),h<s&&f<s||(h<s?(c+=Math.round(p*((s-h)/m)),h=s):f<s&&(d=c+Math.round(p*((s-h)/m)),f=s),c>=a&&d>=a||(c>=a?(h+=Math.round(m*((a-c)/p)),c=a):d>=a&&(f=h+Math.round(m*((a-c)/p)),d=a),h>=a&&f>=a||(h>=a?(c+=Math.round(p*((a-h)/m)),h=a):f>=a&&(d=c+Math.round(p*((a-h)/m)),f=a),l&&c===l[l.length-1][0]&&h===l[l.length-1][1]||(l=[[c,h]],r.push(l)),l.push([d,f])))))}}var R,L,z,O={exports:{}},U=function(){if(z)return O.exports;z=1;var e=t.e8(),i=function(){if(L)return R;L=1;var e=t.e6(),i=t.e7().VectorTileFeature;function n(t,e){this.options=e||{},this.features=t,this.length=t.length}function o(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}return R=n,n.prototype.feature=function(t){return new o(this.features[t],this.options.extent)},o.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var n=t[i],o=[],r=0;r<n.length;r++)o.push(new e(n[r][0],n[r][1]));this.geometry.push(o)}return this.geometry},o.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,o=-1/0,r=0;r<t.length;r++)for(var s=t[r],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),o=Math.max(o,l.y)}return[e,n,i,o]},o.prototype.toGeoJSON=i.prototype.toGeoJSON,R}();function n(t){var i=new e;return function(t,e){for(var i in t.layers)e.writeMessage(3,o,t.layers[i])}(t,i),i.finish()}function o(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,r,n);var o=n.keys;for(i=0;i<o.length;i++)e.writeStringField(3,o[i]);var s=n.values;for(i=0;i<s.length;i++)e.writeMessage(4,c,s[i])}function r(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,s,t),e.writeVarintField(3,i.type),e.writeMessage(4,u,i)}function s(t,e){var i=t.feature,n=t.keys,o=t.values,r=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],u=r[a];if(null!==l){void 0===u&&(n.push(a),r[a]=u=n.length-1),e.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,d=s[h];void 0===d&&(o.push(l),s[h]=d=o.length-1),e.writeVarint(d)}}}function a(t,e){return(e<<3)+(7&t)}function l(t){return t<<1^t>>31}function u(t,e){for(var i=t.loadGeometry(),n=t.type,o=0,r=0,s=i.length,u=0;u<s;u++){var c=i[u],h=1;1===n&&(h=c.length),e.writeVarint(a(1,h));for(var d=3===n?c.length-1:c.length,f=0;f<d;f++){1===f&&1!==n&&e.writeVarint(a(2,d-1));var p=c[f].x-o,m=c[f].y-r;e.writeVarint(l(p)),e.writeVarint(l(m)),o+=p,r+=m}3===n&&e.writeVarint(a(7,1))}}function c(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}return O.exports=n,O.exports.fromVectorTileJs=n,O.exports.fromGeojsonVt=function(t,e){e=e||{};var o={};for(var r in t)o[r]=new i(t[r].features,e),o[r].name=r,o[r].version=e.version,o[r].extent=e.extent;return n({layers:o})},O.exports.GeoJSONWrapper=i,O.exports}(),F=t.e9(U);const N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},V=Math.fround||(H=new Float32Array(1),t=>(H[0]=+t,H[0]));var H;const j=3,G=5,W=6;class q{constructor(t){this.options=Object.assign(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:n}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;const r=[];for(let a=0;a<t.length;a++){const e=t[a];if(!e.geometry)continue;const[i,n]=e.geometry.coordinates,o=V(K(i)),s=V(Y(n));r.push(o,s,1/0,a,-1,1),this.options.reduce&&r.push(0)}let s=this.trees[n+1]=this._createTree(r);e&&console.timeEnd(o);for(let a=n;a>=i;a--){const t=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),e&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let o=180===t[2]?180:((t[2]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,o=180;else if(i>o){const t=this.getClusters([i,n,180,r],e),s=this.getClusters([-180,n,o,r],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(K(i),Y(r),K(o),Y(n)),l=s.data,u=[];for(const c of a){const t=this.stride*c;u.push(l[t+G]>1?Z(l,t,this.clusterProps):this.points[l[t+j]])}return u}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",o=this.trees[i];if(!o)throw new Error(n);const r=o.data;if(e*this.stride>=r.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=o.within(r[e*this.stride],r[e*this.stride+1],s),l=[];for(const u of a){const e=u*this.stride;r[e+4]===t&&l.push(r[e+G]>1?Z(r,e,this.clusterProps):this.points[r[e+j]])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],o=Math.pow(2,t),{extent:r,radius:s}=this.options,a=s/r,l=(i-a)/o,u=(i+1+a)/o,c={features:[]};return this._addTileFeatures(n.range((e-a)/o,l,(e+1+a)/o,u),n.data,e,i,o,c),0===e&&this._addTileFeatures(n.range(1-a/o,l,1,u),n.data,o,i,o,c),e===o-1&&this._addTileFeatures(n.range(0,l,a/o,u),n.data,-1,i,o,c),c.features.length?c:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,o){const r=this.getChildren(e);for(const s of r){const e=s.properties;if(e&&e.cluster?o+e.point_count<=n?o+=e.point_count:o=this._appendLeaves(t,e.cluster_id,i,n,o):o<n?o++:t.push(s),t.length===i)break}return o}_createTree(e){const i=new t.bE(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,n,o,r){for(const s of t){const t=s*this.stride,a=e[t+G]>1;let l,u,c;if(a)l=$(e,t,this.clusterProps),u=e[t],c=e[t+1];else{const i=this.points[e[t+j]];l=i.properties;const[n,o]=i.geometry.coordinates;u=K(n),c=Y(o)}const h={type:1,geometry:[[Math.round(this.options.extent*(u*o-i)),Math.round(this.options.extent*(c*o-n))]],tags:l};let d;d=a||this.options.generateId?e[t+j]:this.points[e[t+j]].id,void 0!==d&&(h.id=d),r.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:n,reduce:o,minPoints:r}=this.options,s=i/(n*Math.pow(2,e)),a=t.data,l=[],u=this.stride;for(let c=0;c<a.length;c+=u){if(a[c+2]<=e)continue;a[c+2]=e;const i=a[c],n=a[c+1],h=t.within(a[c],a[c+1],s),d=a[c+G];let f=d;for(const t of h){const i=t*u;a[i+2]>e&&(f+=a[i+G])}if(f>d&&f>=r){let t,r=i*d,s=n*d,p=-1;const m=(c/u<<5)+(e+1)+this.points.length;for(const i of h){const n=i*u;if(a[n+2]<=e)continue;a[n+2]=e;const l=a[n+G];r+=a[n]*l,s+=a[n+1]*l,a[n+4]=m,o&&(t||(t=this._map(a,c,!0),p=this.clusterProps.length,this.clusterProps.push(t)),o(t,this._map(a,n)))}a[c+4]=m,l.push(r/f,s/f,1/0,m,-1,f),o&&l.push(p)}else{for(let t=0;t<u;t++)l.push(a[c+t]);if(f>1)for(const t of h){const i=t*u;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<u;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+G]>1){const n=this.clusterProps[t[e+W]];return i?Object.assign({},n):n}const n=this.points[t[e+j]].properties,o=this.options.map(n);return i&&o===n?Object.assign({},o):o}}function Z(t,e,i){return{type:"Feature",id:t[e+j],properties:$(t,e,i),geometry:{type:"Point",coordinates:[(n=t[e],360*(n-.5)),J(t[e+1])]}};var n}function $(t,e,i){const n=t[e+G],o=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,r=t[e+W],s=-1===r?{}:Object.assign({},i[r]);return Object.assign(s,{cluster:!0,cluster_id:t[e+j],point_count:n,point_count_abbreviated:o})}function K(t){return t/360+.5}function Y(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function J(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function X(t,e,i,n){let o=n;const r=e+(i-e>>1);let s,a=i-e;const l=t[e],u=t[e+1],c=t[i],h=t[i+1];for(let d=e+3;d<i;d+=3){const e=Q(t[d],t[d+1],l,u,c,h);if(e>o)s=d,o=e;else if(e===o){const t=Math.abs(d-r);t<a&&(s=d,a=t)}}o>n&&(s-e>3&&X(t,e,s,n),t[s+2]=o,i-s>3&&X(t,s,i,n))}function Q(t,e,i,n,o,r){let s=o-i,a=r-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=o,n=r):l>0&&(i+=s*l,n+=a*l)}return s=t-i,a=e-n,s*s+a*a}function tt(t,e,i,n){const o={id:t??null,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)et(o,i);else if("Polygon"===e)et(o,i[0]);else if("MultiLineString"===e)for(const r of i)et(o,r);else if("MultiPolygon"===e)for(const r of i)et(o,r[0]);return o}function et(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function it(t,e,i,n){if(!e.geometry)return;const o=e.geometry.coordinates;if(o&&0===o.length)return;const r=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===r)nt(o,a);else if("MultiPoint"===r)for(const u of o)nt(u,a);else if("LineString"===r)ot(o,a,s,!1);else if("MultiLineString"===r){if(i.lineMetrics){for(const i of o)a=[],ot(i,a,s,!1),t.push(tt(l,"LineString",a,e.properties));return}rt(o,a,s,!1)}else if("Polygon"===r)rt(o,a,s,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"===r){for(const o of e.geometry.geometries)it(t,{id:l,geometry:o,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of o){const e=[];rt(t,e,s,!0),a.push(e)}}t.push(tt(l,r,a,e.properties))}function nt(t,e){e.push(st(t[0]),at(t[1]),0)}function ot(t,e,i,n){let o,r,s=0;for(let l=0;l<t.length;l++){const i=st(t[l][0]),a=at(t[l][1]);e.push(i,a,0),l>0&&(s+=n?(o*a-i*r)/2:Math.sqrt(Math.pow(i-o,2)+Math.pow(a-r,2))),o=i,r=a}const a=e.length-3;e[2]=1,X(e,0,a,i),e[a+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function rt(t,e,i,n){for(let o=0;o<t.length;o++){const r=[];ot(t[o],r,i,n),e.push(r)}}function st(t){return t/360+.5}function at(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function lt(t,e,i,n,o,r,s,a){if(n/=e,r>=(i/=e)&&s<n)return t;if(s<i||r>=n)return null;const l=[];for(const u of t){const t=u.geometry;let e=u.type;const r=0===o?u.minX:u.minY,s=0===o?u.maxX:u.maxY;if(r>=i&&s<n){l.push(u);continue}if(s<i||r>=n)continue;let c=[];if("Point"===e||"MultiPoint"===e)ut(t,c,i,n,o);else if("LineString"===e)ct(t,c,i,n,o,!1,a.lineMetrics);else if("MultiLineString"===e)dt(t,c,i,n,o,!1);else if("Polygon"===e)dt(t,c,i,n,o,!0);else if("MultiPolygon"===e)for(const a of t){const t=[];dt(a,t,i,n,o,!0),t.length&&c.push(t)}if(c.length){if(a.lineMetrics&&"LineString"===e){for(const t of c)l.push(tt(u.id,e,t,u.tags));continue}"LineString"!==e&&"MultiLineString"!==e||(1===c.length?(e="LineString",c=c[0]):e="MultiLineString"),"Point"!==e&&"MultiPoint"!==e||(e=3===c.length?"Point":"MultiPoint"),l.push(tt(u.id,e,c,u.tags))}}return l.length?l:null}function ut(t,e,i,n,o){for(let r=0;r<t.length;r+=3){const s=t[r+o];s>=i&&s<=n&&ft(e,t[r],t[r+1],t[r+2])}}function ct(t,e,i,n,o,r,s){let a=ht(t);const l=0===o?pt:mt;let u,c,h=t.start;for(let g=0;g<t.length-3;g+=3){const d=t[g],f=t[g+1],p=t[g+2],m=t[g+3],y=t[g+4],_=0===o?d:f,v=0===o?m:y;let x=!1;s&&(u=Math.sqrt(Math.pow(d-m,2)+Math.pow(f-y,2))),_<i?v>i&&(c=l(a,d,f,m,y,i),s&&(a.start=h+u*c)):_>n?v<n&&(c=l(a,d,f,m,y,n),s&&(a.start=h+u*c)):ft(a,d,f,p),v<i&&_>=i&&(c=l(a,d,f,m,y,i),x=!0),v>n&&_<=n&&(c=l(a,d,f,m,y,n),x=!0),!r&&x&&(s&&(a.end=h+u*c),e.push(a),a=ht(t)),s&&(h+=u)}let d=t.length-3;const f=t[d],p=t[d+1],m=0===o?f:p;m>=i&&m<=n&&ft(a,f,p,t[d+2]),d=a.length-3,r&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&ft(a,a[0],a[1],a[2]),a.length&&e.push(a)}function ht(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function dt(t,e,i,n,o,r){for(const s of t)ct(s,e,i,n,o,r,!1)}function ft(t,e,i,n){t.push(e,i,n)}function pt(t,e,i,n,o,r){const s=(r-e)/(n-e);return ft(t,r,i+(o-i)*s,1),s}function mt(t,e,i,n,o,r){const s=(r-i)/(o-i);return ft(t,e+(n-e)*s,r,1),s}function gt(t,e){const i=[];for(let n=0;n<t.length;n++){const o=t[n],r=o.type;let s;if("Point"===r||"MultiPoint"===r||"LineString"===r)s=yt(o.geometry,e);else if("MultiLineString"===r||"Polygon"===r){s=[];for(const t of o.geometry)s.push(yt(t,e))}else if("MultiPolygon"===r){s=[];for(const t of o.geometry){const i=[];for(const n of t)i.push(yt(n,e));s.push(i)}}i.push(tt(o.id,r,s,o.tags))}return i}function yt(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function _t(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,o=t.y;for(const r of t.features){const t=r.geometry,s=r.type;if(r.geometry=[],1===s)for(let a=0;a<t.length;a+=2)r.geometry.push(vt(t[a],t[a+1],e,i,n,o));else for(let a=0;a<t.length;a++){const s=[];for(let r=0;r<t[a].length;r+=2)s.push(vt(t[a][r],t[a][r+1],e,i,n,o));r.geometry.push(s)}}return t.transformed=!0,t}function vt(t,e,i,n,o,r){return[Math.round(i*(t*n-o)),Math.round(i*(e*n-r))]}function xt(t,e,i,n,o){const r=e===o.maxZoom?0:o.tolerance/((1<<e)*o.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of t)bt(s,a,r,o);return s}function bt(t,e,i,n){const o=e.geometry,r=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===r||"MultiPoint"===r)for(let a=0;a<o.length;a+=3)s.push(o[a],o[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)Ct(s,o,t,i,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(let a=0;a<o.length;a++)Ct(s,o[a],t,i,"Polygon"===r,0===a);else if("MultiPolygon"===r)for(let a=0;a<o.length;a++){const e=o[a];for(let n=0;n<e.length;n++)Ct(s,e[n],t,i,!0,0===n)}if(s.length){let i=e.tags||null;if("LineString"===r&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=o.start/o.size,i.mapbox_clip_end=o.end/o.size}const a={geometry:s,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a)}}function Ct(t,e,i,n,o,r){const s=n*n;if(n>0&&e.size<(o?s:n))return void(i.numPoints+=e.length/3);const a=[];for(let l=0;l<e.length;l+=3)(0===n||e[l+2]>s)&&(i.numSimplified++,a.push(e[l],e[l+1])),i.numPoints++;o&&function(t,e){let i=0;for(let n=0,o=t.length,r=o-2;n<o;r=n,n+=2)i+=(t[n]-t[r])*(t[n+1]+t[r+1]);if(i>0===e)for(let n=0,o=t.length;n<o/2;n+=2){const e=t[n],i=t[n+1];t[n]=t[o-2-n],t[n+1]=t[o-1-n],t[o-2-n]=e,t[o-1-n]=i}}(a,r),t.push(a)}const wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class St{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(wt),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)it(i,t.features[n],e,n);else it(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const o=lt(t,1,-1-i,i,0,-1,2,e),r=lt(t,1,1-i,2+i,0,-1,2,e);return(o||r)&&(n=lt(t,1,-i,1+i,0,-1,2,e)||[],o&&(n=gt(o,1).concat(n)),r&&(n=n.concat(gt(r,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,n,o,r,s){const a=[t,e,i,n],l=this.options,u=l.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const c=1<<e,h=Tt(e,i,n);let d=this.tiles[h];if(!d&&(u>1&&console.time("creation"),d=this.tiles[h]=xt(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==o){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===o)continue;if(null!=o){const t=o-e;if(i!==r>>t||n!==s>>t)continue}}if(d.source=null,0===t.length)continue;u>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,m=.5+f,g=1+f;let y=null,_=null,v=null,x=null,b=lt(t,c,i-f,i+m,0,d.minX,d.maxX,l),C=lt(t,c,i+p,i+g,0,d.minX,d.maxX,l);t=null,b&&(y=lt(b,c,n-f,n+m,1,d.minY,d.maxY,l),_=lt(b,c,n+p,n+g,1,d.minY,d.maxY,l),b=null),C&&(v=lt(C,c,n-f,n+m,1,d.minY,d.maxY,l),x=lt(C,c,n+p,n+g,1,d.minY,d.maxY,l),C=null),u>1&&console.timeEnd("clipping"),a.push(y||[],e+1,2*i,2*n),a.push(_||[],e+1,2*i,2*n+1),a.push(v||[],e+1,2*i+1,2*n),a.push(x||[],e+1,2*i+1,2*n+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:o,debug:r}=n;if(t<0||t>24)return null;const s=1<<t,a=Tt(t,e=e+s&s-1,i);if(this.tiles[a])return _t(this.tiles[a],o);r>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let l,u=t,c=e,h=i;for(;!l&&u>0;)u--,c>>=1,h>>=1,l=this.tiles[Tt(u,c,h)];return l&&l.source?(r>1&&(console.log("found parent tile z%d-%d-%d",u,c,h),console.time("drilling down")),this.splitTile(l.source,u,c,h,t,e,i),r>1&&console.timeEnd("drilling down"),this.tiles[a]?_t(this.tiles[a],o):null):null}}function Tt(t,e,i){return 32*((1<<t)*i+e)+t}function At(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return void e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return void e(null,null);const o=new w(n.features);let r=F(o);0===r.byteOffset&&r.byteLength===r.buffer.byteLength||(r=new Uint8Array(r)),e(null,{vectorTile:o,rawData:r.buffer})}class Mt extends _{constructor(t,e,i,n,o,r){super(t,e,i,n,At,r),o&&(this.loadGeoJSON=o),this._dynamicIndex=new A}loadData(i,n){const o=i&&i.request,r=o&&o.collectResourceTiming;this.loadGeoJSON(i,((s,a)=>{if(s||!a)return n(s);if("object"!=typeof a)return n(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{try{if(i.filter){const e=t.U(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a.features=a.features.filter((t=>e.value.evaluate({zoom:0},t)))}i.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),i.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),i.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=i.cluster?new q(function(e){let{superclusterOptions:i,clusterProperties:n}=e;if(!n||!i)return i;const o={},r={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(n);for(const u of l){const[e,i]=n[u],s=t.U(i),a=t.U("string"==typeof e?[e,["accumulated"],["get",u]]:e);o[u]=s.value,r[u]=a.value}return i.map=t=>{a.properties=t;const e={};for(const i of l)e[i]=o[i].evaluate(s,a);return e},i.reduce=(t,e)=>{a.properties=e;for(const i of l)s.accumulated=t[i],t[i]=r[i].evaluate(s,a)},i}(i)).load(a.features):i.dynamic?this._dynamicIndex:function(t,e){return new St(t,e)}(a,i.geojsonVtOptions)}catch(t){return n(t)}const s={};if(r){const t=e(o);t&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(t)))}n(null,s)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?t.partial?e(null,void 0):super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.n(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class It{constructor(e,i){this.tileID=new t.aG(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=i}parse(e,i,n,o){this.status="parsing";const r=new t.aG(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),s=[],a=i.familiesBySource[n.source],l=new t.d$(r,n.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,t.ea(e).then((e=>{if(!e)return o(new Error("Could not parse tile"));const i=t.eb(e,1/t.cc(n.tileID.canonical)),u=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new t.a8(this.zoom,{brightness:this.brightness});for(const n in a)for(const e of a[n]){const n=e[0];l.bucketLayerIDs.push(e.map((e=>t.aC(e.id,e.scope)))),n.recalculate(h,[]);const o=new t.ec(e,i,r,u,c,this.brightness,l);u||(o.needsUpload=!0),s.push(o),o.evaluate(n)}this.status="done",o(null,{buckets:s,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((t=>o(new Error(t.message))))}}class Et{constructor(t,e,i,n,o,r){this.actor=t,this.layerIndex=e,this.availableImages=i,this.brightness=r,this.loading={},this.loaded={}}loadTile(e,i){const n=e.uid,o=this.loading[n]=new It(e,this.brightness);t.bi(e.request,((t,r)=>{const s=!this.loading[n];return delete this.loading[n],s||t?(o.status="done",s||(this.loaded[n]=o),i(t)):r&&0!==r.byteLength?void o.parse(r,this.layerIndex,e,((t,e)=>{o.status="done",this.loaded=this.loaded||{},this.loaded[n]=o,t||!e?i(t):i(null,e)})):(o.status="done",this.loaded[n]=o,i())}))}reloadTile(t,e){const i=this.loaded,n=t.uid;if(i&&i[n]){const o=i[n];o.projection=t.projection,o.brightness=t.brightness;const r=(i,n)=>{o.reloadCallback&&(delete o.reloadCallback,this.loadTile(t,e)),e(i,n)};"parsing"===o.status?o.reloadCallback=r:"done"===o.status&&this.loadTile(t,e)}}abortTile(t,e){const i=t.uid;this.loading[i]&&delete this.loading[i],e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class Pt{constructor(e){this.self=e,this.actor=new t.ed(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new t.I,this.projections={},this.defaultProjection=t.bP({name:"mercator"}),this.workerSourceTypes={vector:_,geojson:Mt,"batched-model":Et},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.ee.isParsed())throw new Error("RTL text plugin already registered.");t.ee.applyArabicShaping=e.applyArabicShaping,t.ee.processBidirectionalText=e.processBidirectionalText,t.ee.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],delete this.rasterArrayWorkerSource,i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,i){let{scope:n,isLoaded:o}=i;if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][n]=o,this.workerSources[e]&&this.workerSources[e][n])for(const r in this.workerSources[e][n]){const i=this.workerSources[e][n][r];for(const e in i){const n=i[e];n instanceof _&&(n.isSpriteLoaded=o,n.fire(new t.z("isSpriteLoaded")))}}}setImages(t,e,i){let{scope:n,images:o}=e;if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][n]=o,this.workerSources[t]&&this.workerSources[t][n]){for(const e in this.workerSources[t][n]){const i=this.workerSources[t][n][e];for(const t in i)i[t].availableImages=o}i()}else i()}setProjection(e,i){this.projections[e]=t.bP(i)}setBrightness(t,e,i){this.brightness=e,i()}setLayers(t,e,i){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),i()}updateLayers(t,e,i){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),i()}loadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,i)}decodeRasterArray(t,e,i){this.getRasterArrayWorkerSource().decodeRasterArray(e,i)}reloadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,i)}removeSource(t,e,i){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const n=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,n){try{t.ee.setState(i);const e=t.ee.getPluginURL();if(t.ee.isLoaded()&&!t.ee.isParsed()&&null!=e){this.self.importScripts(e);const i=t.ee.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){n(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let i=this.availableImages[t][e];return i||(i=[]),i}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let i=this.layerIndexes[t][e];return i||(i=this.layerIndexes[t][e]=new o,i.scope=e),i}getWorkerSource(t,e,i,n){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][n]||(this.workerSources[t][n]={}),this.workerSources[t][n][e]||(this.workerSources[t][n][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.workerSources[t][n][e][i]||(this.workerSources[t][n][e][i]=new this.workerSourceTypes[e]({send:(e,i,n,o,r,s)=>{this.actor.send(e,i,n,t,r,s)},scheduler:this.actor.scheduler},this.getLayerIndex(t,n),this.getAvailableImages(t,n),this.isSpriteLoaded[t][n],void 0,this.brightness)),this.workerSources[t][n][e][i]}rasterizeImages(t,e,i){const{imageTasks:n,scope:o}=e,r={};for(const s in n){const{image:e,imageIdWithOptions:i}=n[s];r[s]=this.imageRasterizer.rasterize(i,e,o,t)}i(void 0,r)}removeRasterizedImages(t,e,i){const{imageIds:n,scope:o}=e;this.imageRasterizer.removeImagesFromCacheByIds(n,o,t),i()}getDEMWorkerSource(t,e,i){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][i]||(this.demWorkerSources[t][i]={}),this.demWorkerSources[t][i][e]||(this.demWorkerSources[t][i][e]=new v),this.demWorkerSources[t][i][e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new x),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,i){t.ef(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Pt(self)),Pt})),n(["./shared"],(function(t){var e="3.10.0";const i={create:"create",load:"load",fullLoad:"fullLoad"},n={mark(t){performance.mark(t)},measure(t,e,i){performance.measure(t,e,i)}};function o(e){const i=e.name.split("?")[0];return t.a(i)&&i.includes("mapbox-gl.js")?"javascript":t.a(i)&&i.includes("mapbox-gl.css")?"css":t.b(i)?"fontRange":t.c(i)?"sprite":t.i(i)?"style":t.d(i)?"tilejson":"other"}var r,s={},a=function(){if(r)return s;function t(t){return!e(t)}function e(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===i[n=e&&e.failIfMajorPerformanceCaveat]&&(i[n]=function(e){var i,n=function(e){var i=document.createElement("canvas"),n=Object.create(t.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,i.getContext("webgl2",n)}(e);if(!n)return!1;try{i=n.createShader(n.VERTEX_SHADER)}catch(t){return!1}return!(!i||n.isContextLost())&&(n.shaderSource(i,"void main() {}"),n.compileShader(i),!0===n.getShaderParameter(i,n.COMPILE_STATUS))}(n)),i[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var n}r=1,s.supported=t,s.notSupportedReason=e;var i={};return t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},s}();function l(t,e,i){const n=document.createElement(t);return null!=e&&(n.className=e),i&&i.appendChild(n),n}function u(t,e,i){const n=document.createElementNS("http://www.w3.org/2000/svg",t);for(const o of Object.keys(e))n.setAttributeNS(null,o,String(e[o]));return i&&i.appendChild(n),n}const c="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,h=c&&void 0!==c.userSelect?"userSelect":"WebkitUserSelect";let d;function f(){c&&h&&(d=c[h],c[h]="none")}function p(){c&&h&&(c[h]=d)}function m(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",m,!0)}function g(){window.addEventListener("click",m,!0),window.setTimeout((()=>{window.removeEventListener("click",m,!0)}),0)}function y(t,e){const i=t.getBoundingClientRect();return x(t,i,e)}function _(t,e){const i=t.getBoundingClientRect(),n=[];for(let o=0;o<e.length;o++)n.push(x(t,i,e[o]));return n}function v(t){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===t.button&&t.ctrlKey?0:t.button}function x(e,i,n){const o=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.P((n.clientX-i.left)*o,(n.clientY-i.top)*o)}const b="01",C="NO_ACCESS_TOKEN";class w{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",b,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(i,n){if(!t.f(i))return i;const o=T(i);return o.params.push(`sdk=js-${e}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(e,i){if(!t.f(e))return e;const n=T(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||i)}normalizeModelURL(e,i){if(!t.f(e))return e;const n=T(e);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||i)}normalizeSourceURL(e,i,n,o){if(!t.f(e))return e;const r=T(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),n&&r.params.push(`language=${n}`),o&&r.params.push(`worldview=${o}`),this._makeAPIURL(r,this._customAccessToken||i)}normalizeIconsetURL(e,i){const n=T(e);return t.f(e)?(n.path=`/styles/v1${n.path}/iconset.pbf`,this._makeAPIURL(n,this._customAccessToken||i)):A(n)}normalizeSpriteURL(e,i,n,o){const r=T(e);return t.f(e)?(r.path=`/styles/v1${r.path}/sprite${i}${n}`,this._makeAPIURL(r,this._customAccessToken||o)):(r.path+=`${i}${n}`,A(r))}normalizeTileURL(e,i,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!t.f(e))return e;const o=T(e);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||n&&"raster"!==o.authority&&512===n?"@2x":""}${t.m.supported?".webp":"$1"}`),"raster"===o.authority?o.path=`/${t.e.RASTER_URL_PREFIX}${o.path}`:"rasterarrays"===o.authority?o.path=`/${t.e.RASTERARRAYS_URL_PREFIX}${o.path}`:"3dtiles"===o.authority?o.path=`/${t.e.TILES3D_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${t.e.TILE_URL_VERSION}${o.path}`);const r=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(o.params)||t.e.ACCESS_TOKEN;return t.e.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,r)}canonicalizeTileURL(e,i){const n=T(e);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${t.e.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${t.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${t.e.TILE_URL_VERSION}/`,"")}`;let r=n.params;return i&&(r=r.filter((t=>!t.match(/^access_token=/)))),r.length&&(o+=`?${r.join("&")}`),o}canonicalizeTileset(e,i){const n=!!i&&t.f(i),o=[];for(const r of e.tiles||[])t.h(r)?o.push(this.canonicalizeTileURL(r,n)):o.push(r);return o}_makeAPIURL(e,i){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=T(t.e.API_URL);if(e.protocol=o.protocol,e.authority=o.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==o.path&&(e.path=`${o.path}${e.path}`),!t.e.REQUIRE_ACCESS_TOKEN)return A(e);if(i=i||t.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter((t=>-1===t.indexOf("access_token"))),e.params.push(`access_token=${i||""}`),A(e)}}const S=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function T(t){const e=t.match(S);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function A(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const M="mapbox.eventData";function I(e){if(!e)return null;const i=e.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(t.j(i[1]))}catch(t){return null}}class E{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=I(t.e.ACCESS_TOKEN);let n="";return n=i&&i.u?t.k(i.u):t.e.ACCESS_TOKEN||"",e?`${M}.${e}:${n}`:`${M}:${n}`}fetchEventData(){const e=t.s("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const t=localStorage.getItem(i);t&&(this.eventData=JSON.parse(t));const e=localStorage.getItem(n);e&&(this.anonId=e)}catch(e){t.w("Unable to read from LocalStorage")}}saveEventData(){const e=t.s("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid"),o=this.anonId;if(e&&o)try{localStorage.setItem(n,o),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch(e){t.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(e,i,n,o){if(!t.e.EVENTS_URL)return;const r=T(t.e.EVENTS_URL);r.params.push(`access_token=${o||t.e.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString()},a=i?t.l(s,i):s,l={url:A(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=t.p(l,(t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(o)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const P=new class extends E{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(e,i){t.e.EVENTS_URL&&t.e.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>t.f(e)||t.h(e)))&&this.queueRequest(Date.now(),i)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=I(t.e.ACCESS_TOKEN),o=n?n.u:t.e.ACCESS_TOKEN;let r=o!==this.eventData.tokenU;t.v(this.anonId)||(this.anonId=t.u(),r=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;r=r||i>=1||i<-1||t.getDate()!==e.getDate()}else r=!0;r?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:b,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=s,this.eventData.tokenU=o)}),i):this.processRequests()}},k=P.postTurnstileEvent.bind(P),B=new class extends E{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,i,n,o){this.skuToken=i,this.errorCb=o,t.e.EVENTS_URL&&(n||t.e.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(C)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),t.v(this.anonId)||(this.anonId=t.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:b,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):n&&(this.success[n]=!0)}),i))}remove(){this.errorCb=null}},D=B.postMapLoadEvent.bind(B),R=new class extends E{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(e){let i=this.mapInstanceIdMap.get(e);return i||(i=t.u(),this.mapInstanceIdMap.set(e,i)),i}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(e,i){const{map:n,style:o,importedStyles:r}=i;if(!t.e.EVENTS_URL||!e&&!t.e.ACCESS_TOKEN)return;const s=this.getMapInstanceId(n),a={mapInstanceId:s,eventId:this.getEventId(s),style:o};r.length&&(a.importedStyles=r),this.queueRequest({timestamp:Date.now(),payload:a},e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,(()=>{}),t)}},L=R.postStyleLoadEvent.bind(R),z=new class extends E{constructor(){super("gljs.performance")}postPerformanceEvent(e,i){t.e.EVENTS_URL&&(e||t.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:s}=this.queue.shift(),a=function(n){const r=performance.getEntriesByType("resource"),s=performance.getEntriesByType("mark"),a=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const n of t[i]){const t=`${i}ResolveRangeMin`,o=`${i}ResolveRangeMax`,r=`${i}RequestCount`,s=`${i}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,n.startTime),e[o]=Math.max(e[o]||-1/0,n.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==n.transferSize&&0===n.transferSize&&a(s),a(r)}return e}(function(t,e){const i={};if(t)for(const n of t){const t=e(n);void 0===i[t]&&(i[t]=[]),i[t].push(n)}return i}(r,o)),l=window.devicePixelRatio,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection,c=u?u.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in a)d(h.counters,t,a[t]);if(n.interactionRange[0]!==1/0&&n.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",n.interactionRange[0]),d(h.counters,"interactionRangeMax",n.interactionRange[1])),s)for(const t of Object.keys(i)){const e=i[t],n=s.find((t=>t.name===e));n&&d(h.counters,e,n.startTime)}return d(h.counters,"visibilityHidden",n.visibilityHidden),d(h.attributes,"style",function(e){if(e)for(const i of e){const e=i.name.split("?")[0];if(t.i(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(r)),d(h.attributes,"terrainEnabled",n.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",n.fogEnabled?"true":"false"),d(h.attributes,"projection",n.projection),d(h.attributes,"zoom",n.zoom),d(h.metadata,"devicePixelRatio",l),d(h.metadata,"connectionEffectiveType",c),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",n.width/l),d(h.metadata,"mapHeight",n.height/l),d(h.metadata,"webglRenderer",n.renderer),d(h.metadata,"webglVendor",n.vendor),d(h.metadata,"sdkVersion",e),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(s);for(const t of a.metadata);for(const t of a.counters);for(const t of a.attributes);this.postEvent(r,a,(()=>{}),n)}},O=z.postPerformanceEvent.bind(z),U=new class extends E{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,i,n,o){if(!t.e.API_URL||!t.e.SESSION_PATH)return;const r=T(t.e.API_URL+t.e.SESSION_PATH);r.params.push(`sku=${i||""}`),r.params.push(`access_token=${o||t.e.ACCESS_TOKEN||""}`);const s={url:A(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=t.g(s,(t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(o)}))}getSessionAPI(e,i,n,o){this.skuToken=i,this.errorCb=o,t.e.SESSION_PATH&&t.e.API_URL&&(n||t.e.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(C)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}remove(){this.errorCb=null}},F=U.getSessionAPI.bind(U),N=new Set;function V(t,e){e?N.add(t):N.delete(t)}class H{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function j(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class G extends t.E{constructor(e){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=e,"raster"!==e&&t.t()&&(this.imageRasterizerDispatcher=new t.D(t.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new t.I),this._imageRasterizer}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new t.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:i}of this.requestors)this._notify(t,e,i);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,i){this._validate(t,i)&&(this.images[e][t]=i)}_validate(e,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.y(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.y(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.y(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;if(!e.usvg){if(t[0]<0||e.data.width<t[0])return!1;if(t[1]<0||e.data.height<t[1])return!1;if(t[2]<0||e.data.width<t[2])return!1;if(t[3]<0||e.data.height<t[3])return!1}return!(t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i){i.version=this.images[e][t].version+1,this.images[e][t]=i,this.updatedImages[e][t]=!0,this.removeFromImageRasterizerCache(t,e)}removeFromImageRasterizerCache(e,i){"raster"!==this.spriteFormat&&(t.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[e],scope:i}):this.imageRasterizer.removeImagesFromCacheByIds([e],i))}removeImage(t,e){const i=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],this.removeFromImageRasterizerCache(t,e),i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,i){let n=!0;const o=!!this.loaded[e];if(!o)for(const r of t)this.images[e][r]||(n=!1);o||n?this._notify(t,e,i):this.requestors.push({ids:t,scope:e,callback:i})}rasterizeImages(e,i){let{scope:n,imageTasks:o}=e;const r={};for(const t in o){const e=o[t],i=this.getImage(e.id,n);i&&(r[t]={image:i,imageIdWithOptions:e})}t.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:r,scope:n},i):this.rasterizeImagesInMainThread({imageTasks:r,scope:n},i)}rasterizeImagesInMainThread(t,e){const{imageTasks:i,scope:n}=t,o={};for(const r in i){const{image:t,imageIdWithOptions:e}=i[r];o[r]=this.imageRasterizer.rasterize(e,t,n,"")}e(void 0,o)}getUpdatedImages(t){return this.updatedImages[t]}_notify(e,i,n){const o={};for(const r of e){this.images[i][r]||this.fire(new t.z("styleimagemissing",{id:r}));const e=this.images[i][r];e?o[r]={data:e.usvg?null:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,usvg:e.usvg,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(t){const{width:e,height:i}=this.atlasImage[t];return{width:e,height:i}}getPattern(e,i,n){const o=this.patterns[i][e],r=this.getImage(e,i);if(!r)return null;if(o&&o.position.version===r.version)return o.position;if(o)o.position.version=r.version;else{r.usvg&&!r.data&&(r.data=this.imageRasterizer.rasterize(t.A.from(e).getPrimary(),r,i,""));const n={w:r.data.width+2*t.B,h:r.data.height+2*t.B,x:0,y:0},o=new t.C(n,r,t.B);this.patterns[i][e]={bin:n,position:o}}return this._updatePatternAtlas(i,n),this.patterns[i][e].position}bind(e,i){const n=e.gl;let o=this.atlasTexture[i];o?this.dirty&&(o.update(this.atlasImage[i]),this.dirty=!1):(o=new t.T(e,this.atlasImage[i],n.RGBA8),this.atlasTexture[i]=o),o.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e,i){const n=[];for(const t in this.patterns[e])n.push(this.patterns[e][t].bin);const{w:o,h:r}=t.F(n),s=this.atlasImage[e];s.resize({width:o||1,height:r||1});for(const a in this.patterns[e]){const{bin:n,position:o}=this.patterns[e][a];let r=o.padding;const l=n.x+r,u=n.y+r,c=this.images[e][a].data,h=c.width,d=c.height;r=r>1?r-1:r,t.r.copy(c,s,{x:0,y:0},{x:l,y:u},{width:h,height:d},i),t.r.copy(c,s,{x:0,y:d-r},{x:l,y:u-r},{width:h,height:r},i),t.r.copy(c,s,{x:0,y:0},{x:l,y:u+d},{width:h,height:r},i),t.r.copy(c,s,{x:h-r,y:0},{x:l-r,y:u},{width:r,height:d},i),t.r.copy(c,s,{x:0,y:0},{x:l+h,y:u},{width:r,height:d},i),t.r.copy(c,s,{x:h-r,y:d-r},{x:l-r,y:u-r},{width:r,height:r},i),t.r.copy(c,s,{x:0,y:d-r},{x:l+h,y:u-r},{width:r,height:r},i),t.r.copy(c,s,{x:0,y:0},{x:l+h,y:u+d},{width:r,height:r},i),t.r.copy(c,s,{x:h-r,y:0},{x:l-r,y:u+d},{width:r,height:r},i)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const i of t){if(this.callbackDispatchedThisFrame[e][i])continue;this.callbackDispatchedThisFrame[e][i]=!0;const t=this.images[e][i];j(t)&&this.updateImage(i,e,t)}}}function W(e){const i=e.key,n=e.value,o=e.valueSpec||{},r=e.objectElementValidators||{},s=e.style,a=e.styleSpec;let l=[];const u=t.H(n);if("object"!==u)return[new t.V(i,n,`object expected, ${u} found`)];for(const c in n){const e=c.split(".")[0];let u;r[e]?u=r[e]:o[e]?u=ft:r["*"]?u=r["*"]:o["*"]&&(u=ft),u?l=l.concat(u({key:(i?`${i}.`:i)+c,value:n[c],valueSpec:o[e]||o["*"],style:s,styleSpec:a,object:n,objectKey:c},n)):l.push(new t.G(i,n[c],`unknown property "${c}"`))}for(const c in o)r[c]||o[c].required&&void 0===o[c].default&&void 0===n[c]&&l.push(new t.V(i,n,`missing required property "${c}"`));return l}function q(e){const i=e.value,n=e.valueSpec,o=e.style,r=e.styleSpec,s=e.key,a=e.arrayElementValidator||ft;if("array"!==t.H(i))return[new t.V(s,i,`array expected, ${t.H(i)} found`)];if(n.length&&i.length!==n.length)return[new t.V(s,i,`array length ${n.length} expected, length ${i.length} found`)];if(n["min-length"]&&i.length<n["min-length"])return[new t.V(s,i,`array length at least ${n["min-length"]} expected, length ${i.length} found`)];let l={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(l.function=n.function),"object"===t.H(n.value)&&(l=n.value);let u=[];for(let t=0;t<i.length;t++)u=u.concat(a({array:i,arrayIndex:t,value:i[t],valueSpec:l,style:o,styleSpec:r,key:`${s}[${t}]`},!0));return u}function Z(e){const i=e.key,n=e.value,o=e.valueSpec;let r=t.H(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new t.V(i,n,`number expected, ${r} found`)];if("minimum"in o){let r=o.minimum;if("array"===t.H(o.minimum)&&(r=o.minimum[e.arrayIndex]),n<r)return[new t.V(i,n,`${n} is less than the minimum value ${r}`)]}if("maximum"in o){let r=o.maximum;if("array"===t.H(o.maximum)&&(r=o.maximum[e.arrayIndex]),n>r)return[new t.V(i,n,`${n} is greater than the maximum value ${r}`)]}return[]}function $(e){const i=e.valueSpec,n=t.K(e.value.type);let o,r,s,a={};const l="categorical"!==n&&void 0===e.value.property,u=!l,c="array"===t.H(e.value.stops)&&"array"===t.H(e.value.stops[0])&&"object"===t.H(e.value.stops[0][0]),h=W({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new t.V(e.key,e.value,'identity function may not have a "stops" property')];let i=[];const o=e.value;return i=i.concat(q({key:e.key,value:o,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),"array"===t.H(o)&&0===o.length&&i.push(new t.V(e.key,o,"array must have at least one stop")),i},default:function(t){return ft({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&l&&h.push(new t.V(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||h.push(new t.V(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!t.L(e.valueSpec)&&h.push(new t.V(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(u&&!t.M(e.valueSpec)?h.push(new t.V(e.key,e.value,"property functions not supported")):l&&!t.N(e.valueSpec)&&h.push(new t.V(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||h.push(new t.V(e.key,e.value,'"property" property is required')),h;function d(e){let n=[];const o=e.value,l=e.key;if("array"!==t.H(o))return[new t.V(l,o,`array expected, ${t.H(o)} found`)];if(2!==o.length)return[new t.V(l,o,`array length 2 expected, length ${o.length} found`)];if(c){if("object"!==t.H(o[0]))return[new t.V(l,o,`object expected, ${t.H(o[0])} found`)];if(void 0===o[0].zoom)return[new t.V(l,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new t.V(l,o,"object stop key must have value")];const i=t.K(o[0].zoom);if("number"!=typeof i)return[new t.V(l,o[0].zoom,"stop zoom values must be numbers")];if(s&&s>i)return[new t.V(l,o[0].zoom,"stop zoom values must appear in ascending order")];i!==s&&(s=i,r=void 0,a={}),n=n.concat(W({key:`${l}[0]`,value:o[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Z,value:f}}))}else n=n.concat(f({key:`${l}[0]`,value:o[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},o));return t.O(t.Q(o[1]))?n.concat([new t.V(`${l}[1]`,o[1],"expressions are not allowed in function stops.")]):n.concat(ft({key:`${l}[1]`,value:o[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function f(e,s){const l=t.H(e.value),u=t.K(e.value),c=null!==e.value?e.value:s;if(o){if(l!==o)return[new t.V(e.key,c,`${l} stop domain type must match previous stop domain type ${o}`)]}else o=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof u&&"string"!=typeof u&&"boolean"!=typeof u)return[new t.V(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==n){let o=`number expected, ${l} found`;return t.M(i)&&void 0===n&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(e.key,c,o)]}return"categorical"!==n||"number"!==l||"number"==typeof u&&isFinite(u)&&Math.floor(u)===u?"categorical"!==n&&"number"===l&&"number"==typeof u&&"number"==typeof r&&void 0!==r&&u<r?[new t.V(e.key,c,"stop domain values must appear in ascending order")]:(r=u,"categorical"===n&&u in a?[new t.V(e.key,c,"stop domain values must be unique")]:(a[u]=!0,[])):[new t.V(e.key,c,`integer expected, found ${String(u)}`)]}}function K(e){const i=("property"===e.expressionContext?t.S:t.U)(t.Q(e.value),e.valueSpec);if("error"===i.result)return i.value.map((i=>new t.V(`${e.key}${i.key}`,e.value,i.message)));const n=i.value.expression||i.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new t.V(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!t.W(n))return[new t.V(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Y(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!t.X(n,["zoom","feature-state"]))return[new t.V(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!t.Y(n))return[new t.V(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Y(e,i){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const t of i.valueSpec.expression.parameters)n.delete(t);if(0===n.size)return[];const o=[];return e instanceof t.Z&&n.has(e.name)?[new t.V(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(e.eachChild((t=>{o.push(...Y(t,i))})),o)}function J(e){const i=e.key,n=e.value,o=e.valueSpec,r=[];return Array.isArray(o.values)?-1===o.values.indexOf(t.K(n))&&r.push(new t.V(i,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(o.values).indexOf(t.K(n))&&r.push(new t.V(i,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function X(e){return t.$(t.Q(e.value))?K(t.J({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Q(e)}function Q(e){const i=e.value,n=e.key;if("array"!==t.H(i))return[new t.V(n,i,`array expected, ${t.H(i)} found`)];const o=e.styleSpec;let r,s=[];if(i.length<1)return[new t.V(n,i,"filter array must have at least 1 element")];switch(s=s.concat(J({key:`${n}[0]`,value:i[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),t.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===t.K(i[1])&&s.push(new t.V(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&s.push(new t.V(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(r=t.H(i[1]),"string"!==r&&s.push(new t.V(`${n}[1]`,i[1],`string expected, ${r} found`)));for(let a=2;a<i.length;a++)r=t.H(i[a]),"$type"===t.K(i[1])?s=s.concat(J({key:`${n}[${a}]`,value:i[a],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&s.push(new t.V(`${n}[${a}]`,i[a],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let t=1;t<i.length;t++)s=s.concat(Q({key:`${n}[${t}]`,value:i[t],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=t.H(i[1]),2!==i.length?s.push(new t.V(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==r&&s.push(new t.V(`${n}[1]`,i[1],`string expected, ${r} found`))}return s}function tt(e,i){const n=e.key,o=e.style,r=e.layer,s=e.styleSpec,a=e.value,l=e.objectKey,u=s[`${i}_${e.layerType}`];if(!u)return[];const c=l.match(/^(.*)-use-theme$/);if("paint"===i&&c&&u[c[1]])return t.O(a)?[].concat(ft({key:e.key,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:o,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l})):ft({key:n,value:a,valueSpec:{type:"string"},style:o,styleSpec:s});const h=l.match(/^(.*)-transition$/);if("paint"===i&&h&&u[h[1]]&&u[h[1]].transition)return ft({key:n,value:a,valueSpec:s.transition,style:o,styleSpec:s});const d=e.valueSpec||u[l];if(!d)return[new t.G(n,a,`unknown property "${l}"`)];let f;if("string"===t.H(a)&&t.M(d)&&!d.tokens&&(f=/^{([^}]+)}$/.exec(a))){const e=`\`{ "type": "identity", "property": ${f?JSON.stringify(f[1]):'"_"'} }\``;return[new t.V(n,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const p=[];if("symbol"===e.layerType)"text-field"!==l||!o||o.glyphs||o.imports||p.push(new t.V(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&t.a0(t.Q(a))&&"identity"===t.K(a.type)&&p.push(new t.V(n,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===i&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&t.M(d)&&(t.a1(d)||t.N(d))){const e=t.S(t.Q(a),d),i=e.value.expression||e.value._styleExpression.expression;i&&!t.X(i,["measure-light"])&&("model-emissive-strength"===l&&t.Y(i)&&t.W(i)||p.push(new t.V(n,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(ft({key:e.key,value:a,valueSpec:d,style:o,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l}))}function et(t){return tt(t,"paint")}function it(t){return tt(t,"layout")}function nt(e){let i=[];const n=e.value,o=e.key,r=e.style,s=e.styleSpec;n.type||n.ref||i.push(new t.V(o,n,'either "type" or "ref" is required'));let a=t.K(n.type);const l=t.K(n.ref);if(n.id){const s=t.K(n.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];t.K(e.id)===s&&i.push(new t.V(o,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&i.push(new t.V(o,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((i=>{t.K(i.id)===l&&(e=i)})),e?e.ref?i.push(new t.V(o,n.ref,"ref cannot reference another ref layer")):a=t.K(e.type):"string"==typeof l&&i.push(new t.V(o,n.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source){const e=r.sources&&r.sources[n.source],s=e&&t.K(e.type);e?"vector"===s&&"raster"===a?i.push(new t.V(o,n.source,`layer "${n.id}" requires a raster source`)):"raster"===s&&"raster"!==a?i.push(new t.V(o,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==s||n["source-layer"]?"raster-dem"===s&&"hillshade"!==a?i.push(new t.V(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"!==a||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===s&&e.lineMetrics?"raster-particle"===a&&"raster-array"!==s&&i.push(new t.V(o,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):i.push(new t.V(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new t.V(o,n.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new t.V(o,n,`layer "${n.id}" must specify a "source-layer"`)):i.push(new t.V(o,n.source,`source "${n.source}" not found`))}else i.push(new t.V(o,n,'missing required property "source"'));return i=i.concat(W({key:o,value:n,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ft({key:`${o}.type`,value:n.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>X(t.J({layerType:a},e)),layout:e=>W({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>it(t.J({layerType:a},e))}}),paint:e=>W({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>et(t.J({layerType:a,layer:n},e))}})}})),i}function ot(e){const i=e.value,n=e.key,o=t.H(i);return"string"!==o?[new t.V(n,i,`string expected, ${o} found`)]:[]}const rt={promoteId:function e(i){let{key:n,value:o}=i;if("string"===t.H(o))return ot({key:n,value:o});if(Array.isArray(o)){const e=[],i=t.Q(o),r=t.U(i);return"error"===r.result&&r.value.forEach((i=>{e.push(new t.V(`${n}${i.key}`,null,`${i.message}`))})),t.X(r.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||e.push(new t.V(`${n}`,null,"promoteId expression should be only feature dependent")),e}{const t=[];for(const i in o)t.push(...e({key:`${n}.${i}`,value:o[i]}));return t}}};function st(e){const i=e.value,n=e.key,o=e.styleSpec,r=e.style;if(!i.type)return[new t.V(n,i,'"type" is required')];const s=t.K(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(i.url||i.tiles||a.push(new t.G(n,i,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(W({key:n,value:i,valueSpec:o[`source_${s.replace("-","_")}`],style:e.style,styleSpec:o,objectElementValidators:rt})),a;case"geojson":if(a=W({key:n,value:i,valueSpec:o.source_geojson,style:r,styleSpec:o,objectElementValidators:rt}),i.cluster)for(const t in i.clusterProperties){const[e,o]=i.clusterProperties[t],r="string"==typeof e?[e,["accumulated"],["get",t]]:e;a.push(...K({key:`${n}.${t}.map`,value:o,expressionContext:"cluster-map"})),a.push(...K({key:`${n}.${t}.reduce`,value:r,expressionContext:"cluster-reduce"}))}return a;case"video":return W({key:n,value:i,valueSpec:o.source_video,style:r,styleSpec:o});case"image":return W({key:n,value:i,valueSpec:o.source_image,style:r,styleSpec:o});case"canvas":return[new t.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return J({key:`${n}.type`,value:i.type,valueSpec:{values:at(o)},style:r,styleSpec:o})}}function at(t){return t.source.reduce(((e,i)=>{const n=t[i];return"enum"===n.type.type&&(e=e.concat(Object.keys(n.type.values))),e}),[])}function lt(e){const i=e.value,n=e.styleSpec,o=n.light,r=e.style;let s=[];const a=t.H(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new t.V("light",i,`object expected, ${a} found`)]),s;for(const l in i){const e=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&o[a[1]]?ft({key:l,value:i[l],valueSpec:{type:"string"},style:r,styleSpec:n}):e&&o[e[1]]&&o[e[1]].transition?ft({key:l,value:i[l],valueSpec:n.transition,style:r,styleSpec:n}):o[l]?ft({key:l,value:i[l],valueSpec:o[l],style:r,styleSpec:n}):[new t.V(l,i[l],`unknown property "${l}"`)])}return s}function ut(e){const i=e.value;let n=[];if(!i)return n;const o=t.H(i);if("object"!==o)return n=n.concat([new t.V("light-3d",i,`object expected, ${o} found`)]),n;const r=e.styleSpec,s=r["light-3d"],a=e.key,l=e.style,u=e.style.lights;for(const d of["type","id"])if(!(d in i))return n=n.concat([new t.V("light-3d",i,`missing property ${d} on light`)]),n;if(i.type&&u)for(let d=0;d<e.arrayIndex;d++){const e=t.K(i.type),o=u[d];t.K(o.type)===e&&n.push(new t.V(a,i.id,`duplicate light type "${i.type}", previously defined at line ${o.id.__line__}`))}const c=`properties_light_${i.type}`;if(!(c in r))return n=n.concat([new t.V("light-3d",i,`Invalid light type ${i.type}`)]),n;const h=r[c];for(const d in i)if("properties"===d){const o=i[d],s=t.H(o);if("object"!==s)return n=n.concat([new t.V("properties",o,`object expected, ${s} found`)]),n;for(const i in o)n=n.concat(h[i]?ft({key:i,value:o[i],valueSpec:h[i],style:l,styleSpec:r}):[new t.G(e.key,o[i],`unknown property "${i}"`)])}else{const e=d.match(/^(.*)-transition$/),o=d.match(/^(.*)-use-theme$/);n=n.concat(o&&s[o[1]]?ft({key:d,value:i[d],valueSpec:{type:"string"},style:l,styleSpec:r}):e&&s[e[1]]&&s[e[1]].transition?ft({key:d,value:i[d],valueSpec:r.transition,style:l,styleSpec:r}):s[d]?ft({key:d,value:i[d],valueSpec:s[d],style:l,styleSpec:r}):[new t.G(d,i[d],`unknown property "${d}"`)])}return n}function ct(e){const i=e.value,n=e.key,o=e.style,r=e.styleSpec,s=r.terrain;let a=[];const l=t.H(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new t.V("terrain",i,`object expected, ${l} found`)]),a;for(const u in i){const e=u.match(/^(.*)-transition$/),n=u.match(/^(.*)-use-theme$/);a=a.concat(n&&s[n[1]]?ft({key:u,value:i[u],valueSpec:{type:"string"},style:o,styleSpec:r}):e&&s[e[1]]&&s[e[1]].transition?ft({key:u,value:i[u],valueSpec:r.transition,style:o,styleSpec:r}):s[u]?ft({key:u,value:i[u],valueSpec:s[u],style:o,styleSpec:r}):[new t.G(u,i[u],`unknown property "${u}"`)])}if(i.source){const e=o.sources&&o.sources[i.source],r=e&&t.K(e.type);e?"raster-dem"!==r&&a.push(new t.V(n,i.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):a.push(new t.V(n,i.source,`source "${i.source}" not found`))}else a.push(new t.V(n,i,'terrain is missing required property "source"'));return a}function ht(e){const i=e.value,n=e.style,o=e.styleSpec,r=o.fog;let s=[];const a=t.H(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new t.V("fog",i,`object expected, ${a} found`)]),s;for(const l in i){const e=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&r[a[1]]?ft({key:l,value:i[l],valueSpec:{type:"string"},style:n,styleSpec:o}):e&&r[e[1]]&&r[e[1]].transition?ft({key:l,value:i[l],valueSpec:o.transition,style:n,styleSpec:o}):r[l]?ft({key:l,value:i[l],valueSpec:r[l],style:n,styleSpec:o}):[new t.G(l,i[l],`unknown property "${l}"`)])}return s}const dt={"*":()=>[],array:q,boolean:function(e){const i=e.value,n=e.key,o=t.H(i);return"boolean"!==o?[new t.V(n,i,`boolean expected, ${o} found`)]:[]},number:Z,color:function(e){const i=e.key,n=e.value,o=t.H(n);return"string"!==o?[new t.V(i,n,`color expected, ${o} found`)]:null===t._.parseCSSColor(n)?[new t.V(i,n,`color expected, "${n}" found`)]:[]},enum:J,filter:X,function:$,layer:nt,object:W,source:st,model:t.a2,light:lt,"light-3d":ut,terrain:ct,fog:ht,string:ot,formatted:function(t){return 0===ot(t).length?[]:K(t)},resolvedImage:function(t){return 0===ot(t).length?[]:K(t)},projection:function(e){const i=e.value,n=e.styleSpec,o=n.projection,r=e.style;let s=[];const a=t.H(i);if("object"===a)for(const t in i)s=s.concat(ft({key:t,value:i[t],valueSpec:o[t],style:r,styleSpec:n}));else"string"!==a&&(s=s.concat([new t.V("projection",i,`object or string expected, ${a} found`)]));return s},import:function(e){const{value:i,styleSpec:n}=e,{data:o,...r}=i;Object.defineProperty(r,"__line__",{value:i.__line__,enumerable:!1});let s=W(t.J({},e,{value:r,valueSpec:n.import}));return""===t.K(r.id)&&s.push(new t.V(`${e.key}.id`,r,"import id can't be an empty string")),o&&(s=s.concat(mt(o,n,{key:`${e.key}.data`}))),s}};function ft(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.value,o=e.valueSpec,r=e.styleSpec;if(o.expression&&t.a0(t.K(n)))return $(e);if(o.expression&&t.O(t.Q(n)))return K(e);if(o.type&&dt[o.type]){const n=dt[o.type](e);return!0===i&&n.length>0&&"array"===t.H(e.value)?K(e):n}return W(t.J({},e,{valueSpec:o.type?r[o.type]:o}))}function pt(e){const i=e.value,n=e.key,o=ot(e);return o.length||(-1===i.indexOf("{fontstack}")&&o.push(new t.V(n,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&o.push(new t.V(n,i,'"glyphs" url must include a "{range}" token'))),o}function mt(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.a3;return ft({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:e,valueSpec:i.$root,styleSpec:i,style:e,objectElementValidators:{glyphs:pt,"*":()=>[]}})}function gt(e){return Et(mt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.a3))}const yt=t=>Et(st(t)),_t=t=>Et(lt(t)),vt=t=>Et(ut(t)),xt=t=>Et(ct(t)),bt=t=>Et(ht(t)),Ct=e=>Et(function(e){const i=e.value,n=e.style,o=e.styleSpec,r=o.snow;let s=[];const a=t.H(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new t.V("snow",i,`object expected, ${a} found`)]),s;for(const l in i){const e=l.match(/^(.*)-transition$/);s=s.concat(e&&r[e[1]]&&r[e[1]].transition?ft({key:l,value:i[l],valueSpec:o.transition,style:n,styleSpec:o}):r[l]?ft({key:l,value:i[l],valueSpec:r[l],style:n,styleSpec:o}):[new t.G(l,i[l],`unknown property "${l}"`)])}return s}(e)),wt=e=>Et(function(e){const i=e.value,n=e.style,o=e.styleSpec,r=o.rain;let s=[];const a=t.H(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new t.V("rain",i,`object expected, ${a} found`)]),s;for(const l in i){const e=l.match(/^(.*)-transition$/);s=s.concat(e&&r[e[1]]&&r[e[1]].transition?ft({key:l,value:i[l],valueSpec:o.transition,style:n,styleSpec:o}):r[l]?ft({key:l,value:i[l],valueSpec:r[l],style:n,styleSpec:o}):[new t.G(l,i[l],`unknown property "${l}"`)])}return s}(e)),St=t=>Et(nt(t)),Tt=t=>Et(X(t)),At=t=>Et(et(t)),Mt=t=>Et(it(t)),It=e=>Et(t.a2(e));function Et(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function Pt(e,i){let n=!1;if(i&&i.length)for(const o of i)o instanceof t.G?t.w(o.message):(e.fire(new t.y(new Error(o.message))),n=!0);return n}let kt;class Bt extends t.E{constructor(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new t.a4(kt||(kt=new t.a5({anchor:new t.a6(t.a3.light.anchor),position:new t.a7(t.a3.light.position),color:new t.a6(t.a3.light.color),intensity:new t.a6(t.a3.light.intensity)}))),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(_t,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Pt(this,e.call(gt,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let Dt=class extends t.E{constructor(e,i,n,o){super(),this.scope=n,this._transitionable=new t.a4(new t.a5({source:new t.a6(t.a3.terrain.source),exaggeration:new t.a6(t.a3.terrain.exaggeration)}),n,o),this._transitionable.setTransitionOrValue(e,o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new t.a8(e)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const e=this._transitionable._values.exaggeration;if(!e)return null;const i=e.value.expression;if(!i)return null;let n=-1,o=-1,r=1;for(const s of i.zoomStops)r=i.evaluate(new t.a8(s)),r>.01?(n=s,o=-1):o=s;return r<.01&&n>0&&o>n?[n,o]:null}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof t.a9}};const Rt=45,Lt=65,zt=.05;function Ot(e,i,n,o){const r=t.ac(Rt,Lt,n),[s,a]=Ut(e,o);let l=1-Math.min(1,Math.exp((i-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*r*e.alpha}function Ut(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function Ft(e,i,n,o,r){const s=t.ab.vec3.transformMat4([],[i,n,o],r.mercatorFogMatrix);return Ot(e,t.ab.vec3.length(s),r.pitch,r._fov)}function Nt(e,i,n,o,r,s,a){const l=[[n,o,0],[r,o,0],[r,s,0],[n,s,0]];let u=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const h of l){const e=t.ab.vec3.transformMat4([],h,i),n=t.ab.vec3.length(e);u=Math.min(u,n),c=Math.max(c,n)}return[Ot(e,u,a.pitch,a._fov),Ot(e,c,a.pitch,a._fov)]}class Vt extends t.E{constructor(e,i,n,o){super();const r=new t.a5({range:new t.a6(t.a3.fog.range),color:new t.a6(t.a3.fog.color),"color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new t.a6(t.a3.fog["high-color"]),"high-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new t.a6(t.a3.fog["space-color"]),"space-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new t.a6(t.a3.fog["horizon-blend"]),"star-intensity":new t.a6(t.a3.fog["star-intensity"]),"vertical-range":new t.a6(t.a3.fog["vertical-range"])});this._transitionable=new t.a4(r,n,new Map(o)),this.set(e,o),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new t.ad(r),this.scope=n}get state(){const e=this._transform,i="globe"===e.projection.name,n=t.ae(e.zoom),o=this.properties.get("range"),r=[.5,3];return{range:i?[t.af(r[0],o[0],n),t.af(r[1],o[1],n)]:o,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(bt,e,n))return;const o=t.l({},e);for(const r of Object.keys(t.a3.fog))void 0===o[r]&&(o[r]=t.a3.fog[r].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.ac(Rt,Lt,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,n){const o=t.aa.fromLngLat(i),r=n.elevation?n.elevation.getAtPointOrZero(o):0;return Ft(e,o.x,o.y,r,n)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return Nt(this.state,i,0,0,t.ag,t.ag,this._transform)}getOpacityForBounds(t,e,i,n,o){return this._transform.projection.supportsFog?Nt(this.state,t,e,i,n,o,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ut(this.state,t):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const n of i){const i=e.points[n];let o;if(i[2]>=0)o=i;else{const r=e.points[n-4];o=t.ah(r,i,r[2]/(r[2]-i[2]))}if(Ft(this.state,o[0],o[1],0,this._transform)>=zt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Pt(this,e.call(gt,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let Ht,jt,Gt,Wt,qt=class extends t.E{constructor(e,i,n,o){super();const r=Ht||(Ht=new t.a5({density:new t.a6(t.a3.snow.density),intensity:new t.a6(t.a3.snow.intensity),color:new t.a6(t.a3.snow.color),opacity:new t.a6(t.a3.snow.opacity),vignette:new t.a6(t.a3.snow.vignette),"vignette-color":new t.a6(t.a3.snow["vignette-color"]),"center-thinning":new t.a6(t.a3.snow["center-thinning"]),direction:new t.a6(t.a3.snow.direction),"flake-size":new t.a6(t.a3.snow["flake-size"])}));this._transitionable=new t.a4(r,n,new Map(o)),this.set(e,o),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(r),this.scope=n}get state(){const e=this.properties.get("opacity"),i=this.properties.get("color"),n=this.properties.get("direction"),o=t.ai(n[0]),r=-Math.max(t.ai(n[1]),.01),s=[Math.cos(o)*Math.cos(r),Math.sin(o)*Math.cos(r),Math.sin(r)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(i.r,i.g,i.b,i.a*e),direction:s,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ct,e,n))return;const o=t.l({},e);for(const r of Object.keys(t.a3.snow))void 0===o[r]&&(o[r]=t.a3.snow[r].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Pt(this,e.call(gt,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}},Zt=class extends t.E{constructor(e,i,n,o){super();const r=jt||(jt=new t.a5({density:new t.a6(t.a3.rain.density),intensity:new t.a6(t.a3.rain.intensity),color:new t.a6(t.a3.rain.color),opacity:new t.a6(t.a3.rain.opacity),vignette:new t.a6(t.a3.rain.vignette),"vignette-color":new t.a6(t.a3.rain["vignette-color"]),"center-thinning":new t.a6(t.a3.rain["center-thinning"]),direction:new t.a6(t.a3.rain.direction),"droplet-size":new t.a6(t.a3.rain["droplet-size"]),"distortion-strength":new t.a6(t.a3.rain["distortion-strength"])}));this._transitionable=new t.a4(r,n,new Map(o)),this.set(e,o),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(r),this.scope=n}get state(){const e=this.properties.get("opacity"),i=this.properties.get("color"),n=this.properties.get("direction"),o=t.ai(n[0]),r=-Math.max(t.ai(n[1]),.01),s=[Math.cos(o)*Math.cos(r),Math.sin(o)*Math.cos(r),Math.sin(r)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(i.r,i.g,i.b,i.a*e),direction:s,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(wt,e,n))return;const o=t.l({},e);for(const r of Object.keys(t.a3.rain))void 0===o[r]&&(o[r]=t.a3.rain[r].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Pt(this,e.call(gt,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}};class $t extends t.E{constructor(e,i,n,o){super(),this.scope=n,this._options=e,this.properties=new t.ad(i),this._transitionable=new t.a4(i,n,new Map(o)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Kt{constructor(t,e,i,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let n,o;if(e instanceof t.P||"number"==typeof e[0]){const r=t.P.convert(e);n=[r],o=i.isPointAboveHorizon(r)}else{const r=t.P.convert(e[0]),s=t.P.convert(e[1]);n=[r,s],o=t.al(r,s).every((t=>i.isPointAboveHorizon(t)))}return new Kt(n,i.getCameraPoint(),o,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.al(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],o=t.al(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?o.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?o[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(o[3]=this.cameraPoint)),t.am(o,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],o=t.al(i,n,e),r=this.cameraPoint.clone();switch(3*((r.y>i.y)+(r.y>n.y))+((r.x>i.x)+(r.x>n.x))){case 0:o[0]=r,o[4]=r.clone();break;case 1:o.splice(1,0,r);break;case 2:o[1]=r;break;case 3:o.splice(4,0,r);break;case 5:o.splice(2,0,r);break;case 6:o[3]=r;break;case 7:o.splice(3,0,r);break;case 8:o[2]=r}return o}containsTile(e,i,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=e.queryPadding/i._pixelsPerMercatorPixel+1,s=n?this._bufferedCameraMercator(r,i):this._bufferedScreenMercator(r,i);let a=e.tileID.wrap+(s.unwrapped?o:0);const l=s.polygon.map((i=>t.an(e.tileTransform,i,a)));if(!t.ao(l,0,0,t.ag,t.ag))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?o:0);const u=this.screenGeometryMercator.polygon.map((i=>t.ap(e.tileTransform,i,a))),c=u.map((e=>new t.P(e[0],e[1]))),h=i.getFreeCameraOptions().position||new t.aa(0,0,0),d=t.ap(e.tileTransform,h,a),f=u.map((e=>{const i=t.ab.vec3.sub(e,e,d);return t.ab.vec3.normalize(i,i),new t.aq(d,i)})),p=t.ar(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:f,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=t.as(l),m.min.x=t.aw(m.min.x,0,t.ag),m.min.y=t.aw(m.min.y,0,t.ag),m.max.x=t.aw(m.max.x,0,t.ag),m.max.y=t.aw(m.max.y,0,t.ag),m),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var m}_bufferedScreenMercator(t,e){const i=Xt(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(t,e){const i=Xt(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(e,i){const n=function(e,i){const n=t.ab.mat4.multiply([],i.pixelMatrix,i.globeMatrix),o=[0,-t.ax,0,1],r=[0,t.ax,0,1],s=[0,0,0,1];t.ab.vec4.transformMat4(o,o,n),t.ab.vec4.transformMat4(r,r,n),t.ab.vec4.transformMat4(s,s,n);const a=new t.P(o[0]/o[3],o[1]/o[3]),l=new t.P(r[0]/r[3],r[1]/r[3]),u=t.au(e,a)&&o[3]<s[3],c=t.au(e,l)&&r[3]<s[3];if(!u&&!c)return null;const h=function(t,e,i){for(let n=1;n<t.length;n++){const o=Jt(e.pointCoordinate3D(t[n-1]).x),r=Jt(e.pointCoordinate3D(t[n]).x);if(i<0){if(o<r)return{idx:n,t:-o/(r-1-o)}}else if(r<o)return{idx:n,t:(1-o)/(r+1-o)}}return null}(e,i,u?-1:1);if(!h)return null;const{idx:d,t:f}=h;let p=d>1?Yt(e.slice(0,d),i):[],m=d<e.length?Yt(e.slice(d),i):[];p=p.map((e=>new t.P(Jt(e.x),e.y))),m=m.map((e=>new t.P(Jt(e.x),e.y)));const g=[...p];0===g.length&&g.push(m[m.length-1]);const y=t.af(g[g.length-1].y,(0===m.length?p[0]:m[0]).y,f);let _;return _=u?[new t.P(0,y),new t.P(0,0),new t.P(1,0),new t.P(1,y)]:[new t.P(1,y),new t.P(1,1),new t.P(0,1),new t.P(0,y)],g.push(..._),0===m.length?g.push(p[0]):g.push(...m),{polygon:g.map((e=>new t.aa(e.x,e.y))),unwrapped:!1}}(e,i);if(n)return n;const o=function(e,i){let n=!1,o=-1/0,r=0;for(let t=0;t<e.length-1;t++)e[t].x>o&&(o=e[t].x,r=t);for(let t=0;t<e.length-1;t++){const i=(r+t)%(e.length-1),o=e[i],s=e[i+1];Math.abs(o.x-s.x)>.5&&(o.x<s.x?(o.x+=1,0===i&&(e[e.length-1].x+=1)):(s.x+=1,i+1===e.length-1&&(e[0].x+=1)),n=!0)}const s=t.at(i.center.lng);return n&&s<Math.abs(s-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:n}}(Yt(e,i).map((e=>new t.P(Jt(e.x),e.y))),i);return{polygon:o.polygon.map((e=>new t.aa(e.x,e.y))),unwrapped:o.unwrapped}}}function Yt(e,i){return t.av(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function Jt(t){return t<0?1+t%1:t%1}function Xt(t){return 100*t|0}function Qt(e,i,n,o,r){const s=function(n,o){if(n)return r(n);if(o){if(e.url&&o.tiles&&e.tiles&&delete e.tiles,o.variants){if(!Array.isArray(o.variants))return r(new Error("variants must be an array"));for(const e of o.variants){if(null==e||"object"!=typeof e||e.constructor!==Object)return r(new Error("variant must be an object"));if(!Array.isArray(e.capabilities))return r(new Error("capabilities must be an array"));if(1===e.capabilities.length&&"meshopt"===e.capabilities[0]){o=t.l(o,e);break}}}const n=t.ay(t.l({},o,e),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);n.tiles=i.canonicalizeTileset(n,e.url),r(null,n)}},a=function(t,e,i){if(!t)return null;if(!e&&!i)return t;i=i||t.worldview_default;const n=Object.values(t.language||{});if(0===n.length)return null;const o=Object.values(t.worldview||{});if(0===o.length)return null;const r=n.every((t=>t===e)),s=o.every((t=>t===i));return r&&s?t:e in(t.language_options||{})||i in(t.worldview_options||{})?null:t.language_options&&t.worldview_options?t:null}(e.data,n,o);return a?t.q.frame((()=>s(null,a))):e.url?t.n(i.transformRequest(i.normalizeSourceURL(e.url,null,n,o),t.R.Source),s):t.q.frame((()=>{const{data:t,...i}=e;s(null,i)}))}class te{constructor(e,i,n){this.bounds=t.az.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),n=Math.floor(t.at(this.bounds.getWest())*i),o=Math.floor(t.aA(this.bounds.getNorth())*i),r=Math.ceil(t.at(this.bounds.getEast())*i),s=Math.ceil(t.aA(this.bounds.getSouth())*i);return e.x>=n&&e.x<r&&e.y>=o&&e.y<s}}class ee extends t.E{constructor(e,i,n,o){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.l(this,t.ay(i,["url","scheme","tileSize","promoteId"])),this._options=t.l({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o),this._tileWorkers={},this._deduped=new t.aB}load(e){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Qt(this._options,this.map._requestManager,i,n,((o,r)=>{if(this._tileJSONRequest=null,this._loaded=!0,o)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.y(o));else if(r){if(t.l(this,r),this.hasWorldviews=!!r.worldview_options,r.worldview_default&&(this.worldviewDefault=r.worldview_default),r.vector_layers){this.vectorLayers=r.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const t of r.vector_layers)this.vectorLayerIds.push(t.id),r.worldview&&r.worldview[t.source]&&this.localizableLayerIds.add(t.id)}r.bounds&&(this.tileBounds=new te(r.bounds,this.minzoom,this.maxzoom)),k(r.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}e&&e(o)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.aC(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}loadTile(e,i){const n=e.tileID.canonical.url(this.tiles,this.scheme),o=this.map._requestManager.normalizeTileURL(n),r=this.map._requestManager.transformRequest(o,t.R.Tile),s=this.map.style?this.map.style.getLut(this.scope):null,a=s?{image:s.image.clone()}:null,l={request:r,data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&t.f(n)&&(l.worldview=this.map.getWorldview()||this.worldviewDefault,l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",l,u.bind(this));else if(e.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",l,u.bind(this),void 0,!0);else{const i=t.aD.call({deduped:this._deduped},l,((t,i)=>{t||!i?u.call(this,t):(l.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",l,u.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function u(n,o){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&o&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),t.aE(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,e){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ie extends t.E{constructor(e,i,n,o){super(),this.id=e,this.dispatcher=n,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.l({type:"raster"},i),t.l(this,t.ay(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Qt(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new t.y(i)):n&&(t.l(this,n),n.raster_layers&&(this.rasterLayers=n.raster_layers,this.rasterLayerIds=this.rasterLayers.map((t=>t.id))),n.bounds&&(this.tileBounds=new te(n.bounds,this.minzoom,this.maxzoom)),k(n.tiles),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.aC(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const n=t.q.devicePixelRatio>=2,o=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.o(this.map._requestManager.transformRequest(o,t.R.Tile),((n,o,r,s)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):n?(e.state="errored",i(n)):o?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:r,expires:s}),e.setTexture(o,this.map.painter),e.state="loaded",t.aE(this.dispatcher),void i(null)):i(null))))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e&&e()}unloadTile(e,i){e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ne extends ie{constructor(e,i,n,o){super(e,i,n,o),this.type="raster-array",this.maxzoom=22,this._options=t.l({type:"raster-array"},i)}triggerRepaint(t){const e=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);e&&e.enabled&&i&&e._clearRenderCacheForTile(i.id,t.tileID),this.map.triggerRepaint()}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),o=this.map._requestManager.transformRequest(n,t.R.Tile);e.requestParams=o,e.actor||(e.actor=this.dispatcher.getActor()),e.request=e.fetchHeader(void 0,((t,n,o,r)=>{if(delete e.request,e.aborted)return e.state="unloaded",i(null);if(t){if(20===t.code)return;return e.state="errored",i(t)}this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:r}),e.state="empty",i(null)}))}unloadTile(e,i){const n=e.texture;n&&n instanceof t.T?(e.destroy(!0),this.map.painter.saveTileTexture(n)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(e,i,n){e._isHeaderLoaded&&("empty"!==e.state&&(e.state="reloading"),e.fetchBand(i,n,((i,n)=>{if(i)return e.state="errored",this.fire(new t.y(i)),void this.triggerRepaint(e);n&&(e.setTexture(n,this.map.painter),e.state="loaded",this.triggerRepaint(e))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const e=this.rasterLayers.find((e=>{let{id:i}=e;return i===t})),i=e&&e.fields,n=i&&i.bands&&i.bands;return n?n[0]:0}getTextureDescriptor(e,i,n){if(!e)return;const o=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!o)return;let r=null;i instanceof t.aH?r=i.paint.get("raster-array-band"):i instanceof t.aI&&(r=i.paint.get("raster-particle-array-band"));const s=r||this.getInitialBand(o);if(null!=s)if(e.textureDescriptor){if(!e.updateNeeded(o,s)||n)return Object.assign({},e.textureDescriptor,{texture:e.texture})}else this.prepareTile(e,o,s)}}const oe={vector:ee,raster:ie,"raster-dem":class extends ie{constructor(e,i,n,o){super(e,i,n,o),this.type="raster-dem",this.maxzoom=22,this._options=t.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function o(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.o(this.map._requestManager.transformRequest(n,t.R.Tile),function(n,r,s,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const i=ImageBitmap&&r instanceof ImageBitmap&&t.t(),n=1-(r.width-t.aF(r.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?r:t.q.getImageData(r,n),u={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",u,o.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,n=Math.pow(2,i.z),o=(i.x-1+n)%n,r=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+n)%n,a=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.aG(e.overscaledZ,r,i.z,o,i.y).key]={backfilled:!1},l[new t.aG(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.aG(e.overscaledZ,r,i.z,o,i.y-1).key]={backfilled:!1},l[new t.aG(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.aG(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.aG(e.overscaledZ,r,i.z,o,i.y+1).key]={backfilled:!1},l[new t.aG(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.aG(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}},"raster-array":ne,geojson:class extends t.E{constructor(e,i,n,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(o),this._data=i.data,this._options=t.l({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const r=t.ag/this.tileSize;this.workerOptions=t.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*r,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*r,extent:t.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.ag,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*r,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(e){if(!this._options.dynamic)return this.fire(new t.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof e&&("Feature"===e.type&&(e={type:"FeatureCollection",features:[e]}),"FeatureCollection"!==e.type))return this.fire(new t.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof e&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const t=new Map;for(const e of this._data.features)t.set(e.id,e);for(const i of e.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=e;return this._updateWorkerData(!0),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},n),this}_updateWorkerData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=t.l({append:e},this.workerOptions);i.scope=this.scope;const n=this._data;"string"==typeof n?(i.request=this.map._requestManager.transformRequest(t.q.resolveURL(n),t.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((i,n)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new t.y(i));else{const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(i.resourceTiming=n.resourceTiming[this.id]),e&&(this._partialReload=!0),this.fire(new t.z("data",i)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(e),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const e=t.aC(this.id,this.scope);this.map.style.clearSource(e),this._updateWorkerData()}loadTile(e,i){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const o=this.map.style?this.map.style.getLut(this.scope):null,r=o?{image:o.image.clone()}:null,s=this._partialReload,a={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:r,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:s};e.request=this.actor.send(n,a,((t,o)=>s&&!o?(e.state="loaded",i(null)):(delete e.request,e.destroy(),e.aborted?i(null):t?i(t):(e.loadVectorData(o,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t,e){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(t){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.aJ{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.R.Source).url);t.aK(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.y(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.y(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.aJ,model:class extends t.E{constructor(t,e,i,n){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const e=[];for(const i in this._options.models){const n=this._options.models[i],o=t.aM(this.map._requestManager.transformRequest(n.uri,t.R.Model).url).then((e=>{if(!e)return;const o=t.aN(e),r=new t.aO(i,n.position,n.orientation,o);r.computeBoundsAndApplyParent(),this.models.push(r)})).catch((e=>{this.fire(new t.y(new Error(`Could not load model ${i} from ${n.uri}: ${e.message}`)))}));e.push(o)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new t.y(new Error(`Could not load models: ${e.message}`)))}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(t,e,i,n){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.aC(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(e){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Qt(this._options,this.map._requestManager,i,n,((o,r)=>{this._tileJSONRequest=null,this._loaded=!0,o?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.y(o))):r&&(t.l(this,r),r.bounds&&(this.tileBounds=new te(r.bounds,this.minzoom,this.maxzoom)),k(r.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),e&&e(o)}))}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(n,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=i;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",o,r.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",o,r.bind(this),void 0,!0);function r(t,n){return e.aborted?i(null):t&&404!==t.status?i(t):(this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadModelData(n,this.map.painter),e.state="loaded",void i(null))}}serialize(){return t.l({},this._options)}},canvas:class extends t.aJ{constructor(e,i,n,o){super(e,i,n,o),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.y(new t.V(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.y(new t.V(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.y(new t.V(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.y(new t.V(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.y(new t.V(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(t){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof t.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.E{constructor(e,i,n,o){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(o),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new te(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.l(this,t.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this.map=e,this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:n}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:n,z:o}=t.tileID.canonical,r=new AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:n,z:o},{signal:r.signal})).then(function(i){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===i?(t.state="errored",e(null)):null===i?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement}(i)?(this.loadTileData(t,i),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(t.state="errored",e(i))})),t.request.cancel=()=>r.abort()}loadTileData(t,e){t.setTexture(e,this.map.painter)}unloadTile(e,i){if(e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}i&&i()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e&&e()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){const e=t.aC(this.id,this.scope);this.map.style.clearSource(e)}_update(){this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}}},re=function(e,i,n,o){const r=new oe[i.type](e,i,n,o);if(r.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${r.id}`);return t.aP(["load","abort","unload","serialize","prepare"],r),r};function se(t,e){return`${arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}:${e.id||""}:${e.layer.id}:${function(t){if("layerId"in t)return`layer:${t.layerId}`;{const{featuresetId:e,importId:i}=t;return`featureset:${e}${i?`:import:${i}`:""}`}}(t.target)}`}function ae(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(t.uniqueFeatureID){const o=se(t,e,n);if(i.has(o))return!0;i.add(o)}return!1}function le(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=e.sourceCache.transform,s=e.sourceCache.tilesIn(t,e.has3DLayers,o);s.sort(he);const a=[];for(const l of s){const t=l.tile.queryRenderedFeatures(e,l,i,n,r,o);Object.keys(t).length&&a.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:t})}return 0===a.length?{}:function(t){const e={},i={};for(const n of t){const t=n.queryResults,o=n.wrappedTileID,r=i[o]=i[o]||{};for(const i in t){const n=t[i],o=r[i]=r[i]||{},s=e[i]=e[i]||[];for(const t of n)o[t.featureIndex]||(o[t.featureIndex]=!0,s.push(t))}}return e}(a)}function ue(t,e,i,n,o){const r={},s=n.queryRenderedSymbols(t),a=[];for(const l of Object.keys(s).map(Number))a.push(o[l]);a.sort(he);for(const l of a){const t=l.featureIndex.lookupSymbolFeatures(s[l.bucketInstanceId],l.bucketIndex,l.sourceLayerIndex,e,i);for(const e in t){const i=r[e]=r[e]||[],n=t[e];n.sort(((t,e)=>{const i=l.featureSortOrder;if(i){const n=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex}));for(const t of n)i.push(t)}}return r}function ce(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],o={};for(let r=0;r<i.length;r++){const t=i[r],s=t.tileID.canonical.key;o[s]||(o[s]=!0,t.querySourceFeatures(n,e))}return n}function he(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function de(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.fqid]=n}}return i}const fe=32,pe=33,me=new Uint16Array(8184);for(let _l=0;_l<2046;_l++){let t=_l+2,e=0,i=0,n=0,o=0,r=0,s=0;for(1&t?n=o=r=fe:e=i=s=fe;(t>>=1)>1;){const a=e+n>>1,l=i+o>>1;1&t?(n=e,o=i,e=r,i=s):(e=n,i=o,n=r,o=s),r=a,s=l}const a=4*_l;me[a+0]=e,me[a+1]=i,me[a+2]=n,me[a+3]=o}const ge=new Uint16Array(2178),ye=new Uint8Array(1089),_e=new Uint16Array(1089);function ve(t){return 0===t?-.03125:32===t?.03125:0}const xe={type:2,extent:t.ag,loadGeometry:()=>[[new t.P(0,0),new t.P(t.ag+1,0),new t.P(t.ag+1,t.ag+1),new t.P(0,t.ag+1),new t.P(0,0)]]};class be{constructor(e,i,n,o,r){this.tileID=e,this.uid=t.aV(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,o&&o.style&&(this._lastUpdatedBrightness=o.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",o&&o.transform&&(this.projection=o.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<t.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=t.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=de(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aX){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aX&&i.hasRTLText){this.hasRTLText=!0,t.aY();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t],n=i.style.getOwnLayer(t);if(!n)continue;const o=n.queryRadius(e);this.queryPadding=Math.max(this.queryPadding,o)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new t.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,e,i){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,de(t.buckets,e.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const i=e.gl,n=this.imageAtlas;if(n&&!n.uploaded){const o=!!Object.keys(n.patternPositions).length;this.imageAtlasTexture=new t.T(e,n.image,i.RGBA8,{useMipmap:o}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,e,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=e.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this.updateBuckets(e,this._lastUpdatedBrightness!==n),this._lastUpdatedBrightness=n))}queryRenderedFeatures(e,i,n,o,r,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const a=function(e,i){const n=t.ab.mat4.fromScaling([],[.5*e.width,.5*-e.height,1]);return t.ab.mat4.translate(n,n,[1,-1,0]),t.ab.mat4.multiply(n,n,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}(r,this.tileID);return this.latestFeatureIndex.query(e,{tilespaceGeometry:i,pixelPosMatrix:a,transform:o,availableImages:n,tileTransform:this.tileTransform})}querySourceFeatures(e,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const o=n.loadVTLayers(),r=i?i.sourceLayer:"",s=o._geojsonTileLayer||o[r];if(!s)return;const a=t.aZ(i&&i.filter),{z:l,x:u,y:c}=this.tileID.canonical,h={z:l,x:u,y:c};for(let d=0;d<s.length;d++){const i=s.feature(d);if(a.needGeometry){const e=t.a_(i,!0);if(!a.filter(new t.a8(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.a8(this.tileID.overscaledZ),i))continue;const o=n.getId(i,r),f=new t.a$(i,l,u,c,o);f.tile=h,e.push(f)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.b0(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const n=this.expirationTime-i;n?this.expirationTime=t+Math.max(n,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;if(!e.style)return;const n=this.latestFeatureIndex.loadVTLayers(),o=e.style.listImages(),r=e.style.getBrightness();for(const s in this.buckets){if(!e.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0],u=l.sourceLayer||"_geojsonTileLayer",c=n[u],h=e.style.getLayerSourceCache(l);let d={};h&&(d=h._state.getState(u,void 0));const f=this.imageAtlas&&this.imageAtlas.patternPositions||{},p=Object.keys(d).length>0&&!i;p&&!a.stateDependentLayers.length&&!i||a.update(d,c,o,f,p?a.stateDependentLayers:a.layers,i,r),(a instanceof t.b1||a instanceof t.b2)&&e._terrain&&e._terrain.enabled&&h&&a.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(h.id,this.tileID);const m=e&&e.style&&e.style.getOwnLayer(s);m&&(this.queryPadding=Math.max(this.queryPadding,m.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.q.now()+e}setTexture(e,i){const n=i.context,o=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e):(this.texture=new t.T(n,e,o.RGBA8,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const n of e)i[n]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const n=t.b3(xe,this.tileID.canonical,this.tileTransform)[0],o=new t.b4,r=new t.b5;for(let t=0;t<n.length;t++){const{x:e,y:i}=n[t];o.emplaceBack(e,i),r.emplaceBack(t)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(o,t.b6.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,o.length,r.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const n=t.b3(xe,this.tileID.canonical,this.tileTransform)[0];let o,r;if(this.isRaster){const e=function(e,i){const n=t.aQ(e,i),o=Math.pow(2,e.z);for(let c=0;c<pe;c++)for(let r=0;r<pe;r++){const s=t.aR((e.x+(r+ve(r))/fe)/o),a=t.aS((e.y+(c+ve(c))/fe)/o),l=i.project(s,a),u=c*pe+r;ge[2*u+0]=Math.round((l.x*n.scale-n.x)*t.ag),ge[2*u+1]=Math.round((l.y*n.scale-n.y)*t.ag)}ye.fill(0),_e.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=me[e+0],n=me[e+1],o=me[e+2],r=me[e+3],s=i+o>>1,a=n+r>>1,l=s+a-n,u=a+i-s,c=n*pe+i,h=r*pe+o,d=a*pe+s,f=Math.hypot((ge[2*c+0]+ge[2*h+0])/2-ge[2*d+0],(ge[2*c+1]+ge[2*h+1])/2-ge[2*d+1])>=16;ye[d]=ye[d]||(f?1:0),t<1022&&(ye[d]=ye[d]||ye[(n+u>>1)*pe+(i+l>>1)]||ye[(r+u>>1)*pe+(o+l>>1)])}const r=new t.aT,s=new t.aU;let a=0;function l(e,i){const n=i*pe+e;return 0===_e[n]&&(r.emplaceBack(ge[2*n+0],ge[2*n+1],e*t.ag/fe,i*t.ag/fe),_e[n]=++a),_e[n]-1}function u(t,e,i,n,o,r){const a=t+i>>1,c=e+n>>1;if(Math.abs(t-o)+Math.abs(e-r)>1&&ye[c*pe+a])u(o,r,t,e,a,c),u(i,n,o,r,a,c);else{const a=l(t,e),u=l(i,n),c=l(o,r);s.emplaceBack(a,u,c)}}return u(0,0,fe,fe,fe,0),u(fe,fe,0,0,0,fe),{vertices:r,indices:s}}(this.tileID.canonical,i);o=e.vertices,r=e.indices}else{o=new t.aT,r=new t.aU;for(const{x:t,y:i}of n)o.emplaceBack(t,i,0,0);const e=t.b8(o.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(o,t.b9.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=t.b7.simpleSegment(0,0,o.length,r.length)}_makeGlobeTileDebugBuffers(e,i){const n=i.projection;if(!n||"globe"!==n.name||i.freezeTileCoverage)return;const o=this.tileID.canonical,r=t.ba(o,i),s=t.bb(r),a=t.ae(i.zoom);let l;a>0&&(l=t.ab.mat4.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,o,i,s,l,a),this._makeGlobeTileDebugTextBuffer(e,o,i,s,l,a)}_globePoint(e,i,n,o,r,s,a){let l=t.bc(e,i,n);if(s){const r=1<<n.z,u=t.at(o.center.lng),c=t.aA(o.center.lat),h=(n.x+.5)/r-u;let d=0;h>.5?d=-1:h<-.5&&(d=1);let f=(e/t.ag+n.x)/r+d,p=(i/t.ag+n.y)/r;f=(f-u)*o._pixelsPerMercatorPixel+u,p=(p-c)*o._pixelsPerMercatorPixel+c;const m=[f*o.worldSize,p*o.worldSize,0];t.ab.vec3.transformMat4(m,m,s),l=t.bd(l,m,a)}return t.ab.vec3.transformMat4(l,l,r)}_makeGlobeTileDebugBorderBuffer(e,i,n,o,r,s){const a=new t.b4,l=new t.b5,u=new t.be,c=(t,e,c,h,d)=>{const f=(c-t)/(d-1),p=(h-e)/(d-1),m=a.length;for(let g=0;g<d;g++){const c=t+g*f,h=e+g*p;a.emplaceBack(c,h);const d=this._globePoint(c,h,i,n,o,r,s);u.emplaceBack(d[0],d[1],d[2]),l.emplaceBack(m+g)}},h=t.ag;c(0,0,h,0,16),c(h,0,h,h,16),c(h,h,0,h,16),c(0,h,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,t.b6.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(u,t.bf.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(e,i,n,o,r,s){const a=t.ag/4,l=new t.b4,u=new t.aU,c=new t.be,h=25;u.reserve(32),l.reserve(h),c.reserve(h);const d=(t,e)=>h*t+e;for(let t=0;t<h;t++){const e=t*a;for(let t=0;t<h;t++){const u=t*a;l.emplaceBack(u,e);const h=this._globePoint(u,e,i,n,o,r,s);c.emplaceBack(h[0],h[1],h[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=d(t,e),n=d(t,e+1),o=d(t+1,e),r=d(t+1,e+1);u.emplaceBack(i,n,o),u.emplaceBack(o,n,r)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(u),this._tileDebugTextBuffer=e.createVertexBuffer(l,t.b6.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,t.bf.members),this._tileDebugTextSegments=t.b7.simpleSegment(0,0,h,32)}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}t.bg.setPbf(t.bh);class Ce extends be{constructor(t,e,i,n,o){super(t,e,i,n,o),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,i){const n=i.context,o=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e,{premultiply:!1}):this.texture=new t.T(n,e,o.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,i=arguments.length>1?arguments[1]:void 0;const n=this._mrt=new t.bg(30),o=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=t.bi(o,((t,o,r,s)=>{if(t)i(t);else try{const t=n.getHeaderLength(o);if(t>e)return void(this.request=this.fetchHeader(t,i));n.parseHeader(o),this._isHeaderLoaded=!0;let a=0;for(const e of Object.values(n.layers))a=Math.max(a,e.dataIndex[e.dataIndex.length-1].last_byte);o.byteLength>=a&&(this.entireBuffer=o),i(null,this.entireBuffer||o,r,s)}catch(t){i(t)}})),this.request}fetchBand(e,i,n){const o=this._mrt;if(!this._isHeaderLoaded||!o)return void n(new Error("Tile header is not ready"));const r=this.actor;if(!r)return void n(new Error("Can't fetch tile band without an actor"));let s;const a=(t,o)=>{s.complete(t,o),t?n(t):(this.updateTextureDescriptor(e,i),n(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(t,e)=>{if(t)return n(t);const i=r.send("decodeRasterArray",{buffer:e,task:s},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),s.cancel()}))},u=o.getLayer(e);if(!u)return void n(new Error(`Unknown sourceLayer "${e}"`));if(u.hasDataForBand(i))return this.updateTextureDescriptor(e,i),void n(null,this.textureDescriptor?this.textureDescriptor.img:null);const c=u.getDataRange([i]);if(s=o.createDecodingTask(c),!s||s.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(c.firstByte,c.lastByte+1));else{const e=Object.assign({},this.requestParams,{headers:{Range:`bytes=${c.firstByte}-${c.lastByte}`}}),i=t.bi(e,l);this._fetchQueue.push((()=>{i.cancel(),s.cancel()}))}else n(null)}updateNeeded(t,e){return(!this.textureDescriptor||this.textureDescriptor.band!==e||this.textureDescriptor.layer!==t)&&"errored"!==this.state}updateTextureDescriptor(e,i){if(!this._mrt)return;const n=this._mrt.getLayer(e);if(!n||!n.hasBand(i)||!n.hasDataForBand(i))return;const{bytes:o,tileSize:r,buffer:s,offset:a,scale:l}=n.getBandView(i),u=r+2*s,c={data:o,width:u,height:u},h=this.texture;h&&h instanceof t.T&&h.update(c,{premultiply:!1}),this.textureDescriptor={layer:e,band:i,img:c,buffer:s,offset:a,tileSize:r,format:n.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class we{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const o={value:e,timeout:void 0};if(void 0!==i&&(o.timeout=setTimeout((()=>{this.remove(t,o)}),i)),this.data[n].push(o),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),o=this.data[i][n];return this.data[i].splice(n,1),o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(o.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const i of e)this.remove(i.value.tileID,i)}}class Se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,n){const o=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},t.l(this.stateChanges[e][o],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==o&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][o]){this.deletedStates[e][o]={};for(const t in this.state[e][o])n[t]||(this.deletedStates[e][o][t]=null)}else for(const t in n)this.deletedStates[e]&&this.deletedStates[e][o]&&null===this.deletedStates[e][o][t]&&delete this.deletedStates[e][o][t]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(e,i){const n=this.state[e]||{},o=this.stateChanges[e]||{},r=this.deletedStates[e];if(null===r)return{};if(void 0!==i){const e=String(i),s=t.l({},n[e],o[e]);if(r){const t=r[i];if(null===t)return{};for(const e in t)delete s[e]}return s}const s=t.l({},n,o);if(r)for(const t in r)delete s[t];return s}initializeTileState(t,e){t.refreshFeatureState(e)}coalesceChanges(e,i){const n={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const e={};for(const i in this.stateChanges[o])this.state[o][i]||(this.state[o][i]={}),t.l(this.state[o][i],this.stateChanges[o][i]),e[i]=this.state[o][i];n[o]=e}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const e={};if(null===this.deletedStates[o])for(const t in this.state[o])e[t]={},this.state[o][t]={};else for(const t in this.deletedStates[o]){if(null===this.deletedStates[o][t])this.state[o][t]={};else if(this.state[o][t])for(const e of Object.keys(this.deletedStates[o][t]))delete this.state[o][t][e];e[t]=this.state[o][t]}n[o]=n[o]||{},t.l(n[o],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const t in e)e[t].refreshFeatureState(i)}}class Te extends t.E{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new we(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Se,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return t.bj(this._tiles).map((t=>t.tileID)).sort(Ae).map((t=>t.key))}getRenderableIds(e,i){const n=[];for(const t in this._tiles)this._isIdRenderable(+t,e,i)&&n.push(this._tiles[t]);return e?n.sort(((e,i)=>{const n=e.tileID,o=i.tileID,r=new t.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new t.P(o.canonical.x,o.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-o.overscaledZ||s.y-r.y||s.x-r.x})).map((t=>t.tileID.key)):n.map((t=>t.tileID)).sort(Ae).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(e,i,n,o){if(o)if(e.state="errored",404!==o.status)this._source.fire(new t.y(o,{tile:e}));else{if(this._source.fire(new t.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:e})),!(e.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=t.q.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.z("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const o=e[n];if(t.neighboringTiles&&t.neighboringTiles[o]){const e=this.getTileByID(o);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,o=Math.pow(2,t.tileID.canonical.z),r=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+o)?i+=o:1===Math.abs(i-o)&&(i-=o)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[r]&&(t.neighboringTiles[r].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const o in this._tiles){let r=this._tiles[o];if(n[o]||!r.hasData()||r.tileID.overscaledZ<=e||r.tileID.overscaledZ>i)continue;let s=r.tileID;for(;r&&r.tileID.overscaledZ>e+1;){const t=r.tileID.scaledTo(r.tileID.overscaledZ-1);r=this._tiles[t.key],r&&r.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,o=Math.floor(i*n*5),r="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,o):o,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,i,n,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const r="batched-model"===this._source.type;let s,a=this._source.maxzoom;const l=this.map&&this.map.painter?this.map.painter._terrain:null;if(l&&l.sourceCache===this&&l.attenuationRange()){const t=l.attenuationRange()[0],e=Math.floor(t)-Math.log2(l.getDemUpscale());a>e&&(a=e)}if(this.used||this.usedForTerrain){if(this._source.tileID)s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.aG(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)));else if(0!==this.tileCoverLift){const o=e.clone();o.tileCoverLift=this.tileCoverLift,s=o.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:a,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:r}),this._source.minzoom<=1&&"globe"===e.projection.name&&(s.push(new t.aG(1,0,1,0,0)),s.push(new t.aG(1,0,1,1,0)),s.push(new t.aG(1,0,1,0,1)),s.push(new t.aG(1,0,1,1,1)))}else if(s=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:a,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:r}),this._source.hasTile){const t=this._source.hasTile.bind(this._source);s=s.filter((e=>t(e)))}}else s=[];if(s.length>0&&this.castsShadows&&o&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Me(this._source.type)){const t=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),a=Math.min(t,this._source.maxzoom);if(r){const t=e.extendTileCover(s,a);for(const e of t)s.push(e)}else{const t=e.extendTileCover(s,a,o);for(const e of t)this._shadowCasterTiles[e.key]=!0,s.push(e)}}const u=this._updateRetainedTiles(s);if(Me(this._source.type)&&0!==s.length){const e={},i={},n=Object.keys(u);for(const r of n){const n=u[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=t.q.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-Te.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),i[r]=n}const o=s[s.length-1].overscaledZ;for(const t in this._tiles){const e=this._tiles[t];if(u[t]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&i[n.key]){u[t]=e.tileID;break}}}for(const t in e)u[t]||(this._coveredTiles[t]=!0,u[t]=e[t])}for(const t in u)this._tiles[t].clearFadeHold();const c=t.bk(this._tiles,u);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},n=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),o=t[0].overscaledZ,r=Math.max(o-Te.maxOverzooming,this._source.minzoom),s=Math.max(o+Te.maxUnderzooming,this._source.minzoom),a={};for(const l of t){const t=this._addTile(l);e[l.key]=l,t.hasData()||n<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,n,s,e);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let o=l.overscaledZ-1;o>=r;--o){const r=l.scaledTo(o);if(i[r.key])break;if(i[r.key]=!0,t=this.getTile(r),!t&&n&&(t=this._addTile(r)),t&&(e[r.key]=r,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const n=Boolean(i);if(!n){const t=this.map?this.map.painter:null,n=this._source.tileSize*e.overscaleFactor();i="raster-array"===this._source.type?new Ce(e,n,this.transform.tileZoom,t,this._isRaster):new be(e,n,this.transform.tileZoom,t,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new t.z("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state||"empty"===e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,n){const o=[],r=this.transform;if(!r)return o;const s="globe"===r.projection.name,a=t.at(r.center.lng);for(const l in this._tiles){const u=this._tiles[l];if(n&&u.clearQueryDebugViz(),u.holdingForFade())continue;let c;if(s){const e=u.tileID.canonical;if(0===e.z){const i=[Math.abs(t.aw(a,...Ie(e,-1))-a),Math.abs(t.aw(a,...Ie(e,1))-a)];c=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(t.aw(a,...Ie(e,-1))-a),Math.abs(t.aw(a,...Ie(e,0))-a),Math.abs(t.aw(a,...Ie(e,1))-a)];c=[i.indexOf(Math.min(...i))-1]}}else c=[0];for(const t of c){const n=e.containsTile(u,r,i,t);n&&o.push(n)}}return o}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const i=this.getRenderableIds(t,e).map((t=>this._tiles[t].tileID)),n="globe"===this.transform.projection.name;for(const o of i)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped()),o.expandedProjMatrix=n?this.transform.calculateProjMatrix(o.toUnwrapped(),!1,!0):o.projMatrix;return i}sortCoordinatesByDistance(t){const e=t.slice(),i=this.transform._camera.position,n=this.transform._camera.forward(),o={};for(const r of e){const t=1/(1<<r.canonical.z);o[r.key]=((r.canonical.x+.5)*t+r.wrap-i[0])*n[0]+((r.canonical.y+.5)*t-i[1])*n[1]-i[2]*n[2]}return e.sort(((t,e)=>o[t.key]-o[e.key])),e}hasTransition(){if(this._source.hasTransition())return!0;if(Me(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.q.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(e,i){if(!this._sourceLoaded){const t=()=>{this._sourceLoaded&&(this._source.off("data",t),this._preloadTiles(e,i))};return void this._source.on("data",t)}const n=new Map,o=Array.isArray(e)?e:[e],r=this.map.painter.terrain,s=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const t of o){const e=t.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)n.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}const a=Array.from(n.values());t.bl(a,((t,e)=>{const i=new be(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),i)}}function Ae(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Me(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Ie(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Te.maxOverzooming=10,Te.maxUnderzooming=3;class Ee{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,e=!1;for(const i in this.style._mergedLayers){const n=this.style._mergedLayers[i];if("fill-extrusion"===n.type)this.layers.push({layer:n,visible:t,visibilityChanged:e});else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push({layer:n,visible:t,visibilityChanged:e})}}}onNewFrame(t){this.layersGotHidden=!1;for(const e of this.layers){const i=e.layer;let n=!1;"fill-extrusion"===i.type?n=!i.isHidden(t)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(n=!i.isHidden(t)&&i.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!n&&e.visible,e.visible=n}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(const n of this.layers){const t=n.layer,i=this.style.getLayerSourceCache(t);let o=1;"fill-extrusion"===t.type&&(o=n.visible?t.paint.get("fill-extrusion-vertical-scale"):0);let r=i?i.getTile(e):null;if(!r&&i&&e.canonical.z>i.getSource().minzoom){let t=e.scaledTo(Math.min(i.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=i.getSource().minzoom&&(r=i.getTile(t),!r&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:r?r.getBucket(t):null,tileID:r?r.tileID:e,verticalScale:o})}t.hasAnyZOffset=!1;let i=!1;for(let n=0;n<t.symbolInstances.length;n++){const o=t.symbolInstances.get(n),r=o.zOffset,s=this._getHeightAtTileOffset(e,o.tileAnchorX,o.tileAnchorY);o.zOffset=s!==Number.NEGATIVE_INFINITY?s:r,i||r===o.zOffset||(i=!0),t.hasAnyZOffset||0===o.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,n,o){let r=i,s=n;if(e.canonical.z!==o.canonical.z){const a=o.canonical,l=1/(1<<e.canonical.z-a.z);r=(i+e.canonical.x*t.ag)*l-a.x*t.ag|0,s=(n+e.canonical.y*t.ag)*l-a.y*t.ag|0}return{tileX:r,tileY:s}}_getHeightAtTileOffset(t,e,i){let n,o;for(let r=0;r<this.layers.length;++r){if("fill-extrusion"!==this.layers[r].layer.type)continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[r];if(!s)continue;const{tileX:u,tileY:c}=this._mapCoordToOverlappingTile(t,e,i,a),h=s.getHeightAtTileCoord(u,c);h&&void 0!==h.height&&(h.hidden?n=h.height:o=Math.max(h.height*l,o||0))}if(void 0!==o)return o;for(let r=0;r<this.layers.length;++r){const o=this.layers[r];if("model"!==o.layer.type||!o.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[r];if(!s)continue;const{tileX:l,tileY:u}=this._mapCoordToOverlappingTile(t,e,i,a),c=s.getHeightAtTileCoord(l,u);if(c&&!c.hidden)return void 0===c.height&&void 0!==n?Math.min(c.maxHeight,n)*c.verticalScale:c.height?c.height*c.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Pe(e,i){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.bm.forEach((t=>{t in i&&(n[t]=i[t])})),n}function ke(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Pe(t[i],e[t[i].ref]));return t}const Be={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function De(t,e,i){i.push({command:Be.addSource,args:[t,e[t]]})}function Re(t,e,i){e.push({command:Be.removeSource,args:[t]}),i[t]=!0}function Le(t,e,i,n){Re(t,i,n),De(t,e,i)}function ze(e,i,n){let o;for(o in e[n])if(e[n].hasOwnProperty(o)&&"data"!==o&&!t.bn(e[n][o],i[n][o]))return!1;for(o in i[n])if(i[n].hasOwnProperty(o)&&"data"!==o&&!t.bn(e[n][o],i[n][o]))return!1;return!0}function Oe(e,i,n,o,r,s){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t.bn(e[a],i[a])||n.push({command:s,args:[o,a,i[a],r]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t.bn(e[a],i[a])||n.push({command:s,args:[o,a,i[a],r]}))}function Ue(t){return t.id}function Fe(t,e){return t[e.id]=e,t}class Ne{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.aw(e,0,1);let i=1,n=this._distances[i];const o=e*this.paddedLength+this.padding;for(;n<o&&i<this._distances.length;)n=this._distances[++i];const r=i-1,s=this._distances[r],a=n-s,l=a>0?(o-s)/a:0;return this.points[r].mult(1-l).add(this.points[i].mult(l))}}class Ve{constructor(t,e,i){const n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let r=0;r<this.xCellCount*this.yCellCount;r++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,o){this._forEachCell(e,i,n,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(o)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,o,r){this.boxCells[o].push(r)}_insertCircleCell(t,e,i,n,o,r){this.circleCells[o].push(r)}_query(t,e,i,n,o,r){if(i<0||t>this.width||n<0||e>this.height)return!o&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(o)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return r?s.filter(r):s}return this._forEachCell(t,e,i,n,this._queryCell,s,{hitTest:o,seenUids:{box:{},circle:{}}},r),o?s.length>0:s}_queryCircle(t,e,i,n,o){const r=t-i,s=t+i,a=e-i,l=e+i;if(s<0||r>this.width||l<0||a>this.height)return!n&&[];const u=[];return this._forEachCell(r,a,s,l,this._queryCellCircle,u,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},o),n?u.length>0:u}query(t,e,i,n,o){return this._query(t,e,i,n,!1,o)}hitTest(t,e,i,n,o){return this._query(t,e,i,n,!0,o)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,o,r,s,a){const l=s.seenUids,u=this.boxCells[o];if(null!==u){const o=this.bboxes;for(const c of u)if(!l.box[c]){l.box[c]=!0;const u=4*c;if(t<=o[u+2]&&e<=o[u+3]&&i>=o[u+0]&&n>=o[u+1]&&(!a||a(this.boxKeys[c]))){if(s.hitTest)return r.push(!0),!0;r.push({key:this.boxKeys[c],x1:o[u],y1:o[u+1],x2:o[u+2],y2:o[u+3]})}}}const c=this.circleCells[o];if(null!==c){const o=this.circles;for(const u of c)if(!l.circle[u]){l.circle[u]=!0;const c=3*u;if(this._circleAndRectCollide(o[c],o[c+1],o[c+2],t,e,i,n)&&(!a||a(this.circleKeys[u]))){if(s.hitTest)return r.push(!0),!0;{const t=o[c],e=o[c+1],i=o[c+2];r.push({key:this.circleKeys[u],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,o,r,s,a){const l=s.circle,u=s.seenUids,c=this.boxCells[o];if(null!==c){const t=this.bboxes;for(const e of c)if(!u.box[e]){u.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return r.push(!0),!0}}const h=this.circleCells[o];if(null!==h){const t=this.circles;for(const e of h)if(!u.circle[e]){u.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return r.push(!0),!0}}}_forEachCell(t,e,i,n,o,r,s,a){const l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=c;d++)for(let l=u;l<=h;l++)if(o.call(this,t,e,i,n,this.xCellCount*l+d,r,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,o,r){const s=n-t,a=o-e,l=i+r;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,n,o,r,s){const a=(r-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const u=(s-o)/2,c=Math.abs(e-(o+u));if(c>u+i)return!1;if(l<=a||c<=u)return!0;const h=l-a,d=c-u;return h*h+d*d<=i*i}}const He={unknown:0,flipRequired:1,flipNotRequired:2},je=Math.tan(85*Math.PI/180);function Ge(e,i,n,o,r,s,a){const l=t.ab.mat4.create();if(n)if("globe"===s.name){const e=t.bo(r,i);t.ab.mat4.multiply(l,l,e)}else{const e=t.ab.mat2.invert([],a);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],o||t.ab.mat4.rotateZ(l,l,r.angle)}else t.ab.mat4.multiply(l,r.labelPlaneMatrix,e);return l}function We(t,e,i,n,o,r,s){const a=Ge(t,e,i,n,o,r,s);return"globe"===r.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function qe(e,i,n,o,r,s,a){if(n){if("globe"===s.name){const l=Ge(e,i,n,o,r,s,a);return t.ab.mat4.invert(l,l),t.ab.mat4.multiply(l,e,l),l}{const i=t.ab.mat4.clone(e),n=t.ab.mat4.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],t.ab.mat4.multiply(i,i,n),o||t.ab.mat4.rotateZ(i,i,-r.angle),i}}return r.glCoordMatrix}function Ze(e,i,n,o){const r=[e,i,n,1];n?t.ab.vec4.transformMat4(r,r,o):oi(r,r,o);const s=r[3];return r[0]/=s,r[1]/=s,r[2]/=s,r}function $e(t,e){return Math.min(.5+t/e*.5,1.5)}function Ke(t,e){const i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function Ye(e,i,n,o,r,s,a,l,u,c){const h=n.transform,d=o?e.textSizeData:e.iconSizeData,f=t.bp(d,n.transform.zoom),p="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=o?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;g.clear();let y=null;p&&(y=o?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const _=e.lineVertexArray,v=o?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b,C=!1;for(let w=0;w<v.length;w++){const o=v.get(w),{numGlyphs:p,writingMode:S}=o;if(S!==t.bq.vertical||C||b===t.bq.horizontal||(C=!0),b=S,(o.hidden||S===t.bq.vertical)&&!C){ni(p,g);continue}C=!1;const T=new t.P(o.tileAnchorX,o.tileAnchorY);let{x:A,y:M,z:I}=h.projection.projectTilePoint(T.x,T.y,c.canonical);if(u){const[t,e,i]=u(T);A+=t,M+=e,I+=i}const E=[A,M,I,1];if(t.ab.vec4.transformMat4(E,E,i),!Ke(E,m)){ni(p,g);continue}const P=E[3],k=$e(n.transform.getCameraToCenterDistance(h.projection),P),B=t.br(d,f,o),D=a?B/k:B*k,R=Ze(A,M,I,r);if(R[3]<=0){ni(p,g);continue}let L={};const z=a?null:u,O=Qe(o,D,!1,l,i,r,s,e.glyphOffsetArray,_,g,y,R,T,L,x,z,h.projection,c,a);C=O.useVertical,z&&O.needsFlipping&&(L={}),(O.notEnoughRoom||C||O.needsFlipping&&Qe(o,D,!0,l,i,r,s,e.glyphOffsetArray,_,g,y,R,T,L,x,z,h.projection,c,a).notEnoughRoom)&&ni(p,g)}o?(e.text.dynamicLayoutVertexBuffer.updateData(g),y&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(y)):(e.icon.dynamicLayoutVertexBuffer.updateData(g),y&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(y))}function Je(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m){const{lineStartIndex:g,glyphStartIndex:y,segment:_}=a,v=y+a.numGlyphs,x=g+a.lineLength,b=e.getoffsetX(y),C=e.getoffsetX(v-1),w=ii(t*b,i,n,o,r,s,_,g,x,l,u,c,h,d,!0,f,p,m);if(!w)return null;const S=ii(t*C,i,n,o,r,s,_,g,x,l,u,c,h,d,!0,f,p,m);return S?{first:w,last:S}:null}function Xe(e,i,n,o){return e===t.bq.horizontal&&Math.abs(o)>Math.abs(n)?{useVertical:!0}:e===t.bq.vertical?o>0?{needsFlipping:!0}:null:i!==He.unknown&&function(t,e){return 0===t||Math.abs(e/t)>je}(n,o)?i===He.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function Qe(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v){const x=i/24,b=e.lineOffsetX*x,C=e.lineOffsetY*x,{lineStartIndex:w,glyphStartIndex:S,numGlyphs:T,segment:A,writingMode:M,flipState:I}=e,E=w+e.lineLength,P=e=>{if(h){const[i,n,o]=e.up,r=c.length;t.bs(h,r+0,i,n,o),t.bs(h,r+1,i,n,o),t.bs(h,r+2,i,n,o),t.bs(h,r+3,i,n,o)}const[i,n,o]=e.point;t.bt(c,i,n,o,e.angle)};if(T>1){const t=Je(x,l,b,C,n,d,f,e,u,s,p,g,!1,y,_,v);if(!t)return{notEnoughRoom:!0};if(o&&!n){let[i,n,o]=t.first.point,[r,s,l]=t.last.point;[i,n]=Ze(i,n,o,a),[r,s]=Ze(r,s,l,a);const u=Xe(M,I,(r-i)*m,s-n);if(e.flipState=u&&u.needsFlipping?He.flipRequired:He.flipNotRequired,u)return u}P(t.first);for(let e=S+1;e<S+T-1;e++){const t=ii(x*l.getoffsetX(e),b,C,n,d,f,A,w,E,u,s,p,g,!1,!1,y,_,v);if(!t)return c.length-=4*(e-S),{notEnoughRoom:!0};P(t)}P(t.last)}else{if(o&&!n){const i=Ze(f.x,f.y,0,r),n=w+A+1,o=new t.P(u.getx(n),u.gety(n)),s=Ze(o.x,o.y,0,r),a=s[3]>0?s:ei(f,o,i,1,r,void 0,y,_.canonical),l=Xe(M,I,(a[0]-i[0])*m,a[1]-i[1]);if(e.flipState=l&&l.needsFlipping?He.flipRequired:He.flipNotRequired,l)return l}const i=ii(x*l.getoffsetX(S),b,C,n,d,f,A,w,E,u,s,p,g,!1,!1,y,_,v);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function ti(t,e,i,n,o){const{x:r,y:s,z:a}=n.projectTilePoint(t.x,t.y,e);if(!o)return Ze(r,s,a,i);const[l,u,c]=o(t);return Ze(r+l,s+u,a+c,i)}function ei(e,i,n,o,r,s,a,l){const u=ti(e.sub(i)._unit()._add(e),l,r,a,s);return t.ab.vec3.sub(u,n,u),t.ab.vec3.normalize(u,u),t.ab.vec3.scaleAndAdd(u,n,u,o)}function ii(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_){const v=o?e-i:e+i;let x=v>0?1:-1,b=0;o&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let C=l+a+(x>0?0:1)|0,w=r,S=r,T=0,A=0;const M=Math.abs(v),I=[],E=[];let P=s,k=P;const B=()=>ei(k,P,S,M-T+1,h,f,g,y.canonical);for(;T+A<=M;){if(C+=x,C<l||C>=u)return null;if(S=w,k=P,I.push(S),p&&E.push(k),P=new t.P(c.getx(C),c.gety(C)),w=d[C],!w){const t=ti(P,y.canonical,h,g,f);w=t[3]>0?d[C]=t:B()}T+=A,A=t.ab.vec3.distance(S,w)}m&&f&&(d[C]&&(w=B(),A=t.ab.vec3.distance(S,w)),d[C]=w);const D=(M-T)/A,R=P.sub(k)._mult(D)._add(k),L=t.ab.vec3.sub([],w,S),z=t.ab.vec3.scaleAndAdd([],S,L,D);let O=[0,0,1],U=L[0],F=L[1];if(_&&(O=g.upVector(y.canonical,R.x,R.y),0!==O[0]||0!==O[1]||1!==O[2])){const e=[O[2],0,-O[0]],i=t.ab.vec3.cross([],O,e);t.ab.vec3.normalize(e,e),t.ab.vec3.normalize(i,i),U=t.ab.vec3.dot(L,e),F=t.ab.vec3.dot(L,i)}if(n){const e=t.ab.vec3.cross([],O,L);t.ab.vec3.normalize(e,e),t.ab.vec3.scaleAndAdd(z,z,e,n*x)}const N=b+Math.atan2(F,U);return I.push(z),p&&E.push(R),{point:z,angle:N,path:I,tilePath:E,up:O}}function ni(t,e){const i=e.length,n=i+4*t;e.resize(n),e.float32.fill(-1/0,4*i,4*n)}function oi(t,e,i){const n=e[0],o=e[1];return t[0]=i[0]*n+i[4]*o+i[12],t[1]=i[1]*n+i[5]*o+i[13],t[3]=i[3]*n+i[7]*o+i[15],t}const ri=100;class si{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ve(t.width+200,t.height+200,25),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Ve(t.width+200,t.height+200,25);this.transform=t,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ri,this.screenBottomBoundary=t.height+ri,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,n,o,r,s,a){let l=i.projectedAnchorX,u=i.projectedAnchorY,c=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,f=t.getProjection();if(h&&d){const[t,e,n]=f.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),o=f.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*o,u+=e*h*o,c+=n*h*o}const p=this.projectAndGetPerspectiveRatio(s,l,u,c,i.tileID,"globe"===f.name||!!h||this.transform.pitch>0,f),m=r*p.perspectiveRatio,g=(i.x1*e+n.x-i.padding)*m+p.point.x,y=(i.y1*e+n.y-i.padding)*m+p.point.y,_=(i.x2*e+n.x+i.padding)*m+p.point.x,v=(i.y2*e+n.y+i.padding)*m+p.point.y,x=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(g,y,_,v)||!o&&this.grid.hitTest(g,y,_,v,a)||x?{box:[],offscreen:!1,occluded:p.occluded}:{box:[g,y,_,v],offscreen:this.isOffscreen(g,y,_,v),occluded:!1}}placeCollisionCircles(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m){const g=[],y=this.transform.elevation,_=e.getProjection(),v=y?y.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,_):null,x=new t.P(n.tileAnchorX,n.tileAnchorY);let{x:b,y:C,z:w}=_.projectTilePoint(x.x,x.y,m.canonical);if(v){const[t,e,i]=v(x);b+=t,C+=e,w+=i}const S="globe"===_.name,T=this.projectAndGetPerspectiveRatio(a,b,C,w,m,S||!!y||this.transform.pitch>0,_),{perspectiveRatio:A}=T,M=(h?s/A:s*A)/t.bw,I=Ze(b,C,w,l),E=T.signedDistanceFromCamera>0?Je(M,r,n.lineOffsetX*M,n.lineOffsetY*M,!1,I,x,n,o,l,{},y&&!h?v:null,h&&!!y,_,m,h):null;let P=!1,k=!1,B=!0;if(E&&!T.occluded){const e=.5*f*A+p,n=new t.P(-100,-100),o=new t.P(this.screenRightBoundary,this.screenBottomBoundary),r=new Ne,{first:s,last:a}=E,l=s.path.length;let h=[];for(let t=l-1;t>=1;t--)h.push(s.path[t]);for(let t=1;t<a.path.length;t++)h.push(a.path[t]);const m=2.5*e;u&&(h=h.map(((t,e)=>{let[i,n,o]=t;return v&&!S&&(o=v(e<l-1?s.tilePath[l-1-e]:a.tilePath[e-l+2])[2]),Ze(i,n,o,u)})),h.some((t=>t[3]<=0))&&(h=[]));let y=[];if(h.length>0){let e=1/0,i=-1/0,r=1/0,s=-1/0;for(const t of h)e=Math.min(e,t[0]),r=Math.min(r,t[1]),i=Math.max(i,t[0]),s=Math.max(s,t[1]);i>=n.x&&e<=o.x&&s>=n.y&&r<=o.y&&(y=[h.map((e=>new t.P(e[0],e[1])))],(e<n.x||i>o.x||r<n.y||s>o.y)&&(y=t.bu(y,n.x,n.y,o.x,o.y)))}for(const t of y){r.reset(t,.25*e);let n=0;n=r.length<=.5*e?1:Math.ceil(r.paddedLength/m)+1;for(let t=0;t<n;t++){const o=t/Math.max(n-1,1),s=r.lerp(o),a=s.x+ri,l=s.y+ri;g.push(a,l,e,0);const u=a-e,h=l-e,f=a+e,p=l+e;if(B=B&&this.isOffscreen(u,h,f,p),k=k||this.isInsideGrid(u,h,f,p),!i&&this.grid.hitTestCircle(a,l,e,d)&&(P=!0,!c))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!c&&P||!k?[]:g,offscreen:B,collisionDetected:P,occluded:T.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,o=1/0,r=-1/0,s=-1/0;for(const c of e){const e=new t.P(c.x+ri,c.y+ri);n=Math.min(n,e.x),o=Math.min(o,e.y),r=Math.max(r,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(n,o,r,s).concat(this.ignoredGrid.query(n,o,r,s)),l={},u={};for(const c of a){const e=c.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const n=[new t.P(c.x1,c.y1),new t.P(c.x2,c.y1),new t.P(c.x2,c.y2),new t.P(c.x1,c.y2)];t.bv(i,n)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===u[e.bucketInstanceId]&&(u[e.bucketInstanceId]=[]),u[e.bucketInstanceId].push(e.featureIndex))}return u}insertCollisionBox(t,e,i,n,o){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,o){const r=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:n,collisionGroupID:o};for(let a=0;a<t.length;a+=4)r.insertCircle(s,t[a],t[a+1],t[a+2])}projectAndGetPerspectiveRatio(e,i,n,o,r,s,a){const l=[i,n,o,1];let u=!1;if(o||this.transform.pitch>0){if(t.ab.vec4.transformMat4(l,l,e),this.fogState&&r&&"globe"!==a.name){const e=function(e,i,n,o,r,s){const a=s.calculateFogTileMatrix(r),l=[i,n,o];return t.ab.vec3.transformMat4(l,l,a),Ot(e,t.ab.vec3.length(l),s.pitch,s._fov)}(this.fogState,i,n,o,r.toUnwrapped(),this.transform);u=e>.9}}else oi(l,l,e);const c=l[3];return{point:new t.P((l[0]/c+1)/2*this.transform.width+ri,(-l[1]/c+1)/2*this.transform.height+ri),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/c*.5,1.5),signedDistanceFromCamera:c,occluded:s&&l[2]>c||u}}isOffscreen(t,e,i,n){return i<ri||t>=this.screenRightBoundary||n<ri||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.ab.mat4.identity([]);return t.ab.mat4.translate(e,e,[-100,-100,0]),e}}function ai(e,i,n){const o=i.createTileMatrix(e,e.worldSize,n.toUnwrapped());return t.ab.mat4.multiply(new Float32Array(16),e.projMatrix,o)}function li(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const n=i.clone();return n.setProjection(e.projection),ai(n,e.getProjection(),t)}function ui(t,e,i){return e.name===i.projection.name?t.projMatrix:ai(i,e,t)}class ci{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class hi{constructor(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new ci(t?t.text:null,e,i,o),this.icon=new ci(t?t.icon:null,e,n,o),this.clipped=r}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class di{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=t,this.icon=e,this.skipFade=i,this.clipped=n}}class fi{constructor(){this.invProjMatrix=t.ab.mat4.create(),this.viewportMatrix=t.ab.mat4.create(),this.circles=[]}}class pi{constructor(t,e,i,n,o){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=o}}class mi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function gi(e,i,n,o,r){const{horizontalAlign:s,verticalAlign:a}=t.bD(e),l=-(s-.5)*i,u=-(a-.5)*n,c=t.bC(e,o);return new t.P(l+c[0]*r,u+c[1]*r)}function yi(e,i,n,o,r){const s=new t.P(e,i);return n&&s._rotate(o?r:-r),s}class _i{constructor(t,e,i,n,o,r){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new si(this.transform,o),this.buildingIndex=r,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new mi(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,n,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=n.getBucket(i),a=n.latestFeatureIndex;if(!s||!a||i.fqid!==s.layerIds[0])return;const l=s.layers[0].layout,u=s.layers[0].paint,c=n.collisionBoxArray,h=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),d=n.tileSize/t.ag,f=n.tileID.toUnwrapped();this.transform.setProjection(s.projection);const p=(m=n.tileID,g=s.getProjection(),y=this.transform,g.name===this.projection?y.calculateProjMatrix(m.toUnwrapped()):ai(y,g,m));var m,g,y;const _="map"===l.get("text-pitch-alignment"),v="map"===l.get("text-rotation-alignment");i.compileFilter(i.options);const x=i.dynamicFilter(),b=i.dynamicFilterNeedsFeature(),C=this.transform.calculatePixelsToTileUnitsMatrix(n),w=We(p,n.tileID.canonical,_,v,this.transform,s.getProjection(),C);let S=null;if(_){const e=qe(p,n.tileID.canonical,_,v,this.transform,s.getProjection(),C);S=t.ab.mat4.multiply([],this.transform.labelPlaneMatrix,e)}let T=null;x&&n.latestFeatureIndex&&(T={unwrappedTileID:f,dynamicFilter:x,dynamicFilterNeedsFeature:b}),this.retainedQueryData[s.bucketInstanceId]=new pi(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,n.tileID);const[A,M]=s.layers[0].layout.get("text-size-scale-range"),I=t.aw(r,A,M),[E,P]=l.get("icon-size-scale-range"),k=t.aw(r,E,P),B={bucket:s,layout:l,paint:u,posMatrix:p,textLabelPlaneMatrix:w,labelToScreenMatrix:S,clippingData:T,scale:h,textPixelRatio:d,holdingForFade:n.holdingForFade(),collisionBoxArray:c,partiallyEvaluatedTextSize:t.bp(s.textSizeData,this.transform.zoom,I),partiallyEvaluatedIconSize:t.bp(s.iconSizeData,this.transform.zoom,k),collisionGroup:this.collisionGroups.get(s.sourceID),latestFeatureIndex:n.latestFeatureIndex};if(o)for(const t of s.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:o}=t;e.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:o,parameters:B})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:B})}attemptAnchorPlacement(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y){const{textOffset0:_,textOffset1:v,crossTileID:x}=h,b=[_,v],C=gi(t,i,n,b,o),w=this.collisionIndex.placeCollisionBox(f,o,e,yi(C.x,C.y,r,s,this.transform.angle),c,a,l,u.predicate);if(m){const t=f.getSymbolInstanceIconSize(y,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(f,t,m,yi(C.x,C.y,r,s,this.transform.angle),c,a,l,u.predicate).box.length)return}if(w.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(e=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:i,height:n,anchor:t,textScale:o,prevAnchor:e},this.markUsedJustification(f,t,h,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,h),this.placedOrientations[x]=p),{shift:C,placedGlyphBoxes:w}}}placeLayerBucketPart(e,i,n,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:s,layout:a,paint:l,posMatrix:u,textLabelPlaneMatrix:c,labelToScreenMatrix:h,clippingData:d,textPixelRatio:f,holdingForFade:p,collisionBoxArray:m,partiallyEvaluatedTextSize:g,partiallyEvaluatedIconSize:y,collisionGroup:_,latestFeatureIndex:v}=e.parameters,x=a.get("text-optional"),b=a.get("icon-optional"),C=a.get("text-allow-overlap"),w=a.get("icon-allow-overlap"),S="map"===a.get("text-rotation-alignment"),T="map"===a.get("text-pitch-alignment"),A=a.get("symbol-z-elevate"),M=l.get("symbol-z-offset"),I="sea"===a.get("symbol-elevation-reference"),[E,P]=a.get("text-size-scale-range"),[k,B]=a.get("icon-size-scale-range"),D=t.aw(r,E,P),R=t.aw(r,k,B);this.transform.setProjection(s.projection);let L=C&&(w||!s.hasIconData()||b),z=w&&(C||!s.hasTextData()||x);const O=!M.isConstant();!s.collisionArrays&&m&&s.deserializeCollisionBoxes(m),n&&o&&s.updateCollisionDebugBuffers(this.transform.zoom,m,D,R);const U=(e,o,l)=>{const{crossTileID:m,numVerticalGlyphVertices:A}=e;let E=null;if(d&&d.dynamicFilterNeedsFeature||O){const t=this.retainedQueryData[s.bucketInstanceId];E=v.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(d&&!(0,d.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},E,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new t.P(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(d.unwrappedTileID)))return this.placements[m]=new di(!1,!1,!1,!0),void i.add(m);const P=M.evaluate(E,{});if(i.has(m))return;if(p)return void(this.placements[m]=new di(!1,!1,!1));let k=!1,B=!1,D=!0,R=!1,U=!1,F=null,N={box:null,offscreen:null,occluded:null},V={box:null,offscreen:null,occluded:null},H=null,j=null,G=null,W=0,q=0,Z=0;l.textFeatureIndex?W=l.textFeatureIndex:e.useRuntimeCollisionCircles&&(W=e.featureIndex),l.verticalTextFeatureIndex&&(q=l.verticalTextFeatureIndex);const $=t=>{t.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const i=this.transform.elevation;t.elevation=I?P:P+(i?i.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0),t.elevation+=e.zOffset},K=l.textBox;if(K){$(K);const i=i=>{let n=t.bq.horizontal;if(s.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[m];t&&(this.placedOrientations[m]=t,n=t,this.markUsedOrientation(s,n,e))}return n},n=(e,i)=>{if(s.allowVerticalPlacement&&A>0&&l.verticalTextBox){for(const n of s.writingModes)if(n===t.bq.vertical?(N=i(),V=N):N=e(),N&&N.box&&N.box.length)break}else N=e()};if(a.get("text-variable-anchor")){let r=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[m]){const t=this.prevPlacement.variableOffsets[m];r.indexOf(t.anchor)>0&&(r=r.filter((e=>e!==t.anchor)),r.unshift(t.anchor))}const c=(t,i,n)=>{const a=s.getSymbolInstanceTextSize(g,e,this.transform.zoom,o),l=(t.x2-t.x1)*a+2*t.padding,c=(t.y2-t.y1)*a+2*t.padding,h=e.hasIconTextFit&&!w?i:null;h&&$(h);let d={box:[],offscreen:!1,occluded:!1};const p=C?2*r.length:r.length;for(let m=0;m<p;++m){const i=this.attemptAnchorPlacement(r[m%r.length],t,l,c,a,S,T,f,u,_,m>=r.length,e,o,s,n,h,g,y);if(i&&(d=i.placedGlyphBoxes,d&&d.box&&d.box.length)){k=!0,F=i.shift;break}}return d};n((()=>c(K,l.iconBox,t.bq.horizontal)),(()=>{const e=l.verticalTextBox;return e&&$(e),s.allowVerticalPlacement&&!(N&&N.box&&N.box.length)&&A>0&&e?c(e,l.verticalIconBox,t.bq.vertical):{box:null,offscreen:null,occluded:null}})),N&&(k=N.box,D=N.offscreen,R=N.occluded);const h=i(!(!N||!N.box));if(!k&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[m];t&&(this.variableOffsets[m]=t,this.markUsedJustification(s,t.anchor,e,h))}}else{const a=(i,n)=>{const a=s.getSymbolInstanceTextSize(g,e,this.transform.zoom,o,r),l=this.collisionIndex.placeCollisionBox(s,a,i,new t.P(0,0),C,f,u,_.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(s,n,e),this.placedOrientations[m]=n),l};n((()=>a(K,t.bq.horizontal)),(()=>{const e=l.verticalTextBox;return s.allowVerticalPlacement&&A>0&&e?($(e),a(e,t.bq.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(N&&N.box&&N.box.length))}}if(H=N,k=H&&H.box&&H.box.length>0,D=H&&H.offscreen,R=H&&H.occluded,e.useRuntimeCollisionCircles){const i=s.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),o=t.br(s.textSizeData,g,i),r=a.get("text-padding");j=this.collisionIndex.placeCollisionCircles(s,C,i,s.lineVertexArray,s.glyphOffsetArray,o,u,c,h,n,T,_.predicate,e.collisionCircleDiameter*o/t.bw,r,this.retainedQueryData[s.bucketInstanceId].tileID),k=C||j.circles.length>0&&!j.collisionDetected,D=D&&j.offscreen,R=j.occluded}if(l.iconFeatureIndex&&(Z=l.iconFeatureIndex),l.iconBox){const i=i=>{$(i);const n=e.hasIconTextFit&&F?yi(F.x,F.y,S,T,this.transform.angle):new t.P(0,0),o=s.getSymbolInstanceIconSize(y,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,o,i,n,w,f,u,_.predicate)};V&&V.box&&V.box.length&&l.verticalIconBox?(G=i(l.verticalIconBox),B=G.box.length>0):(G=i(l.iconBox),B=G.box.length>0),D=D&&G.offscreen,U=G.occluded}const Y=x||0===e.numHorizontalGlyphVertices&&0===A,J=b||0===e.numIconVertices;if(Y||J?J?Y||(B=B&&k):k=B&&k:B=k=B&&k,k&&H&&H.box&&this.collisionIndex.insertCollisionBox(H.box,a.get("text-ignore-placement"),s.bucketInstanceId,V&&V.box&&q?q:W,_.ID),B&&G&&this.collisionIndex.insertCollisionBox(G.box,a.get("icon-ignore-placement"),s.bucketInstanceId,Z,_.ID),j&&(k&&this.collisionIndex.insertCollisionCircles(j.circles,a.get("text-ignore-placement"),s.bucketInstanceId,W,_.ID),n)){const t=s.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new fi);for(let i=0;i<j.circles.length;i+=4)e.circles.push(j.circles[i+0]),e.circles.push(j.circles[i+1]),e.circles.push(j.circles[i+2]),e.circles.push(j.collisionDetected?1:0)}const X="globe"!==s.projection.name;L=L&&(X||!R),z=z&&(X||!U),this.placements[m]=new di(k||L,B||z,D||s.justReloaded),i.add(m)};if(A&&this.buildingIndex&&(this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),s.updateZOffset()),s.sortFeaturesByY){const e=s.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];U(s.symbolInstances.get(i),i,s.collisionArrays[i])}s.hasAnyZOffset&&t.w(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const t=s.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const i=t[e];U(s.symbolInstances.get(i),i,s.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)U(s.symbolInstances.get(t),t,s.collisionArrays[t]);if(n&&s.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[s.bucketInstanceId];t.ab.mat4.invert(e.invProjMatrix,u),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(e,i,n,o){const{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:u}=n,c=t.bB(i),h=o===t.bq.vertical?l:"left"===c?r:"center"===c?s:"right"===c?a:-1;r>=0&&(e.text.placedSymbolArray.get(r).crossTileID=h>=0&&r!==h?0:u),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:u),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:u),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:u)}markUsedOrientation(e,i,n){const o=i===t.bq.horizontal||i===t.bq.horizontalOnly?i:0,r=i===t.bq.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:u}=n,c=e.text.placedSymbolArray;s>=0&&(c.get(s).placedOrientation=o),a>=0&&(c.get(a).placedOrientation=o),l>=0&&(c.get(l).placedOrientation=o),u>=0&&(c.get(u).placedOrientation=r)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,o=e?e.opacities:{},r=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=o[a];e?(this.opacities[a]=new hi(e,n,t.text,t.icon,null,t.clipped),i=i||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new hi(null,n,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const a in o){const t=o[a];if(!this.opacities[a]){const e=new hi(t,n,!1,!1);e.isHidden()||(this.opacities[a]=e,i=i||t.text.placed||t.icon.placed)}}for(const a in r)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=r[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e,i,n){const o=new Set;for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,o,r,r.collisionBoxArray,i,n,r.tileID,t.scope),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,r.tileID),e.updateZOffset()))}}updateBucketOpacities(e,i,n,o,r,s,a,l){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const u=e.layers[0].layout,c=e.layers[0].paint,h=!!e.layers[0].dynamicFilter(),d=new hi(null,0,!1,!1,!0),f=u.get("text-allow-overlap"),p=u.get("icon-allow-overlap"),m=u.get("text-variable-anchor"),g="map"===u.get("text-rotation-alignment"),y="map"===u.get("text-pitch-alignment"),_=c.get("symbol-z-offset"),v="sea"===u.get("symbol-elevation-reference"),x=!_.isConstant(),b=new hi(null,0,f&&(p||!e.hasIconData()||u.get("icon-optional")),p&&(f||!e.hasTextData()||u.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const C=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)};let w=0;s&&e.updateReplacement(a,s);for(let S=0;S<e.symbolInstances.length;S++){const o=e.symbolInstances.get(S),{numHorizontalGlyphVertices:u,numVerticalGlyphVertices:c,crossTileID:f,numIconVertices:p,tileAnchorX:T,tileAnchorY:A}=o;let M=null;const I=this.retainedQueryData[e.bucketInstanceId];x&&o&&I&&(M=n.latestFeatureIndex.loadFeature({featureIndex:o.featureIndex,bucketIndex:I.bucketIndex,sourceLayerIndex:I.sourceLayerIndex,layoutVertexArrayOffset:0}));const E=_.evaluate(M,{}),P=i.has(f);let k=this.opacities[f];P?k=d:k||(k=b,this.opacities[f]=k),i.add(f);const B=u>0||c>0,D=p>0,R=this.placedOrientations[f],L=R===t.bq.vertical,z=R===t.bq.horizontal||R===t.bq.horizontalOnly;!B&&!D||k.isHidden()||w++;let O=!1;if((B||D)&&s)for(const i of e.activeReplacements){if(t.bx(i,r,t.by.Symbol,l))continue;if(i.min.x>T||T>i.max.x||i.min.y>A||A>i.max.y)continue;const e=t.bz(T,A,a.canonical,i.footprintTileId.canonical);if(O=t.bA(e,i.footprint),O)break}if(B){const t=O?Ii:Mi(k.text);C(e.text,u,L?Ii:t),C(e.text,c,z?Ii:t);const i=k.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:r,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a}=o,l=e.text.placedSymbolArray,h=i||L?1:0;n>=0&&(l.get(n).hidden=h),r>=0&&(l.get(r).hidden=h),s>=0&&(l.get(s).hidden=h),a>=0&&(l.get(a).hidden=i||z?1:0);const d=this.variableOffsets[f];d&&this.markUsedJustification(e,d.anchor,o,R);const p=this.placedOrientations[f];p&&(this.markUsedJustification(e,"left",o,p),this.markUsedOrientation(e,p,o))}if(D){const t=O?Ii:Mi(k.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=o,r=e.icon.placedSymbolArray,s=k.icon.isHidden()?1:0;i>=0&&(C(e.icon,p,L?Ii:t),r.get(i).hidden=s),n>=0&&(C(e.icon,o.numVerticalIconVertices,z?Ii:t),r.get(n).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[S];if(i){let n=new t.P(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(m){const t=this.variableOffsets[f];t?(n=gi(t.anchor,t.width,t.height,t.textOffset,t.textScale),g&&n._rotate(y?this.transform.angle:-this.transform.angle)):r=!1}h&&(r=!k.clipped),i.textBox&&vi(e.textCollisionBox.collisionVertexArray,k.text.placed,!r||L,E,v,n.x,n.y),i.verticalTextBox&&vi(e.textCollisionBox.collisionVertexArray,k.text.placed,!r||z,E,v,n.x,n.y)}const s=r&&Boolean(!z&&i.verticalIconBox);i.iconBox&&vi(e.iconCollisionBox.collisionVertexArray,k.icon.placed,s,E,v,o.hasIconTextFit?n.x:0,o.hasIconTextFit?n.y:0),i.verticalIconBox&&vi(e.iconCollisionBox.collisionVertexArray,k.icon.placed,!s,E,v,o.hasIconTextFit?n.x:0,o.hasIconTextFit?n.y:0)}}}if(e.fullyClipped=0===w,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function vi(t,e,i,n,o,r,s){t.emplaceBack(e?1:0,i?1:0,r||0,s||0,n,o?1:0),t.emplaceBack(e?1:0,i?1:0,r||0,s||0,n,o?1:0),t.emplaceBack(e?1:0,i?1:0,r||0,s||0,n,o?1:0),t.emplaceBack(e?1:0,i?1:0,r||0,s||0,n,o?1:0)}const xi=Math.pow(2,25),bi=Math.pow(2,24),Ci=Math.pow(2,17),wi=Math.pow(2,16),Si=Math.pow(2,9),Ti=Math.pow(2,8),Ai=Math.pow(2,1);function Mi(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*xi+e*bi+i*Ci+e*wi+i*Si+e*Ti+i*Ai+e}const Ii=0;class Ei{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,n,o,r){const s=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(s,n,t[this._currentTileIndex],this._sortAcrossTiles,r),this._currentTileIndex++,o())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<s.length;){const t=s[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart,r),this._currentPartIndex++,o())return!0}return!1}}class Pi{constructor(t,e,i,n,o,r,s,a,l){this.placement=new _i(t,o,r,s,a,l),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,n,o,r){const s=t.q.now(),a=()=>{const e=t.q.now()-s;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const s=i[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){const e=s,i=e.layout.get("symbol-z-elevate"),l=void 0!==e.layout.get("symbol-sort-key").constantOr(1),u=e.layout.get("symbol-z-order"),c="viewport-y"===u||"auto"===u&&!("viewport-y"!==u&&l),h=e.layout.get("text-allow-overlap")||e.layout.get("icon-allow-overlap")||e.layout.get("text-ignore-placement")||e.layout.get("icon-ignore-placement"),d=c&&h,f=this._inProgressLayer=this._inProgressLayer||new Ei(e),p=t.aC(s.source,s.scope);if(f.continuePlacement(i||d?o[p]:n[p],this.placement,this._showCollisionBoxes,s,a,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ki=512/t.ag/2;class Bi{constructor(e,i,n){this.tileID=e,this.bucketInstanceId=n,this.index=new t.bE(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const o=e.canonical.x*t.ag,r=e.canonical.y*t.ag;for(let t=0;t<i.length;t++){const{key:e,crossTileID:n,tileAnchorX:s,tileAnchorY:a}=i.get(t),l=Math.floor((o+s)*ki),u=Math.floor((r+a)*ki);this.index.add(l,u),this.keys.push(e),this.crossTileIDs.push(n)}this.index.finish()}findMatches(e,i,n){const o=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),r=ki/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*t.ag,a=i.canonical.y*t.ag;for(let t=0;t<e.length;t++){const i=e.get(t);if(i.crossTileID)continue;const{key:l,tileAnchorX:u,tileAnchorY:c}=i,h=Math.floor((s+u)*r),d=Math.floor((a+c)*r),f=this.index.range(h-o,d-o,h+o,d+o);for(const t of f){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!n.has(e)){n.add(e),i.crossTileID=e;break}}}}}class Di{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ri{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const i in this.indexes){const t=this.indexes[i],n={};for(const i in t){const o=t[i];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),n[o.tileID.key]=o}this.indexes[i]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let o=0;o<e.symbolInstances.length;o++)e.symbolInstances.get(o).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const n=this.usedCrossTileIDs[t.overscaledZ];for(const o in this.indexes){const i=this.indexes[o];if(Number(o)>t.overscaledZ)for(const o in i){const r=i[o];r.tileID.isChildOf(t)&&r.findMatches(e.symbolInstances,t,n)}else{const r=i[t.scaledTo(Number(o)).key];r&&r.findMatches(e.symbolInstances,t,n)}}for(let o=0;o<e.symbolInstances.length;o++){const t=e.symbolInstances.get(o);t.crossTileID||(t.crossTileID=i.generate(),n.add(t.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Bi(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const o in n)t[n[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[o]),delete n[o],e=!0)}return e}}class Li{constructor(){this.layerIndexes={},this.crossTileIDs=new Di,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,n){let o=this.layerIndexes[t.fqid];void 0===o&&(o=this.layerIndexes[t.fqid]=new Ri);let r=!1;const s={};"globe"!==n.name&&o.handleWrapJump(i);for(const a of e){const e=a.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(a.tileID,e,this.crossTileIDs)&&(r=!0),s[e.bucketInstanceId]=!0)}return o.removeStaleBuckets(s)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const i in this.layerIndexes)e[i]||delete this.layerIndexes[i]}}const zi=771;class Oi{constructor(t,e,i,n){this.blendFunction=t,this.blendColor=e,this.mask=i,this.blendEquation=n}}Oi.Replace=[1,0,1,0],Oi.disabled=new Oi(Oi.Replace,t.aj.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,t.aj.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,zi,1,zi],t.aj.transparent,[!0,!0,!0,!0]),Oi.alphaBlendedNonPremultiplied=new Oi([770,zi,770,zi],t.aj.transparent,[!0,!0,!0,!0]),Oi.multiply=new Oi([774,0,774,0],t.aj.transparent,[!0,!0,!0,!0]);class Ui{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ui.ReadOnly=!1,Ui.ReadWrite=!0,Ui.disabled=new Ui(519,Ui.ReadOnly,[0,1]);const Fi=7680;class Ni{constructor(t,e,i,n,o,r){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=o,this.pass=r}}Ni.disabled=new Ni({func:519,mask:0},0,0,Fi,Fi,Fi);const Vi=1029,Hi=2305;class ji{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}function Gi(e,i){const n=t.bG(e,3);t.ab.mat4.fromQuat(e,i),t.bI(e,3,n)}function Wi(e,i){const n=t.ab.quat.identity([]);return t.ab.quat.rotateZ(n,n,-i),t.ab.quat.rotateX(n,n,-e),n}function qi(e,i){const n=[e[0],e[1],0],o=[i[0],i[1],0];if(t.ab.vec3.length(n)>=1e-15){const e=t.ab.vec3.normalize([],n);t.ab.vec3.scale(o,e,t.ab.vec3.dot(o,e)),i[0]=o[0],i[1]=o[1]}const r=t.ab.vec3.cross([],i,e);if(t.ab.vec3.len(r)<1e-15)return null;const s=Math.atan2(-r[1],r[0]);return Wi(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}ji.disabled=new ji(!1,Vi,Hi),ji.backCCW=new ji(!0,Vi,Hi),ji.backCW=new ji(!0,Vi,2304),ji.frontCW=new ji(!0,1028,2304),ji.frontCCW=new ji(!0,1028,Hi);class Zi{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t.aa?e:new t.aa(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.bF(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const n=this.position,o=this._elevation?this._elevation.getAtPointOrZero(t.aa.fromLngLat(e)):0,r=t.aa.fromLngLat(e,o),s=[r.x-n.x,r.y-n.y,r.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=qi(s,i)}setPitchBearing(e,i){this.orientation=Wi(t.ai(e),t.ai(-i))}}class $i{constructor(e,i){this._transform=t.ab.mat4.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t.aa(e[0],e[1],e[2])}get position(){const e=t.bG(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.bI(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.ab.quat.identity([]),e&&Gi(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Wi(t,e),Gi(this._transform,this._orientation)}forward(){const e=t.bG(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.bG(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.bG(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const n=new Float64Array(16);return t.ab.mat4.invert(n,this.getWorldToCamera(e,i)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,n){const o=this.position;t.ab.vec3.scale(o,o,-e);const r=new Float64Array(16);return t.ab.mat4.fromScaling(r,[n,n,n]),t.ab.mat4.translate(r,r,o),r[10]*=i,r}getWorldToCamera(e,i){const n=new Float64Array(16),o=new Float64Array(4),r=this.position;return t.ab.quat.conjugate(o,this._orientation),t.ab.vec3.scale(r,r,-e),t.ab.mat4.fromQuat(n,o),t.ab.mat4.translate(n,n,r),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(e,i,n,o){const r=new Float64Array(16);return t.ab.mat4.perspective(r,e,i,n,o),r}getCameraToClipOrthographic(e,i,n,o,r,s){const a=new Float64Array(16);return t.ab.mat4.ortho(a,e,i,n,o,r,s),a}getDistanceToElevation(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=0===e?0:t.bH(e,i?t.aS(this.position[1]):this.position[1]),o=this.forward();return(n-this.position[2])/o[2]}clone(){return new $i([...this.position],[...this.orientation])}}const Ki={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Yi{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.af(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.af(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.af(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.af(e.right,i.right,n)),this}getCenter(e,i){const n=t.aw((this.left+e-this.right)/2,0,e),o=t.aw((this.top+i-this.bottom)/2,0,i);return new t.P(n,o)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Yi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ji=(t,e,i)=>(1-i)*t+i*e,Xi=t=>t*t*t*t*t;class Qi{constructor(e,i,n,o,r,s,a){this.tileSize=512,this._renderWorldCopies=void 0===r||r,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=n??0,this._maxPitch=o??60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new $i,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.ay(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=t.bP(this.projectionOptions);const n=this.getProjection(),o=!t.bn(i,n);return o&&this._calcMatrices(),this.mercatorFromTransition=!1,o}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.bP({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.ab.mat2.create(),t.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.aw(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.ai(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let o=0,r=0;for(let s=0;s<i.length;s++){const a=new t.P(i[s][0]*this.width,n+i[s][1]*(this.height-n)),l=e.pointCoordinate(a);if(!l)continue;const u=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);o+=l[3]*u,r+=u}return 0===r?NaN:o/r}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,n=this._mercatorZfromZoom(t),o=this._mercatorZfromZoom(this._maxZoom),r=Math.max(n-i,o);this._setZoom(this._zoomFromMercatorZ(r))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const o=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,n));return t.aw(this._zoomFromMercatorZ(o),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.ab.quat.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.ab.vec3.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new Zi;return i.position=new t.aa(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.ab.quat.length(e))return!1;t.ab.quat.normalize(e,e);const i=t.ab.vec3.transformQuat([],[0,0,-1],e),n=t.ab.vec3.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const o=qi(i,n);return!!o&&(this._camera.orientation=o,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,o=this.cameraToCenterDistance;e[2]=t.aw(e[2],o/n,o/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.bQ(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new t.P(0,0)),o=this.pointCoordinate(new t.P(this.width,0)),r=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(n.x,o.x,r.x,s.x)),l=Math.floor(Math.max(n.x,o.x,r.x,s.x)),u=1;for(let c=a-u;c<=l+u;c++)0!==c&&i.push(new t.bQ(c,e))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(e,i,n){let o=[];const r=void 0!==n,s=!r;if(s&&this.zoom<i)return o;if(r&&0===n[0]&&0===n[1])return o;const a=new Set,l=(e,i,n,r,s)=>{const l=t.c5(i,e,n,r,s);a.has(l)||(o.push(new t.aG(e,i,n,r,s)),a.add(l))};for(let t=0;t<e.length;t++){const o=e[t];if(s&&o.canonical.z!==i)continue;const a=o.canonical,u=o.overscaledZ,c=o.wrap,h=1<<a.z,d=a.x+1<h,f=a.x>0,p=a.y+1<h,m=a.y>0,g=o.wrap-(f?0:1),y=o.wrap+(d?0:1),_=f?a.x-1:h-1,v=d?a.x+1:0;if(r)n[0]<0?(l(u,y,a.z,v,a.y),n[1]<0&&p&&(l(u,c,a.z,a.x,a.y+1),l(u,y,a.z,v,a.y+1)),n[1]>0&&m&&(l(u,c,a.z,a.x,a.y-1),l(u,y,a.z,v,a.y-1))):n[0]>0?(l(u,g,a.z,_,a.y),n[1]<0&&p&&(l(u,c,a.z,a.x,a.y+1),l(u,g,a.z,_,a.y+1)),n[1]>0&&m&&(l(u,c,a.z,a.x,a.y-1),l(u,g,a.z,_,a.y-1))):n[1]<0&&p?l(u,c,a.z,a.x,a.y+1):m&&l(u,c,a.z,a.x,a.y-1);else{const t=o.visibleQuadrants;1&t&&(l(u,g,a.z,_,a.y),m&&(l(u,c,a.z,a.x,a.y-1),l(u,g,a.z,_,a.y-1))),2&t&&(l(u,y,a.z,v,a.y),m&&(l(u,c,a.z,a.x,a.y-1),l(u,y,a.z,v,a.y-1))),4&t&&(l(u,g,a.z,_,a.y),p&&(l(u,c,a.z,a.x,a.y+1),l(u,g,a.z,_,a.y+1))),8&t&&(l(u,y,a.z,v,a.y),p&&(l(u,c,a.z,a.x,a.y+1),l(u,y,a.z,v,a.y+1)))}}const u=[];for(const t of o)o.some((e=>t.isChildOf(e)))||u.push(t);if(o=u.filter((t=>!e.some((e=>!!(t.overscaledZ<i&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),s){const t=1<<i,e="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),n=[t*e.x,t*e.y],r=4,s=r*r;o=o.filter((t=>{const e=t.canonical.x+.5-n[0],i=t.canonical.y+.5-n[1];return e*e+i*i<s}))}return o}coveringTiles(e){let i=this.coveringZoomLevel(e);const n=i,o=this.elevation&&this.elevation.exaggeration(),r=o&&!e.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,u=1<<i,c=[u*a.x,u*a.y,0],h="globe"===this.projection.name,d=!h,f=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),p=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=u*t.bH(1,this.center.lat),g=this._camera.position[2]/t.bH(1,this.center.lat),y=[u*p.x,u*p.y,g*(d?1:m)],_=h||o,v=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),x=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&e.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();b=t?t.max:this._centerAltitude}else b=this._centerAltitude;const C=e.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?t.bS(this):1,S=e=>{const i=1/4e4,n=new t.aa(e.x+i,e.y,e.z),o=new t.aa(e.x,e.y+i,e.z),r=e.toLngLat(),s=n.toLngLat(),a=o.toLngLat(),l=this.locationCoordinate(r),u=this.locationCoordinate(s),c=this.locationCoordinate(a),h=Math.hypot(u.x-l.x,u.y-l.y),d=Math.hypot(c.x-l.x,c.y-l.y);return Math.sqrt(h*d)*w/i},T=e=>{const i=b,n=C;return{aabb:t.bV(this,u,0,0,0,e,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:e,fullyVisible:!1}},A=[];let M=[];const I=i,E=e.reparseOverscaled?n:i,P=(g-this._centerAltitude)*m,k=t=>{if(!this._elevation||!t.tileID||!s)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=D(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},B=(t,e)=>{if(.707*e<t)return 1;const i=e/t;return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)},D=e=>{if(e.zoom<x)return!0;if(e.zoom===I)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(y),o=e.aabb.distanceY(y);let a=P,u=1;if(h){a=e.aabb.distanceZ(y);const i=Math.pow(2,e.zoom),n=t.aS((e.y+1)/i),o=t.aS(e.y/i),r=Math.min(Math.max(l,n),o),s=t.c9(r)/t.c9(l);if(u=r===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,s/this._mercatorScaleRatio),this.zoom<=t.c6&&e.zoom===I-1&&s>=.9)return!0}else if(r&&(a=e.aabb.distanceZ(y)*m),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,e.zoom),n=S(new t.aa((e.x+.5)/i,(e.y+.5)/i));u=n>.85?1:n}if(!s){const t=Math.sqrt(i*i+o*o+a*a);let n=(1<<I-e.zoom)*v*u;return n*=B(Math.max(a,P),t),t<n}let d=Number.MAX_VALUE,f=0;const p=e.aabb.getCorners(),g=[];for(const n of p){t.ab.vec3.sub(g,n,y),h||(r?g[2]*=m:g[2]=P);const e=t.ab.vec3.dot(g,this._camera.forward());e<d&&(d=e,f=Math.abs(g[2]))}let _=(1<<I-e.zoom)*v*u;if(_*=B(Math.max(f,P),d),d<_)return!0;const b=e.aabb.closestPoint(c);return b[0]===c[0]&&b[1]===c[1]};if(this.renderWorldCopies)for(let t=1;t<=3;t++)A.push(T(-t)),A.push(T(t));for(A.push(T(0));A.length>0;){const n=A.pop(),o=n.x,a=n.y;let l=n.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!l){let e=_?n.aabb.intersects(f):n.aabb.intersectsFlat(f);if(0===e&&d()){const i=new t.bT(n.zoom,o,a);e=t.bU(this,u,i,!0).intersects(f)}if(0===e)continue;l=2===e}if(n.zoom!==I&&D(n))for(let e=0;e<4;e++){const i=(o<<1)+e%2,c=(a<<1)+(e>>1),d={aabb:s?n.aabb.quadrant(e):t.bV(this,u,n.zoom+1,i,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:c,wrap:n.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!h&&(d.tileID=new t.aG(n.zoom+1===I?E:n.zoom+1,n.wrap,n.zoom+1,i,c),k(d)),A.push(d)}else{const r=n.zoom===I?E:n.zoom;if(e.minzoom&&e.minzoom>r)continue;let s=0;if(!l){let i=_?n.aabb.intersectsPrecise(f):n.aabb.intersectsPreciseFlat(f);if(0===i&&d()){const e=new t.bT(n.zoom,o,a);i=t.bU(this,u,e,!0).intersectsPrecise(f)}if(0===i)continue;if(e.calculateQuadrantVisibility)if(f.containsPoint(n.aabb.center))s=15;else for(let t=0;t<4;t++)0!==n.aabb.quadrant(t).intersects(f)&&(s|=1<<t)}const h=c[0]-(.5+o+(n.wrap<<n.zoom))*(1<<i-n.zoom),p=c[1]-.5-a,m=n.tileID?n.tileID:new t.aG(r,n.wrap,n.zoom,o,a);e.calculateQuadrantVisibility&&(m.visibleQuadrants=s),M.push({tileID:m,distanceSq:h*h+p*p})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();M=M.filter((o=>{const r=[0,0,0,1],s=[t.ag,t.ag,0,1],a=this.calculateFogTileMatrix(o.tileID.toUnwrapped());t.ab.vec4.transformMat4(r,r,a),t.ab.vec4.transformMat4(s,s,a);const l=t.ab.vec4.min([],r,s),u=t.ab.vec4.max([],r,s),c=t.bW(l,u);if(0===c)return!0;let h=!1;const d=this._elevation;if(d&&c>i&&0!==n){const i=this.calculateProjMatrix(o.tileID.toUnwrapped());let r;e.isTerrainDEM||(r=d.getMinMaxForTile(o.tileID)),r||(r={min:C,max:b});const s=t.c7(this.rotation),a=[s[0]*t.ag,s[1]*t.ag,r.max];t.ab.vec3.transformMat4(a,a,i),h=(1-a[1])*this.height*.5<n}return c<i||h}))}return M.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.aw(e.lat,-t.bX,t.bX),n=this.projection.project(e.lng,i);return new t.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let n,o;const r=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;n=(i.x-r.x)/t,o=(i.y-r.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(r);n=t.x-e.x,o=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.aa(s.x-n,s.y-o))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const n=i?t.bH(i,e.lat):void 0,o=this.projection.project(e.lng,e.lat);return new t.aa(o.x,o.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const n=null!=i?i:this._centerAltitude,o=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.ab.vec4.transformMat4(o,o,this.pixelMatrixInverse),t.ab.vec4.transformMat4(r,r,this.pixelMatrixInverse);const s=r[3];t.ab.vec4.scale(o,o,1/o[3]),t.ab.vec4.scale(r,r,1/s);const a=o[2],l=r[2];return{p0:o,p1:r,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.ab.vec4.transformMat4(i,i,this.pixelMatrixInverse),t.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),t.ab.vec4.scale(i,i,1/i[3]),t.ab.vec4.scale(n,n,1/n[3]),i[2]=t.bH(i[2],this._center.lat)*this.worldSize,n[2]=t.bH(n[2],this._center.lat)*this.worldSize,t.ab.vec4.scale(i,i,1/this.worldSize),t.ab.vec4.scale(n,n,1/this.worldSize),new t.aq([i[0],i[1],i[2]],t.ab.vec3.normalize([],t.ab.vec3.sub([],n,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:n,t:o}=e,r=t.bH(i[2],this._center.lat),s=t.bH(n[2],this._center.lat);return new t.aa(t.af(i[0],n[0],o)/this.worldSize,t.af(i[1],n[1],o)/this.worldSize,t.af(r,s,o))}pointCoordinate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t.aa(i[0],i[1],i[2]);let n=0,o=this.horizonLineFromTop();if(e.y>o)return this.pointCoordinate(e);const r=.02*o,s=e.clone();for(let a=0;a<10&&o-n>r;a++){s.y=t.af(n,o,.66);const e=this.projection.pointCoordinate3D(this,s.x,s.y);e?(o=s.y,i=e):n=s.y}return i?new t.aa(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.bY)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,o=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.ab.vec4.transformMat4(o,o,this.pixelMatrix),o[3]>0?new t.P(o[0]/o[3],o[1]/o[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,r=this.pointLocation3D(new t.P(i,e)),s=this.pointLocation3D(new t.P(o,e)),a=this.pointLocation3D(new t.P(o,n)),l=this.pointLocation3D(new t.P(i,n));let u=Math.min(r.lng,s.lng,a.lng,l.lng),c=Math.max(r.lng,s.lng,a.lng,l.lng),h=Math.min(r.lat,s.lat,a.lat,l.lat),d=Math.max(r.lat,s.lat,a.lat,l.lat);const f=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,m=(e,i,n,o,r)=>{const s=(e+n)/2,a=(i+o)/2,l=new t.P(s,a),{lng:g,lat:y}=this.pointLocation3D(l),_=Math.max(0,u-g,h-y,g-c,y-d);u=Math.min(u,g),c=Math.max(c,g),h=Math.min(h,y),d=Math.max(d,y),(r<p||_>f)&&(m(e,i,s,a,r+1),m(s,a,n,o,r+1))};if(m(i,e,o,e,1),m(o,e,o,n,1),m(o,n,i,n,1),m(i,n,i,e,1),"globe"===this.projection.name){const[e,i]=t.bZ(this);e?(d=90,c=180,u=-180):i&&(h=-90,c=180,u=-180)}return new t.az(new t.bO(u,h),new t.bO(c,d))}_getBoundsRectangular(e,i){const{top:n,left:o}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new t.P(o,n),l=new t.P(s,n),u=new t.P(s,r),c=new t.P(o,r);let h=this.pointCoordinate(a,e),d=this.pointCoordinate(l,e);const f=this.pointCoordinate(u,i),p=this.pointCoordinate(c,i),m=(t,e)=>(e.y-t.y)/(e.x-t.x);return h.y>1&&d.y>=0?h=new t.aa((1-p.y)/m(p,h)+p.x,1):h.y<0&&d.y<=1&&(h=new t.aa(-p.y/m(p,h)+p.x,0)),d.y>1&&h.y>=0?d=new t.aa((1-f.y)/m(f,d)+f.x,1):d.y<0&&h.y<=1&&(d=new t.aa(-f.y/m(f,d)+f.x,0)),(new t.az).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(f))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.bX,this.maxLat=t.bX,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.at(this.minLng)*this.tileSize,this.worldMaxX=t.at(this.maxLng)*this.tileSize,this.worldMinY=t.aA(this.maxLat)*this.tileSize,this.worldMaxY=t.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,n=this._distanceTileDataCache;if(n[i])return n[i];const o=e.canonical,r=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(o.z),l=(o.x+Math.pow(2,o.z)*e.wrap)*a,u=o.y*a,c=this.point;c.x*=s/this.worldSize,c.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),f=-Math.cos(-h);return n[i]={bearing:[d,f],center:[(c.x-l)*r,(c.y-u)*r],scale:a/t.ag*r},n[i]}calculateFogTileMatrix(e){const i=e.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const o=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.ab.mat4.multiply(o,this.worldToFogMatrix,o),n[i]=new Float32Array(o),n[i]}calculateProjMatrix(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=e.key;let r;if(r=n?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,r[o])return r[o];const s=this.calculatePosMatrix(e,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,t.ab.mat4.multiply(s,a,s),r[o]=new Float32Array(s),r[o]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const o=t.b_(e,this);return n[i]=o,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,i=t.ab.mat4.fromScaling([],[e,e,e]);return t.ab.mat4.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.bH(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),o=this._camera.forward(),r=t.bH(1,this._center.lat);n[2]/=r,o[2]/=r,t.ab.vec3.normalize(o,o);const s=e.raycast(n,o,e.exaggeration());if(s){const e=t.ab.vec3.scaleAndAdd([],n,o,s),i=new t.aa(e[0],e[1],t.bH(e[2],t.aS(e[1]))),a=(i.z+t.ab.vec3.length([i.x-n[0],i.y-n[1],i.z-n[2]*r]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const i=this._elevation,n=t.bH(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(n),r=i.getAtPointOrZero(new t.aa(...o)),s=this.pixelsPerMeter/this.worldSize*r,a=this._minimumHeightOverTerrain(),l=o[2]-s;if(l<=a)if(l<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[o[0],o[1],e.z-o[2]],n=t.ab.vec3.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const r=t.ab.vec3.length(i);if(0===r)return;t.ab.vec3.scale(i,i,n/r*this._pixelsPerMercatorPixel),this._camera.position=[o[0],o[1],e.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const i=this.center;return i.lat=t.aw(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(i.lng=t.aw(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:o}=this.point;let r=0,s=n,a=o;const l=this.width/2,u=this.height/2,c=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(o-u<c&&(a=c+u),o+u>h&&(a=h-u),h-c<this.height&&(r=Math.max(r,this.height/(h-c)),a=(h+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,i=this.worldSize/2-(t+e)/2;s=(n+i+this.worldSize)%this.worldSize-i,s-l<t&&(s=t+l),s+l>e&&(s=e-l),e-t<this.width&&(r=Math.max(r,this.width/(e-t)),s=(e+t)/2)}s===n&&a===o||(this.center=this.unproject(new t.P(s,a))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.bH(1,this.center.lat)/t.bH(1,t.c8));const o=t.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,o),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?n:1,s=this._camera.getWorldToCamera(this.worldSize,r);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=t*this.aspect,n=-i,o=-t;i-=e.x,n-=e.x,t+=e.y,o+=e.y,a=this._camera.getCameraToClipOrthographic(n,i,o,t,this._nearZ,this._farZ),((t,e,i,n)=>{for(let o=0;o<16;o++)t[o]=Ji(e[o],i[o],n)})(a,a,l,Xi(this.pitch>=15?1:this.pitch/15))}else a=l;const u=t.ab.mat4.mul([],l,s);let c=t.ab.mat4.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.ab.mat4.identity([]);t.ab.mat4.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.ab.mat4.multiply(i,i,t.c0(this)),t.ab.mat4.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.ab.mat4.multiply(c,c,i),t.ab.mat4.multiply(u,u,i),this.inverseAdjustmentMatrix=t.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ab.mat4.scale([],c,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=c,this.invProjMatrix=t.ab.mat4.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-e.x/this.width,i[9]=2*e.y/this.height,this.expandedFarZProjMatrix=t.ab.mat4.mul([],i,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=t.ab.mat4.invert([],a);this.frustumCorners=t.c2.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);t.ab.mat4.identity(d),t.ab.mat4.scale(d,d,[1,-1,1]),t.ab.mat4.rotateX(d,d,this._pitch),t.ab.mat4.rotateZ(d,d,this.angle);const f=t.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ab.mat4.clone(f);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;f[8]=2*-e.x/this.width,f[9]=2*(e.y+p)/this.height,this.skyboxMatrix=t.ab.mat4.multiply(d,f,d);const m=this.point,g=m.x,y=m.y,_=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),C=g-Math.round(g)+x*_+b*v,w=y-Math.round(y)+x*v+b*_,S=new Float64Array(c);if(t.ab.mat4.translate(S,S,[C>.5?C-1:C,w>.5?w-1:w,0]),this.alignedProjMatrix=S,c=t.ab.mat4.create(),t.ab.mat4.scale(c,c,[this.width/2,-this.height/2,1]),t.ab.mat4.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.ab.mat4.create(),t.ab.mat4.scale(c,c,[1,-1,1]),t.ab.mat4.translate(c,c,[-1,-1,0]),t.ab.mat4.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,u),this._calcFogMatrices(),this._distanceTileDataCache={},c=t.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.c3(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.ab.vec3.transformMat4(e,e,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,o=1/this.height/this._pixelsPerMercatorPixel,r=[e,e,i];t.ab.vec3.scale(r,r,o),t.ab.vec3.scale(n,n,-1),t.ab.vec3.multiply(n,n,r);const s=t.ab.mat4.create();t.ab.mat4.translate(s,s,n),t.ab.mat4.scale(s,s,r),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,o)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,o=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*o,n.y/this.worldSize-i[1]*o,t/this.worldSize*this._centerAltitude-i[2]*o]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],o=e[2];let r=1;this.projection.wrap&&(this.center=this.center.wrap()),o>0&&(r=Math.min((i-n)/o,1)),this._camera.position=t.ab.vec3.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:o}=this._camera.getPitchBearing(),r=t.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ai(this._maxPitch)),a=Math.max((e[2]-r)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);t.ab.vec3.scaleAndAdd(e,e,i,a),this._pitch=t.aw(n,t.ai(this.minPitch),t.ai(this.maxPitch)),this.angle=t.bF(o,-Math.PI,Math.PI),this._setZoom(t.aw(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.aa(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,n=t.bY,o=0,r=1/0;for(;n-i>1e-6&&n>i;){const t=i+.5*(n-i),s=this.tileSize*Math.pow(2,t),a=this.getCameraToCenterDistance(this.projection,t,s),l=this.scaleZoom(a/(e*this.tileSize)),u=Math.abs(t-l);u<r&&(r=u,o=t),t<l?i=t:n=t}return o}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const n=Math.min(e.x,i.x),o=Math.max(e.x,i.x),r=Math.min(e.y,i.y),s=Math.max(e.y,i.y);if(r<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.P(n,r),new t.P(o,s),new t.P(n,s),new t.P(o,r)],l=this.renderWorldCopies?-3:0,u=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>u||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(e,i){const n=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,e)),o=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(o)}getCameraPoint(){if("globe"===this.projection.name){const e=function(e,i){let[n,o,r]=e;const s=[n,o,r,1];t.ab.vec4.transformMat4(s,s,i);const a=s[3]=Math.max(s[3],1e-6);return s[0]/=a,s[1]/=a,s[2]/=a,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}}getCameraToCenterDistance(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const o=t.b$(e,i,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,n,o);let s=.5/Math.tan(.5*this._fov)*this.height*r;return this.isOrthographic&&(s=Ji(1,s,Xi(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.ab.mat4.multiply(e,e,this.globeMatrix),e}getFrustum(e){return t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const tn=(e,i)=>{if(i>0&&e.terrain&&t.w("Cutoff is currently disabled on terrain"),i<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=e.transform,o=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),r=n.isLODDisabled(!1)?t.ac(60,45,n.pitch):t.ac(30,15,n.pitch),s=n._farZ-n._nearZ,a=i*n.height,l=((1-(u=r))*n.cameraToCenterDistance+u*(n._farZ+a))*o;var u;return{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(l-n._nearZ)/s,(l-a-n._nearZ)/s]}}},en={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class nn{constructor(t,e){this.aabb=t,this.lastCascade=e}}class on{add(t,e){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],e.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],e.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],e.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],e.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],e.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],e.max[2])):this.receivers[t.key]=new nn(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(e,i,n){const o=t.cd.fromPoints(e.points);let r=0;for(const s in this.receivers){const e=this.receivers[s];if(!e)continue;if(!o.intersectsAabb(e.aabb))continue;e.aabb.min=o.closestPoint(e.aabb.min),e.aabb.max=o.closestPoint(e.aabb.max);const a=e.aabb.getCorners();for(let o=0;o<n.length;o++){let s=!0;for(const e of a){const r=[e[0]*i,e[1]*i,e[2]];if(t.ab.vec3.transformMat4(r,r,n[o].matrix),r[0]<-1||r[0]>1||r[1]<-1||r[1]>1){s=!1;break}}if(e.lastCascade=o,r=Math.max(r,o),s)break}}return r+1}}class rn{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new on,this._depthMode=new Ui(t.context.gl.LEQUAL,Ui.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(en,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(en,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(en,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const o=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||o<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((t,i)=>{const o=n.style._mergedLayers[i];return t+(o.hasShadowPass()&&!o.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const r=n.context,s=en.shadowMapResolution,a=en.shadowMapResolution;if(0===this._cascades.length||en.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<en.cascadeCount;++e){const e=n._shadowMapDebug,i=r.gl,o=r.createFramebuffer(s,a,e,"texture"),l=new t.T(r,{width:s,height:a,data:null},i.DEPTH_COMPONENT16);if(o.depthAttachment.set(l.texture),e){const e=new t.T(r,{width:s,height:a,data:null},i.RGBA8);o.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:o,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.bR,scale:0})}}this.shadowDirection=an(i);let l=0;if(e.elevation){const t=e.elevation,i=[1e4,-1e4];t.visibleDemTiles.filter((t=>t.dem)).forEach((t=>{const e=t.dem.tree;i[0]=Math.min(i[0],e.minimums[0]),i[1]=Math.max(i[1],e.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*t.exaggeration())}const u=1.5*e.cameraToCenterDistance,c=3*u,h=new Float64Array(16);for(let p=0;p<this._cascades.length;++p){const i=this._cascades[p];let n=e.height/50,o=1;1===en.cascadeCount?o=c:0===p?o=u:(n=u,o=c);const[r,s]=un(e,this.shadowDirection,n,o,en.shadowMapResolution,l);i.scale=e.scale,i.matrix=r,i.boundingSphereRadius=s,t.ab.mat4.invert(h,i.matrix),i.frustum=t.bR.fromInvProjectionMatrix(h,1,0,!0),i.far=o}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=o,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/en.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=en.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ki.ShadowMap0,this._uniformValues.u_shadowmap_1=Ki.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const f=n.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(f){const i=f.getMinMaxForTile(t);i&&(e=i)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(e,i){if(!this.enabled)return;const n=this.painter,o=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),o.viewport.set([0,0,en.shadowMapResolution,en.shadowMapResolution]);for(let r=0;r<this._numCascadesToRender;++r){n.currentShadowCascade=r,o.bindFramebuffer.set(this._cascades[r].framebuffer.framebuffer),o.clear({color:t.aj.white,depth:1});for(const t of e.order){const o=e._mergedLayers[t];if(!o.hasShadowPass()||o.isHidden(n.transform.zoom))continue;const r=e.getLayerSourceCache(o),s=r?i[r.id]:void 0;("model"===o.type||s&&s.length)&&n.renderLayer(n,r,o,s)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,e=t.style,i=t.context,n=e.directionalLight,o=e.ambientLight;if(!n||!o)return;const r=[],s=tn(t,t.longestCutoffRange);s.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),r.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&r.push("NORMAL_OFFSET");const a=ln(e,n,o),l=new Ui(i.gl.LEQUAL,Ui.ReadOnly,t.depthRangeFor3D);for(const u of this._groundShadowTiles){const e=u.toUnwrapped(),n=t.isTileAffectedByFog(u),o=t.getOrCreateProgram("groundShadow",{defines:r,overrideFog:n});this.setupShadows(e,o),t.uploadCommonUniforms(i,o,e,null,s);const c={u_matrix:t.transform.calculateProjMatrix(e),u_ground_shadow_factor:a};o.draw(t,i.gl.TRIANGLES,l,Ni.disabled,Oi.multiply,ji.disabled,c,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Oi.unblended:Oi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,n=i.calculatePosMatrix(e,i.worldSize);return t.ab.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return t.ab.mat4.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.enabled)return;const r=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,u=new Float64Array(16),c=r.calculatePosMatrix(e,r.worldSize);for(let h=0;h<this._cascades.length;h++)t.ab.mat4.multiply(u,this._cascades[h].matrix,c),l[0===h?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(u),s.activeTexture.set(a.TEXTURE0+Ki.ShadowMap0+h),this._cascades[h].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const i=t.cc(e.canonical),s=2/r.tileSize*t.ag/en.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,u=s*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===n?1:3)/Math.pow(2,o-e.canonical.z-(1-r.zoom+Math.floor(r.zoom)));l.u_shadow_normal_offset=[i,a*c,u*c],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,l)}setupShadowsFromMatrix(e,i){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const o=this.painter.context,r=o.gl,s=this._uniformValues,a=new Float64Array(16);for(let l=0;l<en.cascadeCount;l++)t.ab.mat4.multiply(a,this._cascades[l].matrix,e),s[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),o.activeTexture.set(r.TEXTURE0+Ki.ShadowMap0+l),this._cascades[l].texture.bind(r.NEAREST,r.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const t=en.normalOffset;s.u_shadow_normal_offset=[1,t,t],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,n,o){if(o[2]>=0)return{};const r=function(e,i,n){const o=n/(1<<e.canonical.z);return new t.cd([e.canonical.x*o+e.wrap*n,e.canonical.y*o+e.wrap*n,0],[(e.canonical.x+1)*o+e.wrap*n,(e.canonical.y+1)*o+e.wrap*n,i])}(e,i,n).getCorners(),s=i/-o[2];o[0]<0?(t.ab.vec3.add(r[0],r[0],[o[0]*s,0,0]),t.ab.vec3.add(r[3],r[3],[o[0]*s,0,0])):o[0]>0&&(t.ab.vec3.add(r[1],r[1],[o[0]*s,0,0]),t.ab.vec3.add(r[2],r[2],[o[0]*s,0,0])),o[1]<0?(t.ab.vec3.add(r[0],r[0],[0,o[1]*s,0]),t.ab.vec3.add(r[1],r[1],[0,o[1]*s,0])):o[1]>0&&(t.ab.vec3.add(r[2],r[2],[0,o[1]*s,0]),t.ab.vec3.add(r[3],r[3],[0,o[1]*s,0]));const a={};return a.vertices=r,a.planes=[sn(r[1],r[0],r[4]),sn(r[2],r[1],r[5]),sn(r[3],r[2],r[6]),sn(r[0],r[3],r[7])],a}addShadowReceiver(e,i,n){this._receivers.add(e,t.cd.fromTileIdAndHeight(e,i,n))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function sn(e,i,n){const o=t.ab.vec3.sub([],n,i),r=t.ab.vec3.sub([],e,i),s=t.ab.vec3.cross([],o,r),a=t.ab.vec3.length(s);return 0===a?[0,0,1,0]:(t.ab.vec3.scale(s,s,1/a),[s[0],s[1],s[2],-t.ab.vec3.dot(s,i)])}function an(e){const i=e.properties.get("direction"),n=t.cb(i.x,i.y,i.z);n[2]=t.aw(n[2],0,75);const o=t.ce([n[0],n[1],n[2]]);return t.ab.vec3.fromValues(o.x,o.y,o.z)}function ln(e,i,n){const o="none"===i.properties.get("color-use-theme"),r=i.properties.get("color"),s=i.properties.get("intensity"),a=i.properties.get("direction"),l=[a.x,a.y,a.z],u="none"===n.properties.get("color-use-theme"),c=n.properties.get("color"),h=n.properties.get("intensity"),d=Math.max(t.ab.vec3.dot([0,0,1],l),0),f=[0,0,0];t.ab.vec3.scale(f,c.toRenderColor(u?null:e.getLut(i.scope)).toArray01Linear().slice(0,3),h);const p=[0,0,0];return t.ab.vec3.scale(p,r.toRenderColor(o?null:e.getLut(n.scope)).toArray01Linear().slice(0,3),d*s),t.cf([f[0]>0?f[0]/(f[0]+p[0]):0,f[1]>0?f[1]/(f[1]+p[1]):0,f[2]>0?f[2]/(f[2]+p[2]):0])}function un(e,i,n,o,r,s){const a=e.zoom,l=e.scale,u=e.worldSize,c=1/u,h=e.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*e.fovX),f=d*d,p=o-n,m=o+n;let g,y;f>p/m?(g=o,y=o*d):(g=.5*m*(1+f),y=.5*Math.sqrt(p*p+2*(o*o+n*n)*f+m*m*f*f));const _=e.projection.pixelsPerMeter(e.center.lat,u),v=e._camera.getCameraToWorldMercator(),x=[0,0,-g*c];t.ab.vec3.transformMat4(x,x,v);let b=y*c;const C=e._edgeInsets;if(!(0===C.left&&0===C.top&&0===C.right&&0===C.bottom||C.left===C.right&&C.top===C.bottom)){const i=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?_:1),r=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,o);r[8]=2*-e.centerOffset.x/e.width,r[9]=2*e.centerOffset.y/e.height;const s=new Float64Array(16);t.ab.mat4.mul(s,r,i);const c=new Float64Array(16);t.ab.mat4.invert(c,s);const h=t.bR.fromInvProjectionMatrix(c,u,a,!0);for(const n of h.points){const i=((w=n)[0]/=l,w[1]/=l,w[2]=t.bH(w[2],e._center.lat),w);b=Math.max(b,t.ab.vec3.len(t.ab.vec3.subtract([],x,i)))}}var w;b*=r/(r-1);const S=Math.acos(i[2]),T=Math.atan2(-i[0],-i[1]),A=new $i;A.position=x,A.setPitchBearing(S,T);const M=A.getWorldToCamera(u,_),I=b*u,E=Math.min(e._mercatorZfromZoom(17)*u*-2,-2*I),P=A.getCameraToClipOrthographic(-I,I,-I,I,E,(I+s*_)/i[2]),k=new Float64Array(16);t.ab.mat4.multiply(k,P,M);const B=t.ab.vec3.fromValues(Math.floor(1e6*x[0])/1e6*u,Math.floor(1e6*x[1])/1e6*u,0),D=.5*r,R=[0,0,0];t.ab.vec3.transformMat4(R,B,k),t.ab.vec3.scale(R,R,D);const L=[Math.floor(R[0]),Math.floor(R[1]),Math.floor(R[2])],z=[0,0,0];t.ab.vec3.sub(z,R,L),t.ab.vec3.scale(z,z,-1/D);const O=new Float64Array(16);return t.ab.mat4.identity(O),t.ab.mat4.translate(O,O,z),t.ab.mat4.multiply(k,O,k),[k,I]}class cn extends t.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(e,i){return t.aM(this.requestManager.transformRequest(i,t.R.Model).url).then((i=>{if(!i)return;const n=t.aN(i),o=new t.aO(e,void 0,void 0,n);return o.computeBoundsAndApplyParent(),o})).catch((n=>{if(n&&404===n.status)return null;this.fire(new t.y(new Error(`Could not load model ${e} from ${i}: ${n.message}`)))}))}load(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keepNumReferences:!1};this.models[i]||(this.models[i]={});const o=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+o.length;const r=[];for(const t of o)r.push(this.loadModel(t,e[t]));Promise.allSettled(r).then((e=>{for(let t=0;t<e.length;t++){const{status:r,value:s}=e[t];if("fulfilled"===r&&s){const e=this.models[i][o[t]];this.models[i][o[t]]={model:s,numReferences:n.keepNumReferences&&e?e.numReferences:1}}}this.numModelsLoading[i]-=o.length,this.fire(new t.z("data",{dataType:"style"}))})).catch((e=>{this.fire(new t.y(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]?this.models[e][t].model:void 0}addModel(t,e,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={}),this.hasModel(t,i)&&this.models[i][t].numReferences++,this.modelUris[i][t]=this.requestManager.normalizeModelURL(e),this.load({[t]:this.modelUris[i][t]},i)}addModels(t,e){this.models[e]||(this.models[e]={}),this.modelUris[e]||(this.modelUris[e]={});const i=this.modelUris[e];for(const n in t)this.models[e][n]={},i[n]=this.requestManager.normalizeModelURL(t[n]);this.load(i,e,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,e){this.models[e]||(this.models[e]={}),this.modelUris[e]||(this.modelUris[e]={});const i={};for(const n of t)this.hasModel(n,e)?this.models[e][n].numReferences++:(this.modelUris[e][n]=this.requestManager.normalizeModelURL(n),i[n]=this.modelUris[e][n]);this.load(i,e)}removeModel(t,e){if(this.models[e]&&this.models[e][t]&&(this.models[e][t].numReferences--,0===this.models[e][t].numReferences)){const i=this.models[e][t].model;delete this.models[e][t],delete this.modelUris[e][t],i.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const i in this.models[e])this.models[e][i].model&&this.models[e][i].model.upload(t.context)}}const hn=new t.a5({data:new t.a6(t.a3.colorTheme.data)}),dn={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function fn(t){return t=t||{},Object.assign(t,dn)}class pn extends t.E{constructor(e){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},t.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=e,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle((e=>{e.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new t.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=e.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=e.stylesheet.indoor.buildingFeaturesetId,this._scope=e.scope))})),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(e){if(!this._queryFeatureSetId)return;if(!this._map.isStyleLoaded())return;if(this._map.transform.zoom<13)return;this._indoorData&&!function(t,e){const[i,n]=t,{center:o,radius:r}=e,[s,a]=o,l=Math.abs(i-s);return Math.sqrt((l>180?360-l:l)**2+(n-a)**2)<=r}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new t.z("floorplangone")));const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},n=new t.P(this._map.transform.width/2,this._map.transform.height/2),o=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],r=this._map.queryRenderedFeatures(e?o:n,i);r.length>0&&(this._selectedFloorplan&&r[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=r[0],this._floorplanSelected(!1)))}_floorplanSelected(e){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(t){const[[e,i],[n,o]]=t,r=(n-e+360)%360,s=r>180?360-r:r;return{center:[(e+s/2+360)%360,(i+o)/2],radius:Math.sqrt(s**2+(o-i)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const i=this._floorplanStates[this._indoorData.id].selectedBuilding,n=this._floorplanStates[this._indoorData.id].selectedLevel;let o;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const t of this._indoorData.levels)t.id===this._selectedLevel.id&&(o=t.id);if(this.fire(new t.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:o})),i){const t=this._indoorData.buildings.find((t=>t.id===i));this._buildingSelected(t,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(n){const t=this._indoorData.levels.find((t=>t.id===n));this._updateLevels(t,e)}else e&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(e,i){i&&e&&e.extent&&this._map.fitBounds(e.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=e?e.id:void 0;const n=this._indoorData.levels.filter((t=>e.levels.includes(t.id)));this.fire(new t.z("buildingselected",{buildingId:e.id,levels:n}))}_levelSelected(e){if("overview"===e)this._updateLevels(void 0,!0);else{const t=this._indoorData.levels.find((t=>t.id===e));this._updateLevels(t,!0)}this.fire(new t.z("levelselected",{levelId:"overview"===e?void 0:e}))}_updateLevels(t,e){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(e&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function i(t){const e=t.indexOf("/floor/");if(-1===e)return t;const i=e+7,n=t.indexOf("/",i);return-1===n?t.slice(i):t.slice(i,n)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const n=[],o={},r={},s={},a={};for(const l of this._indoorData.levels)if(n.push(l.id),o[l.id]=l.height,r[l.id]=l.base,t){if(this.mergeFloors){const e=i(t.id),n=i(l.id);s[l.id]=n===e?"true":"false"}else s[l.id]=l.id===t.id?"true":"false";a[l.id]=l.base<t.base?"true":"false"}else a[l.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",n]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",o]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",r]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",s]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",a]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),e&&t.extent)){const e=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),i=this._map.getZoom(),n=e.zoom?Math.abs(i-e.zoom):0;this._map.fitBounds(t.extent,n>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:i})}}selectFloorplan(e){const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},n=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],o=this._map.queryRenderedFeatures(n,i);if(o.length>0)for(const t of o)if(JSON.parse(t.properties["indoor-data"]).floorplanIDs.includes(e)){this._selectedFloorplan=t,this._floorplanSelected(!0);break}}selectBuilding(t){const e=this._indoorData.buildings.find((e=>e.id===t));this._buildingSelected(e,!0)}selectLevel(t){this._levelSelected(t)}}function mn(e){if(!e.metadata||!e.metadata.content_area)return;const i=t.q.devicePixelRatio,{left:n,top:o,width:r,height:s}=e.metadata.content_area,a=n*i,l=o*i;return[a,l,a+r*i,l+s*i]}function gn(e){if(e)return e.map((e=>{let[i,n]=e;return[i*t.q.devicePixelRatio,n*t.q.devicePixelRatio]}))}const yn=(t,e)=>Pt(t,e&&e.filter((t=>"source.canvas"!==t.identifier))),_n=t.ay(Be,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),vn=t.ay(Be,["setCenter","setZoom","setBearing","setPitch"]),xn=new Set(["background","sky","slot","custom"]),bn={version:8,layers:[],sources:{}},Cn={duration:300,delay:0};class wn extends t.E{constructor(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=e,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=t.l({},Cn),this._buildingIndex=new Ee(this),this.crossTileSymbolIndex=new Li,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new H,this.dispatcher=i.dispatcher?i.dispatcher:new t.D(t.ci(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new G(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new t.cj(e._requestManager,i.localFontFamily?t.ck.all:i.localIdeographFontFamily?t.ck.ideographs:t.ck.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new cn(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",t.cl());const n=this;this._rtlTextPluginCallback=wn.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.cm(e),i&&i.every((t=>t)))for(const t in n._sourceCaches){const e=n._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const i in this._layers){const t=this._layers[i];t.source===e.id&&this._validateLayer(t)}}))}load(t){return t?("string"==typeof t?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(e){if(!e)return null;if("string"==typeof e){if(t.f(e))return e;const i=t.cn(e);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(t){return i}return i}return`json://${t.co(JSON.stringify(e))}`}_diffStyle(e,i,n){this.globalId=this._getGlobalId(e);const o=(t,e)=>{try{e(null,this.setState(t,n))}catch(t){e(t,!1)}};if("string"==typeof e){const n=this.map._requestManager.normalizeStyleURL(e),r=this.map._requestManager.transformRequest(n,t.R.Style);t.n(r,((e,n)=>{e?this.fire(new t.y(e)):n&&o(n,i)}))}else"object"==typeof e&&o(e,i)}loadURL(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new t.z("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!t.f(e);this.globalId=this._getGlobalId(e),e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const o=this.importsCache.get(e);if(o)return this._load(o,n);const r=this.map._requestManager.transformRequest(e,t.R.Style);this._request=t.n(r,((i,o)=>{if(this._request=null,i)this.fire(new t.y(i));else if(o)return this.importsCache.set(e,o),this._load(o,n)}))}loadJSON(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new t.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(e),this._request=t.q.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.z("dataloading",{dataType:"style"})),this._load(bn,!1)}_loadImports(e,i,n){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const o=[];for(const t of e){const e=this._createFragmentStyle(t),r=new Promise((t=>{e.once("style.import.load",t),e.once("error",t)})).then((()=>this.mergeAll()));if(o.push(r),this.resolvedImports.has(t.url)){e.loadEmpty();continue}const s=t.data||this.importsCache.get(t.url);s?(e.loadJSON(s,{validate:i}),this._isInternalStyle(s)&&(e.globalId=null)):t.url?e.loadURL(t.url,{validate:i}):e.loadEmpty();const a={style:e,id:t.id,config:t.config};if(n){const t=this.fragments.findIndex((t=>{let{id:e}=t;return e===n}));this.fragments=this.fragments.slice(0,t).concat(a).concat(this.fragments.slice(t))}else this.fragments.push(a)}return Promise.allSettled(o)}getImportGlobalIds(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const i of t.fragments)i.style.globalId&&e.add(i.style.globalId),this.getImportGlobalIds(i.style,e);return[...e.values()]}_createFragmentStyle(e){const i=this.scope?t.aC(e.id,this.scope):e.id;let n;const o=this._initialConfig&&this._initialConfig[i];(e.config||o)&&(n=t.l({},e.config,o));const r=new wn(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n,configOptions:this.options,colorThemeOverride:e["color-theme"],configDependentLayers:this._configDependentLayers});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&!1!==t.fragment)}_load(e,i){const n=e.indoor?fn(e.schema):e.schema;if(this._isInternalStyle(e)){const n=t.l({},bn,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,i)}if(this.updateConfig(this._config,n),i&&yn(this,gt(e)))return;this._loaded=!0,this.stylesheet=t.cp(e);const o=()=>{for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1,isInitialLoad:!0});e.sprite?this._loadIconset(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=ke(this.stylesheet.layers);if(this._order=n.map((t=>t.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new Bt(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Bt(this.stylesheet.light)),this._layers={};for(const e of n){const i=t.cu(e,this.scope,this._styleColorTheme.lut,this.options);0!==i.configDependencies.size&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i;const n=this.getOwnLayerSourceCache(i),o=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&i.canCastShadows()&&o&&(n.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.z("data",{dataType:"style"}));const r=this.isRootStyle();e.imports?this._loadImports(e.imports,i).then((()=>{this._reloadImports(),this.fire(new t.z(r?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new t.z(r?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(r){const e=this._evaluateColorThemeData(r);this._loadColorTheme(e).then((()=>{o()})).catch((e=>{t.w(`Couldn't load color theme from the stylesheet: ${e}`),o()}))}else this._styleColorTheme.lut=null,o()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,i,n,o,r,s,a,l,u,c;const h={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{if(t.stylesheet){if(null!=t.light&&(e=t.light),t.stylesheet.lights)for(const e of t.stylesheet.lights)"ambient"===e.type&&null!=t.ambientLight&&(i=t.ambientLight),"directional"===e.type&&null!=t.directionalLight&&(n=t.directionalLight);o=this._prioritizeTerrain(o,t.terrain,t.stylesheet.terrain),t.stylesheet.fog&&null!=t.fog&&(r=t.fog),t.stylesheet.snow&&null!=t.snow&&(s=t.snow),t.stylesheet.rain&&null!=t.rain&&(a=t.rain),null!=t.stylesheet.camera&&(c=t.stylesheet.camera),null!=t.stylesheet.projection&&(l=t.stylesheet.projection),null!=t.stylesheet.transition&&(u=t.stylesheet.transition),h[t.scope]=t._styleColorTheme}})),this.light=e,this.ambientLight=i,this.directionalLight=n,this.fog=r,this.snow=s,this.rain=a,this._styleColorThemeForScope=h,null===o?delete this.terrain:this.terrain=o,this.camera=c||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=t.l({},Cn,u),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=i=>{for(const t of i.fragments)e(t.style);t(i)};e(this)}_prioritizeTerrain(t,e,i){const n=t&&0===t.drapeRenderMode;return null===i?e&&0===e.drapeRenderMode?e:n?t:null:null!=e&&(!t||n||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)})),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const e={},i={},n={};this.forEachFragmentStyle((o=>{for(const i in o._sourceCaches){const n=t.aC(i,o.scope);e[n]=o._sourceCaches[i]}for(const e in o._otherSourceCaches){const n=t.aC(e,o.scope);i[n]=o._otherSourceCaches[e]}for(const e in o._symbolSourceCaches){const i=t.aC(e,o.scope);n[i]=o._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=n}mergeLayers(){var e=this;const i={},n=[],o={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((e=>{for(const o of e._order){const r=e._layers[o];if("slot"===r.type){const e=t.cq(o);if(i[e])continue;i[e]=[]}r.slot&&i[r.slot]?i[r.slot].push(r):n.push(r)}})),this._mergedOrder=[];const r=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const s of n)if("slot"===s.type){const n=t.cq(s.id);i[n]&&r(i[n]),e._mergedSlots.push(n)}else{const i=t.aC(s.id,s.scope);e._mergedOrder.push(i),o[i]=s,s.is3D()&&(e._has3DLayers=!0),"circle"===s.type&&(e._hasCircleLayers=!0),"symbol"===s.type&&(e._hasSymbolLayers=!0),"clip"===s.type&&(e._clipLayerPresent=!0)}};r(n),this._mergedOrder.sort(((t,e)=>{const i=o[t],n=o[e];return i.hasInitialOcclusionOpacityProperties?n.is3D()?1:0:i.is3D()&&n.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=o,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=t.l({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(e){return e.data?function(e,i,n){const o=t.l({},i);for(const s of Object.keys(t.a3.colorTheme))void 0===o[s]&&(o[s]=t.a3.colorTheme[s].default);const r=new t.a4(hn,e,new Map(n));return r.setTransitionOrValue(o,n),r.untransitioned().possiblyEvaluate(new t.a8(0))}(this.scope,e,this.options).get("data"):null}_loadColorTheme(e){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((n,o)=>{const r="data:image/png;base64,";if(!e||0===e.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void n();let s=e;s.startsWith(r)||(s=r+s);const a="mapbox-reserved-lut",l=new Image;l.src=s,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,o(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void n();this._styleColorTheme.lutLoading=!1;const{width:r,height:s,data:u}=t.q.getImageData(l);if(s>32)return void o(new Error("The height of the image must be less than or equal to 32 pixels."));if(r!==s*s)return void o(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new t.r({width:r,height:s},u),pixelRatio:1,sdf:!1,usvg:!1,version:0});const c=this.imageManager.getImage(a,this.scope);c?(this._styleColorTheme.lut={image:c.data,data:e},n()):o(new Error("Missing LUT image."))}}))}getLut(t){const e=this._styleColorThemeForScope[t];return e?e.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,i,n){let o,r,s;const a=t.q.devicePixelRatio>1?"@2x":"";let l=t.n(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.R.SpriteJSON),((t,e)=>{l=null,s||(s=t,o=e,c())})),u=t.o(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.R.SpriteImage),((t,e)=>{u=null,s||(s=t,r=e,c())}));function c(){if(s)n(s);else if(o&&r){const e=t.q.getImageData(r),i={};for(const n in o){const{width:r,height:s,x:a,y:l,sdf:u,pixelRatio:c,stretchX:h,stretchY:d,content:f}=o[n],p=new t.r({width:r,height:s});t.r.copy(e,p,{x:a,y:l},{x:0,y:0},{width:r,height:s},null),i[n]={data:p,pixelRatio:c,sdf:u,stretchX:h,stretchY:d,content:f,usvg:!1}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.y(e));else if(i)for(const t in i)this.imageManager.addImage(t,this.scope,i[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))}))}_loadIconset(e){if(!t.f(e)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(e);const i="auto"===this.map._spriteFormat;var n,o;this._spriteRequest=(o=(n,o)=>{if(this._spriteRequest=null,n)i?this._loadSprite(e):this.fire(new t.y(n));else if(o)for(const t in o)this.imageManager.addImage(t,this.scope,o[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))},t.bi((n=this.map._requestManager).transformRequest(n.normalizeIconsetURL(e),t.R.Iconset),((e,i)=>{if(e)return void o(e);const n={},r=t.cg(new t.bh(i));for(const o of r.icons){const e={version:1,pixelRatio:t.q.devicePixelRatio,content:mn(o),stretchX:o.metadata?gn(o.metadata.stretch_x_areas):void 0,stretchY:o.metadata?gn(o.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:o};n[o.name]=e}o(null,n)})))}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const n=e.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.y(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,e)=>{const i=this.fragments[e];return i&&i.style&&(t.data=i.style.serialize()),t}))}_serializeSources(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new t.y(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new t.y(new Error(`The source '${e}' does not exist in the map's style.`)))}precompilePrograms(t,e){const i=this.map.painter;if(i)for(let n=t.minzoom||0;n<(t.maxzoom||25.5);n++){const n=t.getProgramIds();if(n)for(const o of n){const n=t.getDefaultProgramParams(o,e.zoom,this._styleColorTheme.lut);n&&(i.style=this,this.fog&&(i._fogVisible=!0,n.overrideFog=!0,i.getOrCreateProgram(o,n)),i._fogVisible=!1,n.overrideFog=!1,i.getOrCreateProgram(o,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,i.getOrCreateProgram(o,n)))}}}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const n=this._changes.isDirty();let o=!1;if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:i,removedIds:n}=t[e];(i||n)&&(this._updateWorkerLayers(e,i,n),o=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this.snow&&this.snow.updateTransitions(e),this.rain&&this.rain.updateTransitions(e),this._changes.reset()}const r={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];r[t]=e.used,e.used=!1,e.tileCoverLift=0}for(const t of this._mergedOrder){const i=this._mergedLayers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this.getLayerSourceCache(i);t&&(t.used=!0,t.tileCoverLift=Math.max(t.tileCoverLift,i.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(i,e)})):this.precompilePrograms(i,e))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&o&&this.mergeLayers();for(const s in r){const e=this._mergedSourceCaches[s];r[s]!==e.used&&e.getSource().fire(new t.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.snow&&this.snow.recalculate(e),this.rain&&this.rain.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new t.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,i){const n=this.getFragmentStyle(t);n&&this.dispatcher.broadcast("updateLayers",{layers:e?n._serializeLayers(e):[],scope:t,removedIds:i||[],options:n.options})}setState(e,i){if(this._checkLoaded(),yn(this,gt(e)))return!1;(e=t.cp(e)).layers=ke(e.layers);const n=function(e,i){if(!e)return[{command:Be.setStyle,args:[i]}];let n=[];try{if(!t.bn(e.version,i.version))return[{command:Be.setStyle,args:[i]}];if(t.bn(e.center,i.center)||n.push({command:Be.setCenter,args:[i.center]}),t.bn(e.zoom,i.zoom)||n.push({command:Be.setZoom,args:[i.zoom]}),t.bn(e.bearing,i.bearing)||n.push({command:Be.setBearing,args:[i.bearing]}),t.bn(e.pitch,i.pitch)||n.push({command:Be.setPitch,args:[i.pitch]}),t.bn(e.sprite,i.sprite)||n.push({command:Be.setSprite,args:[i.sprite]}),t.bn(e.glyphs,i.glyphs)||n.push({command:Be.setGlyphs,args:[i.glyphs]}),t.bn(e.imports,i.imports)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;i=i||[];const o=(e=e||[]).map(Ue),r=i.map(Ue),s=e.reduce(Fe,{}),a=i.reduce(Fe,{}),l=o.slice();let u,c,h,d;for(u=0,c=0;u<o.length;u++)h=o[u],a.hasOwnProperty(h)?c++:(n.push({command:Be.removeImport,args:[h]}),l.splice(l.indexOf(h,c),1));for(u=0,c=0;u<r.length;u++)h=r[r.length-1-u],l[l.length-1-u]!==h&&(s.hasOwnProperty(h)?(n.push({command:Be.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-c),1)):c++,d=l[l.length-u],n.push({command:Be.addImport,args:[a[h],d]}),l.splice(l.length-u,0,h));for(const f of i){const e=s[f.id];e&&!t.bn(e,f)&&n.push({command:Be.updateImport,args:[f.id,f]})}}(e.imports,i.imports,n),t.bn(e.transition,i.transition)||n.push({command:Be.setTransition,args:[i.transition]}),t.bn(e.light,i.light)||n.push({command:Be.setLight,args:[i.light]}),t.bn(e.fog,i.fog)||n.push({command:Be.setFog,args:[i.fog]}),t.bn(e.snow,i.snow)||n.push({command:Be.setSnow,args:[i.snow]}),t.bn(e.rain,i.rain)||n.push({command:Be.setRain,args:[i.rain]}),t.bn(e.projection,i.projection)||n.push({command:Be.setProjection,args:[i.projection]}),t.bn(e.lights,i.lights)||n.push({command:Be.setLights,args:[i.lights]}),t.bn(e.camera,i.camera)||n.push({command:Be.setCamera,args:[i.camera]}),!t.bn(e["color-theme"],i["color-theme"]))return[{command:Be.setStyle,args:[i]}];const o={},r=[];!function(e,i,n,o){let r;for(r in i=i||{},e=e||{})e.hasOwnProperty(r)&&(i.hasOwnProperty(r)||Re(r,n,o));for(r in i){if(!i.hasOwnProperty(r))continue;const s=i[r];e.hasOwnProperty(r)?t.bn(e[r],s)||("geojson"===e[r].type&&"geojson"===s.type&&ze(e,i,r)?n.push({command:Be.setGeoJSONSourceData,args:[r,s.data]}):Le(r,i,n,o)):De(r,i,n)}}(e.sources,i.sources,r,o);const s=[];e.layers&&e.layers.forEach((t=>{t.source&&o[t.source]?n.push({command:Be.removeLayer,args:[t.id]}):s.push(t)}));let a=e.terrain;a&&o[a.source]&&(n.push({command:Be.setTerrain,args:[void 0]}),a=void 0),n=n.concat(r),t.bn(a,i.terrain)||n.push({command:Be.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const o=(e=e||[]).map(Ue),r=i.map(Ue),s=e.reduce(Fe,{}),a=i.reduce(Fe,{}),l=o.slice(),u=Object.create(null);let c,h,d,f,p,m,g;for(c=0,h=0;c<o.length;c++)d=o[c],a.hasOwnProperty(d)?h++:(n.push({command:Be.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(c=0,h=0;c<r.length;c++)d=r[r.length-1-c],l[l.length-1-c]!==d&&(s.hasOwnProperty(d)?(n.push({command:Be.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-c],n.push({command:Be.addLayer,args:[a[d],m]}),l.splice(l.length-c,0,d),u[d]=!0);for(c=0;c<r.length;c++)if(d=r[c],f=s[d],p=a[d],!u[d]&&!t.bn(f,p))if(t.bn(f.source,p.source)&&t.bn(f["source-layer"],p["source-layer"])&&t.bn(f.type,p.type)){for(g in Oe(f.layout,p.layout,n,d,null,Be.setLayoutProperty),Oe(f.paint,p.paint,n,d,null,Be.setPaintProperty),t.bn(f.slot,p.slot)||n.push({command:Be.setSlot,args:[d,p.slot]}),t.bn(f.filter,p.filter)||n.push({command:Be.setFilter,args:[d,p.filter]}),t.bn(f.minzoom,p.minzoom)&&t.bn(f.maxzoom,p.maxzoom)||n.push({command:Be.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),f)f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Oe(f[g],p[g],n,d,g.slice(6),Be.setPaintProperty):t.bn(f[g],p[g])||n.push({command:Be.setLayerProperty,args:[d,g,p[g]]}));for(g in p)p.hasOwnProperty(g)&&!f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Oe(f[g],p[g],n,d,g.slice(6),Be.setPaintProperty):t.bn(f[g],p[g])||n.push({command:Be.setLayerProperty,args:[d,g,p[g]]}))}else n.push({command:Be.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:Be.addLayer,args:[p,m]})}(s,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Be.setStyle,args:[i]}]}return n}(this.serialize(),e).filter((t=>!(t.command in vn)));if(0===n.length)return!1;const o=n.filter((t=>!(t.command in _n)));if(o.length>0)throw new Error(`Unimplemented: ${o.map((t=>t.command)).join(", ")}.`);const r=[];return n.forEach((t=>{r.push(this[t.command].apply(this,t.args))})),i&&Promise.all(r).then(i),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,e),i&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new t.y(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(It,`models.${t}`,e,null,i)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new t.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(yt,`sources.${e}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const o=re(e,i,this.dispatcher,this);o.scope=this.scope,o.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(o.id),source:o.serialize(),sourceId:o.id})));const r=e=>{const i=(e?"symbol:":"other:")+o.id,n=t.aC(i,this.scope),r=this._sourceCaches[i]=new Te(n,o,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[o.id]=r,r.onAdd(this.map)};r(!1),"vector"!==i.type&&"geojson"!==i.type||r(!0),o.onAdd&&o.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===e)return this.fire(new t.y(new Error(`Source "${e}" cannot be removed while layer "${o}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new t.y(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this.getOwnSourceCaches(e);for(const o of n){const e=t.cq(o.id);delete this._sourceCaches[e],this._changes.discardSourceCacheUpdate(o.id),o.fire(new t.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:o.getSource().id})),o.setEventedParent(null),o.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const i=this.getOwnSourceCache(e);i&&t.push(i.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const o of e){if(this._validate(vt,"lights",o))return;switch(o.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(o),t.updateTransitions(i)}else this.ambientLight=new $t(o,Gt||(Gt=new t.a5({color:new t.a6(t.a3.properties_light_ambient.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(o),t.updateTransitions(i)}else this.directionalLight=new $t(o,Wt||(Wt=new t.a5({direction:new t.ak(t.a3.properties_light_directional.direction),color:new t.a6(t.a3.properties_light_directional.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_directional.intensity),"cast-shadows":new t.a6(t.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new t.a6(t.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new t.a6(t.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const n=new t.a8(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const n=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),o=e.properties.get("color").toRenderColor(null).toArray01(),r=e.properties.get("intensity"),s=e.properties.get("direction"),a=1-t.cb(s.x,s.y,s.z)[2]/90,l=n(o)*r*a,u=i.properties.get("color").toRenderColor(null).toArray01(),c=i.properties.get("intensity"),h=n(u)*c;return Number(((l+h)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(t.cr(e)){const i=t.cs(e),n=this.fragments.find((t=>{let{id:e}=t;return e===i}));if(!n)throw new Error(`Style import '${e}' not found`);const o=t.cq(e);return n.style.getFragmentStyle(o)}{const t=this.fragments.find((t=>{let{id:i}=t;return i===e}));return t?t.style:void 0}}setFeaturesetSelectors(e){if(!e)return;const i={},n=function(t){return`${t}::${arguments.length>1&&void 0!==arguments[1]?arguments[1]:""}`};this._featuresetSelectors={};for(const o in e){const r=this._featuresetSelectors[o]=[];for(const s of e[o].selectors){if(s.featureNamespace){const e=this.getOwnLayer(s.layer);if(!e){t.w(`Layer is undefined for selector: ${s.layer}`);continue}const r=n(e.source,e.sourceLayer);if(r in i&&i[r]!==s.featureNamespace){t.w(`"featureNamespace ${s.featureNamespace} of featureset ${o}'s selector is not associated to the same source, skip this selector`);continue}i[r]=s.featureNamespace}let e;if(s.properties)for(const i in s.properties){const n=t.U(s.properties[i]);"success"===n.result&&(e=e||{},e[i]=n.value)}r.push({layerId:s.layer,namespace:s.featureNamespace,properties:e,uniqueFeatureID:s._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const e=this.getFragmentStyle(t);if(!e||!e.stylesheet.featuresets)return[];const i=[];for(const n in e.stylesheet.featuresets)i.push({featuresetId:n,importId:e.scope?e.scope:void 0});return i}getFeaturesetLayers(e,i){const n=this.getFragmentStyle(i),o=n.stylesheet.featuresets;if(!o||!o[e])return this.fire(new t.y(new Error(`The featureset '${e}' does not exist in the map's style and cannot be queried.`))),[];const r=[];for(const t of o[e].selectors){const e=n.getOwnLayer(t.layer);e&&r.push(e)}return r}getConfigProperty(e,i){const n=this.getFragmentStyle(e);if(!n)return null;const o=t.aC(i,n.scope),r=n.options.get(o),s=r?r.value||r.default:null;return s?s.serialize():null}setConfigProperty(e,i,n){const o=this.getFragmentStyle(e);if(!o)return;const r=o.stylesheet.indoor?fn(o.stylesheet.schema):o.stylesheet.schema;if(!r||!r[i])return;const s=t.U(n);if("success"!==s.result)return void yn(this,s.value);const a=s.value.expression,l=t.aC(i,o.scope),u=o.options.get(l);if(!u)return;let c;const{minValue:h,maxValue:d,stepValue:f,type:p,values:m}=r[i],g=t.U(r[i].default);"success"===g.result&&(c=g.value.expression),c?(this.options.set(l,Object.assign({},u,{value:a,default:c,minValue:h,maxValue:d,stepValue:f,type:p,values:m})),this.updateConfigDependencies(i)):this.fire(new t.y(new Error(`No schema defined for the config option "${i}" in the "${e}" fragment.`)))}getConfig(e){const i=this.getFragmentStyle(e);if(!i)return null;const n=i.stylesheet.schema;if(!n)return null;const o={};for(const r in n){const e=t.aC(r,i.scope),n=i.options.get(e),s=n?n.value||n.default:null;o[r]=s?s.serialize():null}return o}setConfig(t,e){const i=this.getFragmentStyle(t);i&&(i.updateConfig(e,i.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const e=this.getFragmentStyle(t);return e?e.stylesheet.schema:null}setSchema(t,e){const i=this.getFragmentStyle(t);i&&(i.stylesheet.schema=e,i.updateConfig(i._config,e),this.updateConfigDependencies())}updateConfig(e,i){if(this._config=e,e||i)if(i)for(const n in i){let o,r;const s=t.U(i[n].default);if("success"===s.result&&(o=s.value.expression),e&&void 0!==e[n]){const i=t.U(e[n]);"success"===i.result&&(r=i.value.expression)}const{minValue:a,maxValue:l,stepValue:u,type:c,values:h}=i[n];if(o){const e=t.aC(n,this.scope);this.options.set(e,{default:o,value:r,minValue:a,maxValue:l,stepValue:u,type:c,values:h})}else this.fire(new t.y(new Error(`No schema defined for config option "${n}".`)))}else this.fire(new t.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const e of this._configDependentLayers){const i=this.getLayer(e);if(i){if(t&&!i.configDependencies.has(t))continue;i.possiblyEvaluateVisibility(),this._updateLayer(i)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((t=>{const e=t._styleColorTheme.colorThemeOverride?t._styleColorTheme.colorThemeOverride:t._styleColorTheme.colorTheme;if(e){const i=t._evaluateColorThemeData(e);(!t._styleColorTheme.lut&&""!==i||t._styleColorTheme.lut&&i!==t._styleColorTheme.lut.data)&&t.setColorTheme(e)}})),this._changes.setDirty()}addLayer(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const o=e.id;if(this._layers[o])return void this.fire(new t.y(new Error(`Layer with id "${o}" already exists on this map`)));let r;if("custom"===e.type){if(yn(this,t.ct(e)))return;r=t.cu(e,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof e.source&&(this.addSource(o,e.source),e=t.cp(e),e=t.l(e,{source:o})),this._validate(St,`layers.${o}`,e,{arrayIndex:-1},n))return;r=t.cu(e,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(r),r.setEventedParent(this,{layer:{id:o}})}0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid);let s=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.y(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?s=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,o),this._layerOrderChanged=!0,this._layers[o]=r;const a=this.getOwnLayerSourceCache(r),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&r.canCastShadows()&&l&&(a.castsShadows=!0);const u=this._changes.getRemovedLayer(r);if(u&&r.source&&a&&"custom"!==r.type){this._changes.discardLayerRemoval(r);const e=t.aC(r.source,r.scope);u.type!==r.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),a.pause())}this._updateLayer(r),r.onAdd&&r.onAdd(this.map),r.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;if(e===i)return;const o=this._order.indexOf(e);this._order.splice(o,1);let r=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.y(new Error(`Layer with id "${i}" does not exist on this map.`)));n.slot===this._layers[i].slot?r=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(r,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const n=this.getOwnLayerSourceCache(e);if(n&&n.castsShadows){let t=!1;for(const i in this._layers)if(this._layers[i].source===e.source&&this._layers[i].canCastShadows()){t=!0;break}n.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const n=this._checkLayer(t);n&&(n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,e){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==e&&(i.slot=e,this._updateLayer(i))}setFilter(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const o=this._checkLayer(e);if(o&&!t.bn(o.filter,i))return null==i?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(Tt,`layers.${o.id}.filter`,i,{layerType:o.type},n)||(o.filter=t.cp(i),this._updateLayer(o)))}getFilter(e){const i=this._checkLayer(e);if(i)return t.cp(i.filter)}setLayoutProperty(e,i,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);if(r&&!t.bn(r.getLayoutProperty(i),n)){if(null!=n&&(!o||!1!==o.validate)&&yn(r,Mt.call(gt,{key:`layers.${e}.layout.${i}`,layerType:r.type,objectKey:i,value:n,styleSpec:t.a3,style:{glyphs:!0,sprite:!0}})))return;r.setLayoutProperty(i,n),0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid),this._updateLayer(r)}}getLayoutProperty(t,e){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(e)}setPaintProperty(e,i,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);if(!r)return;if(t.bn(r.getPaintProperty(i),n))return;if(null!=n&&(!o||!1!==o.validate)&&yn(r,At.call(gt,{key:`layers.${e}.paint.${i}`,layerType:r.type,objectKey:i,value:n,styleSpec:t.a3})))return;const s=r.setPaintProperty(i,n);0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid),s&&this._updateLayer(r),this._changes.updatePaintProperties(r)}getPaintProperty(t,e){const i=this._checkLayer(t);if(i)return i.getPaintProperty(e)}setFeatureState(e,i){if(this._checkLoaded(),"target"in e){if("featuresetId"in e.target){const{featuresetId:t,importId:n}=e.target,o=this.getFragmentStyle(n),r=o.getFeaturesetLayers(t);for(const{source:s,sourceLayer:a}of r)o.setFeatureState({id:e.id,source:s,sourceLayer:a},i)}else if("layerId"in e.target){const{layerId:t}=e.target,n=this.getLayer(t);this.setFeatureState({id:e.id,source:n.source,sourceLayer:n.sourceLayer},i)}return}const n=e.source,o=e.sourceLayer,r=this._checkSource(n);if(!r)return;const s=r.type;if("geojson"===s&&o)return void this.fire(new t.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!o)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.y(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.setFeatureState(o,e.id,i)}removeFeatureState(e,i){if(this._checkLoaded(),"target"in e){if("featuresetId"in e.target){const{featuresetId:t,importId:n}=e.target,o=this.getFragmentStyle(n),r=o.getFeaturesetLayers(t);for(const{source:s,sourceLayer:a}of r)o.removeFeatureState({id:e.id,source:s,sourceLayer:a},i)}else if("layerId"in e.target){const{layerId:t}=e.target,n=this.getLayer(t);this.removeFeatureState({id:e.id,source:n.source,sourceLayer:n.sourceLayer},i)}return}const n=e.source,o=this._checkSource(n);if(!o)return;const r=o.type,s="vector"===r?e.sourceLayer:void 0;if("vector"===r&&!s)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.y(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.removeFeatureState(s,e.id,i)}getFeatureState(e){if(this._checkLoaded(),"target"in e){let i;if("featuresetId"in e.target){const{featuresetId:n,importId:o}=e.target,r=this.getFragmentStyle(o),s=r.getFeaturesetLayers(n);for(const{source:a,sourceLayer:l}of s){const n=r.getFeatureState({id:e.id,source:a,sourceLayer:l});if(n&&!i)i=n;else if(!t.bn(i,n))return void this.fire(new t.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in e.target){const{layerId:t}=e.target,n=this.getLayer(t);i=this.getFeatureState({id:e.id,source:n.source,sourceLayer:n.sourceLayer})}return i}const i=e.source,n=e.sourceLayer,o=this._checkSource(i);if(o){if("vector"!==o.type||n)return void 0===e.id&&this.fire(new t.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(n,e.id);this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=t.l({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return t.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return t.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateFilteredLayers(t){for(const e of Object.values(this._mergedLayers))t(e)&&this._updateLayer(e)}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),n=t.aC(e.source,e.scope),o=this._changes.getUpdatedSourceCaches();e.source&&!o[n]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(n,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>this._mergedLayers[t].is3D(),i=this.order,n={},o=[];for(let s=i.length-1;s>=0;s--){const r=i[s];if(e(r)){n[r]=s;for(const e of t){const t=e[r];if(t)for(const e of t)o.push(e)}}}o.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let s=i.length-1;s>=0;s--){const a=i[s];if(e(a))for(let t=o.length-1;t>=0;t--){const e=o[t].feature;if(e.layer&&n[e.layer.id]<s)break;r.push(e),o.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,i,n){let o;i&&!Array.isArray(i)&&i.filter&&(this._validate(Tt,"queryRenderedFeatures.filter",i.filter,null,i),o=t.aZ(i.filter));const r={},s=t=>{if(xn.has(t.type))return;const e=this.getOwnLayerSourceCache(t),i=r[e.id]=r[e.id]||{sourceCache:e,layers:{},has3DLayers:!1};t.is3D()&&(i.has3DLayers=!0),i.layers[t.fqid]=i.layers[t.fqid]||{styleLayer:t,targets:[]},i.layers[t.fqid].targets.push({filter:o})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.y(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.y(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];s(i)}}else for(const t in this._layers)s(this._layers[t]);const a=this._queryRenderedFeatures(e,r,n),l=this._flattenAndSortRenderedFeatures(a),u=[];for(const c of l)t.cs(c.layer.id)===this.scope&&u.push(c);return u}queryRenderedFeatureset(e,i,n){let o;i&&!Array.isArray(i)&&i.filter&&(this._validate(Tt,"queryRenderedFeatures.filter",i.filter,null,i),o=t.aZ(i.filter));const r="mock",s=[];if(i&&i.target)s.push(Object.assign({},i,{targetId:r,filter:o}));else{const t=this.getFeaturesetDescriptors();for(const e of t)s.push({targetId:r,filter:o,target:e});for(const{style:e}of this.fragments){const t=e.getFeaturesetDescriptors();for(const e of t)s.push({targetId:r,filter:o,target:e})}}const a=this.queryRenderedTargets(e,s,n),l=[],u=new Set;for(const c of a)for(const e of c.variants[r])ae(e,c,u)||l.push(new t.cw(c,e));return l}queryRenderedTargets(e,i,n){const o={},r=(t,e,i,n)=>{const r=o[e.id]=o[e.id]||{sourceCache:e,layers:{},has3DLayers:!1};if(r.layers[t.fqid]=r.layers[t.fqid]||{styleLayer:t,targets:[]},t.is3D()&&(r.has3DLayers=!0),!n)return i.uniqueFeatureID=!1,void r.layers[t.fqid].targets.push(i);r.layers[t.fqid].targets.push(Object.assign({},i,{namespace:n.namespace,properties:n.properties,uniqueFeatureID:n.uniqueFeatureID}))};for(const a of i)if("featuresetId"in a.target){const{featuresetId:e,importId:i}=a.target,n=this.getFragmentStyle(i);if(!n||!n._featuresetSelectors)continue;const o=n._featuresetSelectors[e];if(!o){this.fire(new t.y(new Error(`The featureset '${e}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const t of o){const e=n.getOwnLayer(t.layerId);e&&!xn.has(e.type)&&r(e,n.getOwnLayerSourceCache(e),a,t)}}else if("layerId"in a.target){const{layerId:t}=a.target,e=this.getLayer(t);if(!e||xn.has(e.type))continue;r(e,this.getLayerSourceCache(e),a)}const s=this._queryRenderedFeatures(e,o,n);return this._flattenAndSortRenderedFeatures(s)}_queryRenderedFeatures(t,e,i){const n=[],o=!!this.map._showQueryGeometry,r=Kt.createFromScreenPoints(t,i);for(const s in e){const t=le(r,e[s],this._availableImages,i,o);Object.keys(t).length&&n.push(t)}if(this.placement)for(const s in e){if(!e[s].sourceCache._onlySymbols)continue;const t=ue(r.screenGeometry,e[s],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(t).length&&n.push(t)}return n}querySourceFeatures(t,e){const i=e&&e.filter;i&&this._validate(Tt,"querySourceFeatures.filter",i,null,e);let n=[];const o=this.getOwnSourceCaches(t);for(const r of o)n=n.concat(ce(r,e));return n}addSourceType(t,e,i){return wn.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(wn.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const o=this.light.getLight();let r=!1;for(const a in e)if(!t.bn(e[a],o[a])){r=!0;break}if(!r)return;const s=this._getTransitionParameters();this.light.setLight(e,i,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=t.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!e)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===i&&delete this.terrain,null===e?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=e;const o=null==e.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=t.cp(n),n=t.l(n,{source:e})}const e=t.l({},n),i={};if(this.terrain&&o){e.source=this.terrain.get().source;const t=this.terrain?this.getFragmentStyle(this.terrain.scope):null;t&&(i.style=t.serialize())}if(this._validate(xt,"terrain",e,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&i!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,i),this.fire(new t.z("data",{dataType:"style"}))}else{const i=this.terrain,o=i.get();for(const e of Object.keys(t.a3.terrain))!n.hasOwnProperty(e)&&t.a3.terrain[e].default&&(n[e]=t.a3.terrain[e].default);for(const n in e)if(!t.bn(e[n],o[n])){i.set(e,this.options),this.stylesheet.terrain=e;const n=this._getTransitionParameters({duration:0});i.updateTransitions(n),this.fire(new t.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new Vt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_createSnow(t){const e=this.snow=new qt(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_createRain(t){const e=this.rain=new Zt(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!t.bn(i.get(),e)){i.set(e,this.options),this.stylesheet.fog=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(e){if(this._checkLoaded(),!e)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!t.bn(i.get(),e)){i.set(e,this.options),this.stylesheet.snow=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createSnow(e);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(e){if(this._checkLoaded(),!e)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!t.bn(i.get(),e)){i.set(e,this.options),this.stylesheet.rain=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createRain(e);this._markersNeedUpdate=!0}_reloadColorTheme(){const e=()=>{for(const t in this._layers)this._layers[t].lut=this._styleColorTheme.lut;for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void e();const n=this._evaluateColorThemeData(i);this._loadColorTheme(n).then((()=>{this.fire(new t.z("colorthemeset")),e()})).catch((e=>{t.w(`Couldn't set color theme: ${e}`)}))}setColorTheme(e){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&t.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=e,this._reloadColorTheme()}setImportColorTheme(t,e){const i=this.getFragmentStyle(t);i&&(i._styleColorTheme.colorThemeOverride=e,i._reloadColorTheme())}_getTransitionParameters(e){return{now:t.q.now(),transition:t.l(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const i of this._mergedOrder)this.isLayerDraped(this._mergedLayers[i])?t.push(i):e.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new Dt(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,n,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(r&&!1===r.validate)return!1;const s=t.l({},this.serialize());return yn(this,e.call(gt,t.l({key:i,style:s,value:n,styleSpec:t.a3},o)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const i of e)i.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const i of e)i.resume(),i.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let e;this.directionalLight&&(e=an(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,n,o,r,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,u=!1;const c={},h={};for(const d of this._mergedOrder){const e=this._mergedLayers[d];if("symbol"!==e.type)continue;const n=t.aC(e.source,e.scope);let o=c[n];if(!o){const t=this.getLayerSourceCache(e);if(!t)continue;const i=t.getRenderableIds(!0).map((e=>t.getTileByID(e)));h[n]=i.slice(),o=c[n]=i.sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(e,o,i.center.lng,i.projection);l=l||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===o,this._layerOrderChanged&&this.fire(new t.z("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.q.now(),i.zoom))&&(this.pauseablePlacement=new Pi(i,this._mergedOrder,a,n,o,r,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,c,h,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.q.now()),u=!0),l&&this.pauseablePlacement.placement.setStale()),u||l){this._buildingIndex.onNewFrame(i.zoom);for(let e=0;e<this._mergedOrder.length;e++){const i=this._mergedLayers[this._mergedOrder[e]];if("symbol"!==i.type)continue;const n=this.isLayerClipped(i);this.placement.updateLayerOpacities(i,c[t.aC(i.source,i.scope)],e,n?s:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(e,i){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex((t=>{let{id:i}=t;return i===e.id})))return void this.fire(new t.y(new Error(`Import with id '${e.id}' already exists in the map's style.`)));if(!i)return n.push(e),this._loadImports([e],!0);const o=n.findIndex((t=>{let{id:e}=t;return e===i}));return-1===o&&this.fire(new t.y(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=n.slice(0,o).concat(e).concat(n.slice(o)),this._loadImports([e],!0,i)}updateImport(e,i){this._checkLoaded();const n=this.stylesheet.imports||[],o=this.getImportIndex(e);return-1===o?this:"string"==typeof i?(this.setImportUrl(e,i),this):(i.url&&i.url!==n[o].url&&this.setImportUrl(e,i.url),t.bn(i.config,n[o].config)||this.setImportConfig(e,i.config,i.data.schema),t.bn(i.data,n[o].data)||this.setImportData(e,i.data),this)}moveImport(t,e){this._checkLoaded();let i=this.stylesheet.imports||[];const n=this.getImportIndex(t);if(-1===n)return this;const o=this.getImportIndex(e);if(-1===o)return this;const r=i[n],s=this.fragments[n];return i=i.filter((e=>{let{id:i}=e;return i!==t})),this.fragments=this.fragments.filter((e=>{let{id:i}=e;return i!==t})),this.stylesheet.imports=i.slice(0,o).concat(r).concat(i.slice(o)),this.fragments=this.fragments.slice(0,o).concat(s).concat(this.fragments.slice(o)),this.mergeLayers(),this}setImportUrl(t,e){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(t);if(-1===n)return this;i[n].url=e;const o=this.fragments[n];return o.style=this._createFragmentStyle(i[n]),o.style.on("style.import.load",(()=>this.mergeAll())),o.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const i=this.getImportIndex(t),n=this.stylesheet.imports||[];return-1===i?this:e?(this.fragments[i].style.setState(e),this._reloadImports(),this):(delete n[i].data,this.setImportUrl(t,n[i].url))}setImportConfig(t,e,i){this._checkLoaded();const n=this.getImportIndex(t),o=this.stylesheet.imports||[];if(-1===n)return this;e?o[n].config=e:delete o[n].config;const r=this.fragments[n];i&&r.style.stylesheet&&(r.style.stylesheet.schema=i);const s=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=e,r.style.updateConfig(e,s),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],i=this.getImportIndex(t);-1!==i&&(e.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports())}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===i&&this.fire(new t.y(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[e];i&&t.push(i.getSource())}return t}getSource(t,e){const i=this.getSourceCache(t,e);return i&&i.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(e,i){const n=t.aC(e,i);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const i=t.aC(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(null==t)return Object.values(this._mergedSourceCaches);const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const i=t[e];"reload"===i?this.reloadSource(e):"clear"===i&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const i of e){const e=this.getLayer(i);e&&e.updateTransitions(t)}}getImages(t,e,i){this.imageManager.getImages(e.icons,e.scope,i),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}rasterizeImages(t,e,i){this.imageManager.rasterizeImages(e,i)}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,e.scope,i)}getResource(e,i,n){return t.cy(i,n)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return 0===i.length?(this.fire(new t.y(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,e){if(!this._clipLayerPresent&&"fill-extrusion"!==t.type)return!1;const i="fill-extrusion"===t.type&&"building"===t.sourceLayer;if(t.is3D()){if(i||e&&"batched-model"===e.type)return!0;if("model"===t.type)return!0}else if("symbol"===t.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wn.getSourceType=function(t){return oe[t]},wn.setSourceType=function(t,e){oe[t]=e},wn.registerForPluginStateChange=t.ch;var Sn="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Tn="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",An="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Mn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",In="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",En="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Pn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",kn="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Bn="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Dn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Rn="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Ln=[];Vn(Sn,Ln),Vn(An,Ln),Vn(Tn,Ln);const zn={"_prelude_fog.vertex.glsl":En,"_prelude_terrain.vertex.glsl":In,"_prelude_shadow.vertex.glsl":Dn,"_prelude_fog.fragment.glsl":Pn,"_prelude_shadow.fragment.glsl":Rn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":kn,"_prelude_raster_particle.glsl":Bn},On={};Hn("",In),Hn(Pn,En),Hn(Rn,Dn),Hn(kn,""),Hn(Bn,"");const Un=Hn(Tn,An),Fn=Sn;var Nn={background:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Hn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Hn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Hn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Hn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Hn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Hn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Hn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Hn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Hn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Hn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Hn('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Hn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#else\nz+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#endif\n}'),terrainRaster:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Hn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Hn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Mn),skyboxGradient:Hn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Mn),skyboxCapture:Hn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Hn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Hn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Hn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:Hn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:Hn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:Hn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Hn("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Vn(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let n of i)if(n=n.trim(),"#"===n[0]&&n.includes("if")&&!n.includes("endif")){n=n.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const t=n.split(" ");for(const i of t)e.includes(i)||e.push(i)}}function Hn(t,e){const i=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let o=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);o&&(o=o.map((t=>{const e=t.split(" ");return e[e.length-1]})),o=[...new Set(o)]);const r={},s=[],a=[];if(t=t.replace(i,((t,e)=>(a.push(e),""))),(e=e.replace(i,((t,e)=>(s.push(e),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Ln];Vn(t,l),Vn(e,l);for(const u of[...s,...a])zn[u]||console.error(`Undefined include: ${u}`),On[u]||(On[u]=[],Vn(zn[u],On[u])),l=[...l,...On[u]];return{fragmentSource:t=t.replace(n,((t,e,i,n,o)=>(r[o]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nin ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${o}\n    in ${i} ${n} ${o};\n#endif\n`:"initialize-attribute"===e?"":void 0))),vertexSource:e=e.replace(n,((t,e,i,n,o)=>{const s="float"===n?"vec2":n,a=o.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${o}\nin ${i} ${n} a_${o};\n#endif\n`:r[o]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nin ${i} ${s} a_${o};\nout ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"initialize"===e?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${o}\n    in ${i} ${n} a_${o};\n    out ${i} ${n} ${o};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${o}\n    ${o} = a_${o};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nin ${i} ${s} a_${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"define-instanced"===e?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${o}0;\nin vec4 a_${o}1;\nin vec4 a_${o}2;\nin vec4 a_${o}3;\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${s} a_${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${o}\n    ${i} ${n} ${o} = a_${o};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`})),staticAttributes:o,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class jn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,n,o,r,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==n.length;for(let c=0;!l&&c<n.length;c++)this.boundPaintVertexBuffers[c]!==n[c]&&(l=!0);let u=this.boundDynamicVertexBuffers.length!==s.length;for(let c=0;!u&&c<s.length;c++)this.boundDynamicVertexBuffers[c]!==s[c]&&(u=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||u||this.boundIndexBuffer!==o||this.boundVertexOffset!==r)this.freshBind(e,i,n,o,r,s,a);else{t.bindVertexArrayOES.set(this.vao);for(const i of s)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(t.gl,e,a));o&&o.dynamicDraw&&o.bind()}}freshBind(t,e,i,n,o,r,s){const a=t.numAttributes,l=this.context,u=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=o,this.boundDynamicVertexBuffers=r,e.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,o);for(const c of i)c.enableAttributes(u,t),c.bind(),c.setVertexAttribPointers(u,t,o);for(const c of r)c&&(c.enableAttributes(u,t),c.bind(),c.setVertexAttribPointers(u,t,o),s&&c.instanceCount&&c.setVertexAttribDivisor(u,t,s));n&&n.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Gn(e,i){const n=Math.pow(2,i.canonical.z),o=i.canonical.y;return[new t.aa(0,o/n).toLngLat().lat,new t.aa(0,(o+1)/n).toLngLat().lat]}function Wn(e,i,n,o,r,s,a){const l=e.context,u=l.gl,c=n.hillshadeFBO;if(!c)return;e.prepareDrawTile();const h=e.isTileAffectedByFog(i),d=e.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());const f=((e,i,n,o)=>{const r=n.paint.get("hillshade-shadow-color"),s="none"===n.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=n.paint.get("hillshade-highlight-color"),l="none"===n.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),u=n.paint.get("hillshade-accent-color"),c="none"===n.paint.get("hillshade-accent-color-use-theme").constantOr("default"),h=n.paint.get("hillshade-emissive-strength");let d=t.ai(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))d-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const i=e.style.directionalLight.properties.get("direction"),n=t.cb(i.x,i.y,i.z);d=t.ai(n[1])}const f=!e.options.moving;return{u_matrix:o||e.transform.calculateProjMatrix(i.tileID.toUnwrapped(),f),u_image:0,u_latrange:Gn(0,i.tileID),u_light:[n.paint.get("hillshade-exaggeration"),d],u_shadow:r.toRenderColor(s?null:n.lut),u_highlight:a.toRenderColor(l?null:n.lut),u_emissive_strength:h,u_accent:u.toRenderColor(c?null:n.lut)}})(e,n,o,e.terrain?i.projMatrix:null);e.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=e.getTileBoundsBuffers(n);d.draw(e,u.TRIANGLES,r,s,a,ji.disabled,f,o.id,p,m,g)}function qn(e,i,n){if(!i.needsDEMTextureUpload)return;const o=e.context,r=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(n.stride);const s=n.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new t.T(o,s,r.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Zn(e,i,n){const o=e.context,r=o.gl;if(!i.dem)return;const s=i.dem;if(o.activeTexture.set(r.TEXTURE1),qn(e,i,s),!i.demTexture)return;i.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);const a=s.dim;o.activeTexture.set(r.TEXTURE0);let l=i.hillshadeFBO;if(!l){const e=new t.T(o,{width:a,height:a,data:null},r.RGBA8);e.bind(r.LINEAR,r.CLAMP_TO_EDGE),l=i.hillshadeFBO=o.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(e.texture)}o.bindFramebuffer.set(l.framebuffer),o.viewport.set([0,0,a,a]);const{tileBoundsBuffer:u,tileBoundsIndexBuffer:c,tileBoundsSegments:h}=e.getMercatorTileBoundsBuffers(),d=[];e.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(e,r.TRIANGLES,Ui.disabled,Ni.disabled,Oi.unblended,ji.disabled,((e,i)=>{const n=i.stride,o=t.ab.mat4.create();return t.ab.mat4.ortho(o,0,t.ag,-t.ag,0,0,1),t.ab.mat4.translate(o,o,[0,-t.ag,0]),{u_matrix:o,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ}})(i.tileID,s),n.id,u,c,h),i.needsHillshadePrepare=!1}class $n{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kn extends $n{getDefault(){return t.aj.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yn extends $n{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jn extends $n{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Xn extends $n{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qn extends $n{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class to extends $n{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class eo extends $n{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class io extends $n{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class no extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class oo extends $n{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ro extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class so extends $n{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ao extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class lo extends $n{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uo extends $n{getDefault(){return t.aj.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class co extends $n{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ho extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class fo extends $n{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class po extends $n{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let mo=class extends $n{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class go extends $n{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class yo extends $n{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _o extends $n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class vo extends $n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xo extends $n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bo extends $n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Co extends $n{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wo extends $n{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class So extends $n{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class To extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ao extends $n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Mo extends $n{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Io extends Mo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Eo extends Mo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Po extends Mo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ko extends Eo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Bo=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),Do=(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:o,u_merc_center:r,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:f,u_far_z_cutoff:p});function Ro(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const Lo=new class{constructor(){this.operations={}}newMorphing(t,e,i,n,o){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:n,phase:0,duration:o,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},zo={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Oo(t,e,i){if(0===e)return 0;const n=e<1&&514===i?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*n}function Uo(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const Fo=t=>({u_matrix:t});function No(e,i,n,o,r){if(r>0){const s=t.q.now(),a=(s-e.timeAdded)/r,l=i?(s-i.timeAdded)/r:-1,u=n.getSource(),c=o.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),d=h&&e.refreshedUponExpiration?1:t.aw(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Vo extends Te{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new t.D(t.ci(),null),o=re("mock-dem",i,n,e.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class Ho extends Te{constructor(e){const i=re("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new t.D(t.ci(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,e,i){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((e,i)=>{if(e[i.key]="",!this._tiles[i.key]){const e=new be(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);e.state="loaded",this._tiles[i.key]=e}return e}),{});for(const o in this._tiles)o in n||(this.freeFBO(o),this._tiles[o].unloadVectorData(),delete this._tiles[o])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class jo extends t.aG{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class Go extends t.cJ{constructor(e,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,o,r]=function(){const e=new t.b4,i=new t.aU,n=131;e.reserve(17161),i.reserve(33800);const o=t.ag/128,r=t.ag+o/2,s=r+o;for(let l=-o;l<s;l+=o)for(let i=-o;i<s;i+=o){const n=i<0||i>r||l<0||l>r?24575:0,o=t.aw(Math.round(i),0,t.ag),s=t.aw(Math.round(l),0,t.ag);e.emplaceBack(o+n,s)}const a=(t,e)=>{const o=e*n+t;i.emplaceBack(o+1,o,o+n),i.emplaceBack(o+n,o+n+1,o+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)a(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)a(e,t),a(t,e)})),[e,i,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(n,t.b6.members),this.gridIndexBuffer=s.createIndexBuffer(o),this.gridSegments=t.b7.simpleSegment(0,0,n.length,o.length),this.gridNoSkirtSegments=t.b7.simpleSegment(0,0,n.length,r),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ho(i.map),this.orthoMatrix=t.ab.mat4.create(),t.ab.mat4.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.ag,0,t.ag,0,1);const a=s.gl;this._overlapStencilMode=new Ni({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vo(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,i,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const o=e.terrain.properties,r=0===e.terrain.drapeRenderMode,s=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.q.now();const a=e.terrain&&e.terrain.scope,l=o.get("source"),u=r?this._mockSourceCache:e.getSourceCache(l,a);if(!u)return void t.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=u,this._attenuationRange=e.terrain.getAttenuationRange(),this._exaggeration=s?this.calculateExaggeration(i):o.get("exaggeration"),!i.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const c=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){if(this._attenuationRange&&e.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(e.zoom);const i=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const o=null!=i?n-i:Number.MAX_VALUE;if(Math.abs(o)<2)return this._exaggeration;const r=e.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(r);let a=r-this._previousZoom;const l=this._previousUpdateTimestamp;let u=r;null!=this._evaluationZoom&&(u=this._evaluationZoom,Math.abs(r-u)>.5&&(a=.5*(r-u+a)),a*o<0&&(u+=a)),this._evaluationZoom=u;const c=s.getExaggeration(u),h=c===s.getExaggeration(Math.max(0,u-.1));if(h&&Math.abs(c-this._exaggeration)<.01)return c;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||c<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),t.af(this._exaggeration,c,d)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t.aa.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const o=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),o=new t.P(n.x,n.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const n=new t.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),r=new t.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=o.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(r)}))}(o,this.painter);const r=this.proxyToSource||{};this.proxyToSource={},o.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const t in s){const i=s[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],r),i.usedForTerrain)continue;const n=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=o.map((t=>new jo(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(o),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(r),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],o=n.dem;!o||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),qn(this.painter,n,o))}}_prepareDemTileUniforms(t,e,i,n){if(!e||null==e.demTexture)return!1;const o=t.tileID.canonical,r=Math.pow(2,e.tileID.canonical.z-o.z),s=n||"";return i[`u_dem_tl${s}`]=[o.x*r%1,o.y*r%1],i[`u_dem_scale${s}`]=r,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const n=i.dem.tree.minimums[0];return n>0&&t++,e+n}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),o=new t.cK({width:1,height:1},new Float32Array([n]));this._emptyDEMTextureDirty=!1;let r=this._emptyDEMTexture;return r?r.update(o,{premultiply:!1}):r=this._emptyDEMTexture=new t.T(e,o,i.R32F,{premultiply:!1}),r}setupElevationDraw(e,i,n){const o=this.painter.context,r=o.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,u=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;u=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(l=t),this._prepareDemTileUniforms(e,i,s)&&(a=i))}const c=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?r.LINEAR:r.NEAREST;let h=null;var d;if(this.enabled?l&&a?(h=a.demTexture,o.activeTexture.set(r.TEXTURE4),l.demTexture.bind(c(l),r.CLAMP_TO_EDGE),s.u_dem_lerp=u):(a=this.terrainTileForTile[e.tileID.key],h=this._prepareDemTileUniforms(e,a,s)?a.demTexture:this.emptyDEMTexture):h=this.emptyDEMTexture,o.activeTexture.set(r.TEXTURE2),h&&(s.u_dem_size=1===(d=h).size[0]?1:d.size[0]-2,h.bind(c(a),r.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(n&&n.useDepthForOcclusion,i,s),n&&n.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*t.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(o,s),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(o,t)}}globeUniformValues(e,i,n){const o=e.projection;return{u_tile_tl_up:o.upVector(i,0,0),u_tile_tr_up:o.upVector(i,t.ag,0),u_tile_br_up:o.upVector(i,t.ag,t.ag),u_tile_bl_up:o.upVector(i,0,t.ag),u_tile_up_scale:n?t.cL(1):o.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,n,o,r){if("globe"===e.transform.projection.name)!function(e,i,n,o,r){const s=e.context,a=s.gl;let l,u;const c=e.transform,h=t.cC(e,s,c),d=(t,i)=>{if(u===i)return;const n=[zo[i],"PROJECTION_GLOBE_VIEW"];h&&n.push("CUSTOM_ANTIALIASING");const o=e.isTileAffectedByFog(t);l=e.getOrCreateProgram("globeRaster",{defines:n,overrideFog:o}),u=i},f=e.colorModeForRenderPass(),p=new Ui(a.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D);Lo.update(r);const m=t.cD(c),g=[t.at(c.center.lng),t.aA(c.center.lat)],y=e.globeSharedBuffers,_=[c.width*t.q.devicePixelRatio,c.height*t.q.devicePixelRatio],v=Float32Array.from(c.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const c=e.transform,h=Oo(c.zoom,i.exaggeration(),i.sourceCache._source.tileSize);u=-1;const b=a.TRIANGLES;for(const u of o){const o=n.getTile(u),C=Ni.disabled,w=i.prevTerrainTileForTile[u.key],S=i.terrainTileForTile[u.key];Ro(w,S)&&Lo.newMorphing(u.key,w,S,r,250),s.activeTexture.set(a.TEXTURE0),o.texture&&o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=Lo.getMorphValuesForProxy(u.key),A=T?1:0;T&&t.J(x,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.cB(T.phase)}});const M=t.cE(u.canonical),I=t.cF(M.getCenter().lat),E=t.cG(u.canonical,M,I,c.worldSize/c._pixelsPerMercatorPixel),P=t.bb(t.cH(u.canonical)),k=Do(c.expandedFarZProjMatrix,v,m,P,t.ae(c.zoom),g,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,_,h,c._farZ,E);if(d(u,A),l&&(i.setupElevationDraw(o,l,x),e.uploadCommonUniforms(s,l,u.toUnwrapped()),y)){const[t,i,n]=y.getGridBuffers(I,0!==h);l.draw(e,b,p,C,f,ji.backCCW,k,"globe_raster",t,i,n)}}}if(y&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const r=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&r.push("CUSTOM_ANTIALIASING"),l=e.getOrCreateProgram("globeRaster",{defines:r});for(const u of o){const{x:o,y:r,z:h}=u.canonical,d=0===r,m=r===(1<<h)-1,[v,b,C,w]=y.getPoleBuffers(h,!1);if(w&&(d||m)){const r=n.getTile(u);s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let y=t.cI(h,o,c);const S=t.bb(t.cH(u.canonical)),T=(t,i)=>t.draw(e,a.TRIANGLES,p,Ni.disabled,f,ji.disabled,Do(c.expandedFarZProjMatrix,y,y,S,0,g,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,_,0,c._farZ),"globe_pole_raster",i,C,w);i.setupElevationDraw(r,l,x),e.uploadCommonUniforms(s,l,u.toUnwrapped()),d&&e.renderDefaultNorthPole&&T(l,v),m&&e.renderDefaultSouthPole&&(y=t.ab.mat4.scale(t.ab.mat4.create(),y,[1,-1,1]),T(l,b))}}}}(e,i,n,o,r);else{const s=e.context,a=s.gl;let l,u;const c=e.shadowRenderer,h=tn(e,e.longestCutoffRange),d=t=>{if(u===t)return;const i=[];i.push(zo[t]),h.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),c&&(i.push("RENDER_SHADOWS","DEPTH_TEXTURE"),c.useNormalOffset&&i.push("NORMAL_OFFSET")),l=e.getOrCreateProgram("terrainRaster",{defines:i}),u=t},f=e.colorModeForRenderPass(),p=new Ui(a.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D);Lo.update(r);const m=e.transform,g=Oo(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let y=[0,0,0];if(c){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(y=ln(e.style,t,i))}{u=-1;const _=a.TRIANGLES,[v,x]=[i.gridIndexBuffer,i.gridSegments];for(const u of o){const o=n.getTile(u),b=Ni.disabled,C=i.prevTerrainTileForTile[u.key],w=i.terrainTileForTile[u.key];Ro(C,w)&&Lo.newMorphing(u.key,C,w,r,250),s.activeTexture.set(a.TEXTURE0),o.texture&&o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=Lo.getMorphValuesForProxy(u.key),T=S?1:0;let A;S&&(A={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:t.cB(S.phase)}});const M=Bo(u.projMatrix,Uo(u.canonical,m.renderWorldCopies)?g/10:g,y);if(d(T),!l)continue;i.setupElevationDraw(o,l,A);const I=u.toUnwrapped();c&&c.setupShadows(I,l),e.uploadCommonUniforms(s,l,I,null,h),l.draw(e,_,p,b,f,ji.backCCW,M,"terrain_raster",i.gridBuffer,v,x)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,o=this.proxySourceCache,r=this.proxiedCoords[o.id],s=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let u=0;for(const c of r){const r=o.getTileByID(c.proxyTileKey),h=o.proxyCachedFBO[c.key]?o.proxyCachedFBO[c.key][e]:void 0,d=void 0!==h?o.renderCache[h]:this.pool[u++],f=void 0!==h;if(r.texture=d.tex,f&&!d.dirty){l.push(r.tileID);continue}let p;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:t.aj.transparent,stencil:0}),d.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const o=i.style.getLayerSourceCache(e),r=o?this.proxyToSource[c.key][o.id]:[c];if(!r)continue;const s=r;n.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(o?o.id:null)&&(this._setupStencil(d,r,e,o),p=o?o.id:null),i.renderLayer(i,o,e,s)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const o=i.style.getLayerSourceCache(e),r=o?this.proxyToSource[c.key][o.id]:[c];if(!r)continue;const s=r;n.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(o?o.id:null)&&(this._setupStencil(d,r,e,o),p=o?o.id:null),i.renderLayer(i,o,e,s)}this.renderedToTile?(d.dirty=!0,l.push(r.tileID)):f||--u,5===u&&(u=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let i=-1,n=e;for(let o=0;o<e;++o)this._style.isLayerDraped(t._mergedLayers[t.order[o]])?i=Math.max(i,o):n=Math.min(n,o);return n>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((t=>t.dem)).map((n=>{const o=n.tileID,r=1<<o.overscaledZ,{x:s,y:a}=o.canonical,l=s/r,u=(s+1)/r,c=a/r,h=(a+1)/r;return{minx:l,miny:c,maxx:u,maxy:h,t:n.dem.tree.raycastRoot(l,c,u,h,t,e,i),tile:n}}));n.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const o of n){if(null==o.t)return null;const n=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,t,e,i);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,i=e.gl,n=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const o=new t.T(e,{width:n[0],height:n[1],data:null},i.RGBA8);o.bind(i.LINEAR,i.CLAMP_TO_EDGE);const r=e.createFramebuffer(n[0],n[1],!0,null);return r.colorAttachment.set(o.texture),r.depthAttachment=new ko(e,r.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,r.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):r.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:r,tex:o,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._mergedLayers[t],i=e.isHidden(this.painter.transform.zoom);return"hillshade"===e.type||"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof ee){e=!0;break}if(!e)return;const i={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],o=this._style.getLayerSourceCache(e);if(o&&!i[o.id]&&!e.isHidden(this.painter.transform.zoom)&&"line"===e.type&&e.widthExpression()instanceof t.a9){i[o.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][o.id];if(e)for(const t of e)this._clearRenderCacheForTile(o.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof ie){t=!0;break}if(!t)return;const e={};for(let i=0;i<this._style.order.length;++i){const t=this._style._mergedLayers[this._style.order[i]],n=this._style.getLayerSourceCache(t);if(!n||e[n.id])continue;if(t.isHidden(this.painter.transform.zoom)||"raster"!==t.type)continue;const o=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=No(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,o);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const e=this._style.order,i=e.length;if(0===i)return;const n=[];this._pendingGroundEffectLayers=[];let o,r=0,s=this._style._mergedLayers[e[r]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++r<i;)s=this._style._mergedLayers[e[r]];for(;r<i;++r){const t=this._style._mergedLayers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===o&&(o=r):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(r),void 0!==o&&(n.push({start:o,end:r-1}),o=void 0)))}if(void 0!==o&&n.push({start:o,end:r-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const n=Object.values(t[i]);e.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],r=this.proxyToSource[o.key];let s=0;for(const t in r){const e=r[t],o=i[t];if(!o||o.length!==e.length||e.some(((e,i)=>e!==o[i]||n[t]&&n[t].hasOwnProperty(e.key)))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const o=[...this._drapedRenderBatches];o.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const r of o)for(const t of i){if(e.proxyCachedFBO[t.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[t.key]={},e.proxyCachedFBO[t.key][r.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const o=this.painter.context,r=o.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:r.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:r.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(o.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ni.disabled}_renderTileClippingMasks(t,e){const i=this.painter,n=this.painter.context,o=n.gl;i._tileClippingMaskIDs={},n.setColorMode(Oi.disabled),n.setDepthMode(Ui.disabled);const r=i.getOrCreateProgram("clippingMask");for(const s of t){const t=i._tileClippingMaskIDs[s.key]=--e;r.draw(i,o.TRIANGLES,Ui.disabled,new Ni({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),Oi.disabled,ji.disabled,Fo(s.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const n=[e.x,e.y,1,1];t.ab.vec4.transformMat4(n,n,i.pixelMatrixInverse),t.ab.vec4.scale(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const o=i._camera.position,r=t.bH(1,i.center.lat),s=[o[0],o[1],o[2]/r,0],a=t.ab.vec3.subtract([],n.slice(0,3),s);t.ab.vec3.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.ab.vec3.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=r,s):null}_setupProxiedCoordsForOrtho(e,i,n){if(e.getSource()instanceof t.aJ)return this._setupProxiedCoordsForImageSource(e,i,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const o=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const i=r[t],s=this._findTileCoveringTileID(i,e);if(s){const t=this._createProxiedId(i,s,n[i.key]&&n[i.key][e.id]);o.push(t),this.proxyToSource[i.key][e.id]=[t]}}let s=!1;const a=new Set;for(let t=0;t<i.length;t++){const r=e.getTile(i[t]);if(!r||!r.hasData())continue;const l=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==r.tileID.canonical.z){const t=this.proxyToSource[l.tileID.key][e.id],i=this._createProxiedId(l.tileID,r,n[l.tileID.key]&&n[l.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[l.tileID.key][e.id]=[i];const u=this.proxyToSource[l.tileID.key][e.id];a.has(u)||a.add(u),o.push(i),s=!0}}if(this._sourceTilesOverlap[e.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const t of a)t.sort(((t,e)=>e.overscaledZ-t.overscaledZ))}_setupProxiedCoordsForImageSource(e,i,n){if(!e.getSource().loaded())return;const o=this.proxiedCoords[e.id]=[],r=this.proxyCoords,s=e.getSource(),a=s.tileID;if(!a)return;const l=new t.P(a.x,a.y)._div(1<<a.z),u=s.coordinates.map(t.aa.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-l.x),t.min.y=Math.min(t.min.y,e.y-l.y),t.max.x=Math.max(t.max.x,e.x-l.x),t.max.y=Math.max(t.max.y,e.y-l.y),t)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,i)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),o=e.canonical.y/(1<<e.canonical.z),r=t.ag/(1<<e.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+r<s+u.min.x||n>s+u.max.x||o+r<a+u.min.y||o>a+u.max.y};for(let t=0;t<r.length;t++){const s=r[t];for(let t=0;t<i.length;t++){const r=e.getTile(i[t]);if(!r||!r.hasData())continue;if(c(s,r.tileID))continue;const a=this._createProxiedId(s,r,n[s.key]&&n[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],o.push(a)}}}_createProxiedId(e,i,n){let o=this.orthoMatrix;if(n){const t=n.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const n=e.canonical.z-i.tileID.canonical.z;let r,s,a;o=t.ab.mat4.create();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(r=t.ag>>n,s=r*((i.tileID.canonical.x<<n)-e.canonical.x+l),a=r*((i.tileID.canonical.y<<n)-e.canonical.y)):(r=t.ag<<-n,s=t.ag*(i.tileID.canonical.x-(e.canonical.x+l<<-n)),a=t.ag*(i.tileID.canonical.y-(e.canonical.y<<-n))),t.ab.mat4.ortho(o,0,r,0,r,0,1),t.ab.mat4.translate(o,o,[s,a,0])}return new jo(i.tileID,e.key,o)}_findTileCoveringTileID(e,i){let n=i.getTile(e);if(n&&n.hasData())return n;const o=this._findCoveringTileCache[i.id],r=o[e.key];if(n=r?i.getTileByID(r):null,n&&n.hasData()||null===r)return n;let s=n?n.tileID:e,a=s.overscaledZ;const l=i.getSource().minzoom,u=[];if(!r){const o=i.getSource().maxzoom;if(e.canonical.z>=o){const n=e.canonical.z-o;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),s=new t.aG(a,e.wrap,o,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=o,s=new t.aG(a,e.wrap,o,e.canonical.x>>n,e.canonical.y>>n))}s.key!==e.key&&(u.push(s.key),n=i.getTile(s))}const c=t=>{u.forEach((e=>{o[e]=t})),u.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&c(n.tileID.key);const t=s.calculateScaledKey(a);if(n=i.getTileByID(t),n&&n.hasData())break;const e=o[t];if(null===e)break;void 0===e?u.push(t):n=i.getTileByID(e)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}}function Wo(e,i,n){const o=function(e,i,n){const o=t.ab.vec3.dot(i,e),r=t.ab.vec3.dot(n,[.2126,.7152,.0722]),s=(t,e,i)=>(1-i)*t+i*e,a=s(1-.3*Math.min(r,1),1,Math.min(o+1,1));return s(.92,1,Math.asin(t.aw(i[2],-1,1))/Math.PI+.5)*a}(e,[0,0,1],i),r=[0,0,0];t.ab.vec3.scale(r,n.slice(0,3),o);const s=[0,0,0];t.ab.vec3.scale(s,i.slice(0,3),e[2]);const a=[0,0,0];return t.ab.vec3.add(a,r,s),t.cf(a)}const qo=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Zo=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class $o{static cacheKey(t,e,i,n){let o=`${e}${n?n.cacheKey:""}`;for(const r of i)t.usedDefines.includes(r)&&(o+=`/${r}`);return o}constructor(e,i,n,o,r,s){const a=e.gl;this.program=a.createProgram(),this.configuration=o,this.name=i,this.fixedDefines=[...s];const l=o?o.getBinderAttributes():[],u=(n.staticAttributes||[]).concat(l);let c=o?o.defines():[];c=c.concat(s.map((t=>`#define ${t}`)));const h="#version 300 es\n";let d=h+c.concat("precision mediump float;",Fn,Un.fragmentSource).join("\n");for(const t of n.fragmentIncludes)d+=`\n${zn[t]}`;d+=`\n${n.fragmentSource}`;let f=h+c.concat("precision highp float;",Fn,Un.vertexSource).join("\n");for(const t of n.vertexIncludes)f+=`\n${zn[t]}`;this.forceManualRenderingForInstanceIDShaders=e.forceManualRenderingForInstanceIDShaders&&-1!==n.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(f+="\nuniform int u_instanceID;\n"),f+=`\n${n.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(f=f.replaceAll("gl_InstanceID","u_instanceID"));const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,d),a.compileShader(p),a.attachShader(this.program,p);const m=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(m,f),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)if(u[t]){const e=u[t].startsWith("a_")?u[t]:`a_${u[t]}`;a.bindAttribLocation(this.program,t,e),this.attributes[e]=t}a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(p),this.fixedUniforms=r(e),this.binderUniforms=o?o.getUniforms(e):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(e=>({u_instanceID:new t.bN(e)}))(e)),(s.includes("TERRAIN")||-1!==i.indexOf("symbol")||-1!==i.indexOf("circle"))&&(this.terrainUniforms=(e=>({u_dem:new t.bN(e),u_dem_prev:new t.bN(e),u_dem_tl:new t.bK(e),u_dem_scale:new t.bM(e),u_dem_tl_prev:new t.bK(e),u_dem_scale_prev:new t.bM(e),u_dem_size:new t.bM(e),u_dem_lerp:new t.bM(e),u_exaggeration:new t.bM(e),u_depth:new t.bN(e),u_depth_size_inv:new t.bK(e),u_depth_range_unpack:new t.bK(e),u_occluder_half_size:new t.bM(e),u_occlusion_depth_offset:new t.bM(e),u_meter_to_dem:new t.bM(e),u_label_plane_matrix_inv:new t.bJ(e)}))(e)),s.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.bL(e),u_tile_tr_up:new t.bL(e),u_tile_br_up:new t.bL(e),u_tile_bl_up:new t.bL(e),u_tile_up_scale:new t.bM(e)}))(e)),s.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.bJ(e),u_fog_range:new t.bK(e),u_fog_color:new t.ca(e),u_fog_horizon_blend:new t.bM(e),u_fog_vertical_limit:new t.bK(e),u_fog_temporal_offset:new t.bM(e),u_frustum_tl:new t.bL(e),u_frustum_tr:new t.bL(e),u_frustum_br:new t.bL(e),u_frustum_bl:new t.bL(e),u_globe_pos:new t.bL(e),u_globe_radius:new t.bM(e),u_globe_transition:new t.bM(e),u_is_globe:new t.bN(e),u_viewport:new t.bK(e)}))(e)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new t.ca(e)}))(e)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new t.bL(e),u_lighting_directional_dir:new t.bL(e),u_lighting_directional_color:new t.bL(e),u_ground_radiance:new t.bL(e)}))(e)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new t.bJ(e),u_light_matrix_1:new t.bJ(e),u_fade_range:new t.bK(e),u_shadow_normal_offset:new t.bL(e),u_shadow_intensity:new t.bM(e),u_shadow_texel_size:new t.bM(e),u_shadow_map_resolution:new t.bM(e),u_shadow_direction:new t.bL(e),u_shadow_bias:new t.bL(e),u_shadowmap_0:new t.bN(e),u_shadowmap_1:new t.bN(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const n in e)i[n].set(this.program,n,e[n])}_drawDebugWireframe(e,i,n,o,r,s,a,l,u,c){const h=e.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=e.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||e._terrain&&e._terrain.renderingToTexture||!qo.includes(this.name))||!(!h.layers3D||!Zo.includes(this.name)))())return;const f=d.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,r,d);if(!p)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=e.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const y=(t,e,i)=>{if(e[t]&&i[t])for(const n in e[t])i[t][n]&&i[t][n].set(i.program,n,e[t][n].current)};u&&u.setUniforms(g.program,d,g.binderUniforms,a,{zoom:l}),y("fixedUniforms",this,g),y("terrainUniforms",this,g),y("globeUniforms",this,g),y("fogUniforms",this,g),y("lightsUniforms",this,g),y("shadowUniforms",this,g),p.bind(),d.setColorMode(new Oi([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE],t.aj.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Ui(i.func===f.LESS?f.LEQUAL:i.func,Ui.ReadOnly,i.range)),d.setStencilMode(Ni.disabled);const _=3*s.primitiveLength*2,v=3*s.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const t=c||1;for(let e=0;e<t;++e)g.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",e),f.drawElements(f.LINES,_,f.UNSIGNED_SHORT,v)}else c&&c>1?f.drawElementsInstanced(f.LINES,_,f.UNSIGNED_SHORT,v,c):f.drawElements(f.LINES,_,f.UNSIGNED_SHORT,v);r.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(n),d.setColorMode(o)}checkUniforms(t,e,i){if(this.fixedDefines.includes(e))for(const n of Object.keys(i))if(!i[n].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${n} not set but required by ${e} being defined`)}draw(t,e,i,n,o,r,s,a,l,u,c,h,d,f,p,m){const g=t.context,y=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(i),g.setStencilMode(n),g.setColorMode(o),g.setCullFace(r);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,s[x]);f&&f.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const _={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[e];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const v=m&&m>0?1:void 0;for(const x of c.get()){const r=x.vaos||(x.vaos={});if((r[a]||(r[a]=new jn)).bind(g,this,l,f?f.getPaintVertexBuffers():[],u,x.vertexOffset,p||[],v),this.forceManualRenderingForInstanceIDShaders){const t=m||1;for(let i=0;i<t;++i)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",i),u?y.drawElements(e,x.primitiveLength*_,y.UNSIGNED_SHORT,x.primitiveOffset*_*2):y.drawArrays(e,x.vertexOffset,x.vertexLength)}else m&&m>1?y.drawElementsInstanced(e,x.primitiveLength*_,y.UNSIGNED_SHORT,x.primitiveOffset*_*2,m):u?y.drawElements(e,x.primitiveLength*_,y.UNSIGNED_SHORT,x.primitiveOffset*_*2):y.drawArrays(e,x.vertexOffset,x.vertexLength);e===y.TRIANGLES&&u&&this._drawDebugWireframe(t,i,n,o,u,x,h,d,f,m)}}}function Ko(e,i){const n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,r=o*(i.tileID.canonical.x+i.tileID.wrap*n),s=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.ar(i,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,s>>16],u_pixel_coord_lower:[65535&r,65535&s]}}const Yo={terrain:0,flat:1},Jo=t.ab.mat4.create(),Xo=(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_)=>{const v=i.style.light,x=v.properties.get("position"),b=[x.x,x.y,x.z],C=t.ab.mat3.create();"viewport"===v.properties.get("anchor")&&(t.ab.mat3.fromRotation(C,-i.transform.angle),t.ab.vec3.transformMat3(b,b,C));const w=v.properties.get("color"),S=i.transform,T={u_matrix:e,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[w.r,w.g,w.b],u_vertical_gradient:+n,u_opacity:o,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jo,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Yo[c],u_base_type:Yo[h],u_ao:r,u_edge_radius:s,u_width_scale:a,u_flood_light_color:m,u_vertical_scale:g,u_flood_light_intensity:y,u_ground_shadow_factor:_};return"globe"===S.projection.name&&(T.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],T.u_zoom_transition=d,T.u_inv_rot_matrix=p,T.u_merc_center=f,T.u_up_dir=S.projection.upVector(new t.bT(0,0,0),f[0]*t.ag,f[1]*t.ag),T.u_height_lift=u),T},Qo=(t,e,i,n,o,r)=>({u_matrix:t,u_edge_radius:e,u_width_scale:i,u_vertical_scale:n,u_height_type:Yo[o],u_base_type:Yo[r]}),tr=(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y)=>{const _=Xo(e,i,n,o,r,s,a,l,c,h,d,f,p,m,g,y,1,[0,0,0]),v={u_height_factor:-Math.pow(2,l.overscaledZ)/u.tileSize/8};return t.l(_,Ko(i,u),v)},er=(t,e)=>({u_matrix:t,u_emissive_strength:e}),ir=(e,i,n,o)=>t.l(er(e,i),Ko(n,o)),nr=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),or=(e,i,n,o,r)=>t.l(ir(e,i,n,o),{u_world:r}),rr=(e,i,n,o)=>{const r=t.ag/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(o),u_extrude_scale:[i.pixelsToGLUnits[0]/r,i.pixelsToGLUnits[1]/r]}},sr=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{u_matrix:t,u_color:e.toRenderColor(null),u_overlay:0,u_overlay_scale:i}},ar=t.ab.mat4.create(),lr=(e,i,n,o,r,s,a)=>{const l=e.transform,u="globe"===l.projection.name,c=u?t.cN(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:t.ar(n,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:c,u_intensity:a,u_inv_rot_matrix:ar,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(u){h.u_inv_rot_matrix=o,h.u_merc_center=r,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=t.ae(l.zoom);const e=r[0]*t.ag,n=r[1]*t.ag;h.u_up_dir=l.projection.upVector(new t.bT(0,0,0),e,n)}return h};function ur(t,e,i){let[n,o,r,s]=e,[a,l]=i;if(a===l)return[0,0,0,0];const u=255*(t-1)/(t*(l-a));return[n*u,o*u,r*u,s*u]}function cr(t,e,i){let[n,o]=i;return n===o?0:.5/t+(e-n)*(t-1)/(t*(o-n))}const hr=(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b)=>({u_matrix:e,u_normalize_matrix:i,u_globe_matrix:n,u_merc_matrix:o,u_grid_matrix:r,u_tl_parent:s,u_scale_parent:c,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:t.cO(d.paint.get("raster-saturation")),u_contrast_factor:t.cP(d.paint.get("raster-contrast")),u_spin_weights:dr(d.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:u,u_colorization_mix:ur(t.cQ,g,_),u_colorization_offset:cr(t.cQ,y,_),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function dr(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const fr=.05,pr=(t,e,i,n,o,r,s,a,l,u,c,h)=>({u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:r,u_scale_parent:u,u_fade_t:c.mix,u_opacity:c.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),mr=(t,e,i,n,o,r,s,a,l,u)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_tile_offset:i,u_velocity:n,u_color_ramp:r,u_velocity_res:o,u_max_speed:s,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:u,u_particle_pos_scale:1.1,u_particle_pos_offset:[fr,fr]}),gr=(t,e,i,n,o,r,s,a,l,u)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_velocity:i,u_velocity_res:n,u_max_speed:o,u_speed_factor:r,u_reset_rate:s,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:u,u_particle_pos_scale:1.1,u_particle_pos_offset:[fr,fr]}),yr=t.ab.mat4.create(),_r=(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v,x,b,C)=>{const w=r.transform,S={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:w.getCameraToCenterDistance(v),u_rotate_symbol:+n,u_aspect_ratio:w.width/w.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_elevation_from_sea:u?1:0,u_pitch_with_map:+o,u_texsize:h,u_texsize_icon:d,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yr,u_up_vector:[0,-1,0],u_color_adj_mat:x,u_icon_transition:b||0,u_gamma_scale:o?r.transform.getCameraToCenterDistance(v)*Math.cos(r.terrain?0:r.transform._pitch):1,u_device_pixel_ratio:t.q.devicePixelRatio,u_is_halo:+f,u_scale_factor:C||1};return"globe"===v.name&&(S.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],S.u_zoom_transition=m,S.u_inv_rot_matrix=y,S.u_merc_center=g,S.u_camera_forward=w._camera.forward(),S.u_ecef_origin=t.cR(w.globeMatrix,p.toUnwrapped()),S.u_tile_matrix=Float32Array.from(w.globeMatrix),S.u_up_vector=_),S},vr=(t,e,i,n)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:n}),xr=(e,i,n,o,r,s,a,l,u)=>t.l(function(e,i,n,o,r,s){const{width:a,height:l}=o.imageManager.getPixelSize(i),u=Math.pow(2,s.tileID.overscaledZ),c=s.tileSize*Math.pow(2,o.transform.tileZoom)/u,h=c*(s.tileID.canonical.x+s.tileID.wrap*u),d=c*s.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[a,l],u_pattern_size:n.displaySize,u_pattern_units_to_pixels:r?[o.transform.width,-1*o.transform.height]:[1/t.ar(s,1,o.transform.tileZoom),1/t.ar(s,1,o.transform.tileZoom)],u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(0,s,a,o,l,u),{u_matrix:e,u_emissive_strength:i,u_opacity:n}),br=new Float32Array(t.ab.mat4.identity([])),Cr=function(e,i,n,o,r,s,a,l,u,c,h,d,f){let p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],m=arguments.length>14?arguments[14]:void 0;const g=r.style.light,y=g.properties.get("position"),_=[-y.x,-y.y,y.z],v=t.ab.mat3.create();"viewport"===g.properties.get("anchor")&&(t.ab.mat3.fromRotation(v,-r.transform.angle),t.ab.vec3.transformMat3(_,_,v));const x="MASK"===h.alphaMode,b=g.properties.get("color").toRenderColor(null),C=f.paint.get("model-ambient-occlusion-intensity"),w=f.paint.get("model-color").constantOr(t.aj.white).toRenderColor(null),S=f.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:i,u_normal_matrix:n,u_node_matrix:o||br,u_lightpos:_,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:p,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:[a.r,a.g,a.b,a.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:u,u_roughnessFactor:c,u_baseColorTexture:Ki.BaseColor,u_metallicRoughnessTexture:Ki.MetallicRoughness,u_normalTexture:Ki.Normal,u_occlusionTexture:Ki.Occlusion,u_emissionTexture:Ki.Emission,u_lutTexture:Ki.LUT,u_color_mix:[w.r,w.g,w.b,S],u_aoIntensity:C,u_emissive_strength:d,u_occlusionTextureTransform:m||[0,0,0,0]}},wr=function(t){return{u_matrix:t,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:br,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:br}},Sr={fillExtrusion:e=>({u_matrix:new t.bJ(e),u_lightpos:new t.bL(e),u_lightintensity:new t.bM(e),u_lightcolor:new t.bL(e),u_vertical_gradient:new t.bM(e),u_opacity:new t.bM(e),u_edge_radius:new t.bM(e),u_width_scale:new t.bM(e),u_ao:new t.bK(e),u_height_type:new t.bN(e),u_base_type:new t.bN(e),u_tile_id:new t.bL(e),u_zoom_transition:new t.bM(e),u_inv_rot_matrix:new t.bJ(e),u_merc_center:new t.bK(e),u_up_dir:new t.bL(e),u_height_lift:new t.bM(e),u_flood_light_color:new t.bL(e),u_vertical_scale:new t.bM(e),u_flood_light_intensity:new t.bM(e),u_ground_shadow_factor:new t.bL(e)}),fillExtrusionDepth:e=>({u_matrix:new t.bJ(e),u_edge_radius:new t.bM(e),u_width_scale:new t.bM(e),u_vertical_scale:new t.bM(e),u_height_type:new t.bN(e),u_base_type:new t.bN(e)}),fillExtrusionPattern:e=>({u_matrix:new t.bJ(e),u_lightpos:new t.bL(e),u_lightintensity:new t.bM(e),u_lightcolor:new t.bL(e),u_vertical_gradient:new t.bM(e),u_height_factor:new t.bM(e),u_edge_radius:new t.bM(e),u_width_scale:new t.bM(e),u_ao:new t.bK(e),u_height_type:new t.bN(e),u_base_type:new t.bN(e),u_tile_id:new t.bL(e),u_zoom_transition:new t.bM(e),u_inv_rot_matrix:new t.bJ(e),u_merc_center:new t.bK(e),u_up_dir:new t.bL(e),u_height_lift:new t.bM(e),u_image:new t.bN(e),u_texsize:new t.bK(e),u_pixel_coord_upper:new t.bK(e),u_pixel_coord_lower:new t.bK(e),u_tile_units_to_pixels:new t.bM(e),u_opacity:new t.bM(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new t.bJ(e),u_opacity:new t.bM(e),u_ao_pass:new t.bM(e),u_meter_to_tile:new t.bM(e),u_ao:new t.bK(e),u_flood_light_intensity:new t.bM(e),u_flood_light_color:new t.bL(e),u_attenuation:new t.bM(e),u_edge_radius:new t.bM(e),u_fb:new t.bN(e),u_fb_size:new t.bM(e),u_dynamic_offset:new t.bM(e)}),fill:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e)}),fillPattern:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e),u_image:new t.bN(e),u_texsize:new t.bK(e),u_pixel_coord_upper:new t.bK(e),u_pixel_coord_lower:new t.bK(e),u_tile_units_to_pixels:new t.bM(e)}),fillOutline:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e),u_world:new t.bK(e)}),fillOutlinePattern:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e),u_world:new t.bK(e),u_image:new t.bN(e),u_texsize:new t.bK(e),u_pixel_coord_upper:new t.bK(e),u_pixel_coord_lower:new t.bK(e),u_tile_units_to_pixels:new t.bM(e)}),circle:t.cS,collisionBox:e=>({u_matrix:new t.bJ(e),u_camera_to_center_distance:new t.bM(e),u_extrude_scale:new t.bK(e)}),collisionCircle:e=>({u_matrix:new t.bJ(e),u_inv_matrix:new t.bJ(e),u_camera_to_center_distance:new t.bM(e),u_viewport_size:new t.bK(e)}),debug:e=>({u_color:new t.cz(e),u_matrix:new t.bJ(e),u_overlay:new t.bN(e),u_overlay_scale:new t.bM(e)}),clippingMask:e=>({u_matrix:new t.bJ(e)}),heatmap:e=>({u_extrude_scale:new t.bM(e),u_intensity:new t.bM(e),u_matrix:new t.bJ(e),u_inv_rot_matrix:new t.bJ(e),u_merc_center:new t.bK(e),u_tile_id:new t.bL(e),u_zoom_transition:new t.bM(e),u_up_dir:new t.bL(e)}),heatmapTexture:e=>({u_image:new t.bN(e),u_color_ramp:new t.bN(e),u_opacity:new t.bM(e)}),hillshade:e=>({u_matrix:new t.bJ(e),u_image:new t.bN(e),u_latrange:new t.bK(e),u_light:new t.bK(e),u_shadow:new t.cz(e),u_highlight:new t.cz(e),u_emissive_strength:new t.bM(e),u_accent:new t.cz(e)}),hillshadePrepare:e=>({u_matrix:new t.bJ(e),u_image:new t.bN(e),u_dimension:new t.bK(e),u_zoom:new t.bM(e)}),line:t.cT,linePattern:t.cU,raster:e=>({u_matrix:new t.bJ(e),u_normalize_matrix:new t.bJ(e),u_globe_matrix:new t.bJ(e),u_merc_matrix:new t.bJ(e),u_grid_matrix:new t.cA(e),u_tl_parent:new t.bK(e),u_scale_parent:new t.bM(e),u_fade_t:new t.bM(e),u_opacity:new t.bM(e),u_image0:new t.bN(e),u_image1:new t.bN(e),u_brightness_low:new t.bM(e),u_brightness_high:new t.bM(e),u_saturation_factor:new t.bM(e),u_contrast_factor:new t.bM(e),u_spin_weights:new t.bL(e),u_perspective_transform:new t.bK(e),u_raster_elevation:new t.bM(e),u_zoom_transition:new t.bM(e),u_merc_center:new t.bK(e),u_cutoff_params:new t.ca(e),u_colorization_mix:new t.ca(e),u_colorization_offset:new t.bM(e),u_color_ramp:new t.bN(e),u_texture_offset:new t.bK(e),u_texture_res:new t.bK(e),u_emissive_strength:new t.bM(e)}),rasterParticle:e=>({u_matrix:new t.bJ(e),u_normalize_matrix:new t.bJ(e),u_globe_matrix:new t.bJ(e),u_merc_matrix:new t.bJ(e),u_grid_matrix:new t.cA(e),u_tl_parent:new t.bK(e),u_scale_parent:new t.bM(e),u_fade_t:new t.bM(e),u_opacity:new t.bM(e),u_image0:new t.bN(e),u_image1:new t.bN(e),u_raster_elevation:new t.bM(e),u_zoom_transition:new t.bM(e),u_merc_center:new t.bK(e),u_cutoff_params:new t.ca(e)}),rasterParticleTexture:e=>({u_texture:new t.bN(e),u_opacity:new t.bM(e)}),rasterParticleDraw:e=>({u_particle_texture:new t.bN(e),u_particle_texture_side_len:new t.bM(e),u_tile_offset:new t.bK(e),u_velocity:new t.bN(e),u_color_ramp:new t.bN(e),u_velocity_res:new t.bK(e),u_max_speed:new t.bM(e),u_uv_offset:new t.bK(e),u_data_scale:new t.bK(e),u_data_offset:new t.bM(e),u_particle_pos_scale:new t.bM(e),u_particle_pos_offset:new t.bK(e)}),rasterParticleUpdate:e=>({u_particle_texture:new t.bN(e),u_particle_texture_side_len:new t.bM(e),u_velocity:new t.bN(e),u_velocity_res:new t.bK(e),u_max_speed:new t.bM(e),u_speed_factor:new t.bM(e),u_reset_rate:new t.bM(e),u_rand_seed:new t.bM(e),u_uv_offset:new t.bK(e),u_data_scale:new t.bK(e),u_data_offset:new t.bM(e),u_particle_pos_scale:new t.bM(e),u_particle_pos_offset:new t.bK(e)}),symbol:e=>({u_is_size_zoom_constant:new t.bN(e),u_is_size_feature_constant:new t.bN(e),u_size_t:new t.bM(e),u_size:new t.bM(e),u_camera_to_center_distance:new t.bM(e),u_rotate_symbol:new t.bN(e),u_aspect_ratio:new t.bM(e),u_fade_change:new t.bM(e),u_matrix:new t.bJ(e),u_label_plane_matrix:new t.bJ(e),u_coord_matrix:new t.bJ(e),u_is_text:new t.bN(e),u_elevation_from_sea:new t.bN(e),u_pitch_with_map:new t.bN(e),u_texsize:new t.bK(e),u_texsize_icon:new t.bK(e),u_texture:new t.bN(e),u_texture_icon:new t.bN(e),u_gamma_scale:new t.bM(e),u_device_pixel_ratio:new t.bM(e),u_tile_id:new t.bL(e),u_zoom_transition:new t.bM(e),u_inv_rot_matrix:new t.bJ(e),u_merc_center:new t.bK(e),u_camera_forward:new t.bL(e),u_tile_matrix:new t.bJ(e),u_up_vector:new t.bL(e),u_ecef_origin:new t.bL(e),u_is_halo:new t.bN(e),u_icon_transition:new t.bM(e),u_color_adj_mat:new t.bJ(e),u_scale_factor:new t.bM(e)}),background:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e),u_opacity:new t.bM(e),u_color:new t.cz(e)}),backgroundPattern:e=>({u_matrix:new t.bJ(e),u_emissive_strength:new t.bM(e),u_opacity:new t.bM(e),u_image:new t.bN(e),u_pattern_tl:new t.bK(e),u_pattern_br:new t.bK(e),u_texsize:new t.bK(e),u_pattern_size:new t.bK(e),u_pixel_coord_upper:new t.bK(e),u_pixel_coord_lower:new t.bK(e),u_pattern_units_to_pixels:new t.bK(e)}),terrainRaster:e=>({u_matrix:new t.bJ(e),u_image0:new t.bN(e),u_skirt_height:new t.bM(e),u_ground_shadow_factor:new t.bL(e)}),skybox:e=>({u_matrix:new t.bJ(e),u_sun_direction:new t.bL(e),u_cubemap:new t.bN(e),u_opacity:new t.bM(e),u_temporal_offset:new t.bM(e)}),skyboxGradient:e=>({u_matrix:new t.bJ(e),u_color_ramp:new t.bN(e),u_center_direction:new t.bL(e),u_radius:new t.bM(e),u_opacity:new t.bM(e),u_temporal_offset:new t.bM(e)}),skyboxCapture:e=>({u_matrix_3f:new t.cA(e),u_sun_direction:new t.bL(e),u_sun_intensity:new t.bM(e),u_color_tint_r:new t.ca(e),u_color_tint_m:new t.ca(e),u_luminance:new t.bM(e)}),globeRaster:e=>({u_proj_matrix:new t.bJ(e),u_globe_matrix:new t.bJ(e),u_normalize_matrix:new t.bJ(e),u_merc_matrix:new t.bJ(e),u_zoom_transition:new t.bM(e),u_merc_center:new t.bK(e),u_image0:new t.bN(e),u_grid_matrix:new t.cA(e),u_skirt_height:new t.bM(e),u_far_z_cutoff:new t.bM(e),u_frustum_tl:new t.bL(e),u_frustum_tr:new t.bL(e),u_frustum_br:new t.bL(e),u_frustum_bl:new t.bL(e),u_globe_pos:new t.bL(e),u_globe_radius:new t.bM(e),u_viewport:new t.bK(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.bL(e),u_frustum_tr:new t.bL(e),u_frustum_br:new t.bL(e),u_frustum_bl:new t.bL(e),u_horizon:new t.bM(e),u_transition:new t.bM(e),u_fadeout_range:new t.bM(e),u_color:new t.ca(e),u_high_color:new t.ca(e),u_space_color:new t.ca(e),u_temporal_offset:new t.bM(e),u_horizon_angle:new t.bM(e)}),model:e=>({u_matrix:new t.bJ(e),u_lighting_matrix:new t.bJ(e),u_normal_matrix:new t.bJ(e),u_node_matrix:new t.bJ(e),u_lightpos:new t.bL(e),u_lightintensity:new t.bM(e),u_lightcolor:new t.bL(e),u_camera_pos:new t.bL(e),u_opacity:new t.bM(e),u_baseColorFactor:new t.ca(e),u_emissiveFactor:new t.ca(e),u_metallicFactor:new t.bM(e),u_roughnessFactor:new t.bM(e),u_baseTextureIsAlpha:new t.bN(e),u_alphaMask:new t.bN(e),u_alphaCutoff:new t.bM(e),u_baseColorTexture:new t.bN(e),u_metallicRoughnessTexture:new t.bN(e),u_normalTexture:new t.bN(e),u_occlusionTexture:new t.bN(e),u_emissionTexture:new t.bN(e),u_lutTexture:new t.bN(e),u_color_mix:new t.ca(e),u_aoIntensity:new t.bM(e),u_emissive_strength:new t.bM(e),u_occlusionTextureTransform:new t.ca(e)}),modelDepth:e=>({u_matrix:new t.bJ(e),u_instance:new t.bJ(e),u_node_matrix:new t.bJ(e)}),groundShadow:e=>({u_matrix:new t.bJ(e),u_ground_shadow_factor:new t.bL(e)}),stars:e=>({u_matrix:new t.bJ(e),u_up:new t.bL(e),u_right:new t.bL(e),u_intensity_multiplier:new t.bM(e)}),snowParticle:e=>({u_modelview:new t.bJ(e),u_projection:new t.bJ(e),u_time:new t.bM(e),u_cam_pos:new t.bL(e),u_velocityConeAperture:new t.bM(e),u_velocity:new t.bM(e),u_horizontalOscillationRadius:new t.bM(e),u_horizontalOscillationRate:new t.bM(e),u_boxSize:new t.bM(e),u_billboardSize:new t.bM(e),u_simpleShapeParameters:new t.bK(e),u_screenSize:new t.bK(e),u_thinningCenterPos:new t.bK(e),u_thinningShape:new t.bL(e),u_thinningAffectedRatio:new t.bM(e),u_thinningParticleOffset:new t.bM(e),u_particleColor:new t.ca(e),u_direction:new t.bL(e)}),rainParticle:e=>({u_modelview:new t.bJ(e),u_projection:new t.bJ(e),u_time:new t.bM(e),u_cam_pos:new t.bL(e),u_texScreen:new t.bN(e),u_velocityConeAperture:new t.bM(e),u_velocity:new t.bM(e),u_boxSize:new t.bM(e),u_rainDropletSize:new t.bK(e),u_distortionStrength:new t.bM(e),u_rainDirection:new t.bL(e),u_color:new t.ca(e),u_screenSize:new t.bK(e),u_thinningCenterPos:new t.bK(e),u_thinningShape:new t.bL(e),u_thinningAffectedRatio:new t.bM(e),u_thinningParticleOffset:new t.bM(e),u_shapeDirectionalPower:new t.bM(e),u_shapeNormalPower:new t.bM(e),u_mode:new t.bM(e)}),vignette:e=>({u_vignetteShape:new t.bL(e),u_vignetteColor:new t.ca(e)}),occlusion:e=>({u_matrix:new t.bJ(e),u_anchorPos:new t.bL(e),u_screenSizePx:new t.bK(e),u_occluderSizePx:new t.bK(e),u_color:new t.ca(e)})};class Tr{constructor(t,e,i,n){this.id=Tr.uniqueIdxCounter,Tr.uniqueIdxCounter++,this.context=t;const o=t.gl;this.buffer=o.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Tr.uniqueIdxCounter,Tr.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Tr.uniqueIdxCounter=0;const Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mr{constructor(t,e,i,n,o,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.instanceCount=r,this.context=t;const s=t.gl;this.buffer=s.createBuffer(),t.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||o||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const o=this.attributes[n],r=e.attributes[o.name];void 0!==r&&t.vertexAttribPointer(r,o.components,t[Ar[o.type]],!1,this.itemSize,o.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,e,i){for(let n=0;n<this.attributes.length;n++){const o=e.attributes[this.attributes[n].name];void 0!==o&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(o,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ir{constructor(t,e,i,n,o){this.context=t,this.width=e,this.height=i;const r=this.framebuffer=t.gl.createFramebuffer();n&&(this.colorAttachment=new Io(t,r)),o&&(this.depthAttachmentType=o,this.depthAttachment="renderbuffer"===o?new Eo(t,r):new Po(t,r))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class Er{constructor(t,e){this.gl=t,this.clearColor=new Kn(this),this.clearDepth=new Yn(this),this.clearStencil=new Jn(this),this.colorMask=new Xn(this),this.depthMask=new Qn(this),this.stencilMask=new to(this),this.stencilFunc=new eo(this),this.stencilOp=new io(this),this.stencilTest=new no(this),this.depthRange=new oo(this),this.depthTest=new ro(this),this.depthFunc=new so(this),this.blend=new ao(this),this.blendFunc=new lo(this),this.blendColor=new uo(this),this.blendEquation=new co(this),this.cullFace=new ho(this),this.cullFaceSide=new fo(this),this.frontFace=new po(this),this.program=new mo(this),this.activeTexture=new go(this),this.viewport=new yo(this),this.bindFramebuffer=new _o(this),this.bindRenderbuffer=new vo(this),this.bindTexture=new xo(this),this.bindVertexBuffer=new bo(this),this.bindElementBuffer=new Co(this),this.bindVertexArrayOES=new wo(this),this.pixelStoreUnpack=new So(this),this.pixelStoreUnpackPremultiplyAlpha=new To(this),this.pixelStoreUnpackFlipY=new Ao(this),this.options=e?Object.assign({},e):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=e&&!!e.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e,i){return new Tr(this,t,e,i)}createVertexBuffer(t,e,i,n,o){return new Mr(this,t,e,i,n,o)}createRenderbuffer(t,e,i){const n=this.gl,o=n.createRenderbuffer();return this.bindRenderbuffer.set(o),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),o}createFramebuffer(t,e,i,n){return new Ir(this,t,e,i,n)}clear(t){let{color:e,depth:i,stencil:n,colorMask:o}=t;const r=this.gl;let s=0;e&&(s|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(o||[!0,!0,!0,!0])),void 0!==i&&(s|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),void 0!==n&&(s|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),r.clear(s)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bn(e.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Pr;function kr(e,i,n,o,r,s,a){const l=e.context,u=l.gl,c=e.transform,h=e.getOrCreateProgram("collisionBox"),d=[];let f=0,p=0;for(let b=0;b<o.length;b++){const l=o[b],m=i.getTile(l),g=m.getBucket(n);if(!g)continue;const y=li(l,g,c);let _=y;0===r[0]&&0===r[1]||(_=e.translatePosMatrix(y,m,r,s));const v=a?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const e=t.ab.mat4.create(),i=_;t.ab.mat4.mul(e,g.placementInvProjMatrix,c.glCoordMatrix),t.ab.mat4.mul(e,e,g.placementViewportMatrix),d.push({circleArray:x,circleOffset:p,transform:i,invTransform:e,projection:g.getProjection()}),f+=x.length/4,p=f}v&&(e.terrain&&e.terrain.setupElevationDraw(m,h),h.draw(e,u.LINES,Ui.disabled,Ni.disabled,e.colorModeForRenderPass(),ji.disabled,rr(_,c,m,g.getProjection()),n.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,c.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!a||!d.length)return;const m=e.getOrCreateProgram("collisionCircle"),g=new t.cV;g.resize(4*f),g._trim();let y=0;for(const t of d)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],o=t.circleArray[i+1],r=t.circleArray[i+2],s=t.circleArray[i+3];g.emplace(y++,n,o,r,s,0),g.emplace(y++,n,o,r,s,1),g.emplace(y++,n,o,r,s,2),g.emplace(y++,n,o,r,s,3)}(!Pr||Pr.length<2*f)&&(Pr=function(e){const i=2*e,n=new t.aU;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(f));const _=l.createIndexBuffer(Pr,!0),v=l.createVertexBuffer(g,t.cW.members,!0);for(const b of d){const i={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(x=c).getCameraToCenterDistance(b.projection),u_viewport_size:[x.width,x.height]};m.draw(e,u.TRIANGLES,Ui.disabled,Ni.disabled,e.colorModeForRenderPass(),ji.disabled,i,n.id,v,_,t.b7.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,c.zoom)}var x;v.destroy(),_.destroy()}const Br=t.ab.mat4.create();function Dr(e){const i=e._camera.getWorldToCamera(e.worldSize,1),n=t.ab.mat4.multiply([],i,e.globeMatrix);t.ab.mat4.invert(n,n);const o=[0,0,0],r=[0,1,0,0];return t.ab.vec4.transformMat4(r,r,n),o[0]=r[0],o[1]=r[1],o[2]=r[2],t.ab.vec3.normalize(o,o),o}function Rr(e,i){let{width:n,height:o,anchor:r,textOffset:s,textScale:a}=e;const{horizontalAlign:l,verticalAlign:u}=t.bD(r),c=-(l-.5)*n,h=-(u-.5)*o,d=t.bC(r,s);return new t.P((c/a+d[0])*i,(h/a+d[1])*i)}function Lr(e,i,n,o,r,s,a,l,u,c,h){const d=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,m={},g=e.getProjection(),y=ui(l,g,s),_=s.elevation,v=g.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;f.clear();for(let x=0;x<d.length;x++){const p=d.get(x),{tileAnchorX:b,tileAnchorY:C,numGlyphs:w}=p,S=p.hidden||!p.crossTileID||e.allowVerticalPlacement&&!p.placedOrientation?null:o[p.crossTileID];if(S){let o=0,d=0,x=0;if(_){const t=_?_.getAtTileOffset(l,b,C):0,[e,i,n]=g.upVector(l.canonical,b,C);o=t*e*v,d=t*i*v,x=t*n*v}let[T,A,M,I]=Ze(p.projectedAnchorX+o,p.projectedAnchorY+d,p.projectedAnchorZ+x,n?y:a);const E=$e(s.getCameraToCenterDistance(g),I);let P=r.evaluateSizeForFeature(e.textSizeData,c,p)*E/t.bw;n&&(P*=e.tilePixelRatio/u);const k=Rr(S,P);n?(({x:T,y:A,z:M}=g.projectTilePoint(b+k.x,C+k.y,l.canonical)),[T,A,M]=Ze(T+o,A+d,M+x,a)):(i&&k._rotate(-s.angle),T+=k.x,A+=k.y,M=0);const B=e.allowVerticalPlacement&&p.placedOrientation===t.bq.vertical?Math.PI/2:0;for(let e=0;e<w;e++)t.bt(f,T,A,M,B);h&&p.associatedIconIndex>=0&&(m[p.associatedIconIndex]={x:T,y:A,z:M,angle:B})}else ni(w,f)}if(h){p.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const n=i.get(e),{numGlyphs:o}=n,r=m[e];if(n.hidden||!r)ni(o,p);else{const{x:e,y:i,z:n,angle:s}=r;for(let r=0;r<o;r++)t.bt(p,e,i,n,s)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function zr(e,i,n,o,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=n.paint.get("icon-translate"),u=n.paint.get("text-translate"),c=n.paint.get("icon-translate-anchor"),h=n.paint.get("text-translate-anchor"),d=n.layout.get("icon-rotation-alignment"),f=n.layout.get("text-rotation-alignment"),p=n.layout.get("icon-pitch-alignment"),m=n.layout.get("text-pitch-alignment"),g=n.layout.get("icon-keep-upright"),y=n.layout.get("text-keep-upright"),_=n.paint.get("icon-color-saturation"),v=n.paint.get("icon-color-contrast"),x=n.paint.get("icon-color-brightness-min"),b=n.paint.get("icon-color-brightness-max"),C="sea"===n.layout.get("symbol-elevation-reference"),w=e.context,S=w.gl,T=e.transform,A="map"===d,M="map"===f,I="map"===p,E="map"===m,P=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let k=!1;const B=e.depthModeForSublayer(0,Ui.ReadOnly),D=[t.at(T.center.lng),t.aA(T.center.lat)],R=n.layout.get("text-variable-anchor"),L="globe"===T.projection.name,z=[],O=[0,-1,0];for(const U of o){const o=i.getTile(U),r=o.getBucket(n);if(!r)continue;if("mercator"===r.projection.name&&L)continue;if(r.fullyClipped)continue;const s="globe"===r.projection.name,d=s?t.ae(T.zoom):0,f=ui(U,r.getProjection(),T),p=T.calculatePixelsToTileUnitsMatrix(o),m=R&&r.hasTextData(),w=r.hasIconTextFit()&&m&&r.hasIconData(),B=r.getProjection().createInversionMatrix(T,U.canonical),F=t=>{T.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||e.terrain)&&(t.push("DEPTH_D24"),t.push("DEPTH_OCCLUSION"))},N=()=>{const i=A&&"point"!==n.layout.get("symbol-placement"),a=[];F(a);const u=i||w,h=n.paint.get("icon-image-cross-fade").constantOr(0);e.terrainRenderModeElevated()&&I&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),u&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),r.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),0===_&&0===v&&0===x&&1===b||a.push("COLOR_ADJUSTMENT"),r.sdfIcons&&a.push("RENDER_SDF");const m=r.icon.programConfigurations.get(n.id),y=e.getOrCreateProgram("symbol",{config:m,defines:a}),M=o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],E=r.iconSizeData,P=t.bp(E,T.zoom),k=I||0!==T.pitch,R=Ge(f,o.tileID.canonical,I,A,T,r.getProjection(),p),z=qe(f,o.tileID.canonical,I,A,T,r.getProjection(),p),N=e.translatePosMatrix(z,o,l,c,!0),V=e.translatePosMatrix(f,o,l,c),H=u?Br:R,j=A&&!I&&!i;let G=O;!L&&!T.mercatorFromTransition||A||(G=Dr(T));const W=s?G:O,q=n.getColorAdjustmentMatrix(_,v,x,b),Z=_r(E.kind,P,j,I,e,V,H,N,C,!1,M,[0,0],!0,U,d,D,B,W,r.getProjection(),q,h),$=o.imageAtlasTexture?o.imageAtlasTexture:null,K=1!==n.layout.get("icon-size").constantOr(0)||r.iconsNeedLinear,Y=r.sdfIcons||e.options.rotating||e.options.zooming||K||k?S.LINEAR:S.NEAREST,J=r.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),X=e.terrain&&I&&i?t.ab.mat4.invert(t.ab.mat4.create(),R):Br;if(i&&r.icon){const t=T.elevation,i=t?t.getAtTileOffsetFunc(U,T.center.lat,T.worldSize,r.getProjection()):null,n=We(f,o.tileID.canonical,I,A,T,r.getProjection(),p);Ye(r,f,e,!1,n,z,I,g,i,U)}return{program:y,buffers:r.icon,uniformValues:Z,atlasTexture:$,atlasTextureIcon:null,atlasInterpolation:Y,atlasInterpolationIcon:null,isSDF:r.sdfIcons,hasHalo:J,tile:o,labelPlaneMatrixInv:X}},V=()=>{const i=M&&"point"!==n.layout.get("symbol-placement"),a=[],l=i||R||w;e.terrainRenderModeElevated()&&E&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),r.text.zOffsetVertexBuffer&&a.push("Z_OFFSET"),r.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),F(a);const c=r.text.programConfigurations.get(n.id),m=e.getOrCreateProgram("symbol",{config:c,defines:a});let g,_=[0,0],v=null;const x=r.textSizeData;r.iconsInText&&(_=o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],v=o.imageAtlasTexture?o.imageAtlasTexture:null,g=E||0!==T.pitch||e.options.rotating||e.options.zooming||"composite"===x.kind||"camera"===x.kind?S.LINEAR:S.NEAREST);const b=o.glyphAtlasTexture?o.glyphAtlasTexture.size:[0,0],A=n.layout.get("text-size-scale-range"),I=t.aw(e.scaleFactor,A[0],A[1]),P=t.bp(x,T.zoom,I),k=Ge(f,o.tileID.canonical,E,M,T,r.getProjection(),p),z=qe(f,o.tileID.canonical,E,M,T,r.getProjection(),p),N=e.translatePosMatrix(z,o,u,h,!0),V=e.translatePosMatrix(f,o,u,h),H=l?Br:k,j=M&&!E&&!i;let G=O;!L&&!T.mercatorFromTransition||M||(G=Dr(T));const W=_r(x.kind,P,j,E,e,V,H,N,C,!0,b,_,!0,U,d,D,B,s?G:O,r.getProjection(),null,null,I),q=o.glyphAtlasTexture?o.glyphAtlasTexture:null,Z=S.LINEAR,$=0!==n.paint.get("text-halo-width").constantOr(1),K=e.terrain&&E&&i?t.ab.mat4.invert(t.ab.mat4.create(),k):Br;if(i&&r.text){const t=T.elevation,i=t?t.getAtTileOffsetFunc(U,T.center.lat,T.worldSize,r.getProjection()):null,n=We(f,o.tileID.canonical,E,M,T,r.getProjection(),p);Ye(r,f,e,!0,n,z,E,y,i,U)}return{program:m,buffers:r.text,uniformValues:W,atlasTexture:q,atlasTextureIcon:v,atlasInterpolation:Z,atlasInterpolationIcon:g,isSDF:!0,hasHalo:$,tile:o,labelPlaneMatrixInv:K}},H=r.icon.segments.get().length,j=r.text.segments.get().length,G=H&&!a.onlyText?N():null,W=j&&!a.onlyIcons?V():null,q=n.paint.get("icon-opacity").constantOr(1),Z=n.paint.get("text-opacity").constantOr(1);if(P&&r.canOverlap){k=!0;const e=q&&!a.onlyText?r.icon.segments.get():[],i=Z&&!a.onlyIcons?r.text.segments.get():[];for(const n of e)z.push({segments:new t.b7([n]),sortKey:n.sortKey,state:G});for(const n of i)z.push({segments:new t.b7([n]),sortKey:n.sortKey,state:W})}else a.onlyText||z.push({segments:q?r.icon.segments:new t.b7([]),sortKey:0,state:G}),a.onlyIcons||z.push({segments:Z?r.text.segments:new t.b7([]),sortKey:0,state:W})}k&&z.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of z){const i=t.state;if(i)if(e.terrain?e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:T.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}):e.setupDepthForOcclusion(T.depthOcclusionForSymbolsAndCircles,i.program),w.activeTexture.set(S.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,S.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(w.activeTexture.set(S.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,S.CLAMP_TO_EDGE,!0)),e.uploadCommonLightUniforms(e.context,i.program),i.hasHalo){const o=i.uniformValues;o.u_is_halo=1,Or(i.buffers,t.segments,n,e,i.program,B,r,s,o,2),o.u_is_halo=0}else{if(i.isSDF){const o=i.uniformValues;i.hasHalo&&(o.u_is_halo=1,Or(i.buffers,t.segments,n,e,i.program,B,r,s,o,1)),o.u_is_halo=0}Or(i.buffers,t.segments,n,e,i.program,B,r,s,i.uniformValues,1)}}}function Or(t,e,i,n,o,r,s,a,l,u){const c=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];o.draw(n,n.context.gl.TRIANGLES,r,s,a,ji.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,n.transform.zoom,t.programConfigurations.get(i.id),c,u)}function Ur(e,i,n,o,r,s,a){const l=e.context.gl,u=n.paint.get("fill-pattern"),c=n.is3D(),h=c?e.stencilModeFor3D():Ni.disabled,d=u&&u.constantOr(1);let f,p,m,g,y;a?(p=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=l.LINES):(p=d?"fillPattern":"fill",f=l.TRIANGLES);for(const _ of o){const o=i.getTile(_);if(d&&!o.patternsLoaded())continue;const v=o.getBucket(n);if(!v)continue;e.prepareDrawTile();const x=v.programConfigurations.get(n.id),b=e.isTileAffectedByFog(_),C=e.getOrCreateProgram(p,{config:x,overrideFog:b});d&&(e.context.activeTexture.set(l.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),x.updatePaintBuffers());const w=u.constantOr(null);if(w&&o.imageAtlas){const e=o.imageAtlas,i=t.A.from(w).getPrimary().scaleSelf(t.q.devicePixelRatio).serialize(),n=e.patternPositions[i];n&&x.setConstantPatternPositions(n)}const S=e.translatePosMatrix(_.projMatrix,o,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),T=n.paint.get("fill-emissive-strength");if(a){g=v.indexBuffer2,y=v.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];m="fillOutlinePattern"===p&&d?or(S,T,e,o,t):nr(S,T,t)}else g=v.indexBuffer,y=v.segments,m=d?ir(S,T,e,o):er(S,T);e.uploadCommonUniforms(e.context,C,_.toUnwrapped()),C.draw(e,f,r,c?h:e.stencilModeForClipping(_),s,ji.disabled,m,n.id,v.layoutVertexBuffer,g,y,n.paint,e.transform.zoom,x,void 0)}}function Fr(e,i,n,o,r,s,a,l){n.resetLayerRenderingStats(e);const u=e.context,c=u.gl,h=e.transform,d=n.paint.get("fill-extrusion-pattern"),f=d.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),m=e.style.enable3dLights(),g=n.paint.get(m&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),y=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],_=n.layout.get("fill-extrusion-edge-radius"),v=_>0&&!n.paint.get("fill-extrusion-rounded-roof"),x=v?0:_,b="globe"===h.projection.name?t.d3():0,C="globe"===h.projection.name,w=C?t.ae(h.zoom):0,S=[t.at(h.center.lng),t.aA(h.center.lat)],T="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),A=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(T?null:n.lut).toArray01().slice(0,3),M=n.paint.get("fill-extrusion-flood-light-intensity"),I=n.paint.get("fill-extrusion-vertical-scale"),E=0!==n.paint.get("fill-extrusion-line-width").constantOr(1),P=n.paint.get("fill-extrusion-height-alignment"),k=n.paint.get("fill-extrusion-base-alignment"),B=tn(e,n.paint.get("fill-extrusion-cutoff-fade-range")),D=[];let R;C&&D.push("PROJECTION_GLOBE_VIEW"),y[0]>0&&D.push("FAUX_AO"),v&&D.push("ZERO_ROOF_RADIUS"),l&&D.push("HAS_CENTROID"),M>0&&D.push("FLOOD_LIGHT"),B.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),E&&D.push("RENDER_WALL_MODE");const L="shadow"===e.renderPass,z=e.shadowRenderer,O=L&&!!z;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let U=[0,0,0];if(z){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(U=ln(e.style,t,i)),L||(D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&D.push("NORMAL_OFFSET")),R=D.concat(["SHADOWS_SINGLE_CASCADE"])}const F=O?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",N=n.getLayerRenderingStats();for(const V of o){const o=i.getTile(V),m=o.getBucket(n);if(!m||m.projection.name!==h.projection.name)continue;let g=!1;z&&(g=0===z.getMaxCascadeForTile(V.toUnwrapped()));const _=e.isTileAffectedByFog(V),v=m.programConfigurations.get(n.id),T=e.getOrCreateProgram(F,{config:v,defines:g?R:D,overrideFog:_});if(e.terrain&&e.terrain.setupElevationDraw(o,T,{useMeterToDem:!0}),!m.centroidVertexBuffer){const t=T.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}!L&&z&&z.setupShadows(o.tileID.toUnwrapped(),T,"vector-tile",o.tileID.overscaledZ),f&&(e.context.activeTexture.set(c.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),v.updatePaintBuffers());const O=d.constantOr(null);if(O&&o.imageAtlas){const e=o.imageAtlas,i=t.A.from(O).getPrimary().scaleSelf(t.q.devicePixelRatio),n=e.patternPositions[i.serialize()];n&&v.setConstantPatternPositions(n)}const H=n.paint.get("fill-extrusion-vertical-gradient"),j=1/m.tileToMeter;let G;if(L&&z){if(Wr(o.tileID,m,e))continue;const t=z.calculateShadowPassMatrixFromTile(o.tileID.toUnwrapped());G=Qo(t,x,j,I,P,k)}else{const t=e.translatePosMatrix(V.expandedProjMatrix,o,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=h.projection.createInversionMatrix(h,V.canonical);G=f?tr(t,e,H,p,y,x,j,V,o,b,P,k,w,S,i,A,I):Xo(t,e,H,p,y,x,j,V,b,P,k,w,S,i,A,I,M,U)}e.uploadCommonUniforms(u,T,V.toUnwrapped(),null,B);let W=m.segments;if("mercator"===h.projection.name&&!L&&(W=m.getVisibleSegments(o.tileID,e.terrain,e.transform.getFrustum(0)),!W.get().length))continue;if(N)if(L)for(const t of W.get())N.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of W.get())N.numRenderedVerticesInTransparentPass+=t.primitiveLength;const q=[];(e.terrain||l)&&q.push(m.centroidVertexBuffer),C&&q.push(m.layoutVertexExtBuffer),E&&q.push(m.wallVertexBuffer),T.draw(e,u.gl.TRIANGLES,r,s,a,ji.backCCW,G,n.id,m.layoutVertexBuffer,m.indexBuffer,W,n.paint,e.transform.zoom,v,q)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Nr(e,i,n,o,r,s,a,l,u,c,h,d,f,p,m,g,y,_,v){const x=e.context,b=x.gl,C=e.transform,w=e.transform.zoom,S=[],T=tn(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(S.push("CLEAR_SUBPASS"),v&&(S.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===c&&S.push("SDF_SUBPASS"),y&&S.push("HAS_CENTROID"),T.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const A=n.layout.get("fill-extrusion-edge-radius"),M=(t,i,o,c,_)=>{const b=i.programConfigurations.get(n.id),C=e.isTileAffectedByFog(t),M=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:S,overrideFog:C}),I=((t,e,i,n,o,r,s,a,l,u,c)=>({u_matrix:e,u_opacity:i,u_ao_pass:n?1:0,u_meter_to_tile:o,u_ao:r,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:u,u_fb:0,u_fb_size:c,u_dynamic_offset:1}))(0,c,h,u,_,[d,f*_],p,m,g,w>=17?0:A*_,v?v.size[0]:0),E=[];y&&E.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(x,M,t.toUnwrapped(),null,T),M.draw(e,x.gl.TRIANGLES,r,s,a,l,I,n.id,i.vertexBuffer,i.indexBuffer,o,n.paint,w,b,E)};for(const I of o){const o=i.getTile(I),r=o.getBucket(n);if(!r||r.projection.name!==C.projection.name||!r.groundEffect||r.groundEffect&&!r.groundEffect.hasData())continue;const s=r.groundEffect,a=1/r.tileToMeter;{const t=e.translatePosMatrix(I.projMatrix,o,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=s.getDefaultSegment();M(I,s,i,t,a)}if(_)for(let l=0;l<4;l++){const r=t.d4[l](I),s=i.getTile(r);if(!s)continue;const u=s.getBucket(n);if(!u||u.projection.name!==C.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const c=u.groundEffect;let h,d;0===l?(h=[-t.ag,0,0],d=1):1===l?(h=[t.ag,0,0],d=0):2===l?(h=[0,-t.ag,0],d=3):(h=[0,t.ag,0],d=2);const f=c.regionSegments[d];if(!f)continue;const p=new Float32Array(16);t.ab.mat4.translate(p,I.projMatrix,h),M(I,c,f,e.translatePosMatrix(p,o,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),a)}}}function Vr(e,i,n,o,r,s,a){0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const l=s?s.findDEMTileFor(n):null;if(!(l&&l.dem||a))return;s&&l&&l.dem&&o.selfDEMTileTimestamp!==l.dem._timestamp&&(o.borderDoneWithNeighborZ=[-1,-1,-1,-1],o.selfDEMTileTimestamp=l.dem._timestamp);const u=e=>new t.P(Math.ceil((e+t.d7)*t.d8),0),c=t=>{const e=i.getSource().minzoom,n=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(r)},o=[0,-1,1];for(const i of o){if(t.overscaledZ+i<e)continue;const o=n(t.calculateScaledKey(t.overscaledZ+i));if(o)return o}},h=[0,0,0],d=(e,i)=>(h[0]=Math.min(e.min.y,i.min.y),h[1]=Math.max(e.max.y,i.max.y),h[2]=t.ag-i.min.x>e.max.x?i.min.x-t.ag:e.max.x,h),f=(e,i)=>(h[0]=Math.min(e.min.x,i.min.x),h[1]=Math.max(e.max.x,i.max.x),h[2]=t.ag-i.min.y>e.max.y?i.min.y-t.ag:e.max.y,h),p=[(t,e)=>d(t,e),(t,e)=>d(e,t),(t,e)=>f(t,e),(t,e)=>f(e,t)],m=(e,i,o,r,a,u,c)=>{if(!s)return 0;const h=[[u?o:e,u?e:o,0],[u?o:i,u?i:o,0]],d=c<0?t.ag+c:c,f=[u?d:(e+i)/2,u?(e+i)/2:d,0];return 0===o&&c<0||0!==o&&c>0?s.getForTilePoints(a,[f],!0,r):h.push(f),s.getForTilePoints(n,h,!0,l),Math.max(h[0][2],h[1][2],f[2])/s.exaggeration()};for(let _=0;_<4;_++){const e=o.borderFeatureIndices[_];if(0===e.length)continue;const i=t.d4[_](n),r=c(i);if(!(r&&r instanceof t.d5))continue;const l=s?s.findDEMTileFor(i):null;if(!(l&&l.dem||a))continue;if(s&&l&&l.dem&&o.borderDEMTileTimestamp[_]!==l.dem._timestamp&&(o.borderDoneWithNeighborZ[_]=-1,o.borderDEMTileTimestamp[_]=l.dem._timestamp),o.borderDoneWithNeighborZ[_]===r.canonical.z)continue;0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const h=(_<2?1:5)-_,d=r.borderDoneWithNeighborZ[h]!==o.canonical.z,f=r.borderFeatureIndices[h];let v=0;if(o.canonical.z!==r.canonical.z){for(const t of e)o.showCentroid(o.featuresOnBorder[t]);if(d)for(const t of f)r.showCentroid(r.featuresOnBorder[t]);o.borderDoneWithNeighborZ[_]=r.canonical.z,r.borderDoneWithNeighborZ[h]=o.canonical.z}for(const n of e){const e=o.featuresOnBorder[n],s=o.centroidData[e.centroidDataIndex],c=e.borders[_];let d;for(;v<f.length;){d=r.featuresOnBorder[f[v]];const t=d.borders[h];if(t[1]>c[0]+3||t[0]>c[0]-3)break;r.showCentroid(d),v++}if(d&&v<f.length){const n=v;let x=0;for(;!(d.borders[h][0]>c[1]-3)&&(x++,++v!==f.length);)d=r.featuresOnBorder[f[v]];d=r.featuresOnBorder[f[n]];let b=!1;if(x>=1){const t=d.borders[h];Math.abs(c[0]-t[0])<3&&Math.abs(c[1]-t[1])<3&&(x=1,b=!0,v=n+1)}else if(0===x){o.showCentroid(e);continue}const C=r.centroidData[d.centroidDataIndex];a&&b&&(((g=s).flags|(y=C).flags)&t.d6?(g.flags|=t.d6,y.flags|=t.d6):(g.flags&=~t.d6,y.flags&=~t.d6));const w=e.intersectsCount()>1||d.intersectsCount()>1;if(x>1)v=n,s.centroidXY=C.centroidXY=new t.P(0,0);else if(l&&l.dem&&!w){const e=p[_](s,C),n=_%2?t.ag-1:0,o=m(e[0],Math.min(t.ag-1,e[1]),n,l,i,_<2,e[2]);s.centroidXY=C.centroidXY=u(o)}else w?s.centroidXY=C.centroidXY=new t.P(0,0):(s.centroidXY=o.encodeBorderCentroid(e),C.centroidXY=r.encodeBorderCentroid(d));o.writeCentroidToBuffer(s),r.writeCentroidToBuffer(C)}else o.showCentroid(e)}o.borderDoneWithNeighborZ[_]=r.canonical.z,r.borderDoneWithNeighborZ[h]=o.canonical.z}var g,y;(o.needsCentroidUpdate||!o.centroidVertexBuffer&&0!==o.centroidVertexArray.length)&&o.uploadCentroid(e)}const Hr=[1,0,0],jr=[0,1,0],Gr=[0,0,1];function Wr(e,i,n){const o=n.transform,r=n.shadowRenderer;if(!r)return!0;const s=e.toUnwrapped(),a=o.tileSize*r._cascades[n.currentShadowCascade].scale;let l=i.maxHeight;if(o.elevation){const t=o.elevation.getMinMaxForTile(e);t&&(l+=t.max)}const u=[...r.shadowDirection];u[2]=-u[2];const c=r.computeSimplifiedTileShadowVolume(s,l,a,u);if(!c)return!1;const h=[Hr,jr,Gr,u,[u[0],0,u[2]],[0,u[1],u[2]]],d="globe"===o.projection.name,f=o.scaleZoom(a),p=t.bR.fromInvProjectionMatrix(o.invProjMatrix,o.worldSize,f,!d),m=r.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(c.vertices,c.planes,h)||0===m.intersectsPrecise(c.vertices,c.planes,h)}function qr(e){return[e[0]*t.d9,e[1]*t.d9,e[2]*t.d9,0]}function Zr(e,i,n,o,r,s,a,l,u){const c=o.getSource(),h=n.globeSharedBuffers;if(!h)return;let d,f,p;if(i&&(d=o.getTile(i)),c instanceof t.aJ?(f=c.texture,p=t.cI(0,0,n.transform)):d&&i&&(f=d.texture,p=t.cI(i.canonical.z,i.canonical.x,n.transform)),!f||!p)return;e||(p=t.ab.mat4.scale(t.ab.mat4.create(),p,[1,-1,1]));const m=n.context,g=m.gl,y="nearest"===r.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,_=n.colorModeForDrapableLayerRenderPass(s),v=a.defines;v.push("GLOBE_POLES");const x=new Ui(g.LEQUAL,Ui.ReadWrite,n.depthRangeFor3D),b=Float32Array.from(n.transform.expandedFarZProjMatrix),C=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),f.bind(y,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),f.bind(y,g.CLAMP_TO_EDGE),f.useMipmap&&m.extTextureFilterAnisotropic&&n.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[w,S,T,A]=i?h.getPoleBuffers(i.canonical.z,!1):h.getPoleBuffers(0,!0),M=r.paint.get("raster-elevation");let I;e?(I=w,n.renderDefaultNorthPole=0!==M):(I=S,n.renderDefaultSouthPole=0!==M);const E=qr(a.mix),P=((t,e,i,n,o,r,s,a,l,u,c,h,d)=>hr(t,e,i,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},r,[0,0]||0,a,2,u,c,h,1,0,d))(b,C,p,t.ae(n.transform.zoom),0,r,0,M,0,E,a.offset,a.range,s),k=n.getOrCreateProgram("raster",{defines:v});n.uploadCommonUniforms(m,k,null),k.draw(n,g.TRIANGLES,x,u,_,l,P,r.id,I,T,A)}function $r(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,o=.2*t.height,r=e+o;return[e,i,(r-o-e)/n,(r-e)/n]}function Kr(t,e,i,n){if(t)return e instanceof ne&&t instanceof Ce?e.getTextureDescriptor(t,i,!0):{texture:t.texture,mix:qr(n.mix),offset:n.offset,buffer:0,tileSize:1}}var Yr=t.da([{name:"a_index",type:"Int16",components:1}]);class Jr{constructor(e,i,n,o){const r={width:n[0],height:n[1],data:null},s=e.gl;this.targetColorTexture=new t.T(e,r,s.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new t.T(e,r,s.RGBA8,{useMipmap:!1}),this.context=e,this.updateParticleTexture(i,o),this.lastInvalidatedAt=0}updateParticleTexture(e,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const n=this.context.gl,o=i.width*i.height;this.particleTexture0=new t.T(this.context,i,n.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,i,n.RGBA8,{premultiply:!1,useMipmap:!1});const r=new t.db;r.reserve(o);for(let t=0;t<o;t++)r.emplaceBack(t);this.particleIndexBuffer=this.context.createVertexBuffer(r,Yr.members,!0),this.particleSegment=t.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=t.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Xr(e,i,n){if(!e)return null;const o=i.getTextureDescriptor(e,n,!0);if(!o)return null;let{texture:r,mix:s,offset:a,tileSize:l,buffer:u,format:c}=o;if(!r||!c)return null;let h=!1;return"uint32"===c&&(h=!0,s[3]=0,s=ur(t.dc,s,[0,n.paint.get("raster-particle-max-speed")]),a=cr(t.dc,a,[0,n.paint.get("raster-particle-max-speed")])),{texture:r,textureOffset:[u/(l+2*u),l/(l+2*u)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[c]]}}function Qr(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,o=.2*t.height,r=e+o;return[e,i,(r-o-e)/n,(r-e)/n]}const ts=new t.aj(1,0,0,1),es=new t.aj(0,1,0,1),is=new t.aj(0,0,1,1),ns=new t.aj(1,0,1,1),os=new t.aj(0,1,1,1);function rs(e,i,n,o,r,s,a){const l=e.context,u=e.transform,c=l.gl,h="globe"===u.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let f=t.ab.mat4.clone(n.projMatrix);if(h&&t.ae(u.zoom)>0){const e=t.ba(n.canonical,u),i=t.dd(e);f=t.ab.mat4.multiply(new Float32Array(16),u.globeMatrix,i),t.ab.mat4.multiply(f,u.projMatrix,f)}const p=t.ab.mat4.create();p[12]+=2*r/(t.q.devicePixelRatio*u.width),p[13]+=2*s/(t.q.devicePixelRatio*u.height),t.ab.mat4.multiply(f,p,f);const m=e.getOrCreateProgram("debug",{defines:d}),g=i.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(g,m);const y=Ui.disabled,_=Ni.disabled,v=e.colorModeForRenderPass(),x="$debug";l.activeTexture.set(c.TEXTURE0),e.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(e.context,u):g._makeDebugTileBoundsBuffers(e.context,u.projection);const b=g._tileDebugBuffer||e.debugBuffer,C=g._tileDebugIndexBuffer||e.debugIndexBuffer,w=g._tileDebugSegments||e.debugSegments;if(m.draw(e,c.LINE_STRIP,y,_,v,ji.disabled,sr(f,o),x,b,C,w,null,null,null,[g._globeTileDebugBorderBuffer]),a){const t=g.latestRawTileData,i=Math.floor((t&&t.byteLength||0)/1024);let o=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(o+=` => ${n.overscaledZ}`),o+=` ${g.state}`,o+=` ${i}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,o=t.debugOverlayCanvas.getContext("2d");o.clearRect(0,0,i.width,i.height),o.shadowColor="white",o.shadowBlur=2,o.lineWidth=1.5,o.strokeStyle="white",o.textBaseline="top",o.font="bold 36px Open Sans, sans-serif",o.fillText(e,5,5),o.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,o)}const S=i.getTile(n).tileSize,T=512/Math.min(S,512)*(n.overscaledZ/u.zoom)*.5,A=g._tileDebugTextBuffer||e.debugBuffer,M=g._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,I=g._tileDebugTextSegments||e.debugSegments;m.draw(e,c.TRIANGLES,y,_,Oi.alphaBlended,ji.disabled,sr(f,t.aj.transparent,T),x,A,M,I,null,null,null,[g._globeTileDebugTextBuffer])}function ss(t,e,i,n){ls(t,0,e+i/2,t.transform.width,i,n)}function as(t,e,i,n){ls(t,e-i/2,0,i,t.transform.height,n)}function ls(e,i,n,o,r,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.q.devicePixelRatio,n*t.q.devicePixelRatio,o*t.q.devicePixelRatio,r*t.q.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const us=t.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:cs}=us;function hs(t,e,i,n){t.emplaceBack(e,i,n)}class ds{constructor(e){this.vertexArray=new t.de,this.indices=new t.aU,hs(this.vertexArray,-1,-1,1),hs(this.vertexArray,1,-1,1),hs(this.vertexArray,-1,1,1),hs(this.vertexArray,1,1,1),hs(this.vertexArray,-1,-1,-1),hs(this.vertexArray,1,-1,-1),hs(this.vertexArray,-1,1,-1),hs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,cs),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.b7.simpleSegment(0,0,36,12)}}function fs(e,i,n,o,r,s){const a=e.context.gl,l=i.paint.get("sky-atmosphere-color"),u=i.paint.get("sky-atmosphere-halo-color"),c=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,n,o)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[o.r,o.g,o.b,o.a],u_luminance:5e-5}))(t.ab.mat3.fromMat4(t.ab.mat3.create(),o),r,c,l,u);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),n.draw(e,a.TRIANGLES,Ui.disabled,Ni.disabled,Oi.unblended,ji.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const ps=t.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ms{constructor(e){const i=new t.df;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new t.aU;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,ps.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=t.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const gs=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ys{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _s{constructor(e){this.colorModeAlphaBlendedWriteRGB=new Oi([1,zi,1,zi],t.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Oi([1,0,1,0],t.aj.transparent,[!1,!1,!1,!0]),this.params=new ys,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(e){const i=e.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ms(i);const e=this.params.sizeRange,n=this.params.intensityRange,o=function(e){const i=t.di(30),n=[];for(let o=0;o<e;++o){const e=2*Math.PI*i(),o=Math.acos(1-2*i())-.5*Math.PI;n.push(t.ab.vec3.fromValues(Math.cos(o)*Math.cos(e),Math.cos(o)*Math.sin(e),Math.sin(o)))}return n}(this.params.starsCount),r=t.di(300),s=new t.dg,a=new t.aU;let l=0;for(let i=0;i<o.length;++i){const u=t.ab.vec3.scale([],o[i],200),c=Math.max(0,1+.01*e*(1*r()-.5)),h=Math.max(0,1+.01*n*(1*r()-.5));s.emplaceBack(u[0],u[1],u[2],-1,-1,c,h),s.emplaceBack(u[0],u[1],u[2],1,-1,c,h),s.emplaceBack(u[0],u[1],u[2],1,1,c,h),s.emplaceBack(u[0],u[1],u[2],-1,1,c,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(s,gs.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=t.b7.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const n=e.context,o=n.gl,r=e.transform,s=new Ui(o.LEQUAL,Ui.ReadOnly,[0,1]),a=t.ae(r.zoom),l=e.style.getLut(i.scope),u="none"===i.properties.get("color-use-theme"),c=i.properties.get("color").toRenderColor(u?null:l).toArray01(),h="none"===i.properties.get("high-color-use-theme"),d=i.properties.get("high-color").toRenderColor(h?null:l).toArray01(),f="none"===i.properties.get("space-color-use-theme"),p=i.properties.get("space-color").toRenderColor(f?null:l).toArray01PremultipliedAlpha(),m=5e-4,g=t.dh(i.properties.get("horizon-blend"),0,1,m,.25),y=t.cC(e,n,r)&&g===m?r.worldSize/(2*Math.PI*1.025)-1:r.globeRadius,_=e.frameCounter/1e3%1,v=t.ab.vec3.length(r.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(y,2)),b=Math.acos(x/v),C=t=>{const i="globe"===r.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&i.push("ALPHA_PASS");const l=e.getOrCreateProgram("globeAtmosphere",{defines:i}),u=((t,e,i,n,o,r,s,a,l,u,c,h)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:i,u_frustum_bl:n,u_horizon:o,u_transition:r,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:u,u_temporal_offset:c,u_horizon_angle:h}))(r.frustumCorners.TL,r.frustumCorners.TR,r.frustumCorners.BR,r.frustumCorners.BL,r.frustumCorners.horizon,a,g,c,d,p,_,b);e.uploadCommonUniforms(n,l);const h=this.atmosphereBuffer;h&&l.draw(e,o.TRIANGLES,s,Ni.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ji.backCW,u,t?"atmosphere_glow_alpha":"atmosphere_glow",h.vertexBuffer,h.indexBuffer,h.segments)};C(!1),C(!0)}drawStars(e,i){const n=t.aw(i.properties.get("star-intensity"),0,1);if(0===n)return;const o=e.context,r=o.gl,s=e.transform,a=e.getOrCreateProgram("stars"),l=t.ab.quat.identity([]);t.ab.quat.rotateX(l,l,-s._pitch),t.ab.quat.rotateZ(l,l,-s.angle),t.ab.quat.rotateX(l,l,t.ai(s._center.lat)),t.ab.quat.rotateY(l,l,-t.ai(s._center.lng));const u=t.ab.mat4.fromQuat(new Float32Array(16),l),c=t.ab.mat4.multiply([],s.starsProjMatrix,u),h=t.ab.mat3.fromMat4([],u),d=t.ab.mat3.invert([],h),f=[0,1,0];t.ab.vec3.transformMat3(f,f,d),t.ab.vec3.scale(f,f,this.params.sizeMultiplier);const p=[1,0,0];t.ab.vec3.transformMat3(p,p,d),t.ab.vec3.scale(p,p,this.params.sizeMultiplier);const m=(g=f,y=p,_=n,{u_matrix:Float32Array.from(c),u_up:g,u_right:y,u_intensity_multiplier:_});var g,y,_;e.uploadCommonUniforms(o,a),this.starsVx&&this.starsIdx&&a.draw(e,r.TRIANGLES,Ui.disabled,Ni.disabled,this.colorModeAlphaBlendedWriteRGB,ji.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function vs(e,i){const n=[...e],o=i.cameraWorldSizeForFog/i.worldSize,r=t.ab.mat4.identity([]);return t.ab.mat4.scale(r,r,[o,o,1]),t.ab.mat4.multiply(n,r,n),t.ab.mat4.multiply(n,i.worldToFogMatrix,n),n}function xs(e,i,n,o,r){const s=n.material,a=o.context,{baseColorTexture:l,metallicRoughnessTexture:u}=s.pbrMetallicRoughness,{normalTexture:c,occlusionTexture:h,emissionTexture:d}=s;function f(t,i,n){if(t&&(e.push(i),a.activeTexture.set(a.gl.TEXTURE0+n),t.gfxTexture)){const{minFilter:e,magFilter:i,wrapS:n,wrapT:o}=t.sampler;t.gfxTexture.bindExtraParam(e,i,n,o)}}f(l,"HAS_TEXTURE_u_baseColorTexture",Ki.BaseColor),f(u,"HAS_TEXTURE_u_metallicRoughnessTexture",Ki.MetallicRoughness),f(c,"HAS_TEXTURE_u_normalTexture",Ki.Normal),f(h,"HAS_TEXTURE_u_occlusionTexture",Ki.Occlusion),f(d,"HAS_TEXTURE_u_emissionTexture",Ki.Emission),r&&(r.texture||(r.texture=new t.dk(o.context,r.image,[r.image.height,r.image.height,r.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+Ki.LUT),r.texture&&r.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),e.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(n.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||e.push("DIFFUSE_SHADED");const p=o.shadowRenderer;p&&(e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),p.useNormalOffset&&e.push("NORMAL_OFFSET"))}function bs(e,i,n,o,r,s){const a=n.paint.get("model-opacity").constantOr(1),l=i.context,u=new Ui(i.context.gl.LEQUAL,Ui.ReadWrite,i.depthRangeFor3D),c=i.transform,h=e.mesh,d=h.material,f=d.pbrMetallicRoughness,p=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:t.ab.mat4.multiply([],o.zScaleMatrix,e.nodeModelMatrix),t.ab.mat4.multiply(m,o.negCameraPosMatrix,m);const g=t.ab.mat4.invert([],m);t.ab.mat4.transpose(g,g);const y="none"===n.paint.get("model-color-use-theme").constantOr("default"),_=n.paint.get("model-emissive-strength").constantOr(0),v=Cr(new Float32Array(e.worldViewProjection),new Float32Array(m),new Float32Array(g),null,i,a,f.baseColorFactor.toRenderColor(null),d.emissiveFactor,f.metallicFactor,f.roughnessFactor,d,_,n),x={defines:[]},b=[],C=i.shadowRenderer;C&&(C.useNormalOffset=!1),xs(x.defines,b,h,i,y?null:n.lut);let w=null;if(p){const t=vs(e.nodeModelMatrix,i.transform);if(w=new Float32Array(t),"globe"!==c.projection.name){const e=h.aabb.min,i=h.aabb.max,[n,o]=p.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);x.overrideFog=n>=zt||o>=zt}}const S=tn(i,n.paint.get("model-cutoff-fade-range"));S.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const T=i.getOrCreateProgram("model",x);i.uploadCommonUniforms(l,T,null,w,S),"shadow"!==i.renderPass&&C&&C.setupShadowsFromMatrix(e.nodeModelMatrix,T),T.draw(i,l.gl.TRIANGLES,u,r,s,h.material.doubleSided?ji.disabled:ji.backCCW,v,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,i.transform.zoom,void 0,b)}function Cs(e,i,n,o,r,s,a){let l;l="globe"===e.projection.name?t.dl(n,e):[...n],t.ab.mat4.multiply(l,l,i.matrix);const u=t.ab.mat4.multiply([],o,l);if(i.meshes)for(const c of i.meshes){if("BLEND"!==c.material.alphaMode){a.push({mesh:c,depth:0,modelIndex:r,worldViewProjection:u,nodeModelMatrix:l});continue}const i=t.ab.vec3.transformMat4([],c.centroid,u);!e.isOrthographic&&i[2]<=0||s.push({mesh:c,depth:i[2],modelIndex:r,worldViewProjection:u,nodeModelMatrix:l})}if(i.children)for(const t of i.children)Cs(e,t,n,o,r,s,a)}function ws(t,e,i,n){const o=i.shadowRenderer;if(!o)return;const r=o.getShadowPassDepthMode(),s=o.getShadowPassColorMode(),a=o.calculateShadowPassMatrixFromMatrix(e),l=wr(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,r,Ni.disabled,s,ji.backCCW,l,n.id,t.vertexBuffer,t.indexBuffer,t.segments,n.paint,i.transform.zoom,void 0,void 0)}function Ss(e,i,n){const o=i.updateZoomBasedPaintProperties(),r=function(e,i,n){let o,r,s,a=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&a>0){const i=e.terrain,r=i.findDEMTileFor(n);r&&r.dem?o=t.dn.create(i,n,r):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||o&&o._demTile&&o._demTile.tileID===i.validForDEMTile.id&&o._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const t in i.instancesPerModel){const e=i.instancesPerModel[t];for(let t=0;t<e.instancedDataArray.length;++t){const n=(o?a*o.getElevationAt(0|e.instancedDataArray.float32[16*t],0|e.instancedDataArray.float32[16*t+1],!0,!0):0)+e.instancesEvaluatedElevation[t];e.instancedDataArray.float32[16*t+6]=n,r=r?Math.min(i.terrainElevationMin,n):n,s=s?Math.max(i.terrainElevationMax,n):n}}return i.terrainElevationMin=r||0,i.terrainElevationMax=s||0,i.validForExaggeration=a,i.validForDEMTile=o&&o._demTile?{id:o._demTile.tileID,timestamp:o._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,i,n);(o||r)&&(i.uploaded=!1,i.upload(e.context))}const Ts={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.cd([0,0,0],[t.ag,t.ag,0])};function As(e,i){const n=1<<e.canonical.z,o=i.getFreeCameraOptions().position,r=i.elevation,s=e.canonical.x/n,a=(e.canonical.x+1)/n,l=e.canonical.y/n,u=(e.canonical.y+1)/n;let c=i._centerAltitude;if(r){const t=r.getMinMaxForTile(e);t&&t.max>c&&(c=t.max)}const h=t.aw(o.x,s,a)-o.x,d=t.aw(o.y,l,u)-o.y,f=t.bH(c,i.center.lat)-o.z;return i._zoomFromMercatorZ(Math.sqrt(h*h+d*d+f*f))}function Ms(t,e,i,n,o,r,s){const a=t.context,l="shadow"===t.renderPass,u=t.shadowRenderer,c=l&&u?u.getShadowPassDepthMode():new Ui(a.gl.LEQUAL,Ui.ReadWrite,t.depthRangeFor3D),h=t.isTileAffectedByFog(r);if(i.meshes)for(const d of i.meshes){const f=["MODEL_POSITION_ON_GPU"],p=[];let m,g,y;n.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const _=tn(t,e.paint.get("model-cutoff-fade-range"));if(_.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&u)m=t.getOrCreateProgram("modelDepth",{defines:f}),g=wr(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),y=u.getShadowPassColorMode();else{xs(f,p,d,t,"none"===e.paint.get("model-color-use-theme").constantOr("default")?null:e.lut),m=t.getOrCreateProgram("model",{defines:f,overrideFog:h});const n=d.material,l=n.pbrMetallicRoughness,c=e.paint.get("model-opacity").constantOr(1),v=e.paint.get("model-emissive-strength").constantOr(0);g=Cr(r.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,t,c,l.baseColorFactor.toRenderColor(null),n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,v,e,o),u&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,u.getShadowUniformValues()):(u.setupShadows(r.toUnwrapped(),m,"model-tile",r.overscaledZ),s.shadowUniformsInitialized=!0)),y=_.shouldRenderCutoff||c<1||"OPAQUE"!==n.alphaMode?Oi.alphaBlended:Oi.unblended}t.uploadCommonUniforms(a,m,r.toUnwrapped(),null,_);const v=d.material.doubleSided?ji.disabled:ji.backCCW;if(n.instancedDataArray.length>20)p.push(n.instancedDataBuffer),m.draw(t,a.gl.TRIANGLES,c,Ni.disabled,y,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,p,n.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let o=0;o<n.instancedDataArray.length;++o)g[i]=new Float32Array(n.instancedDataArray.arrayBuffer,64*o,16),m.draw(t,a.gl.TRIANGLES,c,Ni.disabled,y,v,g,e.id,d.vertexBuffer,d.indexBuffer,d.segments,e.paint,t.transform.zoom,void 0,p)}}if(i.children)for(const d of i.children)Ms(t,e,d,n,o,r,s)}const Is=[1,-1,1];function Es(e,i,n,o){if(!n.modelManager)return!0;const r=n.modelManager;if(!n.shadowRenderer)return!0;const s=n.shadowRenderer,a=i.aabb;let l=!0,u=e.maxHeight;if(0===u){let t=0;for(const i in e.instancesPerModel){const e=r.getModel(i,o);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):l=!1}u=e.maxScale*t*1.41+e.maxVerticalOffset,l&&(e.maxHeight=u)}a.max[2]=u,a.min[2]+=e.terrainElevationMin,a.max[2]+=e.terrainElevationMax,t.ab.vec3.transformMat4(a.min,a.min,i.tileMatrix),t.ab.vec3.transformMat4(a.max,a.max,i.tileMatrix);const c=a.intersects(s.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===c),0===c}function Ps(e,i){const n=e.uniformValues.u_cutoff_params[0],o=e.uniformValues.u_cutoff_params[1],r=e.uniformValues.u_cutoff_params[2],s=e.uniformValues.u_cutoff_params[3];return o===n||s===r?1:t.aw(((i-n)/(o-n)-r)/(s-r),0,1)}function ks(e,i,n,o){if(i.pitch<20)return 1;const r=i.getWorldToCameraMatrix();t.ab.mat4.multiply(r,r,e);const s=t.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let a=t.ab.vec4.transformMat4(t.ab.vec4.create(),s,r),l=a,u=a;s[1]=n.max[1],a=t.ab.vec4.transformMat4(t.ab.vec4.create(),s,r),l=a[1]<l[1]?a:l,u=a[1]>u[1]?a:u,s[0]=n.max[0],a=t.ab.vec4.transformMat4(t.ab.vec4.create(),s,r),l=a[1]<l[1]?a:l,u=a[1]>u[1]?a:u,s[1]=n.min[1],a=t.ab.vec4.transformMat4(t.ab.vec4.create(),s,r),l=a[1]<l[1]?a:l,u=a[1]>u[1]?a:u;const c=t.aw(o[0],0,1),h=100*i.pixelsPerMeter*t.aw(o[1],0,1),d=t.aw(o[2],0,1),f=t.ab.vec4.lerp(t.ab.vec4.create(),l,u,c),p=Math.tan(.5*i.fovX),m=-f[2]*p;if(0===h)return f[1]<-Math.abs(m)?d:1;const g=(-Math.abs(m)-f[1])/h,y=(t,e,i)=>(1-i)*t+i*e,_=t.aw(y(1,d,g),d,1);return y(1,_,t.aw((i.pitch-20)/20,0,1))}class Bs{}class Ds{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,n){{const t=this._storage.get(i.id);if(t)return t.lastUsedFrameIdx=e,t.buf}const o=n.gl,r=o.getBufferParameter(o.ELEMENT_ARRAY_BUFFER,o.BUFFER_SIZE),s=new ArrayBuffer(r),a=new Int16Array(s);o.getBufferSubData(o.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new t.dq;for(let t=0;t<r/2;t+=3){const e=a[t],i=a[t+1],n=a[t+2];l.emplaceBack(e,i),l.emplaceBack(i,n),l.emplaceBack(n,e)}const u=n.bindVertexArrayOES.current,c=new Bs;return c.buf=new Tr(n,l),c.lastUsedFrameIdx=e,this._storage.set(i.id,c),n.bindVertexArrayOES.set(u),c.buf}update(t){for(const[e,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}class Rs{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ls=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class zs{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Os{constructor(t,e){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...e,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...e,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Us=t.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Fs{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(e,i){const n=e.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const i=new t.dr,n=new t.aU;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1),n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),this.vignetteVx=e.context.createVertexBuffer(i,Us.members),this.vignetteIdx=e.context.createIndexBuffer(n)}const o=t.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){e.uploadCommonUniforms(e.context,n);const t={u_vignetteShape:(r={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:r.vignetteColor};n.draw(e,e.context.gl.TRIANGLES,Ui.disabled,Ni.disabled,Oi.alphaBlended,ji.disabled,t,"vignette",this.vignetteVx,this.vignetteIdx,o,{})}var r}}class Ns{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(e,i){const n=e.getFreeCameraOptions().position,o=n.toAltitude(),r=n.toLngLat(),s=t.ai(r.lng),a=t.ai(r.lat),l=e.pixelsPerMeter/i,u=s*t.ds,c=t.ds*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const t=-this._offsetYPrev+c,e=-this._elevationPrev+o;this._accumulatedOffsetX+=(-this._offsetXPrev+u)*l,this._accumulatedOffsetY+=t*l,this._accumulatedElevation+=e*l,this._offsetXPrev=u,this._offsetYPrev=c,this._elevationPrev=o}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Vs(t,e){return[-(t[0]-Math.floor(t[0]/e)*e),-(t[1]-Math.floor(t[1]/e)*e),-(t[2]-Math.floor(t[2]/e)*e)]}function Hs(e){const i=t.di(1323123451230),n=[];for(let o=0;o<e;++o){const e=2*i()-1,o=2*i()-1,r=2*i()-1;n.push(t.ab.vec3.fromValues(e,o,r))}return n}function js(e,i,n,o,r){const s=t.aw((r-n)/(o-n),0,1);return(1-s)*e+s*i}class Gs{constructor(t){this._movement=new Ns,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Fs,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(e,i){const n=e.transform;this._movement.update(n,this._ppmScaleFactor);const o=n.starsProjMatrix,r=t.ab.quat.identity([]);t.ab.quat.rotateX(r,r,t.ai(90)-n._pitch),t.ab.quat.rotateZ(r,r,-n.angle);const s=t.ab.mat4.fromQuat(new Float32Array(16),r),a=t.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=t.ab.mat4.transpose([],a),u=t.ab.mat4.multiply([],l,s),c=Date.now()/1e3;return this._accumulatedTimeFromStart+=(c-this._prevTime)*i,this._prevTime=c,{projectionMatrix:o,modelviewMatrix:u}}}class Ws extends Gs{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Os(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(e){const i=e.context;if(!this.particlesVx){const e=Hs(this.particlesCount),n=new t.dt,o=new t.aU;let r=0;const s=t.di(1323123451230);for(let t=0;t<e.length;++t){const i=e[t],a=[2*s()-1,s(),s(),s()];n.emplaceBack(i[0],i[1],i[2],-1,-1,...a),n.emplaceBack(i[0],i[1],i[2],1,-1,...a),n.emplaceBack(i[0],i[1],i[2],1,1,...a),n.emplaceBack(i[0],i[1],i[2],-1,1,...a),o.emplaceBack(r+0,r+1,r+2),o.emplaceBack(r+0,r+2,r+3),r+=4}this.particlesVx=i.createVertexBuffer(n,Ls.members),this.particlesIdx=i.createIndexBuffer(o)}}draw(e){if(!this._params.overrideStyleParameters&&!e.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},n=e.transform.zoom;if(i.revealStart>n)return;const o=js(0,1,i.revealStart,i.revealStart+i.revealRange,n);if(!this.particlesVx||!this.particlesIdx)return;const r=structuredClone(this._params);let s=[-r.direction.x,r.direction.y,-100];t.ab.vec3.normalize(s,s);const a=structuredClone(this._vignetteParams);a.strength*=o,r.overrideStyleParameters||(r.intensity=e.style.rain.state.density,r.timeFactor=e.style.rain.state.intensity,r.color=structuredClone(e.style.rain.state.color),s=structuredClone(e.style.rain.state.direction),r.screenThinning.intensity=e.style.rain.state.centerThinning,r.dropletSizeX=e.style.rain.state.dropletSize[0],r.dropletSizeYScale=e.style.rain.state.dropletSize[1]/e.style.rain.state.dropletSize[0],r.distortionStrength=100*e.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(e.style.rain.state.vignetteColor));const l=this.updateOnRender(e,r.timeFactor),u=e.context,c=u.gl,h=e.transform;this.screenTexture&&this.screenTexture.size[0]===e.width&&this.screenTexture.size[1]===e.height||(this.screenTexture=new t.T(u,{width:e.width,height:e.height,data:null},c.RGBA8)),r.distortionStrength>0&&(u.activeTexture.set(c.TEXTURE0),this.screenTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.copyTexSubImage2D(c.TEXTURE_2D,0,0,0,0,0,e.width,e.height));const d=e.getOrCreateProgram("rainParticle");e.uploadCommonUniforms(u,d),u.activeTexture.set(c.TEXTURE0),this.screenTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE);const f=[r.color.r,r.color.g,r.color.b,r.color.a],p=(i,n)=>{const o=Vs(this._movement.getPosition(),i),a=r.dropletSizeX,u=r.dropletSizeX*r.dropletSizeYScale,p=e.width/2,m=e.height/2,g=js(0,r.screenThinning.start,0,1,r.screenThinning.intensity),y=js(.001,r.screenThinning.range,0,1,r.screenThinning.intensity),_=js(0,r.screenThinning.particleOffset,0,1,r.screenThinning.intensity),v=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:o,velocityConeAperture:r.velocityConeAperture,velocity:r.velocity,boxSize:i,rainDropletSize:[a,u],distortionStrength:r.distortionStrength,rainDirection:s,color:f,screenSize:[h.width,h.height],thinningCenterPos:[p,m],thinningShape:[g,y,Math.pow(10,r.screenThinning.fadePower)],thinningAffectedRatio:r.screenThinning.affectedRatio,thinningParticleOffset:_,shapeDirectionalPower:r.shapeDirPower,shapeNormalPower:r.shapeNormalPower,mode:n?0:1},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_texScreen:0,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_boxSize:x.boxSize,u_rainDropletSize:x.rainDropletSize,u_distortionStrength:x.distortionStrength,u_rainDirection:x.rainDirection,u_color:x.color,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_shapeDirectionalPower:x.shapeDirectionalPower,u_shapeNormalPower:x.shapeNormalPower,u_mode:x.mode});var x;const b=Math.round(r.intensity*this.particlesCount),C=t.b7.simpleSegment(0,0,4*b,2*b);d.draw(e,c.TRIANGLES,Ui.disabled,Ni.disabled,Oi.alphaBlended,ji.disabled,v,"rain_particles",this.particlesVx,this.particlesIdx,C,{})};r.distortionStrength>0&&p(r.boxSize,!0),p(r.boxSize,!1),this._vignette.draw(e,a)}}const qs=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Zs extends Gs{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Os(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(e){const i=e.context;if(!this.particlesVx){const e=Hs(this.particlesCount),n=new t.du,o=new t.aU;let r=0;const s=t.di(1323123451230);for(let t=0;t<e.length;++t){const i=e[t],a=s(),l=s(),u=s(),c=[t/e.length,a,l,u],h=[s(),s()];n.emplaceBack(i[0],i[1],i[2],-1,-1,...c,...h),n.emplaceBack(i[0],i[1],i[2],1,-1,...c,...h),n.emplaceBack(i[0],i[1],i[2],1,1,...c,...h),n.emplaceBack(i[0],i[1],i[2],-1,1,...c,...h),o.emplaceBack(r+0,r+1,r+2),o.emplaceBack(r+0,r+2,r+3),r+=4}this.particlesVx=i.createVertexBuffer(n,qs.members),this.particlesIdx=i.createIndexBuffer(o)}}draw(e){if(!this._params.overrideStyleParameters&&!e.style.snow)return;const i=structuredClone(this._params);let n=[-i.direction.x,i.direction.y,-100];t.ab.vec3.normalize(n,n);const o=structuredClone(this._vignetteParams),r=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},s=e.transform.zoom;if(r.revealStart>s)return;const a=js(0,1,r.revealStart,r.revealStart+r.revealRange,s);o.strength*=a,i.overrideStyleParameters||(i.intensity=e.style.snow.state.density,i.timeFactor=e.style.snow.state.intensity,i.color=structuredClone(e.style.snow.state.color),n=structuredClone(e.style.snow.state.direction),i.screenThinning.intensity=e.style.snow.state.centerThinning,i.billboardSize=2.79*e.style.snow.state.flakeSize,o.strength=1,o.color=structuredClone(e.style.snow.state.vignetteColor));const l=this.updateOnRender(e,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const u=e.context,c=u.gl,h=e.transform,d=e.getOrCreateProgram("snowParticle");e.uploadCommonUniforms(u,d),((i,o,r)=>{const s=Vs(this._movement.getPosition(),i),a=h.width/2,u=h.height/2,f=js(0,r.screenThinning.start,0,1,r.screenThinning.intensity),p=js(.001,r.screenThinning.range,0,1,r.screenThinning.intensity),m=js(0,r.screenThinning.particleOffset,0,1,r.screenThinning.intensity),g=(y={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:s,velocityConeAperture:r.velocityConeAperture,velocity:r.velocity,horizontalOscillationRadius:r.horizontalOscillationRadius,horizontalOscillationRate:r.horizontalOscillationRate,boxSize:i,billboardSize:1*r.billboardSize,simpleShapeParameters:[r.shapeFadeStart,r.shapeFadePower],screenSize:[h.width,h.height],thinningCenterPos:[a,u],thinningShape:[f,p,Math.pow(10,r.screenThinning.fadePower)],thinningAffectedRatio:r.screenThinning.affectedRatio,thinningParticleOffset:m,color:[r.color.r,r.color.g,r.color.b,r.color.a],direction:n},{u_modelview:Float32Array.from(y.modelview),u_projection:Float32Array.from(y.projection),u_time:y.time,u_cam_pos:y.camPos,u_velocityConeAperture:y.velocityConeAperture,u_velocity:y.velocity,u_horizontalOscillationRadius:y.horizontalOscillationRadius,u_horizontalOscillationRate:y.horizontalOscillationRate,u_boxSize:y.boxSize,u_billboardSize:y.billboardSize,u_simpleShapeParameters:y.simpleShapeParameters,u_screenSize:y.screenSize,u_thinningCenterPos:y.thinningCenterPos,u_thinningShape:y.thinningShape,u_thinningAffectedRatio:y.thinningAffectedRatio,u_thinningParticleOffset:y.thinningParticleOffset,u_particleColor:y.color,u_direction:y.direction});var y;const _=Math.round(r.intensity*this.particlesCount),v=t.b7.simpleSegment(0,0,4*_,2*_);this.particlesVx&&this.particlesIdx&&d.draw(e,c.TRIANGLES,Ui.disabled,Ni.disabled,Oi.alphaBlended,ji.disabled,g,"snow_particles",this.particlesVx,this.particlesIdx,v,{})})(i.boxSize,0,i),this._vignette.draw(e,o)}}const $s={symbol:function(e,i,n,o,r){if("translucent"!==e.renderPass)return;const s=Ni.disabled,a=e.colorModeForRenderPass(),l=n.layout.get("text-variable-anchor"),u=n.layout.get("text-size-scale-range"),c=t.aw(e.scaleFactor,u[0],u[1]);l&&function(e,i,n,o,r,s,a,l){const u=i.transform,c="map"===r,h="map"===s;for(const d of e){const e=o.getTile(d),i=e.getBucket(n);if(!i||!i.text||!i.text.segments.get().length)continue;const r=t.bp(i.textSizeData,u.zoom,l),s=ui(d,i.getProjection(),u),f=u.calculatePixelsToTileUnitsMatrix(e),p=Ge(s,e.tileID.canonical,h,c,u,i.getProjection(),f),m=i.hasIconTextFit()&&i.hasIconData();if(r){const n=Math.pow(2,u.zoom-e.tileID.overscaledZ);Lr(i,c,h,a,t.cX,u,p,d,n,r,m)}}}(o,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),r,c);const h=0!==n.paint.get("icon-opacity").constantOr(1),d=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(h||d)?zr(e,i,n,o,s,a):(h&&zr(e,i,n,o,s,a,{onlyIcons:!0}),d&&zr(e,i,n,o,s,a,{onlyText:!0})),i.map.showCollisionBoxes&&(kr(e,i,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),kr(e,i,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,n,o){if("translucent"!==e.renderPass)return;const r=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1),u=n.paint.get("circle-emissive-strength");if(0===r.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,h=c.gl,d=e.transform,f=e.depthModeForSublayer(0,Ui.ReadOnly),p=Ni.disabled,m=e.colorModeForDrapableLayerRenderPass(u),g="globe"===d.projection.name,y=[t.at(d.center.lng),t.aA(d.center.lat)],_=[];for(let x=0;x<o.length;x++){const r=o[x],s=i.getTile(r),a=s.getBucket(n);if(!a||a.projection.name!==d.projection.name)continue;const u=a.programConfigurations.get(n.id),c=t.cY(n),h=e.isTileAffectedByFog(r);g&&c.push("PROJECTION_GLOBE_VIEW"),c.push("DEPTH_D24"),e.terrain&&d.depthOcclusionForSymbolsAndCircles&&c.push("DEPTH_OCCLUSION");const f=e.getOrCreateProgram("circle",{config:u,defines:c,overrideFog:h}),p=a.layoutVertexBuffer,m=a.globeExtVertexBuffer,v=a.indexBuffer,b=d.projection.createInversionMatrix(d,r.canonical),C={programConfiguration:u,program:f,layoutVertexBuffer:p,globeExtVertexBuffer:m,indexBuffer:v,uniformValues:t.cZ(e,r,s,b,y,n),tile:s};if(l){const e=a.segments.get();for(const i of e)_.push({segments:new t.b7([i]),sortKey:i.sortKey,state:C})}else _.push({segments:a.segments,sortKey:0,state:C})}l&&_.sort(((t,e)=>t.sortKey-e.sortKey));const v={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const t of _){const{programConfiguration:i,program:o,layoutVertexBuffer:r,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:u}=t.state,g=t.segments;e.terrain&&e.terrain.setupElevationDraw(u,o,v),e.uploadCommonUniforms(c,o,u.tileID.toUnwrapped()),o.draw(e,h.TRIANGLES,f,p,m,ji.disabled,l,n.id,r,a,g,n.paint,d.zoom,i,[s])}},heatmap:function(e,i,n,o){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const r=e.context,s=r.gl,a=Ni.disabled,l=new Oi([s.ONE,s.ONE,s.ONE,s.ONE],t.aj.transparent,[!0,!0,!0,!0]);!function(t,e,i,n){const o=t.gl,r=e.width*n,s=e.height*n;t.activeTexture.set(o.TEXTURE1),t.viewport.set([0,0,r,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==r||a.height!==s)){a&&a.destroy();const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),a=i.heatmapFbo=t.createFramebuffer(r,s,!0,null),function(t,e,i,n,o,r){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,o,r,0,s.RGBA,t.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,0,e,a,r,s)}else o.bindTexture(o.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(r,e,n,"globe"===e.transform.projection.name?.5:.25),r.clear({color:t.aj.transparent});const u=e.transform,c="globe"===u.projection.name,h=c?["PROJECTION_GLOBE_VIEW"]:[],d=c?ji.frontCCW:ji.disabled,f=[t.at(u.center.lng),t.aA(u.center.lat)];for(let t=0;t<o.length;t++){const p=o[t];if(i.hasRenderableParent(p))continue;const m=i.getTile(p),g=m.getBucket(n);if(!g||g.projection.name!==u.projection.name)continue;const y=e.isTileAffectedByFog(p),_=g.programConfigurations.get(n.id),v=e.getOrCreateProgram("heatmap",{config:_,defines:h,overrideFog:y}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(r,v,p.toUnwrapped());const b=u.projection.createInversionMatrix(u,p.canonical);v.draw(e,s.TRIANGLES,Ui.disabled,a,l,d,lr(e,p,m,b,f,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,_,c?[g.globeExtVertexBuffer]:null)}r.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const n=e.context,o=n.gl,r=i.heatmapFbo;if(!r)return;n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(o.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new t.T(n,i.colorRamp,o.RGBA8)),s.bind(o.LINEAR,o.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,o.TRIANGLES,Ui.disabled,Ni.disabled,e.colorModeForRenderPass(),ji.disabled,((t,e)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,n))},line:function(e,i,n,o){if("translucent"!==e.renderPass)return;const r=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===r.constantOr(1)||0===s.constantOr(1))return;const a=n.paint.get("line-emissive-strength"),l=n.paint.get("line-occlusion-opacity"),u=n.layout.get("line-elevation-reference"),c="meters"===n.layout.get("line-width-unit"),h="sea"===u,d=e.context,f=d.gl;if(n.hasElevatedBuckets&&"globe"===e.transform.projection.name)return;const p=n.layout.get("line-cross-slope"),m=void 0!==p,g=p<1,y=e.colorModeForDrapableLayerRenderPass(a),_=e.terrain&&e.terrain.renderingToTexture,v=_?1:t.q.devicePixelRatio,x=n.paint.get("line-dasharray"),b=x.constantOr(1),C=n.layout.get("line-cap"),w=x.constantOr(null),S=C.constantOr(null),T=n.paint.get("line-pattern"),A=T.constantOr(1),M=T.constantOr(null),I=n.paint.get("line-opacity").constantOr(1);let E=!A&&1!==I||e.depthOcclusion&&l>0&&l<1;const P=n.paint.get("line-gradient"),k=A?"linePattern":"line",B=t.c_(n);let D;if(_&&e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(E=!1),0!==l&&e.depthOcclusion){const e=n.paint._values["line-opacity"];e&&e.value&&"constant"===e.value.kind?D=e.value:t.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==s.value.kind&&!1===s.value.isLineProgressConstant&&B.push("VARIABLE_LINE_WIDTH");const R=(o,r,s,a,u)=>{for(const p of o){const o=i.getTile(p);if(A&&!o.patternsLoaded())continue;const m=o.getBucket(n);if(!m)continue;if(m.hasZOffset&&!u||!m.hasZOffset&&u)continue;e.prepareDrawTile();const g=m.programConfigurations.get(n.id),x=e.isTileAffectedByFog(p),C=e.getOrCreateProgram(k,{config:g,defines:r,overrideFog:x,overrideRtt:!u&&void 0});if(M&&o.imageAtlas){const e=t.A.from(M).getPrimary().scaleSelf(v).serialize(),i=o.imageAtlas.patternPositions[e];i&&g.setConstantPatternPositions(i)}if(!A&&w&&S&&o.lineAtlas){const t=o.lineAtlas.getDash(w,S);t&&g.setConstantPatternPositions(t)}let[T,B]=n.paint.get("line-trim-offset");if("round"===S||"square"===S){const t=1;T!==B&&(0===T&&(T-=t),1===B&&(B+=t))}const R=_?p.projMatrix:null,L=c?1/m.tileToMeter/t.ar(o,1,e.transform.zoom):1,z=c?1/m.tileToMeter/t.ar(o,1,Math.floor(e.transform.zoom)):1,O=A?t.c$(e,o,n,R,v,L,z,[T,B]):t.d0(e,o,n,R,m.lineClipsArray.length,v,L,z,[T,B]);if(P){const o=m.gradients[n.id];let r=o.texture;if(n.gradientVersion!==o.version){let s=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,o=p.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-p.canonical.z):1;s=t.aw(t.d1(m.maxLineLength/t.ag*1024*o),256,d.maxTextureSize)}o.gradient=t.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:o.gradient||void 0,clips:m.lineClipsArray}),o.texture?o.texture.update(o.gradient):o.texture=new t.T(d,o.gradient,f.RGBA8),o.version=n.gradientVersion,r=o.texture}d.activeTexture.set(f.TEXTURE1),r.bind(n.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}b&&(d.activeTexture.set(f.TEXTURE0),o.lineAtlasTexture&&o.lineAtlasTexture.bind(f.LINEAR,f.REPEAT),g.updatePaintBuffers()),A&&(d.activeTexture.set(f.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),g.updatePaintBuffers()),u&&!h&&e.terrain.setupElevationDraw(o,C),e.uploadCommonUniforms(d,C,p.toUnwrapped());const U=t=>{null!=D&&(D.value=I*l),C.draw(e,f.TRIANGLES,s,t,y,ji.disabled,O,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,g,[m.layoutVertexBuffer2,m.patternVertexBuffer,m.zOffsetVertexBuffer]),null!=D&&(D.value=I)};if(E&&!u){const t=e.stencilModeForClipping(p).ref;0===t&&_&&d.clear({stencil:0});const i={func:f.EQUAL,mask:255};O.u_alpha_discard_threshold=.8,U(new Ni(i,t,255,f.KEEP,f.KEEP,f.INVERT)),O.u_alpha_discard_threshold=0,U(new Ni(i,t,255,f.KEEP,f.KEEP,f.KEEP))}else E&&u&&(O.u_alpha_discard_threshold=.001),U(u?a:e.stencilModeForClipping(p))}};if(n.hasNonElevatedBuckets){const i=!_&&e.terrain;0!==l&&i?t.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):i?t.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):R(o,B,e.depthModeForSublayer(0,Ui.ReadOnly),Ni.disabled,!1)}if(n.hasElevatedBuckets){B.push("ELEVATED"),m&&B.push(g?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&B.push("ELEVATION_REFERENCE_SEA");const t=E?e.stencilModeFor3D():Ni.disabled,i=new Ui(e.depthOcclusion?f.GREATER:f.LEQUAL,Ui.ReadOnly,e.depthRangeFor3D);e.forceTerrainMode=!0,R(o,B,i,t,!0),e.forceTerrainMode=!1}E&&(e.resetStencilClippingMasks(),_&&d.clear({stencil:0})),0===l||e.depthOcclusion||_||e.layersWithOcclusionOpacity.push(e.currentLayer)},fill:function(e,i,n,o){const r=n.paint.get("fill-color"),s=n.paint.get("fill-opacity"),a=n.is3D(),l=new Ui(e.context.gl.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D);if(0===s.constantOr(1))return;const u=n.paint.get("fill-emissive-strength"),c=e.colorModeForDrapableLayerRenderPass(u),h=n.paint.get("fill-pattern"),d=e.opaquePassEnabledForLayer()&&!h.constantOr(1)&&1===r.constantOr(t.aj.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===d){const t=a?l:e.depthModeForSublayer(1,"opaque"===e.renderPass?Ui.ReadWrite:Ui.ReadOnly);Ur(e,i,n,o,t,c,!1)}if(!a&&"translucent"===e.renderPass&&n.paint.get("fill-antialias")){const t=a?l:e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ui.ReadOnly);Ur(e,i,n,o,t,c,!0)}},"fill-extrusion":function(e,i,n,o){const r=n.paint.get("fill-extrusion-opacity"),s=e.context,a=s.gl,l=e.terrain,u=l&&l.renderingToTexture;if(0===r)return;const c=e.conflationActive&&e.style.isLayerClipped(n,i.getSource()),h=e.style.order.indexOf(n.fqid);if(c&&function(t,e,i,n,o){for(const r of n){const n=e.getTile(r).getBucket(i);n&&(n.updateReplacement(r,t.replacementSource,o),n.uploadCentroid(t.context))}}(e,i,n,o,h),l||c)for(const t of o){const o=i.getTile(t).getBucket(n);o&&Vr(e.context,i,t,o,n,l,c)}if("shadow"===e.renderPass&&e.shadowRenderer){const s=e.shadowRenderer;if(l&&r<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.a9)return;const a=s.getShadowPassDepthMode(),u=s.getShadowPassColorMode();Fr(e,i,n,o,a,Ni.disabled,u,c)}else if("translucent"===e.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1),d=n.paint.get("fill-extrusion-color").constantOr(t.aj.white);if(!u&&0!==d.a){const t=new Ui(e.context.gl.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D);1===r&&h?Fr(e,i,n,o,t,Ni.disabled,Oi.unblended,c):(Fr(e,i,n,o,t,Ni.disabled,Oi.disabled,c),Fr(e,i,n,o,t,e.stencilModeFor3D(),e.colorModeForRenderPass(),c),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!l&&"globe"!==e.transform.projection.name||u)){const r=n.paint.get("fill-extrusion-opacity"),h=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=n.paint.get("fill-extrusion-flood-light-intensity"),p="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),m=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(p?null:n.lut).toArray01().slice(0,3),g=h>0&&d>0,y=f>0,_=(t,e,i)=>(1-i)*t+i*e,v=s=>{const l=e.depthModeForSublayer(1,Ui.ReadOnly,a.LEQUAL,!0),u=n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=_(.1,3,u),g=e._showOverdrawInspector;if(!g){const u=new Ni({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Oi([a.ONE,a.ONE,a.ONE,a.ONE],t.aj.transparent,[!1,!1,!1,!0],a.MIN);Nr(e,i,n,o,l,u,g,ji.disabled,s,"sdf",r,h,d,f,m,p,c,!1)}{const u=g?Ni.disabled:new Ni({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),y=g?e.colorModeForRenderPass():new Oi([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],t.aj.transparent,[!0,!0,!0,!0]);Nr(e,i,n,o,l,u,y,ji.disabled,s,"color",r,h,d,f,m,p,c,!1)}};if(u){const u=(s,l,u)=>{const p=e.depthModeForSublayer(1,Ui.ReadOnly,a.LEQUAL,!1),g=n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const u=new Oi([a.ONE,a.ONE,a.ONE,a.ONE],t.aj.transparent,[!1,!1,!1,!0]);Nr(e,i,n,o,p,Ni.disabled,u,ji.disabled,s,"clear",r,h,d,f,m,y,c,l)}{const u=new Ni({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Oi([a.ONE,a.ONE,a.ONE,a.ONE],t.aj.transparent,[!1,!1,!1,!0],a.MIN);Nr(e,i,n,o,p,u,g,ji.disabled,s,"sdf",r,h,d,f,m,y,c,l)}{const u=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new Ni({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=new Oi([u,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],t.aj.transparent,[!0,!0,!0,!0]);Nr(e,i,n,o,p,g,_,ji.disabled,s,"color",r,h,d,f,m,y,c,l)}{const g=new Oi([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],t.aj.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);Nr(e,i,n,o,p,Ni.disabled,g,ji.disabled,s,"clear",r,h,d,f,m,y,c,l,u)}};if(g||y){let i;if(e.prepareDrawTile(),l){const e=l.drapeBufferSize[0],n=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===e&&i.size[1]===n)||(i&&i.destroy(),i=l.framebufferCopyTexture=new t.T(s,new t.r({width:e,height:n}),a.RGBA8)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,e,n)}g&&u(!0,!1,i),y&&u(!1,!0,i)}}else g&&v(!0),y&&v(!1),(g||y)&&e.resetStencilClippingMasks()}}},hillshade:function(t,e,i,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const o=t.context,r=t.terrain&&t.terrain.renderingToTexture,[s,a]="translucent"!==t.renderPass||r?[{},n]:t.stencilConfigForOverlap(n);for(const l of a){const n=e.getTile(l);if(n.needsHillshadePrepare&&"offscreen"===t.renderPass)Zn(t,n,i);else if("translucent"===t.renderPass){const e=t.depthModeForSublayer(0,Ui.ReadOnly),o=i.paint.get("hillshade-emissive-strength"),a=t.colorModeForDrapableLayerRenderPass(o),u=r&&t.terrain?t.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];Wn(t,l,n,i,e,u,a)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(e,i,n,o,r,s){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const a="globe"===e.transform.projection.name,l=0!==n.paint.get("raster-elevation"),u=l&&a;if(e.renderElevatedRasterBackface&&!u)return;const c=e.context,h=c.gl,d=i.getSource(),f=function(e,i,n,o){const r=i.paint.get("raster-color"),s="raster-array"===e.type,a=[],l=i.paint.get("raster-resampling"),u=i.paint.get("raster-color-mix");let c=i.paint.get("raster-color-range");const h=[u[0],u[1],u[2],0],d=u[3];let f="nearest"===l?o.NEAREST:o.LINEAR;if(s&&(a.push("RASTER_ARRAY"),r||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),f=o.NEAREST,!c&&e.rasterLayers)){const t=e.rasterLayers.find((t=>{let{id:e}=t;return e===i.sourceLayer}));t&&t.fields&&t.fields.range&&(c=t.fields.range)}if(c=c||[0,1],r){a.push("RASTER_COLOR"),n.activeTexture.set(o.TEXTURE2),i.updateColorRamp(c);let e=i.colorRampTexture;e||(e=i.colorRampTexture=new t.T(n,i.colorRamp,o.RGBA8)),e.bind(o.LINEAR,o.CLAMP_TO_EDGE)}return{mix:h,range:c,offset:d,defines:a,resampling:f}}(d,n,c,h);if(d instanceof t.aJ&&!o.length&&!a)return;const p=n.paint.get("raster-emissive-strength"),m=e.colorModeForDrapableLayerRenderPass(p),g=e.terrain&&e.terrain.renderingToTexture,y=!e.options.moving,_="nearest"===n.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof t.aJ&&!o.length&&(d.onNorthPole||d.onSouthPole)){const t=l?e.stencilModeFor3D():Ni.disabled;return void Zr(!!d.onNorthPole,null,e,i,n,p,f,ji.disabled,t)}if(!o.length)return;const[v,x]=d instanceof t.aJ||g?[{},o]:e.stencilConfigForOverlap(o),b=x[x.length-1].overscaledZ;u&&f.defines.push("PROJECTION_GLOBE_VIEW"),l&&f.defines.push("RENDER_CUTOFF");const C=(o,r,x)=>{for(const C of o){const o=C.toUnwrapped(),w=i.getTile(C);if(g&&(!w||!w.hasData()))continue;c.activeTexture.set(h.TEXTURE0);const S=Kr(w,d,n,f);if(!S||!S.texture)continue;const{texture:T,mix:A,offset:M,tileSize:I,buffer:E}=S;let P,k;g?(P=Ui.disabled,k=C.projMatrix):l?(P=new Ui(h.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D),k=a?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(o,y)):(P=e.depthModeForSublayer(C.overscaledZ-b,1===n.paint.get("raster-opacity")?Ui.ReadWrite:Ui.ReadOnly,h.LESS),k=e.transform.calculateProjMatrix(o,y));const B=e.terrain&&g?e.terrain.stencilModeForRTTOverlap(C):v[C.overscaledZ],D=s?0:n.paint.get("raster-fade-duration");w.registerFadeDuration(D);const R=i.findLoadedParent(C,0),L=No(w,R,i,e.transform,D);let z,O;e.terrain&&e.terrain.prepareDrawTile(),c.activeTexture.set(h.TEXTURE0),T.bind(_,h.CLAMP_TO_EDGE),c.activeTexture.set(h.TEXTURE1),R?(R.texture&&R.texture.bind(_,h.CLAMP_TO_EDGE),z=Math.pow(2,R.tileID.overscaledZ-w.tileID.overscaledZ),O=[w.tileID.canonical.x*z%1,w.tileID.canonical.y*z%1]):T.bind(_,h.CLAMP_TO_EDGE),T.useMipmap&&c.extTextureFilterAnisotropic&&e.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);const U=e.transform;let F;const N=l?$r(U):[0,0,0,0];let V,H,j,G,W,q=0;if(u&&d instanceof t.aJ&&d.coordinates.length>3)V=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0)))),H=Float32Array.from(U.globeMatrix),j=Float32Array.from(t.cD(U)),G=[t.at(U.center.lng),t.aA(U.center.lat)],F=d.elevatedGlobePerspectiveTransform,W=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(u){const e=t.cE(C.canonical);q=t.cF(e.getCenter().lat),V=Float32Array.from(t.bb(t.cH(C.canonical))),H=Float32Array.from(U.globeMatrix),j=Float32Array.from(t.cD(U)),G=[t.at(U.center.lng),t.aA(U.center.lat)],F=[0,0],W=Float32Array.from(t.cG(C.canonical,e,q,U.worldSize/U._pixelsPerMercatorPixel))}else F=d instanceof t.aJ?d.perspectiveTransform:[0,0],V=new Float32Array(16),H=new Float32Array(9),j=new Float32Array(16),G=[0,0],W=new Float32Array(9);const Z=hr(k,V,H,j,W,O||[0,0],t.ae(e.transform.zoom),G,N,z||1,L,n,F,l?n.paint.get("raster-elevation"):0,2,A,M,f.range,I,E,p),$=e.isTileAffectedByFog(C),K=e.getOrCreateProgram("raster",{defines:f.defines,overrideFog:$});if(e.uploadCommonUniforms(c,K,o),d instanceof t.aJ){const i=d.elevatedGlobeVertexBuffer,o=d.elevatedGlobeIndexBuffer;if(g||!a)d.boundsBuffer&&d.boundsSegments&&K.draw(e,h.TRIANGLES,P,Ni.disabled,m,ji.disabled,Z,n.id,d.boundsBuffer,e.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&o){const s=U.zoom<=t.c6?d.elevatedGlobeSegments:d.getSegmentsForLongitude(U.center.lng);s&&K.draw(e,h.TRIANGLES,P,Ni.disabled,m,r,Z,n.id,i,o,s)}}else if(u){P=new Ui(h.LEQUAL,Ui.ReadOnly,e.depthRangeFor3D);const t=e.globeSharedBuffers;if(t){const[i,o,s]=t.getGridBuffers(q,!1);K.draw(e,h.TRIANGLES,P,x||B,e.colorModeForRenderPass(),r,Z,n.id,i,o,s)}}else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:i,tileBoundsSegments:o}=e.getTileBoundsBuffers(w);K.draw(e,h.TRIANGLES,P,B,m,ji.disabled,Z,n.id,t,i,o)}}if(!(d instanceof t.aJ)&&u)for(const t of o){const o=t.canonical.y===(1<<t.canonical.z)-1;0===t.canonical.y&&Zr(!0,t,e,i,n,p,f,r,x||Ni.disabled),o&&Zr(!1,t,e,i,n,p,f,r===ji.frontCW?ji.backCW:ji.frontCW,x||Ni.disabled)}};u?C(x,e.renderElevatedRasterBackface?ji.backCW:ji.frontCW,e.stencilModeFor3D()):C(x,ji.disabled,void 0),e.resetStencilClippingMasks()},"raster-particle":function(e,i,n,o,r,s){"offscreen"===e.renderPass&&function(e,i,n,o){if(!o.length)return;const r=e.context,s=r.gl,a=i.getSource();if(!(a instanceof ne))return;const l=Math.ceil(Math.sqrt(n.paint.get("raster-particle-count")));let u=n.particlePositionRGBAImage;if(!u||u.width!==l){const e=function(t){const e=t*t,i=new Uint8Array(4*e),n=function(t){return t|=0,t=Math.imul(2747636419^t,2654435769),t=Math.imul(t^t>>>16,2654435769),((t=Math.imul(t^t>>>16,2654435769))>>>0)/4294967296},o=1/1.1;for(let r=0;r<e;r++){const t=o*(n(2*r+0)+fr),e=o*(n(2*r+1)+fr),s=255*t%1,a=255*e%1,l=s,u=e-a/255,c=a;i[4*r+0]=255*(t-s/255),i[4*r+1]=255*l,i[4*r+2]=255*u,i[4*r+3]=255*c}return i}(l);u=n.particlePositionRGBAImage=new t.r({width:l,height:l},e)}let c=n.particleFramebuffer;c?c.width!==l&&(c.destroy(),c=n.particleFramebuffer=r.createFramebuffer(l,l,!0,null)):c=n.particleFramebuffer=r.createFramebuffer(l,l,!0,null);const h=[];for(const t of o){const e=i.getTile(t);if(!(e instanceof Ce))continue;const o=Xr(e,a,n);if(!o)continue;const s=[e.tileSize,e.tileSize];let c=n.tileFramebuffer;c||(c=n.tileFramebuffer=r.createFramebuffer(s[0],s[1],!0,null));let d=e.rasterParticleState;d||(d=e.rasterParticleState=new Jr(r,t,s,u));const f=d.update(n.lastInvalidatedAt);d.particleTextureDimension!==l&&d.updateParticleTexture(t,u);const p=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=p;const m=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=m,h.push([t,o,d,f])}if(0===h.length)return;const d=t.q.now(),f=n.previousDrawTimestamp?.001*(d-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=d,n.hasColorMap()){r.activeTexture.set(s.TEXTURE0+2);let e=n.colorRampTexture;e||(e=n.colorRampTexture=new t.T(r,n.colorRamp,s.RGBA8)),e.bind(s.LINEAR,s.CLAMP_TO_EDGE)}r.bindFramebuffer.set(n.tileFramebuffer.framebuffer),function(e,i,n){const o=e.context,r=o.gl,s=i.tileFramebuffer;o.activeTexture.set(r.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(u=i.paint.get("raster-particle-fade-opacity-factor"))/(u+.05)},l=e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var u;for(const c of n){const[,,n,u]=c;s.colorAttachment.set(n.targetColorTexture.texture),o.viewport.set([0,0,s.width,s.height]),o.clear({color:t.aj.transparent}),u&&(n.backgroundColorTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),l.draw(e,r.TRIANGLES,Ui.disabled,Ni.disabled,Oi.alphaBlended,ji.disabled,a,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments))}}(e,n,h),function(e,i,n,o){const r=e.context,s=r.gl,a=n.tileFramebuffer,l="globe"===e.transform.projection.name,u=n.paint.get("raster-particle-max-speed");for(const c of o){const[o,h,d]=c;r.activeTexture.set(s.TEXTURE0+0),h.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.colorAttachment.set(d.targetColorTexture.texture);const f=e.getOrCreateProgram("rasterParticleDraw",{defines:h.defines,overrideFog:!1});r.activeTexture.set(s.TEXTURE0+1);const p=h.scalarData?[]:[0,1,2,3].map((e=>t.d4[e](o)));p.push(o);const m=o.canonical.x,g=o.canonical.y;for(const t of p){const r=i.getTile(l?t.wrapped():t);if(!r)continue;const a=r.rasterParticleState;if(!a)continue;const c=t.canonical.x+(1<<t.canonical.z)*(t.wrap-o.wrap),d=t.canonical.y;a.particleTexture0.bind(s.NEAREST,s.CLAMP_TO_EDGE);const p=mr(1,a.particleTexture0.size[0],[c-m,d-g],0,h.texture.size,2,u,h.textureOffset,h.scale,h.offset);f.draw(e,s.POINTS,Ui.disabled,Ni.disabled,Oi.alphaBlended,ji.disabled,p,n.id,a.particleIndexBuffer,void 0,a.particleSegment)}}}(e,i,n,h),r.bindFramebuffer.set(n.particleFramebuffer.framebuffer),function(e,i,n,o){const r=e.context,s=r.gl,a=i.paint.get("raster-particle-max-speed"),l=o*i.paint.get("raster-particle-speed-factor")*.15,u=function(t){return Math.pow(t,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),c=i.particleFramebuffer;r.viewport.set([0,0,c.width,c.height]);for(const h of n){const[,n,o]=h;r.activeTexture.set(s.TEXTURE0+0),n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),r.activeTexture.set(s.TEXTURE0+1);const d=o.particleTexture0;d.bind(s.NEAREST,s.CLAMP_TO_EDGE);const f=gr(1,d.size[0],0,n.texture.size,a,l,u,n.textureOffset,n.scale,n.offset);c.colorAttachment.set(o.particleTexture1.texture),r.clear({color:t.aj.transparent}),e.getOrCreateProgram("rasterParticleUpdate",{defines:n.defines}).draw(e,s.TRIANGLES,Ui.disabled,Ni.disabled,Oi.unblended,ji.disabled,f,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments)}}(e,n,h,f)}(e,i,n,o),"translucent"===e.renderPass&&(function(e,i,n,o){const r=e.context,s=r.gl,a=i.getSource().tileSize,l=5*(1-t.ac(t.bY,t.bY+1,e.transform.zoom))*a+n.paint.get("raster-particle-elevation"),u=!e.options.moving,c="globe"===e.transform.projection.name;if(!o.length)return;const[h,d]=e.stencilConfigForOverlap(o),f=[];c&&f.push("PROJECTION_GLOBE_VIEW");const p=e.stencilModeFor3D();for(const m of d){const o=m.toUnwrapped(),a=i.getTile(m);if(!a.rasterParticleState)continue;const d=a.rasterParticleState,g=100;a.registerFadeDuration(g);const y=i.findLoadedParent(m,0),_=No(a,y,i,e.transform,g);let v,x;e.terrain&&e.terrain.prepareDrawTile(),r.activeTexture.set(s.TEXTURE0),d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),r.activeTexture.set(s.TEXTURE1),y&&y.rasterParticleState?(y.rasterParticleState.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),v=Math.pow(2,y.tileID.overscaledZ-a.tileID.overscaledZ),x=[a.tileID.canonical.x*v%1,a.tileID.canonical.y*v%1]):d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const b=c?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(o,u),C=e.transform,w=Qr(C),S=t.cE(m.canonical),T=t.cF(S.getCenter().lat);let A,M,I,E,P;c?(A=Float32Array.from(t.bb(t.cH(m.canonical))),M=Float32Array.from(C.globeMatrix),I=Float32Array.from(t.cD(C)),E=[t.at(C.center.lng),t.aA(C.center.lat)],P=Float32Array.from(t.cG(m.canonical,S,T,C.worldSize/C._pixelsPerMercatorPixel))):(A=new Float32Array(16),M=new Float32Array(9),I=new Float32Array(16),E=[0,0],P=new Float32Array(9));const k=pr(b,A,M,I,P,x||[0,0],t.ae(e.transform.zoom),E,w,v||1,_,l),B=e.isTileAffectedByFog(m),D=e.getOrCreateProgram("rasterParticle",{defines:f,overrideFog:B});if(e.uploadCommonUniforms(r,D,o),c){const t=new Ui(s.LEQUAL,Ui.ReadOnly,e.depthRangeFor3D),i=0,o=e.globeSharedBuffers;if(o){const[r,a,l]=o.getGridBuffers(T,0!==i);D.draw(e,s.TRIANGLES,t,p,Oi.alphaBlended,e.renderElevatedRasterBackface?ji.frontCCW:ji.backCCW,k,n.id,r,a,l)}}else{const t=e.depthModeForSublayer(0,Ui.ReadOnly),i=h[m.overscaledZ],{tileBoundsBuffer:o,tileBoundsIndexBuffer:r,tileBoundsSegments:l}=e.getTileBoundsBuffers(a);D.draw(e,s.TRIANGLES,t,i,Oi.alphaBlended,ji.disabled,k,n.id,o,r,l)}}e.resetStencilClippingMasks()}(e,i,n,o),e.style.map.triggerRepaint())},background:function(e,i,n,o){const r=n.paint.get("background-color"),s="none"===n.paint.get("background-color-use-theme").constantOr("default"),a=n.paint.get("background-opacity"),l=n.paint.get("background-emissive-strength"),u="viewport"===n.paint.get("background-pitch-alignment");if(0===a)return;const c=e.context,h=c.gl,d=e.transform,f=d.tileSize,p=n.paint.get("background-pattern");let m;if(void 0!==p){if(null===p)return;if(m=e.imageManager.getPattern(p.toString(),n.scope,e.style.getLut(n.scope)),!m)return}const g=!p&&1===r.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==g)return;const y=Ni.disabled,_=e.depthModeForSublayer(0,"opaque"===g?Ui.ReadWrite:Ui.ReadOnly),v=e.colorModeForDrapableLayerRenderPass(l),x=p?"backgroundPattern":"background";let b,C=o;if(C||(b=e.getBackgroundTiles(),C=Object.values(b).map((t=>t.tileID))),p&&(c.activeTexture.set(h.TEXTURE0),e.imageManager.bind(e.context,n.scope)),u){const i=e.getOrCreateProgram(x,{overrideFog:!1,overrideRtt:!0}),o=new Float32Array(t.ab.mat4.identity([])),c=new t.aG(0,0,0,0,0),d=p?xr(o,l,a,e,0,n.scope,m,u,{tileID:c,tileSize:f}):vr(o,l,a,r.toRenderColor(s?null:n.lut));i.draw(e,h.TRIANGLES,_,y,v,ji.disabled,d,n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments)}else for(const t of C){const g=e.isTileAffectedByFog(t),C=e.getOrCreateProgram(x,{overrideFog:g}),w=t.toUnwrapped(),S=o?t.projMatrix:e.transform.calculateProjMatrix(w);e.prepareDrawTile();const T=i?i.getTile(t):b?b[t.key]:new be(t,f,d.zoom,e),A=p?xr(S,l,a,e,0,n.scope,m,u,{tileID:t,tileSize:f}):vr(S,l,a,r.toRenderColor(s?null:n.lut));e.uploadCommonUniforms(c,C,w);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:I,tileBoundsSegments:E}=e.getTileBoundsBuffers(T);C.draw(e,h.TRIANGLES,_,y,v,ji.disabled,A,n.id,M,I,E)}},sky:function(e,i,n){const o=e._atmosphere?t.ae(e.transform.zoom):1,r=n.paint.get("sky-opacity")*o;if(0===r)return;const s=e.context,a=n.paint.get("sky-type"),l=new Ui(s.gl.LEQUAL,Ui.ReadOnly,[0,1]),u=e.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,i){const n=e.context,o=n.gl;let r=i.skyboxFbo;if(!r){r=i.skyboxFbo=n.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new ds(n),i.skyboxTexture=n.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let t=0;t<6;++t)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}n.bindFramebuffer.set(r.framebuffer),n.viewport.set([0,0,32,32]);const s=i.getCenter(e,!0),a=e.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);t.ab.mat4.identity(l),t.ab.mat4.rotateY(l,l,.5*-Math.PI),fs(e,i,a,l,s,0),t.ab.mat4.identity(l),t.ab.mat4.rotateY(l,l,.5*Math.PI),fs(e,i,a,l,s,1),t.ab.mat4.identity(l),t.ab.mat4.rotateX(l,l,.5*-Math.PI),fs(e,i,a,l,s,2),t.ab.mat4.identity(l),t.ab.mat4.rotateX(l,l,.5*Math.PI),fs(e,i,a,l,s,3),t.ab.mat4.identity(l),fs(e,i,a,l,s,4),t.ab.mat4.identity(l),t.ab.mat4.rotateY(l,l,Math.PI),fs(e,i,a,l,s,5),n.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(t,e,i,n,o){const r=t.context,s=r.gl,a=t.transform,l=t.getOrCreateProgram("skybox");r.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,e.skyboxTexture);const u=((t,e,i,n,o)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:o}))(a.skyboxMatrix,e.getCenter(t,!1),0,n,o);t.uploadCommonUniforms(r,l),l.draw(t,s.TRIANGLES,i,Ni.disabled,t.colorModeForRenderPass(),ji.backCW,u,"skybox",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(e,n,l,r,u):"gradient"===a&&"sky"===e.renderPass&&function(e,i,n,o,r){const s=e.context,a=s.gl,l=e.transform,u=e.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new ds(s)),s.activeTexture.set(a.TEXTURE0);let c=i.colorRampTexture;c||(c=i.colorRampTexture=new t.T(s,i.colorRamp,a.RGBA8)),c.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,n,o,r)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.ai(n),u_opacity:o,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),o,r);e.uploadCommonUniforms(s,u),u.draw(e,a.TRIANGLES,n,Ni.disabled,e.colorModeForRenderPass(),ji.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,l,r,u)},debug:function(e,i,n,o,r,s){for(let a=0;a<n.length;a++)if(r){const r=1,l=.8,u=new t.aj(o.r*l,o.g*l,o.b*l,1);rs(e,i,n[a],o,-r,-r,s),rs(e,i,n[a],o,-r,r,s),rs(e,i,n[a],o,r,r,s),rs(e,i,n[a],o,r,-r,s),rs(e,i,n[a],u,0,0,s)}else rs(e,i,n[a],o,0,0,s)},custom:function(e,i,n,o){const r=e.context,s=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isDraped(i)){if("offscreen"===e.renderPass){const i=s.prerender;if(i){if(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;i.call(s,r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.ae(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else i.call(s,r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const i=s.renderToTile;if(i){const n=o[0].canonical,a=new t.aa(n.x+o[0].wrap*(1<<n.z),n.y,n.z);r.setDepthMode(Ui.disabled),r.setStencilMode(Ni.disabled),r.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),i.call(s,r.gl,a),r.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Ni.disabled);const i="3d"===s.renderingMode?new Ui(e.context.gl.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Ui.ReadOnly);if(r.setDepthMode(i),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;s.render(r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.ae(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else s.render(r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,i,n,o){if("opaque"===e.renderPass)return;const r=n.paint.get("model-opacity").constantOr(1);if(0===r)return;const s=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!s)return;if(e.terrain&&r<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof t.a9)return}const a=e.shadowRenderer,l=n.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const u=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},c=i.getSource();if("light-beam"===e.renderPass&&"batched-model"!==c.type)return;if("vector"===c.type||"geojson"===c.type)return function(e,i,n,o,r){const s=e.transform;if("mercator"!==s.projection.name)return void t.w(`Drawing 3D models for ${s.projection.name} projection is not yet implemented`);const a=s.getFreeCameraOptions().position;if(!e.modelManager)return;const l=e.modelManager;n.modelManager=l;const u=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=n._unevaluatedLayout._values["model-id"],h=Object.assign({},n.layout.get("model-id").parameters),d=e.style.order.indexOf(n.fqid);for(const f of o){const o=i.getTile(f).getBucket(n);if(!o||o.projection.name!==s.projection.name)continue;const p=o.getModelUris();p&&!o.modelsRequested&&(l.addModelsFromBucket(p,r),o.modelsRequested=!0);const m=As(f,s);h.zoom=m;const g=c.possiblyEvaluate(h);if(Ss(e,o,f),Ts.shadowUniformsInitialized=!1,Ts.useSingleShadowCascade=!!u&&0===u.getMaxCascadeForTile(f.toUnwrapped()),"shadow"===e.renderPass&&u){if(1===e.currentShadowCascade&&o.isInsideFirstShadowMapFrustum)continue;const i=s.calculatePosMatrix(f.toUnwrapped(),s.worldSize);if(Ts.tileMatrix.set(i),Ts.shadowTileMatrix=Float32Array.from(u.calculateShadowPassMatrixFromMatrix(i)),Ts.aabb.min.fill(0),Ts.aabb.max[0]=Ts.aabb.max[1]=t.ag,Ts.aabb.max[2]=0,Es(o,Ts,e,n.scope))continue}const y=1<<f.canonical.z,_=[((a.x-f.wrap)*y-f.canonical.x)*t.ag,(a.y*y-f.canonical.y)*t.ag,a.z*y*t.ag];e.conflationActive&&Object.keys(o.instancesPerModel).length>0&&e.style.isLayerClipped(n,i.getSource())&&o.updateReplacement(f,e.replacementSource,d,r)&&(o.uploaded=!1,o.upload(e.context));for(let t in o.instancesPerModel){const i=o.instancesPerModel[t];i.features.length>0&&(t=g.evaluate(i.features[0].feature,{}));const s=l.getModel(t,r);if(s&&s.uploaded)for(const t of s.nodes)Ms(e,n,t,i,_,f,Ts)}}}(e,i,n,o,"vector"===c.type?n.scope:""),void u();if(!c.loaded())return;if("batched-model"===c.type)return function(e,i,n,o){n.resetLayerRenderingStats(e);const r=e.context,s=e.transform,a=e.style.fog,l=e.shadowRenderer;if("mercator"!==s.projection.name)return void t.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const u=e.transform.getFreeCameraOptions().position,c=t.ab.vec3.scale([],[u.x,u.y,u.z],e.transform.worldSize),h=t.ab.vec3.negate([],c),d=t.ab.mat4.identity([]),f=t.dj(s.center.lat,s.zoom),p=t.ab.mat4.fromScaling([],[1,1,1/f]);t.ab.mat4.translate(d,d,h);const m=n.paint.get("model-opacity").constantOr(1),g=new Ui(r.gl.LEQUAL,Ui.ReadWrite,e.depthRangeFor3D),y=new Ui(r.gl.LEQUAL,Ui.ReadOnly,e.depthRangeFor3D),_=new t.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),v="shadow"===e.renderPass,x=v&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),b=n.paint.get("model-front-cutoff"),C=b[2]<1,w=tn(e,n.paint.get("model-cutoff-fade-range")),S=n.getLayerRenderingStats();(function(t,e,i,n){const o=t.terrain?t.terrain.exaggeration():0,r=t.transform.zoom;for(const s of n){const n=e.getTile(s).getBucket(i);n&&(t.conflationActive&&n.updateReplacement(s,t.replacementSource),n.evaluateScale(t,i),t.terrain&&o>0&&n.elevationUpdate(t.terrain,o,s,i.source),n.needsReEvaluation(t,r,i)&&n.evaluate(i))}})(e,i,n,o),function(){let u,h,T;C?(u=o.length-1,h=-1,T=-1):(u=0,h=o.length,T=1);const A=new Float64Array(16),M=t.ab.vec3.create(),I=new t.P(0,0);for(let E=u;E!==h;E+=T){const u=o[E],h=i.getTile(u).getBucket(n);if(!h||!h.uploaded)continue;let T=!1;l&&(T=0===l.getMaxCascadeForTile(u.toUnwrapped()));const P=s.calculatePosMatrix(u.toUnwrapped(),s.worldSize),k=h.modelTraits;!v&&C&&(t.ab.mat4.invert(A,P),t.ab.vec3.transformMat4(M,c,A),I.x=M[0],I.y=M[1]);const B=[];for(const i of h.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const n=i.node;let o=0;e.terrain&&n.elevation&&(o=n.elevation*e.terrain.exaggeration());const r=(()=>{const e=i.aabb;return _.min=[...e.min],_.max=[...e.max],_.min[2]+=o,_.max[2]+=o,t.ab.vec3.transformMat4(_.min,_.min,P),t.ab.vec3.transformMat4(_.max,_.max,P),_})(),a=i.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===r.intersects(x))continue;if(!v&&C){const e=1/6;i.cameraCollisionOpacity=c[0]>r.min[0]&&c[0]<r.max[0]&&c[1]>r.min[1]&&c[1]<r.max[1]&&c[2]*f<r.max[2]&&n.footprint&&t.bA(I,n.footprint)?Math.max(i.cameraCollisionOpacity-e,0):Math.min(1,i.cameraCollisionOpacity+e)}const l=[...P],u=n.anchor?n.anchor[0]:0,h=n.anchor?n.anchor[1]:0;t.ab.mat4.translate(l,l,[u*(a[0]-1),h*(a[1]-1),o]),t.ab.vec3.exactEquals(a,t.dm)||t.ab.mat4.scale(l,l,a);const d=t.ab.mat4.multiply([],l,n.matrix),p=t.ab.mat4.multiply([],s.expandedFarZProjMatrix,d),g=t.ab.mat4.multiply([],s.expandedFarZProjMatrix,l),y=t.ab.vec4.transformMat4([],[u,h,o,1],p)[2];n.hidden=!1;let S=m;v||(C&&(S*=i.cameraCollisionOpacity,S*=ks(l,s,i.aabb,b)),S*=Ps(w,y)),0!==S?B.push({nodeInfo:i,depth:y,opacity:S,wvpForNode:p,wvpForTile:g,nodeModelMatrix:d,tileModelMatrix:l}):n.hidden=!0}v||B.sort(((t,e)=>!C||1===t.opacity&&1===e.opacity?t.depth<e.depth?-1:1:1===t.opacity?-1:1===e.opacity?1:t.depth>e.depth?-1:1));for(const i of B){const o=i.nodeInfo,u=o.node;let c=t.ab.mat4.multiply([],p,i.tileModelMatrix);t.ab.mat4.multiply(c,d,c);const h=t.ab.mat4.invert([],c);t.ab.mat4.transpose(h,h),t.ab.mat4.scale(h,h,Is),c=t.ab.mat4.multiply(c,c,u.matrix);const f="light-beam"===e.renderPass,m="none"===n.paint.get("model-color-use-theme").constantOr("default"),_=k&t.dp.HasMapboxMeshFeatures,x=_?0:o.evaluatedRMEA[0][2];for(let t=0;t<u.meshes.length;++t){const d=u.meshes[t],p=t===u.lightMeshIndex;let b=i.wvpForNode;if(p){if(!f&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}b=i.wvpForTile}else if(f)continue;const C={defines:[]},w=[];if(!v&&l&&(l.useNormalOffset=!!d.normalBuffer),xs(C.defines,w,d,e,m?null:n.lut),_||C.defines.push("DIFFUSE_SHADED"),T&&C.defines.push("SHADOWS_SINGLE_CASCADE"),S&&(v?S.numRenderedVerticesInShadowPass+=d.vertexArray.length:S.numRenderedVerticesInTransparentPass+=d.vertexArray.length),v){ws(d,i.nodeModelMatrix,e,n);continue}let A=null;if(a){const t=vs(i.nodeModelMatrix,e.transform);if(A=new Float32Array(t),"globe"!==s.projection.name){const e=d.aabb.min,i=d.aabb.max,[n,o]=a.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);C.overrideFog=n>=zt||o>=zt}}const M=d.material;let I;M.occlusionTexture&&M.occlusionTexture.offsetScale&&(I=M.occlusionTexture.offsetScale,C.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const E=e.getOrCreateProgram("model",C);!v&&l&&l.setupShadowsFromMatrix(i.tileModelMatrix,E,l.useNormalOffset),e.uploadCommonUniforms(r,E,null,A);const P=M.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;const k=Cr(new Float32Array(b),new Float32Array(c),new Float32Array(h),new Float32Array(u.matrix),e,i.opacity,P.baseColorFactor.toRenderColor(null),M.emissiveFactor,P.metallicFactor,P.roughnessFactor,M,x,n,[0,0,0],I);!p&&(o.hasTranslucentParts||i.opacity<1)&&E.draw(e,r.gl.TRIANGLES,g,Ni.disabled,Oi.disabled,ji.backCCW,k,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,w),E.draw(e,r.gl.TRIANGLES,p?y:g,Ni.disabled,p||i.opacity<1||o.hasTranslucentParts?Oi.alphaBlended:Oi.unblended,ji.backCCW,k,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,w)}}}}()}(e,i,n,o),void u();if("model"!==c.type)return;const h=c.getModels(),d=[],f=e.transform.getFreeCameraOptions().position,p=t.ab.vec3.scale([],[f.x,f.y,f.z],e.transform.worldSize);t.ab.vec3.negate(p,p);const m=[],g=[];let y=0;for(const _ of h){const i=n.paint.get("model-rotation").constantOr(null),o=n.paint.get("model-scale").constantOr(null),r=n.paint.get("model-translation").constantOr(null);_.computeModelMatrix(e,i,o,r,!0,!0,!1);const s=t.ab.mat4.identity([]),a=t.dj(_.position.lat,e.transform.zoom),l=t.ab.mat4.fromScaling([],[1,1,1/a]);t.ab.mat4.translate(s,s,p),d.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const t of _.nodes)Cs(e.transform,t,_.matrix,e.transform.expandedFarZProjMatrix,y,m,g);y++}if(m.sort(((t,e)=>e.depth-t.depth)),"shadow"!==e.renderPass){if(1===r)for(const t of g)bs(t,e,n,d[t.modelIndex],Ni.disabled,e.colorModeForRenderPass());else{for(const t of g)bs(t,e,n,d[t.modelIndex],Ni.disabled,Oi.disabled);for(const t of g)bs(t,e,n,d[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of m)bs(t,e,n,d[t.modelIndex],Ni.disabled,e.colorModeForRenderPass());u()}else{for(const t of g)ws(t.mesh,t.nodeModelMatrix,e,n);for(const t of m)ws(t.mesh,t.nodeModelMatrix,e,n);u()}}},Ks={line:function(t,e,i){if(t.hasElevatedBuckets=!1,t.hasNonElevatedBuckets=!1,void 0!==t._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==t._unevaluatedLayout.getValue("line-z-offset")){if(e){const i=e.getVisibleCoordinates();for(const n of i){const i=e.getTile(n).getBucket(t);if(i&&(i.hasZOffset?t.hasElevatedBuckets=!0:t.hasNonElevatedBuckets=!0,t.hasElevatedBuckets&&t.hasNonElevatedBuckets))break}}}else t.hasNonElevatedBuckets=!0},model:function(t,e,i){const n=e.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===n.type?t.scope:""));if("batched-model"===n.type)return;if("model"!==n.type)return;const o=n.getModels();for(const r of o)r.upload(i.context)},raster:function(t,e,i){const n=e.getSource();if(!(n instanceof ne&&n.loaded()))return;const o=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!o)return;const r=t.paint.get("raster-array-band")||n.getInitialBand(o);if(null==r)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const a of s)a.updateNeeded(o,r)&&n.prepareTile(a,o,r)},"raster-particle":function(t,e,i){const n=e.getSource();if(!(n instanceof ne&&n.loaded()))return;const o=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!o)return;const r=t.paint.get("raster-particle-array-band")||n.getInitialBand(o);if(null==r)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const a of s)a.updateNeeded(o,r)&&n.prepareTile(a,o,r)}};class Ys{constructor(e,i,n,o,r){this.context=new Er(e,i),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=r,this._timeStamp=t.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const s=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const t of s)this._debugParams.enabledLayers[t]=!0;r.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),r.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),r.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),r.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),r.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),r.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const t of s)r.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],t);this.occlusionParams=new Rs(r),this.setup(),this.numSublayers=Te.maxUnderzooming+Te.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new rn(this),this._wireframeDebugCache=new Ds,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const a=new t.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new t.T(this.context,a,e.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=o}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Go(this,t));const n=this._terrain;this.transform.elevation=i?n:null,n.update(t,this.transform,e),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=e.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const o=i+.78*(n-i);this.transform.fogCullDistSq=o*o}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Go(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*t.q.devicePixelRatio,this.height=i*t.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const e=this.context,i=new t.b4;i.emplaceBack(0,0),i.emplaceBack(t.ag,0),i.emplaceBack(0,t.ag),i.emplaceBack(t.ag,t.ag),this.tileExtentBuffer=e.createVertexBuffer(i,t.b6.members),this.tileExtentSegments=t.b7.simpleSegment(0,0,4,2);const n=new t.b4;n.emplaceBack(0,0),n.emplaceBack(t.ag,0),n.emplaceBack(0,t.ag),n.emplaceBack(t.ag,t.ag),this.debugBuffer=e.createVertexBuffer(n,t.b6.members),this.debugSegments=t.b7.simpleSegment(0,0,4,5);const o=new t.b4;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(-1,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,t.b6.members),this.viewportSegments=t.b7.simpleSegment(0,0,4,2);const r=new t.aT;r.emplaceBack(0,0,0,0),r.emplaceBack(t.ag,0,t.ag,0),r.emplaceBack(0,t.ag,0,t.ag),r.emplaceBack(t.ag,t.ag,t.ag,t.ag),this.mercatorBoundsBuffer=e.createVertexBuffer(r,t.b9.members),this.mercatorBoundsSegments=t.b7.simpleSegment(0,0,4,2);const s=new t.aU;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.b5;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.T(e,new t.r({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA8),this.identityMat=t.ab.mat4.create();const l=this.context.gl;this.stencilClearMode=new Ni({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ui.disabled,this.stencilClearMode,Oi.disabled,ji.disabled,Fo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,e,i){if(!e||this.currentStencilSource===e.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of i)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=e.id;const n=this.context,o=n.gl;this.nextStencilID+i.length>256&&this.clearStencil(),n.setColorMode(Oi.disabled),n.setDepthMode(Ui.disabled);const r=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of i){const t=e.getTile(s),i=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:n,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(t);r.draw(this,o.TRIANGLES,Ui.disabled,new Ni({func:o.ALWAYS,mask:0},i,255,o.KEEP,o.KEEP,o.REPLACE),Oi.disabled,ji.disabled,Fo(s.projMatrix),"$clipping",n,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ni({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const e=this.context.gl;return new Ni({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,o=i[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let i=0;i<o;i++)t[i+n]=new Ni({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=o,[t,i]}return[{[n]:Ni.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Oi([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new t.aj(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Oi.unblended:Oi.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Oi([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new t.aj(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new Ui(this.context.gl.GREATER,Ui.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return Ui.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ui(i||this.context.gl.LEQUAL,e,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const e=this.context.gl,i=Math.ceil(this.width),n=Math.ceil(this.height),o=this.context.bindFramebuffer.get(),r=e.getParameter(e.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===n||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==i&&0!==n&&(this.depthFBO=new Ir(this.context,i,n,!1,"texture"),this.depthTexture=new t.T(this.context,{width:i,height:n,data:null},e.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(o),e.bindTexture(e.TEXTURE_2D,r),this.depthFBO&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),e.blitFramebuffer(0,0,i,n,0,0,i,n,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,e)=>t+e/this._fpsHistory.length),0))}render(e,i){const n=t.q.now();this._dt=n-this._timeStamp,this._timeStamp=n,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=e.map.repaint,this.style=e,this.options=i;const o=this.style._mergedLayers,r=!(!this.terrain||!this.terrain.enabled),s=()=>this.style._getOrder(r).filter((t=>{const e=o[t];return!(e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[e.type]}));let a=s(),l=!1,u=!1;for(const t of a){const e=o[t];"circle"===e.type&&(l=!0),"symbol"===e.type&&(e.hasInitialOcclusionOpacityProperties?u=!0:l=!0)}let c=a.map((t=>o[t]));const h=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.q.now()),this.imageManager.beginFrame();let d=0,f=!1;for(const t in h){const e=h[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++d)}let p=!1;for(const t of c)t.isHidden(this.transform.zoom)||("clip"===t.type&&(p=!0),this.prepareLayer(t));const m={},g={},y={},_={},v={};for(const t in h){const e=h[t];m[t]=e.getVisibleCoordinates(),g[t]=m[t].slice().reverse(),y[t]=e.getVisibleCoordinates(!0).reverse(),_[t]=e.getShadowCasterCoordinates(),v[t]=e.sortCoordinatesByDistance(m[t])}const x=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(d||p||this._clippingActiveLastFrame){const e=[],i=[];let n=0;for(const t of c)this.isSourceForClippingOrConflation(t,x(t))&&(e.push(t),i.push(n)),n++;if(e&&(p||e.length>1)||this._clippingActiveLastFrame){p=!1;const n=[];for(let o=0;o<e.length;o++){const r=e[o],s=i[o],a=this.style.getLayerSourceCache(r);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==r.type)continue;let l=t.dx,u=t.by.None;const c=[];let h=!0;if("clip"===r.type){l=s;for(const e of r.layout.get("clip-layer-types"))u|="model"===e?t.by.Model:"symbol"===e?t.by.Symbol:t.by.FillExtrusion;for(const t of r.layout.get("clip-layer-scope"))c.push(t);r.isHidden(this.transform.zoom)?h=!1:p=!0}h&&n.push({layer:r.fqid,cache:a,order:l,clipMask:u,clipScope:c})}this.replacementSource.setSources(n),f=!0}}this._clippingActiveLastFrame=p,f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let t=0;t<c.length;t++){const e=c[t],i=e.cutoffRange();if(this.longestCutoffRange=Math.max(i,this.longestCutoffRange),i>0){const t=x(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}e.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=t),this._lastOcclusionLayer=t)}const b=this.style&&this.style.fog;b?(this._fogVisible=0!==b.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=b.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,a=s(),c=a.map((t=>o[t])));const C=this._shadowRenderer;if(C){C.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in h)for(const e of m[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),C.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _s(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const w=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),S=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(w&&!this._snow&&(this._snow=new Zs(this)),!w&&this._snow&&(this._snow.destroy(),delete this._snow),S&&!this._rain&&(this._rain=new Ws(this)),!S&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!N.has(this.context.gl))return;this.renderPass="offscreen";for(const t of c){const i=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=i?g[i.id]:void 0;("custom"===t.type||"raster"===t.type||"raster-particle"===t.type||t.isSky()||n&&n.length)&&this.renderLayer(this,i,t,n)}this.depthRangeFor3D=[0,1-(c.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const T="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),A=(()=>{if(i.showOverdrawInspector)return t.aj.black;const e=this.style.fog;if(e&&this.transform.projection.supportsFog){const i=this.style.getLut(e.scope);if(!T){const n="none"===e.properties.get("color-use-theme"),o=e.properties.get("color").toRenderColor(n?null:i).toArray01();return new t.aj(...o)}if(T){const n="none"===e.properties.get("space-color-use-theme"),o=e.properties.get("space-color").toRenderColor(n?null:i).toArray01();return new t.aj(...o)}}return t.aj.transparent})();if(this.context.clear({color:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const t=c[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())continue;const n=i?(t.is3D()?v:g)[i.id]:void 0;this._renderTileClippingMasks(t,i,n),this.renderLayer(this,i,t,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.ae(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const t=c[this.currentLayer],i=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?g[i.id]:void 0)}function M(t,e){let i;return e&&(i=("symbol"===t.type?y:t.is3D()?v:g)[e.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const t=c[this.currentLayer];if("raster"===t.type||"raster-particle"===t.type){const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,M(t,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let I=0;C&&(I=C.getShadowCastingLayerCount());let E=!1,P=-1;for(let t=0;t<a.length;++t){const e=c[t];e.isHidden(this.transform.zoom)||e.is3D()&&(P=t)}for(u&&-1===P&&(l=!0);this.currentLayer<a.length;){const t=c[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(l&&!E&&this.terrain&&!this.transform.isOrthographic&&(E=!0,this.blitDepth()),u&&-1!==P&&this.currentLayer===P+1&&!this.transform.isOrthographic&&this.blitDepth(),t.is3D()||this.terrain||this._renderTileClippingMasks(t,i,i?m[i.id]:void 0),this.renderLayer(this,i,t,M(t,i)),!this.terrain&&C&&I>0&&t.hasShadowPass()&&0==--I&&(C.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=c[this.currentLayer];if(!t.hasLightBeamPass())continue;const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,i?g[i.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const t=this.currentLayer;this.depthOcclusion=!0;for(const i of this.layersWithOcclusionOpacity){this.currentLayer=i;const t=c[this.currentLayer],n=e.getLayerSourceCache(t),o=n?g[n.id]:void 0;t.is3D()||this.terrain||this._renderTileClippingMasks(t,n,n?m[n.id]:void 0),this.renderLayer(this,n,t,o)}this.depthOcclusion=!1,this.currentLayer=t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;c.forEach((t=>{const n=e.getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&$s.debug(this,i,i.getVisibleCoordinates(),t.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&$s.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(t){const e=t.transform.padding;ss(t,t.transform.height-(e.top||0),3,ts),ss(t,e.bottom||0,3,es),as(t,e.left||0,3,is),as(t,t.transform.width-(e.right||0),3,ns);const i=t.transform.centerPoint;!function(t,e,i,n){ls(t,e-1,i-10,2,20,n),ls(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,os)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:e}=this.transform.projection,i=!e||!e.includes(t.type);if(Ks[t.type]&&(i||this.terrain&&"custom"===t.type)){const e=this.style.getLayerSourceCache(t);Ks[t.type](t,e,this)}this.gpuTimingEnd()}renderLayer(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(i.type)&&(!t.terrain||"custom"!==i.type)||"clip"===i.type||$s[i.type](t,e,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,i=this.context.gl;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),n.calls++,i.beginQuery(e.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,i=e.createQuery();this.deferredRenderGpuTimeQueries.push(i),e.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const n=t[i],o=this.context.extTimerQuery,r=o.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;o.deleteQueryEXT(n.query),e[i]=r}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.gl;let i=0;for(const n of t)i+=e.getQueryParameter(n,e.QUERY_RESULT)/1e6,e.deleteQuery(n);return i}translatePosMatrix(e,i,n,o,r){if(!n[0]&&!n[1])return e;const s=r?"map"===o?this.transform.angle:0:"viewport"===o?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[r?n[0]:t.ar(i,n[0],this.transform.zoom),r?n[1]:t.ar(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return t.ab.mat4.translate(l,e,a),l}saveTileTexture(t){const e=t.size[0],i=this._tileTextures[e];i?i.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,i){const n=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||o.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||n||void 0!==e&&!e||o.push("FOG","FOG_DITHERING"),n&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(t,e){this.cache=this.cache||{};const i=e&&e.defines||[],n=e&&e.config,o=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(i),r=$o.cacheKey(Nn[t],t,o,n);return this.cache[r]||(this.cache[r]=new $o(this.context,t,Nn[t],n,Sr[t],o)),this.cache[r]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const n=this.style.directionalLight,o=this.style.ambientLight;if(n&&o){const r=((e,i,n)=>{const o=e.properties.get("direction"),r="none"===e.properties.get("color-use-theme"),s=e.properties.get("color").toRenderColor(r?null:n.getLut(e.scope)).toArray01(),a=e.properties.get("intensity"),l="none"===i.properties.get("color-use-theme"),u=i.properties.get("color").toRenderColor(l?null:n.getLut(i.scope)).toArray01(),c=i.properties.get("intensity"),h=[o.x,o.y,o.z],d=t.cM(u,c),f=t.cM(s,a);return{u_lighting_ambient_color:d,u_lighting_directional_dir:h,u_lighting_directional_color:f,u_ground_radiance:Wo(h,f,d)}})(n,o,this.style);i.setLightsUniformValues(e,r)}}}uploadCommonUniforms(e,i,n,o,r){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const r=s.getOpacity(this.transform.pitch),a=((e,i,n,o,r,s,a,l,u,c,h,d)=>{const f=e.transform,p="none"===i.properties.get("color-use-theme"),m=i.properties.get("color").toRenderColor(p?null:e.style.getLut(i.scope)).toArray01();m[3]=o;const g=e.frameCounter/1e3%1,[y,_]=i.properties.get("vertical-range");return{u_fog_matrix:n?f.calculateFogTileMatrix(n):d||e.identityMat,u_fog_range:i.getFovAdjustedRange(f._fov),u_fog_color:m,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(y,_),_],u_fog_temporal_offset:g,u_frustum_tl:r,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:u,u_globe_radius:c,u_viewport:h,u_globe_transition:t.ae(f.zoom),u_is_globe:+("globe"===f.projection.name)}})(this,s,n,r,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.q.devicePixelRatio,this.transform.height*t.q.devicePixelRatio],o);i.setFogUniformValues(e,a)}r&&i.setCutoffUniformValues(e,r.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,e=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const n of i)e[n.key]=t[n.key]||new be(n,512,this.transform.tileZoom,this);return e}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,e){return!(!t.is3D()||"clip"!==t.type&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==t.sourceLayer)&&(!e||"batched-model"!==e.type)))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=zt||e[1]>=zt}setupDepthForOcclusion(t,e,i){const n=this.context,o=n.gl,r=!!i;var s;i||(i={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),n.activeTexture.set(o.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),i.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],i.u_depth_range_unpack=[2/((s=this.depthRangeFor3D)[1]-s[0]),-1-2*s[0]/(s[1]-s[0])],i.u_occluder_half_size=.5*this.occlusionParams.occluderSize,i.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),n.activeTexture.set(o.TEXTURE0),r||e.setTerrainUniformValues(n,i)}}function Js(t,e){let i=!1,n=null;const o=()=>{n=null,i&&(t(),n=setTimeout(o,e),i=!1)};return()=>(i=!0,n||o(),n)}class Xs{constructor(e){this._hashName=e&&encodeURIComponent(e),t.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Js(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=Qs(t);if(this._hashName){const t=this._hashName;let i=!1;const n=location.hash.slice(1).split("&").map((n=>{const o=n.split("=")[0];return o===t?(i=!0,`${o}=${e}`):n})).filter((t=>t));return i||n.push(`${t}=${e}`),`#${n.join("&")}`}return`#${e}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Qs(t,e){const i=t.getCenter(),n=Math.round(100*t.getZoom())/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,o),s=Math.round(i.lng*r)/r,a=Math.round(i.lat*r)/r,l=t.getBearing(),u=t.getPitch();let c=e?`/${s}/${a}/${n}`:`${n}/${a}/${s}`;return(l||u)&&(c+="/"+Math.round(10*l)/10),u&&(c+=`/${Math.round(u)}`),c}const ta={linearity:.3,easing:t.dy(0,0,.3,1)},ea=t.l({deceleration:2500,maxSpeed:1400},ta),ia=t.l({deceleration:20,maxSpeed:1400},ta),na=t.l({deceleration:1e3,maxSpeed:360},ta),oa=t.l({deceleration:1e3,maxSpeed:90},ta);class ra{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.q.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(i.pan.mag()){const r=aa(i.pan.mag(),n,t.l({},ea,e||{}));o.offset=i.pan.mult(r.amount/i.pan.mag()),o.center=this._map.transform.center,sa(o,r)}if(i.zoom){const t=aa(i.zoom,n,ia);o.zoom=this._map.transform.zoom+t.amount,sa(o,t)}if(i.bearing){const e=aa(i.bearing,n,na);o.bearing=this._map.transform.bearing+t.aw(e.amount,-179,179),sa(o,e)}if(i.pitch){const t=aa(i.pitch,n,oa);o.pitch=this._map.transform.pitch+t.amount,sa(o,t)}if(o.zoom||o.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;o.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),o.noMoveStart=!0,o}}function sa(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function aa(e,i,n){const{maxSpeed:o,linearity:r,deceleration:s}=n,a=t.aw(e*r/(i/1e3),-o,o),l=Math.abs(a)/(s*r);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class la extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=y(i.getCanvasContainer(),n),s=i.unproject(r);super(e,t.l({point:r,lngLat:s,originalEvent:n},o)),this._defaultPrevented=!1,this.target=i}}class ua extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){const o="touchend"===e?n.changedTouches:n.touches,r=_(i.getCanvasContainer(),o),s=r.map((t=>i.unproject(t))),a=r.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new t.P(0,0));super(e,{points:r,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class ca extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e){super("wheel",{originalEvent:e}),this._defaultPrevented=!1}}class ha{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ca(this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new la(t.type,this._map,t))}mouseup(t){this._map.fire(new la(t.type,this._map,t))}preclick(e){const i=t.l({},e);i.type="preclick",this._map.fire(new la(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new la(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new la(t.type,this._map,t))}mouseover(t){this._map.fire(new la(t.type,this._map,t))}mouseout(t){this._map.fire(new la(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ua(t.type,this._map,t))}touchmove(t){this._map.fire(new ua(t.type,this._map,t))}touchend(t){this._map.fire(new ua(t.type,this._map,t))}touchcancel(t){this._map.fire(new ua(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class da{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new la(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new la("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new la(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fa{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(f(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,n=this._startPos,o=this._lastPos;if(!n||!o||o.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(n.x,i.x),s=Math.max(n.x,i.x),a=Math.min(n.y,i.y),u=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${r}px,${a}px)`,this._box.style.width=s-r+"px",this._box.style.height=u-a+"px")}))}mouseupWindow(e,i){if(!this._active)return;const n=this._startPos,o=i;if(n&&0===e.button){if(this.reset(),g(),n.x!==o.x||n.y!==o.y)return this._map.fire(new t.z("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,o,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),p(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.z(e,{originalEvent:i}))}}function pa(t,e){const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class ma{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=pa(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=pa(i,e);for(const o in this.touches){const t=n[o];(!t||t.dist(this.touches[o])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class ga{constructor(t){this.singleTap=new ma(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class ya{constructor(){this._zoomIn=new ga({numTouches:1,numTaps:2}),this._zoomOut=new ga({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),o=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):o?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _a={0:1,2:2};class va{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=v(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=_a[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&v(t)===this._eventButton&&(this._moved&&g(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa extends va{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class ba extends va{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class Ca extends va{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class wa{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(e,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!t.dz())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,n)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,n){n.length>0&&(this._active=!0);const o=pa(n,i),r=new t.P(0,0),s=new t.P(0,0);let a=0;for(const t in o){const e=o[t],i=this._touches[t];i&&(r._add(e),s._add(e.sub(i)),a++,o[t]=e)}if(this._touches=o,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:r.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Sa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const n=this._firstTwoTouches;if(!n)return;t.preventDefault();const[o,r]=n,s=Ta(i,e,o),a=Ta(i,e,r);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,o]=this._firstTwoTouches,r=Ta(i,e,n),s=Ta(i,e,o);r&&s||(this._active&&g(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ta(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function Aa(t,e){return Math.log(t/e)/Math.LN2}class Ma extends Sa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Aa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Aa(this._distance,i),pinchAround:e}}}function Ia(t,e){return 180*t.angleWith(e)/Math.PI}class Ea extends Sa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ia(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=Ia(t,i);return Math.abs(n)<e}}function Pa(t){return Math.abs(t.y)>Math.abs(t.x)}class ka extends Sa{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Pa(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,i,n){const o=this._lastPoints;if(!o)return;const r=e[0].sub(o[0]),s=e[1].sub(o[1]);return this._map._cooperativeGestures&&!t.dz()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(r,s,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+s.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,o=e.mag()>=2;if(!n&&!o)return;if(!n||!o)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const r=t.y>0==e.y>0;return Pa(t)&&Pa(e)&&r}}const Ba={panStep:100,bearingStep:15,pitchStep:10};class Da{constructor(){const t=Ba;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,o=0,r=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),r=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),r=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ra,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-o*this._panStep,-r*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ra(t){return t*(2-t)}const La=4.000244140625,za=1/450;class Oa{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=za,t.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.dz()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.q.now(),o=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%La==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=y(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>La?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const o=i(),r=Math.pow(2,o),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):r;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=o,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),o=this._startZoom,r=this._easing;let s,a=!1;if("wheel"===this._type&&o&&r){const e=Math.min((t.q.now()-this._lastWheelEventTime)/200,1),i=r(e);s=t.af(o,n,i),e<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=s-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.dA;if(this._prevEase){const e=this._prevEase,n=(t.q.now()-e.start)/e.duration,o=e.easing(n+.01)-e.easing(n),r=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-r*r);i=t.dy(r,s,.25,1)}return this._prevEase={start:t.q.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Ua{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Na{constructor(){this._tap=new ga({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],o=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:o/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ha{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ja{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ga=t=>t.zoom||t.drag||t.pitch||t.rotate;class Wa extends t.z{}class qa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const n=t.ab.vec3.sub([],i,e);this.radius=t.ab.vec3.length(n[2]<0?t.ab.vec3.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.ab.vec3.div(e,e,this.constants),t.ab.vec3.normalize(e,e),t.ab.vec3.mul(e,e,this.constants);const i=t.ab.vec3.scale([],e,this.radius);if(i[2]>0){const e=t.ab.vec3.scale([],[0,0,1],t.ab.vec3.dot(i,[0,0,1])),n=t.ab.vec3.scale([],t.ab.vec3.normalize([],[i[0],i[1],0]),this.radius),o=t.ab.vec3.add([],i,t.ab.vec3.scale([],t.ab.vec3.sub([],t.ab.vec3.add([],n,e),i),2));i[0]=o[0],i[1]=o[1]}return i}}function Za(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class $a{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ra(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new qa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.aP(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,o,r]of this._listeners){const e=t===document?this.handleWindowEvent:this.handleEvent;t.addEventListener(o,e,r)}}destroy(){for(const[t,e,i]of this._listeners){const n=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(e,n,i)}}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new ha(e,t));const n=e.boxZoom=new fa(e,t);this._add("boxZoom",n);const o=new ya,r=new Fa;e.doubleClickZoom=new Ua(r,o),this._add("tapZoom",o),this._add("clickZoom",r);const s=new Na;this._add("tapDragZoom",s);const a=e.touchPitch=new ka(e);this._add("touchPitch",a);const l=new ba(t),u=new Ca(t);e.dragRotate=new Ha(t,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);const c=new xa(t),h=new wa(e,t);e.dragPan=new Va(i,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Ea,f=new Ma;e.touchZoomRotate=new ja(i,f,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new da(e));const p=e.scrollZoom=new Oa(e,this);this._add("scrollZoom",p,["mousePan"]);const m=e.keyboard=new Da;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ga(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,o={needsRenderFrame:!1},r={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?_(this._el,a):i?void 0:y(this._el,t);for(const{handlerName:h,handler:d,allowed:f}of this._handlers){if(!d.isEnabled())continue;let i;this._blockedByActive(s,f,h)?d.reset():d[e||t.type]&&(i=d[e||t.type](t,l,a),this.mergeHandlerResult(o,r,i,h,n),i&&i.needsRenderFrame&&this._triggerRenderFrame()),(i||d.isActive())&&(s[h]=d)}const u={};for(const h in this._previousActiveHandlers)s[h]||(u[h]=n);this._previousActiveHandlers=s,(Object.keys(u).length||Za(o))&&(this._changes.push([o,r,u]),this._triggerRenderFrame()),(Object.keys(s).length||Za(o))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=o;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))}mergeHandlerResult(e,i,n,o,r){if(!n)return;t.l(e,n);const s={handlerName:o,originalEvent:n.originalEvent||r};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},n={};for(const[o,r,s]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),void 0!==o.around&&(e.around=o.around),void 0!==o.aroundCoord&&(e.aroundCoord=o.aroundCoord),void 0!==o.pinchAround&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),t.l(i,r),t.l(n,s);this._updateMapTransform(e,i,n),this._changes=[]}_updateMapTransform(e,i,n){const o=this._map,r=o.transform,s=t=>[t.x,t.y,t.z];if((()=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Za(e)){const t=r.zoom;r.cameraElevationReference="sea",null!=this._originalZoom&&r._orthographicProjectionAtLowPitch&&"globe"!==r.projection.name&&0===r.pitch?(r.cameraElevationReference="ground",r.zoom=this._originalZoom):(r.recenterOnTerrain(),r.cameraElevationReference="ground"),t!==r.zoom&&this._map._update(!0)}if(r._isCameraConstrained&&o._stop(!0),!Za(e))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:u,pitchDelta:c,around:h,aroundCoord:d,pinchAround:f}=e;r._isCameraConstrained&&(l>0&&(l=0),r._isCameraConstrained=!1),void 0!==f&&(h=f),(l||(t=>i[t]&&!this._eventsInProgress[t])("drag"))&&h&&(this._dragOrigin=s(r.pointCoordinate3D(h)),this._originalZoom=r.zoom,this._trackingEllipsoid.setup(r._camera.position,this._dragOrigin)),r.cameraElevationReference="sea",o._stop(!0),h=h||o.transform.centerPoint,u&&(r.bearing+=u),c&&(r.pitch+=c),r._updateCameraState();const p=[0,0,0];if(a)if("mercator"===r.projection.name){const t=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(h).dir),e=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(h.sub(a)).dir);p[0]=e[0]-t[0],p[1]=e[1]-t[1]}else{const e=r.pointCoordinate(h);if("globe"===r.projection.name){a=a.rotate(-r.angle);const i=r._pixelsPerMercatorPixel/r.worldSize;p[0]=-a.x*t.dB(t.aS(e.y))*i,p[1]=-a.y*t.dB(r.center.lat)*i}else{const t=r.pointCoordinate(h.sub(a));e&&t&&(p[0]=t.x-e.x,p[1]=t.y-e.y)}}const m=r.zoom,g=[0,0,0];if(l){const e=s(d||r.pointCoordinate3D(h)),i={dir:t.ab.vec3.normalize([],t.ab.vec3.sub([],e,r._camera.position))};if(i.dir[2]<0){const n=r.zoomDeltaToMovement(e,l);t.ab.vec3.scale(g,i.dir,n)}}const y=t.ab.vec3.add(p,p,g);r._translateCameraConstrained(y),l&&Math.abs(r.zoom-m)>1e-4&&r.recenterOnTerrain(),r.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,n,!0)}_fireEvents(e,i,n){const o=Ga(this._eventsInProgress),r=Ga(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!o&&r&&this._fireEvent("movestart",r.originalEvent);for(const t in s)this._fireEvent(t,s[t]);r&&this._fireEvent("move",r.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||n,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const u=Ga(this._eventsInProgress);if(n&&(o||r)&&!u){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.z("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.z(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Wa("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ka="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ya extends t.E{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,t.aP(["_renderFrameCallback"],this)}getCenter(){return new t.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,n){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.l({offset:e},i),n)}panTo(e,i,n){return this.easeTo(t.l({center:e},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,n){return this.easeTo(t.l({zoom:e},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,n){return this.easeTo(t.l({bearing:e},i),n)}resetNorth(e,i){return this.rotateTo(0,t.l({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.l({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.az.convert(e);const n=i&&i.bearing||0,o=i&&i.pitch||0,r=e.getNorthWest(),s=e.getSouthEast();return this._cameraForBounds(this.transform,r,s,n,o,i)}_extendPadding(e){const i={top:0,right:0,bottom:0,left:0};return null==e?t.l({},i,this.transform.padding):"number"==typeof e?{top:e,bottom:e,right:e,left:e}:t.l({},i,e)}_extendCameraOptions(e){return(e=t.l({offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=this._extendPadding(e.padding),e}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],n=e.max[1]-e.min[1];return i/n>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):n/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,i,n,o,r,s){const a=e.clone(),l=this._extendCameraOptions(s);a.bearing=o,a.pitch=r;const u=t.bO.convert(i),c=t.bO.convert(n),h=.5*(u.lat+c.lat),d=.5*(u.lng+c.lng),f=t.dC(h,d),p=t.ab.vec3.normalize([],f),m=t.ab.vec3.normalize([],t.ab.vec3.cross([],p,[0,1,0])),g=t.ab.vec3.cross([],m,p),y=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,p[0],p[1],p[2],0,0,0,0,1],_=[f,t.dC(u.lat,u.lng),t.dC(c.lat,u.lng),t.dC(c.lat,c.lng),t.dC(u.lat,c.lng),t.dC(h,u.lng),t.dC(h,c.lng),t.dC(u.lat,d),t.dC(c.lat,d)];let v=t.cd.fromPoints(_.map((e=>[t.ab.vec3.dot(m,e),t.ab.vec3.dot(g,e),t.ab.vec3.dot(p,e)])));const x=t.ab.vec3.transformMat4([],v.center,y);0===t.ab.vec3.squaredLength(x)&&t.ab.vec3.set(x,0,0,1),t.ab.vec3.normalize(x,x),t.ab.vec3.scale(x,x,t.ax),a.center=t.dD(x);const b=a.getWorldToCameraMatrix(),C=t.ab.mat4.invert(new Float64Array(16),b);v=t.cd.applyTransform(v,t.ab.mat4.multiply([],b,y));const w=this._extendAABB(v,a,l,o);if(!w)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=w,t.ab.vec3.transformMat4(x,x,b);const S=.5*(v.max[2]-v.min[2]),T=this._minimumAABBFrustumDistance(a,v),A=t.ab.vec3.scale([],[0,0,1],S),M=t.ab.vec3.add(A,x,A),I=T+(0===a.pitch?0:t.ab.vec3.distance(x,M)),E=a.globeCenterInViewSpace,P=t.ab.vec3.sub([],x,[E[0],E[1],E[2]]);t.ab.vec3.normalize(P,P),t.ab.vec3.scale(P,P,I);const k=t.ab.vec3.add([],x,P);t.ab.vec3.transformMat4(k,k,C);const B=t.ds/t.ax,D=t.ab.vec3.length(k),R=t.bH(Math.max(D*B-t.ds,Number.EPSILON),0),L=Math.min(a.zoomFromMercatorZAdjusted(R),l.maxZoom);return L>.5*(t.c6+t.bY)?(a.setProjection({name:"mercator"}),a.zoom=L,this._cameraForBounds(a,i,n,o,r,s)):{center:a.center,zoom:L,bearing:o,pitch:r}}_extendAABB(e,i,n,o){const r=.5*((n.padding.left||0)+(n.padding.right||0)),s=.5*((n.padding.top||0)+(n.padding.bottom||0)),a=s,l=r,u=r,c=s,h=i.width-(l+u),d=i.height-(a+c),f=t.ab.vec3.sub([],e.max,e.min),p=Math.min(h/f[0],d/f[1]),m=Math.min(i.scaleZoom(i.scale*p),n.maxZoom);if(isNaN(m))return null;const g=i.scale/i.zoomScale(m),y=new t.cd([e.min[0]-l*g,e.min[1]-c*g,e.min[2]],[e.max[0]+u*g,e.max[1]+a*g,e.max[2]]),_=("number"==typeof n.offset.x&&"number"==typeof n.offset.y?new t.P(n.offset.x,n.offset.y):t.P.convert(n.offset)).rotate(-t.ai(o));return y.center[0]-=_.x*g,y.center[1]+=_.y*g,y}queryTerrainElevation(e,i){const n=this.transform.elevation;return n?(i=t.l({},{exaggerated:!0},i),n.getAtPoint(t.aa.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,n,o,r,s){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,i,n,o,r,s);const a=e.clone(),l=this._extendCameraOptions(s);a.bearing=o,a.pitch=r;const u=t.bO.convert(i),c=t.bO.convert(n),h=new t.bO(u.lng,c.lat),d=new t.bO(c.lng,u.lat),f=a.project(u),p=a.project(c),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(c),y=this.queryTerrainElevation(h),_=this.queryTerrainElevation(d),v=[[f.x,f.y,Math.min(m||0,g||0,y||0,_||0)],[p.x,p.y,Math.max(m||0,g||0,y||0,_||0)]];let x=t.cd.fromPoints(v);const b=a.getWorldToCameraMatrix(),C=t.ab.mat4.invert(new Float64Array(16),b);x=t.cd.applyTransform(x,b);const w=this._extendAABB(x,a,l,o);if(!w)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=w;const S=.5*t.ab.vec3.sub([],x.max,x.min)[2],T=this._minimumAABBFrustumDistance(a,x),A=[0,0,1,0];t.ab.vec4.transformMat4(A,A,b),t.ab.vec4.normalize(A,A);const M=t.ab.vec3.scale([],A,T+S),I=t.ab.vec3.add([],x.center,M);t.ab.vec3.transformMat4(x.center,x.center,C),t.ab.vec3.transformMat4(I,I,C);const E=a.unproject(new t.P(x.center[0],x.center[1])),P=t.dE(a.projection,E),k=Math.pow(2,P),B=Math.min(a._zoomFromMercatorZ(I[2]*a.pixelsPerMeter*k/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&B<.5*(t.c6+t.bY)?(a.setProjection({name:"globe"}),a.zoom=B,this._cameraForBounds(a,i,n,o,r,s)):{center:E,zoom:B,bearing:o,pitch:r}}fitBounds(t,e,i){const n=this.cameraForBounds(t,e);return this._fitInternal(n,e,i)}fitScreenCoordinates(e,i,n,o,r){const s=t.P.convert(e),a=t.P.convert(i),l=new t.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),u=new t.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const c=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(u),d=this.transform.pointLocation3D(new t.P(l.x,u.y)),f=this.transform.pointLocation3D(new t.P(u.x,l.y)),p=[Math.min(c.lng,h.lng,d.lng,f.lng),Math.min(c.lat,h.lat,d.lat,f.lat)],m=[Math.max(c.lng,h.lng,d.lng,f.lng),Math.max(c.lat,h.lat,d.lat,f.lat)],g=o&&o.pitch?o.pitch:this.getPitch(),y=this._cameraForBounds(this.transform,p,m,n,g,o);return this._fitInternal(y,o,r)}_fitInternal(e,i,n){return e?(i=t.l(e,i)).linear?this.easeTo(i,n):this.flyTo(i,n):this}jumpTo(e,i){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let o=!1,r=!1,s=!1;"zoom"in e&&n.zoom!==+e.zoom&&(o=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.bO.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(r=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(s=!0,n.pitch=+e.pitch);const a="number"==typeof e.padding?this._extendPadding(e.padding):e.padding;if(null!=e.padding&&!n.isPaddingEqual(a))if(!1===e.retainPadding){const t=n.clone();t.padding=a,n.setLocationAtPoint(n.center,t.centerPoint)}else n.padding=a;return e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new t.z("movestart",i)).fire(new t.z("move",i)),o&&this.fire(new t.z("zoomstart",i)).fire(new t.z("zoom",i)).fire(new t.z("zoomend",i)),r&&this.fire(new t.z("rotatestart",i)).fire(new t.z("rotate",i)).fire(new t.z("rotateend",i)),s&&this.fire(new t.z("pitchstart",i)).fire(new t.z("pitch",i)).fire(new t.z("pitchend",i)),this.fire(new t.z("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Ka),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return t.w(Ka),this;this.stop();const o=n.zoom,r=n.pitch,s=n.bearing;n.setFreeCameraOptions(e);const a=o!==n.zoom,l=r!==n.pitch,u=s!==n.bearing;return this.fire(new t.z("movestart",i)).fire(new t.z("move",i)),a&&this.fire(new t.z("zoomstart",i)).fire(new t.z("zoom",i)).fire(new t.z("zoomend",i)),u&&this.fire(new t.z("rotatestart",i)).fire(new t.z("rotate",i)).fire(new t.z("rotateend",i)),l&&this.fire(new t.z("pitchstart",i)).fire(new t.z("pitch",i)).fire(new t.z("pitchend",i)),this.fire(new t.z("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.l({offset:[0,0],duration:500,easing:t.dA},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,o=this.getZoom(),r=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:o,u="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:s,h=this._extendPadding(e.padding),d=t.P.convert(e.offset);let f,p,m;if("globe"===n.projection.name){const i=t.aa.fromLngLat(n.center),o=d.rotate(-n.angle);i.x+=o.x/n.worldSize,i.y+=o.y/n.worldSize;const r=i.toLngLat(),s=t.bO.convert(e.center||r);this._normalizeCenter(s),f=n.centerPoint.add(o),p=new t.P(i.x,i.y).mult(n.worldSize),m=new t.P(t.at(s.lng),t.aA(s.lat)).mult(n.worldSize).sub(p)}else{f=n.centerPoint.add(d);const i=n.pointLocation(f),o=t.bO.convert(e.center||i);this._normalizeCenter(o),p=n.project(i),m=n.project(o).sub(p)}const g=n.zoomScale(l-o);let y,_;e.around&&(y=t.bO.convert(e.around),_=n.locationPoint(y));const v=this._zooming||l!==o,x=this._rotating||r!==u,b=this._pitching||c!==s,C=!n.isPaddingEqual(h),w=!1===e.retainPadding?n.clone():n,S=n=>S=>{if(v&&(n.zoom=t.af(o,l,S)),x&&(n.bearing=t.af(r,u,S)),b&&(n.pitch=t.af(s,c,S)),C&&(w.interpolatePadding(a,h,S),f=w.centerPoint.add(d)),y)n.setLocationAtPoint(y,_);else{const t=n.zoomScale(n.zoom-o),e=l>o?Math.min(2,g):Math.max(.5,g),i=Math.pow(e,1-S),r=n.unproject(p.add(m.mult(S*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?r.wrap():r,f)}return e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(S,e.duration,n);return this._preloadTiles(t),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=C,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,T),this._ease(S(n),(t=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||n.moving||this.fire(new t.z("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.z("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.z("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.z("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.z("move",e)),this._zooming&&this.fire(new t.z("zoom",e)),this._rotating&&this.fire(new t.z("rotate",e)),this._pitching&&this.fire(new t.z("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,o=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.z("zoomend",e)),o&&this.fire(new t.z("rotateend",e)),r&&this.fire(new t.z("pitchend",e)),this.fire(new t.z("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const n=t.ay(e,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(n,i)}this.stop(),e=t.l({offset:[0,0],speed:1.2,curve:1.42,easing:t.dA},e);const n=this.transform,o=this.getZoom(),r=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.aw(+e.zoom,n.minZoom,n.maxZoom):o,u="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:s,h=this._extendPadding(e.padding),d=n.zoomScale(l-o),f=t.P.convert(e.offset);let p=n.centerPoint.add(f);const m=n.pointLocation(p),g=t.bO.convert(e.center||m);this._normalizeCenter(g);const y=n.project(m),_=n.project(g).sub(y);let v=e.curve;const x=Math.max(n.width,n.height),b=x/d,C=_.mag();if("minZoom"in e){const i=t.aw(Math.min(e.minZoom,o,l),n.minZoom,n.maxZoom),r=x/n.zoomScale(i-o);v=Math.sqrt(r/C*2)}const w=v*v;function S(t){const e=(b*b-x*x+(t?-1:1)*w*w*C*C)/(2*(t?b:x)*w*C);return Math.log(Math.sqrt(e*e+1)-e)}function T(t){return(Math.exp(t)-Math.exp(-t))/2}function A(t){return(Math.exp(t)+Math.exp(-t))/2}const M=S(0);let I=function(t){return A(M)/A(M+v*t)},E=function(t){return x*((A(M)*(T(e=M+v*t)/A(e))-T(M))/w)/C;var e},P=(S(1)-M)/v;if(Math.abs(C)<1e-6||!isFinite(P)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,i);const t=b<x?-1:1;P=Math.abs(Math.log(b/x))/v,E=function(){return 0},I=function(e){return Math.exp(t*v*e)}}e.duration="duration"in e?+e.duration:1e3*P/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const k=r!==u,B=c!==s,D=!n.isPaddingEqual(h),R=!1===e.retainPadding?n.clone():n,L=n=>d=>{const m=d*P,v=1/I(m);n.zoom=1===d?l:o+n.scaleZoom(v),k&&(n.bearing=t.af(r,u,d)),B&&(n.pitch=t.af(s,c,d)),D&&(R.interpolatePadding(a,h,d),p=R.centerPoint.add(f));const x=1===d?g:n.unproject(y.add(_.mult(E(m))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?x.wrap():x,p),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(L,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=k,this._pitching=B,this._padding=D,this._prepareEase(i,!1),this._ease(L(n),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.q.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.bF(e,-180,180);const n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.q.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,i){const n=Math.ceil(15*e/1e3),o=[],r=t(i.clone());for(let s=0;s<=n;s++){const t=r(s/n);o.push(t.clone())}return o}_preloadTiles(t,e){}}class Ja{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,t.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact,i=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",i);const n=l("span","mapboxgl-ctrl-icon",this._compactButton);return n.setAttribute("aria-hidden","true"),n.setAttribute("title",i),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.e.ACCESS_TOKEN}];if(e){const n=i.reduce(((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<i.length-1?"&":""}`),t)),"?");e.href=`${t.e.FEEDBACK_URL}/${n}#${Qs(this._map,!0)}`,e.rel="noopener nofollow"}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const n in e){const i=e[n];if(i.used){const e=i.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xa{constructor(){t.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=l("div","mapboxgl-ctrl");const e=l("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Qa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const n of i)if(n.id===t)return void(n.cancelled=!0)}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class tl{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.cB((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const el={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class il extends t.z{constructor(t,e,i,n){const{point:o,lngLat:r,originalEvent:s,target:a}=t;super(t.type,{point:o,lngLat:r,originalEvent:s,target:a}),this.preventDefault=()=>{t.preventDefault()},this.id=e,this.interaction=i,this.feature=n}}class nl{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(e,i){if(this.typeById.has(e))throw new Error(`Interaction id "${e}" already exists.`);const n=i.filter;let o=i.type;n&&this.filters.set(e,t.aZ(n)),"mouseover"===o&&(o="mouseenter"),"mouseout"===o&&(o="mouseleave");const r=this.interactionsByType.get(o)||new Map;"mouseenter"===o||"mouseleave"===o?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(e,i)):0===r.size&&this.map.on(o,this.handleType),0===r.size&&this.interactionsByType.set(o,r),r.set(e,i),this.typeById.set(e,o)}get(t){const e=this.typeById.get(t);if(!e)return;const i=this.interactionsByType.get(e);return i?i.get(t):void 0}remove(t){const e=this.typeById.get(t);if(!e)return;this.typeById.delete(t),this.filters.delete(t);const i=this.interactionsByType.get(e);i&&(i.delete(t),"mouseenter"===e||"mouseleave"===e?(this.delegatedInteractions.delete(t),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===i.size&&this.map.off(e,this.handleType))}queryTargets(t,e){const i=[];for(const[n,o]of e)o.target&&i.push({targetId:n,target:o.target,filter:this.filters.get(n)});return this.map.style.queryRenderedTargets(t,i,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const e=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());e.length&&(t.type="mouseenter",this.handleType(t,e));const i=new Map;for(const[n,{feature:o}]of this.prevHoveredFeatures)this.hoveredFeatures.has(n)||i.set(o.id,o);i.size&&(t.type="mouseleave",this.handleType(t,Array.from(i.values())))}handleOut(t){const e=Array.from(this.hoveredFeatures.values()).map((t=>{let{feature:e}=t;return e}));e.length&&(t.type="mouseleave",this.handleType(t,e)),this.hoveredFeatures.clear()}handleType(e,i){const n=Array.from(this.interactionsByType.get(e.type)).reverse(),o=!!i;i=i||this.queryTargets(e.point,n);const r="mouseenter"===e.type;let s=!1;const a=new Set;for(const l of i){for(const[i,u]of n){if(!u.target)continue;const n=l.variants?l.variants[i]:null;if(n){for(const c of n){if(ae(c,l,a,i))continue;const n=new t.cw(l,c),h=se(c,l,i);o&&(n.state=this.map.getFeatureState(n));const d=r?this.prevHoveredFeatures.get(h):null,f=new il(e,i,u,n),p=d?d.stop:u.handler(f);if(r&&this.hoveredFeatures.set(h,{feature:l,stop:p}),!1!==p){s=!0;break}}if(s)break}}if(s)break}if(!s)for(const[t,l]of n){const{handler:i,target:n}=l;if(!n&&!1!==i(new il(e,t,l,null)))break}}}function ol(e,i){if(Array.isArray(e)&&Array.isArray(i)){const t=new Set(e),n=new Set(i);return t.size===n.size&&e.every((t=>n.has(t)))}return t.bn(e,i)}const rl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},sl={showCompass:!0,showZoom:!0,visualizePitch:!1};class al{constructor(e,i){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=i,this.mouseRotate=new ba({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Ca({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),f()}move(t,e){const i=this.map,n=this.mouseRotate.mousemoveWindow(t,e),o=n&&n.bearingDelta;if(o&&i.setBearing(i.getBearing()+o),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e),o=n&&n.pitchDelta;o&&i.setPitch(i.getPitch()+o)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){p(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.l({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),y(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,y(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=_(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=_(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ll(e,i,n){if(e=new t.bO(e.lng,e.lat),i){const o=new t.bO(e.lng-360,e.lat),r=new t.bO(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-n.center.lng)<s)?e=o:n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<s)&&(e=r)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class cl extends t.E{constructor(e,i){if(super(),(e instanceof HTMLElement||i)&&(e=t.l({element:e},i)),t.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=l("div");const i=41,n=27,o=u("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),r=u("radialGradient",{id:"shadowGradient"},u("defs",{},o));u("stop",{offset:"10%","stop-opacity":.4},r),u("stop",{offset:"100%","stop-opacity":.05},r),u("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o),u("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),u("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),u("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),this._offset=t.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const n=this._element.classList;for(const t in ul)n.remove(`mapboxgl-marker-anchor-${t}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`);const o=e&&e.className?e.className.trim().split(/\s+/):[];n.add(...o),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.bO.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),n=t.getFreeCameraOptions();if(!n.position)return!1;const o=n.position.toLngLat();return o.distanceTo(i)<.9*o.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(i);let o;e._showingGlobe()&&t.dH(e.transform,this._lngLat)?o=0:(o=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(o*=this._occludedOpacity)),this._element.style.opacity=`${o}`,this._element.style.pointerEvents=o>0?"auto":"none",this._popup&&this._popup._setOpacity(o),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${ul[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!e||"map"!==n)return"";if(!i._showingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const o=t.c4(t.dI(i.transform,this._lngLat)),r=e.sub(t.dJ(i.transform)),s=Math.abs(r.x)+Math.abs(r.y);if(0===s)return"";const a=o/s;return`rotateX(${-r.y*a}deg) rotateY(${r.x*a}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let n=0;const o=this.getRotationAlignment();if("map"===o)if(i._showingGlobe()){const e=i.project(new t.bO(this._lngLat.lng,this._lngLat.lat+.001)),o=i.project(new t.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=t.c4(Math.atan2(o.y,o.x))-90}else n=-i.getBearing();else if("horizon"===o){const o=t.ac(4,6,i.getZoom()),r=t.dJ(i.transform);r.y+=o*i.transform.height;const s=e.sub(r),a=t.c4(Math.atan2(s.y,s.x));n=(a>90?a-270:a+90)*(1-o)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=ll(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),e._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(e){const i=this._map;if(!i)return;const n=this._pointerdownPos,o=this._positionDelta;if(n&&o){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;if(e.point.dist(n)<t)return;this._isDragging=!0}this._pos=e.point.sub(o),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.z("dragstart"))),this.fire(new t.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.z("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},dl={maxWidth:100,unit:"metric"},fl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},pl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ml=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.P(0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.P(0,e);case"top-left":return new t.P(n,n);case"top-right":return new t.P(-n,n);case"bottom":return new t.P(0,-e);case"bottom-left":return new t.P(n,-n);case"bottom-right":return new t.P(-n,-n);case"left":return new t.P(e,0);case"right":return new t.P(-e,0)}return new t.P(0,0)}return e instanceof t.P||Array.isArray(e)?t.P.convert(e):t.P.convert(e[i]||[0,0])}const yl={version:e,supported:a.supported,setRTLTextPlugin:t.dK,getRTLTextPluginStatus:t.dL,Map:class extends Ya{constructor(e){n.mark(i.create);const o=e;if(null!=(e=t.l({},rl,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.dF(window)&&(e.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qi(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!!e.repaint,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new Qa,this._domRenderTaskQueue=new Qa,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.aV(),this._locale=t.l({},el,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._tessellationStep=e.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=e.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=e.scaleFactor,this._requestManager=new w(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?Object.assign({},e.contextCreateOptions):{},"string"==typeof e.container){const t=document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=t}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),this._spriteFormat=e.spriteFormat,t.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new zs),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new $a(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||t.e.DEFAULT_STYLE,{config:e.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this.indoor=new pn(this),e.hash&&(this._hash=new Xs("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==o.center&&null==o.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const i=e.bounds;i&&(this.resize(),this.fitBounds(i,t.l({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new Ja({customAttribution:e.customAttribution})),this._logoControl=new Xa,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.z(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.z(`${e.dataType}dataloading`,e))})),this._interactions=new nl(this)}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const o=this._controlPositions[i];return-1!==i.indexOf("bottom")?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.z("movestart",e)).fire(new t.z("move",e)),this.fire(new t.z("resize",e)),i&&this.fire(new t.z("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.az.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(t){return this._scaleFactor=t,this.painter.scaleFactor=t,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>"symbol"===t.type)),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?navigator.language:t)):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,i=e.projection.name;let n;"globe"===i&&e.zoom>=t.bY?(e.setMercatorFromTransition(),n=!0):"mercator"===i&&e.zoom<t.bY&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let i;return i="globe"===e.name&&this.transform.zoom>=t.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(t.bO.convert(e))}unproject(e){return this.transform.pointLocation3D(t.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){const n=t=>{let i=[];if(Array.isArray(e)){const n=e.filter((t=>this.getLayer(t)));i=n.length?this.queryRenderedFeatures(t,{layers:n}):[]}else i=this.queryRenderedFeatures(t,{target:e});return i};if("mouseenter"===t||"mouseover"===t){let o=!1;const r=e=>{const r=n(e.point);r.length?o||(o=!0,i.call(this,new la(t,this,e.originalEvent,{features:r}))):o=!1};return{listener:i,targets:e,delegates:{mousemove:r,mouseout:()=>{o=!1}}}}if("mouseleave"===t||"mouseout"===t){let o=!1;const r=e=>{n(e.point).length?o=!0:o&&(o=!1,i.call(this,new la(t,this,e.originalEvent)))},s=e=>{o&&(o=!1,i.call(this,new la(t,this,e.originalEvent)))};return{listener:i,targets:e,delegates:{mousemove:r,mouseout:s}}}{const o=t=>{const e=n(t.point);e.length&&(t.features=e,i.call(this,t),delete t.features)};return{listener:i,targets:e,delegates:{[t]:o}}}}on(t,e,i){if("function"==typeof e||void 0===i)return super.on(t,e);if("string"==typeof e&&(e=[e]),!this._areTargetsValid(e))return this;const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const o in n.delegates)this.on(o,n.delegates[o]);return this}once(t,e,i){if("function"==typeof e||void 0===i)return super.once(t,e);if("string"==typeof e&&(e=[e]),!this._areTargetsValid(e))return this;const n=this._createDelegatedListener(t,e,i);for(const o in n.delegates)this.once(o,n.delegates[o]);return this}off(t,e,i){if("function"==typeof e||void 0===i)return super.off(t,e);if("string"==typeof e&&(e=[e]),!this._areTargetsValid(e))return this;const n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(t=>{for(let n=0;n<t.length;n++){const o=t[n];if(o.listener===i&&ol(o.targets,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(n,1),this}}})(n),this}queryRenderedFeatures(e,i){if(!this.style)return[];if(void 0===e||e instanceof t.P||Array.isArray(e)||void 0!==i||(i=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],!i){const t=this.style.queryRenderedFeatures(e,void 0,this.transform),i=this.style.queryRenderedFeatureset(e,void 0,this.transform);return t.concat(i)}let n=!0;if(i.target&&(n=this._isTargetValid(i.target),n&&!i.layers))return this.style.queryRenderedFeatureset(e,i,this.transform);let o=!0;if(i.layers&&Array.isArray(i.layers)){for(const t of i.layers)if(!this._isValidId(t)){o=!1;break}if(o&&!i.target)return this.style.queryRenderedFeatures(e,i,this.transform)}let r=[];return o&&(r=r.concat(this.style.queryRenderedFeatures(e,i,this.transform))),n&&(r=r.concat(this.style.queryRenderedFeatureset(e,i,this.transform))),r}querySourceFeatures(t,e){return!t||"string"==typeof t&&!this._isValidId(t)?[]:this.style.querySourceFeatures(t,e)}isPointOnSurface(e){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&t.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(e))}addInteraction(t,e){return this._interactions.add(t,e),this}removeInteraction(t){return this._interactions.remove(t),this}setStyle(e,i){return i=t.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&e&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(e,((n,o)=>{n?(t.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(e,i)):o&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(e,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e){const n=t.l({},i);i&&i.config&&(n.initialConfig=i.config,delete n.config),this.style=new wn(this,n).load(e),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new t.y(new Error("IDs can't be empty."))),!1):!t.cr(e)||(this.fire(new t.y(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}_isTargetValid(t){return"featuresetId"in t?this._isValidId("importId"in t?t.importId:t.featuresetId):"layerId"in t&&this._isValidId(t.layerId)}_areTargetsValid(t){if(Array.isArray(t)){for(const e of t)if(!this._isValidId(e))return!1;return!0}return this._isTargetValid(t)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(e,i){let{pixelRatio:n=1,sdf:o=!1,stretchX:r,stretchY:s,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:u,data:c}=t.q.getImageData(i);this.style.addImage(e,{data:new t.r({width:l,height:u},c),pixelRatio:n,stretchX:r,stretchY:s,content:a,sdf:o,version:0,usvg:!1})}else if(void 0===i.width||void 0===i.height)this.fire(new t.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:u}=i,c=i;this.style.addImage(e,{data:new t.r({width:l,height:u},new Uint8Array(c.data)),pixelRatio:n,stretchX:r,stretchY:s,content:a,sdf:o,usvg:!1,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}updateImage(e,i){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new t.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?t.q.getImageData(i):i,{width:r,height:s,data:a}=o;if(void 0===r||void 0===s)return void this.fire(new t.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(r!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||s!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new t.y(new Error(`The width and height of the updated image (${r}, ${s})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`)));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let u=!1;n.usvg?(n.data=new t.r({width:r,height:s},new Uint8Array(a)),n.usvg=!1,n.icon=void 0,u=!0):n.data.replace(a,l),this.style.updateImage(e,n,u)}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new t.y(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.o(this._requestManager.transformRequest(e,t.R.Image),((e,n)=>{i(e,n instanceof HTMLImageElement?t.q.getImageData(n):n)}))}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new t.y(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}getSlot(t){const e=this.getLayer(t);return e&&e.slot||null}setSlot(t,e){return this.style.setSlot(t,e),this.style.mergeLayers(),this._update(!0)}addImport(t,e){return this.style.addImport(t,e),this}updateImport(t,e){return"string"!=typeof e&&e.id!==t?(this.removeImport(t),this.addImport(e)):(this.style.updateImport(t,e),this._update(!0))}removeImport(t){return this.style.removeImport(t),this}moveImport(t,e){return this.style.moveImport(t,e),this._update(!0)}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){if(!this._isValidId(t))return null;const e=this.style.getOwnLayer(t);return e?"custom"===e.type?e.implementation:e.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,n),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,n),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getSchema(t){return this.style.getSchema(t)}setSchema(t,e){return this.style.setSchema(t,e),this._update(!0)}getConfig(t){return this.style.getConfig(t)}setConfig(t,e){return this.style.setConfig(t,e),this._update(!0)}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}getFeaturesetDescriptors(t){return this.style.getFeaturesetDescriptors(t)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(t){return this._lazyInitEmptyStyle(),this.style.setSnow(t),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(t){return this._lazyInitEmptyStyle(),this.style.setRain(t),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(t){return this._lazyInitEmptyStyle(),this.style.setColorTheme(t),this._update(!0)}setImportColorTheme(t,e){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(t,e),this._update(!0)}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.bO.convert(e),this.transform):0}setFeatureState(t,e){return t.source&&!this._isValidId(t.source)?this:(this.style.setFeatureState(t,e),this._update())}removeFeatureState(t,e){return t.source&&!this._isValidId(t.source)?this:(this.style.removeFeatureState(t,e),this._update())}getFeatureState(t){return t.source&&!this._isValidId(t.source)?null:this.style.getFeatureState(t)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,n,o,r=this._container;for(;r&&(!n||!o);){const t=window.getComputedStyle(r).transform;t&&"none"!==t&&(i=t.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(n=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(o=i[3])),r=r.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=o?Math.abs(e/o):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=l("div","mapboxgl-canvas-container",t);this._canvas=l("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=l("div","mapboxgl-control-container",t),n=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((t=>{n[t]=l("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const n=t.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const e=t.l({},a.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",e);i?(V(i,!0),this.painter=new Ys(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.m.testSupport(i)):this.fire(new t.y(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.z("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new t.z("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let o;this.fire(new t.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,s=t.q.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=a.createQuery(),a.beginQuery(r.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,n=t.q.now(),o=new t.a8(e,{now:n,fadeDuration:l,pitch:i,transition:this.style.transition});this.style.update(o)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(s),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(s);const c=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),c&&(this._placementDirty=c.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.mark(i.load),this.fire(new t.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const e=t.q.now()-s;a.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const i=a.getQueryParameter(o,a.QUERY_RESULT)/1e6;a.deleteQuery(o),this.fire(new t.z("gpu-timing-frame",{cpuTime:e,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.z("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.z("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(h||this._repaint)this.triggerRepaint();else{const e=this.idle();if(e&&(u=this._updateAverageElevation(s,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.z("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,n.mark(i.fullLoad),this._performanceMetricsCollection&&O(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let o=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(o)?o=0:this._averageElevationLastSampledAt=t;const r=Math.abs(e-o);if(r>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(o),i(o);this._averageElevation.easeTo(o,t,300)}else if(r>1e-4)return this._averageElevation.jumpTo(o),i(o)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){F(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===C||401===e.status)){const e=this.painter.context.gl;V(e,!1),this._logoControl instanceof Xa&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),D(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&L(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function o(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(o(t),e.canvasCopies.map(o),e.timeStamps)}_canvasPixelComparison(t,e,i){let n=i[1]-i[0];const o=t.length/4;for(let r=0;r<e.length;r++){const s=e[r];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);n+=(i[r+2]-i[r+1])*(1-a/o)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),N.delete(this.painter.context.gl),U.remove(),B.remove(),this._removed=!0,this.fire(new t.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.q.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?this.style.getSourceCaches():[];return t.bl(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(t){this._showParseStatus!==t&&(this._showParseStatus=t,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this._tp.refreshUI(),t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,this._tp.refreshUI(),t&&this._update())}_setCacheLimits(e,i){t.dG(e,i)}get version(){return e}},NavigationControl:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t.l({},sl,e),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),n=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new al(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=l("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.E{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const i=navigator.geolocation;this.options=t.l({geolocation:i},hl,e),t.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Js(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){var e=this;const i=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!e.options.geolocation;e._supportsGeolocation=i,t(i)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((t=>i("denied"!==t.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.z("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.bO(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,o=this._map.getBearing(),r=t.l({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),r,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.bO(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.bH(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new cl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.z("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ja,ScaleControl:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t.l({},dl,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),t.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,n=e._containerWidth/2-t/2,o=e.unproject([n,i]),r=e.unproject([n+t,i]),s=o.distanceTo(r);if("imperial"===this.options.unit){const e=3.2808*s;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,s/1852,"nautical-mile"):s>=1e3?this._setScale(t,s/1e3,"kilometer"):this._setScale(t,s,"meter")}_setScale(t,e,i){this._map._requestDomTask((()=>{const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),o=n/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):`${n}&nbsp;${fl[i]}`,this._container.style.width=t*o+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),t.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(e){super(),this.options=t.l(Object.create(pl),e),t.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.z("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.bO.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=t;n=i.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=l("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.innerHTML='<span aria-hidden="true">&#215;</span>',t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,n=this._pos;if(!e||!i||!n)return"bottom";const o=i.offsetWidth,r=i.offsetHeight,s=n.x<o/2,a=n.x>e.transform.width-o/2;if(n.y+t<r)return s?"top-left":a?"top-right":"top";if(n.y>e.transform.height-r){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let o=this._container;if(o||(o=this._container=l("div","mapboxgl-popup",i.getContainer()),this._tip=l("div","mapboxgl-popup-tip",o),o.appendChild(n)),this.options.maxWidth&&o.style.maxWidth!==this.options.maxWidth&&(o.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ll(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const n=this._pos=this._trackPointer&&e instanceof t.P?e:i.project(this._lngLat),o=gl(this.options.offset),r=this._anchor=this._getAnchor(o.y),s=gl(this.options.offset,r),a=n.add(s).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${ul[r]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const e=t.dH(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ml);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:cl,Style:wn,LngLat:t.bO,LngLatBounds:t.az,Point:t.P,MercatorCoordinate:t.aa,FreeCameraOptions:Zi,Evented:t.E,config:t.e,prewarm:t.dM,clearPrewarmedResources:t.dN,get accessToken(){return t.e.ACCESS_TOKEN},set accessToken(e){t.e.ACCESS_TOKEN=e},get baseApiUrl(){return t.e.API_URL},set baseApiUrl(e){t.e.API_URL=e},get workerCount(){return t.dO.workerCount},set workerCount(e){t.dO.workerCount=e},get maxParallelImageRequests(){return t.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.e.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.dP(e)},get workerUrl(){return t.dQ.workerUrl},set workerUrl(e){t.dQ.workerUrl=e},get workerClass(){return t.dQ.workerClass},set workerClass(e){t.dQ.workerClass=e},get workerParams(){return t.dQ.workerParams},set workerParams(e){t.dQ.workerParams=e},get dracoUrl(){return t.dR()},set dracoUrl(e){t.dS(e)},get meshoptUrl(){return t.dT()},set meshoptUrl(e){t.dU(e)},setNow:t.q.setNow,restoreNow:t.q.restoreNow};return yl})),i}()},896:(t,e)=>{"use strict";function i(t,e){var i=t.length;t.push(e);t:for(;0<i;){var n=i-1>>>1,o=t[n];if(!(0<r(o,e)))break t;t[n]=e,t[i]=o,i=n}}function n(t){return 0===t.length?null:t[0]}function o(t){if(0===t.length)return null;var e=t[0],i=t.pop();if(i!==e){t[0]=i;t:for(var n=0,o=t.length,s=o>>>1;n<s;){var a=2*(n+1)-1,l=t[a],u=a+1,c=t[u];if(0>r(l,i))u<o&&0>r(c,l)?(t[n]=c,t[u]=i,n=u):(t[n]=l,t[a]=i,n=a);else{if(!(u<o&&0>r(c,i)))break t;t[n]=c,t[u]=i,n=u}}}return e}function r(t,e){var i=t.sortIndex-e.sortIndex;return 0!==i?i:t.id-e.id}if(e.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var u=[],c=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,y=!1,_="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(t){for(var e=n(c);null!==e;){if(null===e.callback)o(c);else{if(!(e.startTime<=t))break;o(c),e.sortIndex=e.expirationTime,i(u,e)}e=n(c)}}function C(t){if(g=!1,b(t),!m)if(null!==n(u))m=!0,S||(S=!0,w());else{var e=n(c);null!==e&&B(C,e.startTime-t)}}var w,S=!1,T=-1,A=5,M=-1;function I(){return!!y||!(e.unstable_now()-M<A)}function E(){if(y=!1,S){var t=e.unstable_now();M=t;var i=!0;try{t:{m=!1,g&&(g=!1,v(T),T=-1),p=!0;var r=f;try{e:{for(b(t),d=n(u);null!==d&&!(d.expirationTime>t&&I());){var s=d.callback;if("function"===typeof s){d.callback=null,f=d.priorityLevel;var a=s(d.expirationTime<=t);if(t=e.unstable_now(),"function"===typeof a){d.callback=a,b(t),i=!0;break e}d===n(u)&&o(u),b(t)}else o(u);d=n(u)}if(null!==d)i=!0;else{var l=n(c);null!==l&&B(C,l.startTime-t),i=!1}}break t}finally{d=null,f=r,p=!1}i=void 0}}finally{i?w():S=!1}}}if("function"===typeof x)w=function(){x(E)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,k=P.port2;P.port1.onmessage=E,w=function(){k.postMessage(null)}}else w=function(){_(E,0)};function B(t,i){T=_((function(){t(e.unstable_now())}),i)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_next=function(t){switch(f){case 1:case 2:case 3:var e=3;break;default:e=f}var i=f;f=e;try{return t()}finally{f=i}},e.unstable_requestPaint=function(){y=!0},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var i=f;f=t;try{return e()}finally{f=i}},e.unstable_scheduleCallback=function(t,o,r){var s=e.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?s+r:s:r=s,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return t={id:h++,callback:o,priorityLevel:t,startTime:r,expirationTime:a=r+a,sortIndex:-1},r>s?(t.sortIndex=r,i(c,t),null===n(u)&&t===n(c)&&(g?(v(T),T=-1):g=!0,B(C,r-s))):(t.sortIndex=a,i(u,t),m||p||(m=!0,S||(S=!0,w()))),t},e.unstable_shouldYield=I,e.unstable_wrapCallback=function(t){var e=f;return function(){var i=f;f=e;try{return t.apply(this,arguments)}finally{f=i}}}},950:(t,e,i)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=i(672)}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;i.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"===typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"===typeof n.then)return n}var r=Object.create(null);i.r(r);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&o&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>n[t]));return s.default=()=>n,i.d(r,s),r}})(),i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="/",(()=>{"use strict";var t={};i.r(t),i.d(t,{hasBrowserEnv:()=>Ye,hasStandardBrowserEnv:()=>Xe,hasStandardBrowserWebWorkerEnv:()=>Qe,navigator:()=>Je,origin:()=>ti});var e,n=i(43),o=i.t(n,2),r=i(391),s=i(950),a=i.t(s,2);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(this,arguments)}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(e||(e={}));const u="popstate";function c(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function h(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(i){}}}function d(t,e){return{usr:t.state,key:t.key,idx:e}}function f(t,e,i,n){return void 0===i&&(i=null),l({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?m(e):e,{state:i,key:e&&e.key||n||Math.random().toString(36).substr(2,8)})}function p(t){let{pathname:e="/",search:i="",hash:n=""}=t;return i&&"?"!==i&&(e+="?"===i.charAt(0)?i:"?"+i),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}function m(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function g(t,i,n,o){void 0===o&&(o={});let{window:r=document.defaultView,v5Compat:s=!1}=o,a=r.history,h=e.Pop,m=null,g=y();function y(){return(a.state||{idx:null}).idx}function _(){h=e.Pop;let t=y(),i=null==t?null:t-g;g=t,m&&m({action:h,location:x.location,delta:i})}function v(t){let e="null"!==r.location.origin?r.location.origin:r.location.href,i="string"===typeof t?t:p(t);return i=i.replace(/ $/,"%20"),c(e,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,e)}null==g&&(g=0,a.replaceState(l({},a.state,{idx:g}),""));let x={get action(){return h},get location(){return t(r,a)},listen(t){if(m)throw new Error("A history only accepts one active listener");return r.addEventListener(u,_),m=t,()=>{r.removeEventListener(u,_),m=null}},createHref:t=>i(r,t),createURL:v,encodeLocation(t){let e=v(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,i){h=e.Push;let o=f(x.location,t,i);n&&n(o,t),g=y()+1;let l=d(o,g),u=x.createHref(o);try{a.pushState(l,"",u)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;r.location.assign(u)}s&&m&&m({action:h,location:x.location,delta:1})},replace:function(t,i){h=e.Replace;let o=f(x.location,t,i);n&&n(o,t),g=y();let r=d(o,g),l=x.createHref(o);a.replaceState(r,"",l),s&&m&&m({action:h,location:x.location,delta:0})},go:t=>a.go(t)};return x}var y;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(y||(y={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function _(t,e,i){return void 0===i&&(i="/"),v(t,e,i,!1)}function v(t,e,i,n){let o=D(("string"===typeof e?m(e):e).pathname||"/",i);if(null==o)return null;let r=x(t);!function(t){t.sort(((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let i=t.length===e.length&&t.slice(0,-1).every(((t,i)=>t===e[i]));return i?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map((t=>t.childrenIndex)),e.routesMeta.map((t=>t.childrenIndex)))))}(r);let s=null;for(let a=0;null==s&&a<r.length;++a){let t=B(o);s=P(r[a],t,n)}return s}function x(t,e,i,n){void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===n&&(n="");let o=(t,o,r)=>{let s={relativePath:void 0===r?t.path||"":r,caseSensitive:!0===t.caseSensitive,childrenIndex:o,route:t};s.relativePath.startsWith("/")&&(c(s.relativePath.startsWith(n),'Absolute route path "'+s.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(n.length));let a=U([n,s.relativePath]),l=i.concat(s);t.children&&t.children.length>0&&(c(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'+a+'".'),x(t.children,e,l,a)),(null!=t.path||t.index)&&e.push({path:a,score:E(a,t.index),routesMeta:l})};return t.forEach(((t,e)=>{var i;if(""!==t.path&&null!=(i=t.path)&&i.includes("?"))for(let n of b(t.path))o(t,e,n);else o(t,e)})),e}function b(t){let e=t.split("/");if(0===e.length)return[];let[i,...n]=e,o=i.endsWith("?"),r=i.replace(/\?$/,"");if(0===n.length)return o?[r,""]:[r];let s=b(n.join("/")),a=[];return a.push(...s.map((t=>""===t?r:[r,t].join("/")))),o&&a.push(...s),a.map((e=>t.startsWith("/")&&""===e?"/":e))}const C=/^:[\w-]+$/,w=3,S=2,T=1,A=10,M=-2,I=t=>"*"===t;function E(t,e){let i=t.split("/"),n=i.length;return i.some(I)&&(n+=M),e&&(n+=S),i.filter((t=>!I(t))).reduce(((t,e)=>t+(C.test(e)?w:""===e?T:A)),n)}function P(t,e,i){void 0===i&&(i=!1);let{routesMeta:n}=t,o={},r="/",s=[];for(let a=0;a<n.length;++a){let t=n[a],l=a===n.length-1,u="/"===r?e:e.slice(r.length)||"/",c=k({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},u),h=t.route;if(!c&&l&&i&&!n[n.length-1].route.index&&(c=k({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},u)),!c)return null;Object.assign(o,c.params),s.push({params:o,pathname:U([r,c.pathname]),pathnameBase:F(U([r,c.pathnameBase])),route:h}),"/"!==c.pathnameBase&&(r=U([r,c.pathnameBase]))}return s}function k(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[i,n]=function(t,e,i){void 0===e&&(e=!1);void 0===i&&(i=!0);h("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were "'+t.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+t.replace(/\*$/,"/*")+'".');let n=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((t,e,i)=>(n.push({paramName:e,isOptional:null!=i}),i?"/?([^\\/]+)?":"/([^\\/]+)")));t.endsWith("*")?(n.push({paramName:"*"}),o+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":""!==t&&"/"!==t&&(o+="(?:(?=\\/|$))");let r=new RegExp(o,e?void 0:"i");return[r,n]}(t.path,t.caseSensitive,t.end),o=e.match(i);if(!o)return null;let r=o[0],s=r.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:n.reduce(((t,e,i)=>{let{paramName:n,isOptional:o}=e;if("*"===n){let t=a[i]||"";s=r.slice(0,r.length-t.length).replace(/(.)\/+$/,"$1")}const l=a[i];return t[n]=o&&!l?void 0:(l||"").replace(/%2F/g,"/"),t}),{}),pathname:r,pathnameBase:s,pattern:t}}function B(t){try{return t.split("/").map((t=>decodeURIComponent(t).replace(/\//g,"%2F"))).join("/")}catch(e){return h(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+e+")."),t}}function D(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,n=t.charAt(i);return n&&"/"!==n?null:t.slice(i)||"/"}function R(t,e,i,n){return"Cannot include a '"+t+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function L(t){return t.filter(((t,e)=>0===e||t.route.path&&t.route.path.length>0))}function z(t,e){let i=L(t);return e?i.map(((t,e)=>e===i.length-1?t.pathname:t.pathnameBase)):i.map((t=>t.pathnameBase))}function O(t,e,i,n){let o;void 0===n&&(n=!1),"string"===typeof t?o=m(t):(o=l({},t),c(!o.pathname||!o.pathname.includes("?"),R("?","pathname","search",o)),c(!o.pathname||!o.pathname.includes("#"),R("#","pathname","hash",o)),c(!o.search||!o.search.includes("#"),R("#","search","hash",o)));let r,s=""===t||""===o.pathname,a=s?"/":o.pathname;if(null==a)r=i;else{let t=e.length-1;if(!n&&a.startsWith("..")){let e=a.split("/");for(;".."===e[0];)e.shift(),t-=1;o.pathname=e.join("/")}r=t>=0?e[t]:"/"}let u=function(t,e){void 0===e&&(e="/");let{pathname:i,search:n="",hash:o=""}="string"===typeof t?m(t):t,r=i?i.startsWith("/")?i:function(t,e){let i=e.replace(/\/+$/,"").split("/");return t.split("/").forEach((t=>{".."===t?i.length>1&&i.pop():"."!==t&&i.push(t)})),i.length>1?i.join("/"):"/"}(i,e):e;return{pathname:r,search:N(n),hash:V(o)}}(o,r),h=a&&"/"!==a&&a.endsWith("/"),d=(s||"."===a)&&i.endsWith("/");return u.pathname.endsWith("/")||!h&&!d||(u.pathname+="/"),u}const U=t=>t.join("/").replace(/\/\/+/g,"/"),F=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),N=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",V=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";Error;function H(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}const j=["post","put","patch","delete"],G=(new Set(j),["get",...j]);new Set(G),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},W.apply(this,arguments)}const q=n.createContext(null);const Z=n.createContext(null);const $=n.createContext(null);const K=n.createContext(null);const Y=n.createContext({outlet:null,matches:[],isDataRoute:!1});const J=n.createContext(null);function X(){return null!=n.useContext(K)}function Q(){return X()||c(!1),n.useContext(K).location}function tt(t){n.useContext($).static||n.useLayoutEffect(t)}function et(){let{isDataRoute:t}=n.useContext(Y);return t?function(){let{router:t}=ht(ut.UseNavigateStable),e=ft(ct.UseNavigateStable),i=n.useRef(!1);return tt((()=>{i.current=!0})),n.useCallback((function(n,o){void 0===o&&(o={}),i.current&&("number"===typeof n?t.navigate(n):t.navigate(n,W({fromRouteId:e},o)))}),[t,e])}():function(){X()||c(!1);let t=n.useContext(q),{basename:e,future:i,navigator:o}=n.useContext($),{matches:r}=n.useContext(Y),{pathname:s}=Q(),a=JSON.stringify(z(r,i.v7_relativeSplatPath)),l=n.useRef(!1);return tt((()=>{l.current=!0})),n.useCallback((function(i,n){if(void 0===n&&(n={}),!l.current)return;if("number"===typeof i)return void o.go(i);let r=O(i,JSON.parse(a),s,"path"===n.relative);null==t&&"/"!==e&&(r.pathname="/"===r.pathname?e:U([e,r.pathname])),(n.replace?o.replace:o.push)(r,n.state,n)}),[e,o,a,s,t])}()}function it(t,e){let{relative:i}=void 0===e?{}:e,{future:o}=n.useContext($),{matches:r}=n.useContext(Y),{pathname:s}=Q(),a=JSON.stringify(z(r,o.v7_relativeSplatPath));return n.useMemo((()=>O(t,JSON.parse(a),s,"path"===i)),[t,a,s,i])}function nt(t,i,o,r){X()||c(!1);let{navigator:s,static:a}=n.useContext($),{matches:l}=n.useContext(Y),u=l[l.length-1],h=u?u.params:{},d=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let f,p=Q();if(i){var g;let t="string"===typeof i?m(i):i;"/"===d||(null==(g=t.pathname)?void 0:g.startsWith(d))||c(!1),f=t}else f=p;let y=f.pathname||"/",v=y;if("/"!==d){let t=d.replace(/^\//,"").split("/");v="/"+y.replace(/^\//,"").split("/").slice(t.length).join("/")}let x=!a&&o&&o.matches&&o.matches.length>0?o.matches:_(t,{pathname:v});let b=lt(x&&x.map((t=>Object.assign({},t,{params:Object.assign({},h,t.params),pathname:U([d,s.encodeLocation?s.encodeLocation(t.pathname).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?d:U([d,s.encodeLocation?s.encodeLocation(t.pathnameBase).pathname:t.pathnameBase])}))),l,o,r);return i&&b?n.createElement(K.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:e.Pop}},b):b}function ot(){let t=function(){var t;let e=n.useContext(J),i=dt(ct.UseRouteError),o=ft(ct.UseRouteError);if(void 0!==e)return e;return null==(t=i.errors)?void 0:t[o]}(),e=H(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,o="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:o};return n.createElement(n.Fragment,null,n.createElement("h2",null,"Unexpected Application Error!"),n.createElement("h3",{style:{fontStyle:"italic"}},e),i?n.createElement("pre",{style:r},i):null,null)}const rt=n.createElement(ot,null);class st extends n.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return void 0!==this.state.error?n.createElement(Y.Provider,{value:this.props.routeContext},n.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function at(t){let{routeContext:e,match:i,children:o}=t,r=n.useContext(q);return r&&r.static&&r.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=i.route.id),n.createElement(Y.Provider,{value:e},o)}function lt(t,e,i,o){var r;if(void 0===e&&(e=[]),void 0===i&&(i=null),void 0===o&&(o=null),null==t){var s;if(!i)return null;if(i.errors)t=i.matches;else{if(!(null!=(s=o)&&s.v7_partialHydration&&0===e.length&&!i.initialized&&i.matches.length>0))return null;t=i.matches}}let a=t,l=null==(r=i)?void 0:r.errors;if(null!=l){let t=a.findIndex((t=>t.route.id&&void 0!==(null==l?void 0:l[t.route.id])));t>=0||c(!1),a=a.slice(0,Math.min(a.length,t+1))}let u=!1,h=-1;if(i&&o&&o.v7_partialHydration)for(let n=0;n<a.length;n++){let t=a[n];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(h=n),t.route.id){let{loaderData:e,errors:n}=i,o=t.route.loader&&void 0===e[t.route.id]&&(!n||void 0===n[t.route.id]);if(t.route.lazy||o){u=!0,a=h>=0?a.slice(0,h+1):[a[0]];break}}}return a.reduceRight(((t,o,r)=>{let s,c=!1,d=null,f=null;var p;i&&(s=l&&o.route.id?l[o.route.id]:void 0,d=o.route.errorElement||rt,u&&(h<0&&0===r?(p="route-fallback",!1||pt[p]||(pt[p]=!0),c=!0,f=null):h===r&&(c=!0,f=o.route.hydrateFallbackElement||null)));let m=e.concat(a.slice(0,r+1)),g=()=>{let e;return e=s?d:c?f:o.route.Component?n.createElement(o.route.Component,null):o.route.element?o.route.element:t,n.createElement(at,{match:o,routeContext:{outlet:t,matches:m,isDataRoute:null!=i},children:e})};return i&&(o.route.ErrorBoundary||o.route.errorElement||0===r)?n.createElement(st,{location:i.location,revalidation:i.revalidation,component:d,error:s,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var ut=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(ut||{}),ct=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ct||{});function ht(t){let e=n.useContext(q);return e||c(!1),e}function dt(t){let e=n.useContext(Z);return e||c(!1),e}function ft(t){let e=function(){let t=n.useContext(Y);return t||c(!1),t}(),i=e.matches[e.matches.length-1];return i.route.id||c(!1),i.route.id}const pt={};function mt(t,e){null==t||t.v7_startTransition,void 0===(null==t?void 0:t.v7_relativeSplatPath)&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}o.startTransition;function gt(t){c(!1)}function yt(t){let{basename:i="/",children:o=null,location:r,navigationType:s=e.Pop,navigator:a,static:l=!1,future:u}=t;X()&&c(!1);let h=i.replace(/^\/*/,"/"),d=n.useMemo((()=>({basename:h,navigator:a,static:l,future:W({v7_relativeSplatPath:!1},u)})),[h,u,a,l]);"string"===typeof r&&(r=m(r));let{pathname:f="/",search:p="",hash:g="",state:y=null,key:_="default"}=r,v=n.useMemo((()=>{let t=D(f,h);return null==t?null:{location:{pathname:t,search:p,hash:g,state:y,key:_},navigationType:s}}),[h,f,p,g,y,_,s]);return null==v?null:n.createElement($.Provider,{value:d},n.createElement(K.Provider,{children:o,value:v}))}function _t(t){let{children:e,location:i}=t;return nt(vt(e),i)}new Promise((()=>{}));n.Component;function vt(t,e){void 0===e&&(e=[]);let i=[];return n.Children.forEach(t,((t,o)=>{if(!n.isValidElement(t))return;let r=[...e,o];if(t.type===n.Fragment)return void i.push.apply(i,vt(t.props.children,r));t.type!==gt&&c(!1),t.props.index&&t.props.children&&c(!1);let s={id:t.props.id||r.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(s.children=vt(t.props.children,r)),i.push(s)})),i}function xt(){return xt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},xt.apply(this,arguments)}function bt(t,e){if(null==t)return{};var i,n,o={},r=Object.keys(t);for(n=0;n<r.length;n++)i=r[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ct=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(In){}new Map;const wt=o.startTransition;a.flushSync,o.useId;function St(t){let{basename:e,children:i,future:o,window:r}=t,s=n.useRef();var a;null==s.current&&(s.current=(void 0===(a={window:r,v5Compat:!0})&&(a={}),g((function(t,e){let{pathname:i,search:n,hash:o}=t.location;return f("",{pathname:i,search:n,hash:o},e.state&&e.state.usr||null,e.state&&e.state.key||"default")}),(function(t,e){return"string"===typeof e?e:p(e)}),null,a)));let l=s.current,[u,c]=n.useState({action:l.action,location:l.location}),{v7_startTransition:h}=o||{},d=n.useCallback((t=>{h&&wt?wt((()=>c(t))):c(t)}),[c,h]);return n.useLayoutEffect((()=>l.listen(d)),[l,d]),n.useEffect((()=>mt(o)),[o]),n.createElement(yt,{basename:e,children:i,location:u.location,navigationType:u.action,navigator:l,future:o})}const Tt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,At=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Mt=n.forwardRef((function(t,e){let i,{onClick:o,relative:r,reloadDocument:s,replace:a,state:l,target:u,to:h,preventScrollReset:d,viewTransition:f}=t,m=bt(t,Ct),{basename:g}=n.useContext($),y=!1;if("string"===typeof h&&At.test(h)&&(i=h,Tt))try{let t=new URL(window.location.href),e=h.startsWith("//")?new URL(t.protocol+h):new URL(h),i=D(e.pathname,g);e.origin===t.origin&&null!=i?h=i+e.search+e.hash:y=!0}catch(In){}let _=function(t,e){let{relative:i}=void 0===e?{}:e;X()||c(!1);let{basename:o,navigator:r}=n.useContext($),{hash:s,pathname:a,search:l}=it(t,{relative:i}),u=a;return"/"!==o&&(u="/"===a?o:U([o,a])),r.createHref({pathname:u,search:l,hash:s})}(h,{relative:r}),v=function(t,e){let{target:i,replace:o,state:r,preventScrollReset:s,relative:a,viewTransition:l}=void 0===e?{}:e,u=et(),c=Q(),h=it(t,{relative:a});return n.useCallback((e=>{if(function(t,e){return 0===t.button&&(!e||"_self"===e)&&!function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t)}(e,i)){e.preventDefault();let i=void 0!==o?o:p(c)===p(h);u(t,{replace:i,state:r,preventScrollReset:s,relative:a,viewTransition:l})}}),[c,u,h,o,r,i,t,s,a,l])}(h,{replace:a,state:l,target:u,preventScrollReset:d,relative:r,viewTransition:f});return n.createElement("a",xt({},m,{href:i||_,onClick:y||s?o:function(t){o&&o(t),t.defaultPrevented||v(t)},ref:e,target:u}))}));var It,Et;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(It||(It={})),function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"}(Et||(Et={}));var Pt=i(579);const kt=()=>{const t="/"===Q().pathname,e=(t,e)=>{t.preventDefault();const i=document.getElementById(e),n=document.querySelector(".navbar").offsetHeight;window.scrollTo({top:i.offsetTop-n,behavior:"smooth"})};return(0,Pt.jsxs)("nav",{className:"navbar",children:[(0,Pt.jsx)("div",{className:"logo",children:(0,Pt.jsx)(Mt,{to:"/",children:"Routify"})}),(0,Pt.jsxs)("ul",{className:"nav-links",children:[(0,Pt.jsx)("li",{children:(0,Pt.jsx)("a",{href:"#about",onClick:i=>{i.preventDefault(),t?e(i,"about"):(window.location.href="/",setTimeout((()=>{e(i,"about")}),200))},children:"About"})}),(0,Pt.jsx)("li",{children:(0,Pt.jsx)("a",{href:"#team",onClick:t=>e(t,"team"),children:"Team"})}),(0,Pt.jsx)("li",{children:(0,Pt.jsx)("a",{href:"#contact",onClick:t=>e(t,"contact"),children:"Contact"})})]})]})};var Bt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Dt=n.createContext&&n.createContext(Bt),Rt=["attr","size","title"];function Lt(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;i[n]=t[n]}return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)i=r[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function zt(){return zt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},zt.apply(this,arguments)}function Ot(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Ut(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ot(Object(i),!0).forEach((function(e){Ft(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ot(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ft(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Nt(t){return t&&t.map(((t,e)=>n.createElement(t.tag,Ut({key:e},t.attr),Nt(t.child))))}function Vt(t){return e=>n.createElement(Ht,zt({attr:Ut({},t.attr)},e),Nt(t.child))}function Ht(t){var e=e=>{var i,{attr:o,size:r,title:s}=t,a=Lt(t,Rt),l=r||e.size||"1em";return e.className&&(i=e.className),t.className&&(i=(i?i+" ":"")+t.className),n.createElement("svg",zt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,o,a,{className:i,style:Ut(Ut({color:t.color||e.color},e.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&n.createElement("title",null,s),t.children)};return void 0!==Dt?n.createElement(Dt.Consumer,null,(t=>e(t))):e(Bt)}function jt(t){return Vt({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M518.3 459a8 8 0 0 0-12.6 0l-112 141.7a7.98 7.98 0 0 0 6.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"},child:[]},{tag:"path",attr:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0 1 52.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 0 1-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"},child:[]}]})(t)}function Gt(t){return Vt({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(t)}const Wt=t=>{let{onFilesSelected:e,width:i="100%",height:o="200px"}=t;const[r,s]=(0,n.useState)([]);return(0,n.useEffect)((()=>{e&&e(r)}),[r,e]),(0,Pt.jsx)("section",{className:"drag-drop",style:{width:i,height:o},children:(0,Pt.jsxs)("div",{className:"document-uploader "+(r.length>0?"upload-box active":"upload-box"),onDrop:t=>{t.preventDefault();const e=Array.from(t.dataTransfer.files);s((t=>[...t,...e]))},onDragOver:t=>t.preventDefault(),children:[(0,Pt.jsx)("input",{type:"file",multiple:!0,onChange:t=>{const e=Array.from(t.target.files);s((t=>[...t,...e]))},style:{display:"none"},id:"fileInput"}),(0,Pt.jsxs)("label",{htmlFor:"fileInput",className:"upload-info",children:[(0,Pt.jsx)(jt,{}),(0,Pt.jsxs)("div",{children:[(0,Pt.jsx)("p",{children:"Drag and drop your files here or click to upload"}),(0,Pt.jsx)("p",{children:"Supported files: .ICS"})]})]}),r.length>0&&(0,Pt.jsx)("div",{className:"file-list",children:(0,Pt.jsx)("div",{className:"file-list__container",children:r.map(((t,e)=>(0,Pt.jsxs)("div",{className:"file-item",children:[(0,Pt.jsx)("div",{className:"file-info",children:(0,Pt.jsx)("p",{children:t.name})}),(0,Pt.jsx)("div",{className:"file-actions",children:(0,Pt.jsx)(Gt,{onClick:()=>(t=>{const e=r.filter(((e,i)=>i!==t));s(e)})(e)})})]},e)))})})]})})},qt=JSON.parse('[{"institution":"Alabama A & M University"},{"institution":"University of Alabama at Birmingham"},{"institution":"Amridge University"},{"institution":"University of Alabama in Huntsville"},{"institution":"Alabama State University"},{"institution":"University of Alabama System Office"},{"institution":"The University of Alabama"},{"institution":"Central Alabama Community College"},{"institution":"Athens State University"},{"institution":"Auburn University at Montgomery"},{"institution":"Auburn University"},{"institution":"Birmingham Southern College"},{"institution":"Chattahoochee Valley Community College"},{"institution":"Concordia College Alabama"},{"institution":"South University-Montgomery"},{"institution":"Enterprise State Community College"},{"institution":"James H Faulkner State Community College"},{"institution":"Faulkner University"},{"institution":"Gadsden State Community College"},{"institution":"New Beginning College of Cosmetology"},{"institution":"George C Wallace State Community College-Dothan"},{"institution":"George C Wallace State Community College-Hanceville"},{"institution":"George C Wallace State Community College-Selma"},{"institution":"Herzing University-Birmingham"},{"institution":"Huntingdon College"},{"institution":"Heritage Christian University"},{"institution":"J F Drake State Community and Technical College"},{"institution":"J F Ingram State Technical College"},{"institution":"Jacksonville State University"},{"institution":"Jefferson Davis Community College"},{"institution":"Jefferson State Community College"},{"institution":"John C Calhoun State Community College"},{"institution":"Judson College"},{"institution":"Lawson State Community College-Birmingham Campus"},{"institution":"University of West Alabama"},{"institution":"Lurleen B Wallace Community College"},{"institution":"Marion Military Institute"},{"institution":"Miles College"},{"institution":"University of Mobile"},{"institution":"University of Montevallo"},{"institution":"Northwest-Shoals Community College"},{"institution":"University of North Alabama"},{"institution":"Northeast Alabama Community College"},{"institution":"Oakwood University"},{"institution":"Alabama Southern Community College"},{"institution":"Prince Institute-Southeast"},{"institution":"Reid State Technical College"},{"institution":"Bishop State Community College"},{"institution":"Samford University"},{"institution":"Selma University"},{"institution":"Shelton State Community College"},{"institution":"Snead State Community College"},{"institution":"University of South Alabama"},{"institution":"Spring Hill College"},{"institution":"Southeastern Bible College"},{"institution":"Stillman College"},{"institution":"Talladega College"},{"institution":"H Councill Trenholm State Technical College"},{"institution":"Troy University"},{"institution":"Tuskegee University"},{"institution":"United States Sports Academy"},{"institution":"Bevill State Community College"},{"institution":"University of Alaska Anchorage"},{"institution":"Alaska Bible College"},{"institution":"University of Alaska Fairbanks"},{"institution":"University of Alaska Southeast"},{"institution":"Alaska Pacific University"},{"institution":"AVTEC-Alaska\'s Institute of Technology"},{"institution":"Charter College-Anchorage"},{"institution":"Prince William Sound Community College"},{"institution":"Alaska Career College"},{"institution":"University of Alaska System of Higher Education"},{"institution":"Everest College-Phoenix"},{"institution":"Collins College"},{"institution":"Empire Beauty School-Paradise Valley"},{"institution":"Empire Beauty School-Tucson"},{"institution":"Thunderbird School of Global Management"},{"institution":"American Indian College of the Assemblies of God Inc"},{"institution":"American Institute of Technology"},{"institution":"Carrington College-Phoenix"},{"institution":"Carrington College-Mesa"},{"institution":"Carrington College-Tucson"},{"institution":"College America-Flagstaff"},{"institution":"Arizona Academy of Beauty-East"},{"institution":"Arizona Automotive Institute"},{"institution":"Brookline College-Phoenix"},{"institution":"Arizona State University-Tempe"},{"institution":"Arizona Western College"},{"institution":"University of Arizona"},{"institution":"Southwest University of Visual Arts-Tucson"},{"institution":"Brillare Hairdressing Academy"},{"institution":"Central Arizona College"},{"institution":"Brown Mackie College-Tucson"},{"institution":"Charles of Italy Beauty College"},{"institution":"Cochise College"},{"institution":"Empire Beauty School-Flagstaff"},{"institution":"Empire Beauty School-Chandler"},{"institution":"Cortiva Institute-Tucson"},{"institution":"DeVry University-Arizona"},{"institution":"Avalon School of Cosmetology-Mesa"},{"institution":"Eastern Arizona College"},{"institution":"Embry-Riddle Aeronautical University-Prescott"},{"institution":"Frank Lloyd Wright School of Architecture"},{"institution":"Glendale Community College"},{"institution":"Grand Canyon University"},{"institution":"Anthem College-Phoenix"},{"institution":"International Academy of Hair Design"},{"institution":"Kaplan College-Phoenix"},{"institution":"Maricopa Community College System Office"},{"institution":"GateWay Community College"},{"institution":"Mesa Community College"},{"institution":"ITT Technical Institute-Tucson"},{"institution":"ITT Technical Institute-Tempe"},{"institution":"Mohave Community College"},{"institution":"Universal Technical Institute of Arizona Inc-Motorcycle Mechanics Institute Division"},{"institution":"Dine College"},{"institution":"Northern Arizona University"},{"institution":"Northland Pioneer College"},{"institution":"Ottawa University-Phoenix"},{"institution":"Phoenix College"},{"institution":"Cortiva Institute-Scottsdale"},{"institution":"University of Phoenix-Phoenix Campus"},{"institution":"Pima Community College"},{"institution":"Pima Medical Institute-Tucson"},{"institution":"Pima Medical Institute-Albuquerque"},{"institution":"Prescott College"},{"institution":"Refrigeration School Inc"},{"institution":"Rio Salado College"},{"institution":"Roberto-Venn School of Luthiery"},{"institution":"Hair Academy of Safford"},{"institution":"Scottsdale Community College"},{"institution":"South Mountain Community College"},{"institution":"Arizona Christian University"},{"institution":"Tucson College"},{"institution":"Universal Technical Institute of Arizona Inc"},{"institution":"Western International University"},{"institution":"Empire Beauty School-NW Phoenix"},{"institution":"Yavapai College"},{"institution":"University of Arkansas at Little Rock"},{"institution":"University of Arkansas for Medical Sciences"},{"institution":"ABC Beauty College Inc"},{"institution":"Arkansas Baptist College"},{"institution":"Arkansas Beauty School"},{"institution":"Arkansas Beauty College"},{"institution":"Lyon College"},{"institution":"Arkansas College of Barbering and Hair Design"},{"institution":"Arthur\'s Beauty College Inc-Fort Smith"},{"institution":"University of Arkansas"},{"institution":"University of Arkansas at Pine Bluff"},{"institution":"Arkansas State University-Beebe"},{"institution":"Arkansas State University-Main Campus"},{"institution":"Arkansas Tech University"},{"institution":"University of Arkansas at Monticello"},{"institution":"Arthur\'s Beauty College Inc-Jacksonville"},{"institution":"Baptist Health Schools-Little Rock"},{"institution":"Black River Technical College"},{"institution":"University of Central Arkansas"},{"institution":"Central Baptist College"},{"institution":"Cossatot Community College of the University of Arkansas"},{"institution":"Crowley\'s Ridge College"},{"institution":"Crowley\'s Ridge Technical Institute"},{"institution":"East Arkansas Community College"},{"institution":"Eastern College of Health Vocations-Little Rock"},{"institution":"Imagine-Paul Mitchell Partner School"},{"institution":"National Park Community College"},{"institution":"University of Arkansas Community College-Batesville"},{"institution":"Harding University"},{"institution":"Henderson State University"},{"institution":"Hendrix College"},{"institution":"Hot Springs Beauty College"},{"institution":"Jefferson Regional Medical Center School of Nursing"},{"institution":"John Brown University"},{"institution":"Lees School of Cosmetology"},{"institution":"Career Academy of Hair Design"},{"institution":"Marsha Kay Beauty College"},{"institution":"Academy of Salon and Spa"},{"institution":"Mid-South Community College"},{"institution":"Arkansas Northeastern College"},{"institution":"Margaret\'s Hair Academy Inc"},{"institution":"New Tyler Barber College Inc"},{"institution":"North Arkansas College"},{"institution":"Northwest Technical Institute"},{"institution":"Ouachita Baptist University"},{"institution":"College of the Ouachitas"},{"institution":"Ozarka College"},{"institution":"University of the Ozarks"},{"institution":"University of Arkansas Community College-Morrilton"},{"institution":"Philander Smith College"},{"institution":"Phillips Community College of the University of Arkansas"},{"institution":"Southeast Arkansas College"},{"institution":"Professional Cosmetology Education Center"},{"institution":"Pulaski Technical College"},{"institution":"University of Arkansas Community College-Hope"},{"institution":"Rich Mountain Community College"},{"institution":"Paul Mitchell the School-Arkansas"},{"institution":"Searcy Beauty College Inc"},{"institution":"Shorter College"},{"institution":"Williams Baptist College"},{"institution":"South Arkansas Community College"},{"institution":"Southern Arkansas University Main Campus"},{"institution":"Southern Arkansas University Tech"},{"institution":"University of Arkansas System Office"},{"institution":"Velvatex College of Beauty Culture"},{"institution":"University of Arkansas-Fort Smith"},{"institution":"Academy of Art University"},{"institution":"ITT Technical Institute-Rancho Cordova"},{"institution":"Academy of Chinese Culture and Health Sciences"},{"institution":"The Academy of Radio and TV Broadcasting"},{"institution":"Avalon School of Cosmetology-Alameda"},{"institution":"College of Alameda"},{"institution":"Allan Hancock College"},{"institution":"American Academy of Dramatic Arts-Los Angeles"},{"institution":"American Baptist Seminary of the West"},{"institution":"American Film Institute Conservatory"},{"institution":"American Beauty College"},{"institution":"American Career College-Los Angeles"},{"institution":"American Conservatory Theater"},{"institution":"American River College"},{"institution":"Everest College-Hayward"},{"institution":"Antelope Valley College"},{"institution":"Art Center College of Design"},{"institution":"Associated Technical College-Los Angeles"},{"institution":"Associated Technical College-San Diego"},{"institution":"Azusa Pacific University"},{"institution":"Bakersfield College"},{"institution":"Barstow Community College"},{"institution":"Bellus Academy-National City"},{"institution":"Bethesda University of California"},{"institution":"Biola University"},{"institution":"Brooks Institute"},{"institution":"Brownson Technical School"},{"institution":"Bryan University"},{"institution":"Butte College"},{"institution":"Phillips Graduate Institute"},{"institution":"California Institute of Integral Studies"},{"institution":"Cabrillo College"},{"institution":"California Baptist University"},{"institution":"California College of the Arts"},{"institution":"University of California-Hastings College of Law"},{"institution":"California Institute of Technology"},{"institution":"California Lutheran University"},{"institution":"California Polytechnic State University-San Luis Obispo"},{"institution":"Alliant International University"},{"institution":"California State University-Bakersfield"},{"institution":"California State University-Stanislaus"},{"institution":"California State University-Chancellors Office"},{"institution":"California State University-San Bernardino"},{"institution":"California State Polytechnic University-Pomona"},{"institution":"California State University-Chico"},{"institution":"California State University-Dominguez Hills"},{"institution":"California State University-Fresno"},{"institution":"California State University-Fullerton"},{"institution":"California State University-East Bay"},{"institution":"California State University-Long Beach"},{"institution":"California State University-Los Angeles"},{"institution":"California State University-Northridge"},{"institution":"California State University-Sacramento"},{"institution":"University of California-Berkeley"},{"institution":"University of California-Davis"},{"institution":"University of California-Irvine"},{"institution":"University of California-Los Angeles"},{"institution":"University of California-Riverside"},{"institution":"University of California-San Diego"},{"institution":"University of California-San Francisco"},{"institution":"University of California-Santa Barbara"},{"institution":"University of California-Santa Cruz"},{"institution":"Sofia University"},{"institution":"California Beauty School"},{"institution":"California Christian College"},{"institution":"California College San Diego"},{"institution":"Le Cordon Bleu College of Culinary Arts-San Francisco"},{"institution":"California Hair Design Academy"},{"institution":"California Institute of the Arts"},{"institution":"California Maritime Academy"},{"institution":"California Western School of Law"},{"institution":"Canada College"},{"institution":"College of the Canyons"},{"institution":"Career Academy of Beauty"},{"institution":"Casa Loma College-Van Nuys"},{"institution":"CET-San Diego"},{"institution":"CET-Sobrato"},{"institution":"CET-El Centro"},{"institution":"CET-San Bernardino"},{"institution":"CET-Watsonville"},{"institution":"CET-Gilroy"},{"institution":"CET-Salinas"},{"institution":"Cerritos College"},{"institution":"Cerro Coso Community College"},{"institution":"Chabot College"},{"institution":"Chaffey College"},{"institution":"Chapman University"},{"institution":"Charles R Drew University of Medicine and Science"},{"institution":"Concordia University-Irvine"},{"institution":"San Diego Christian College"},{"institution":"Church Divinity School of the Pacific"},{"institution":"Citrus College"},{"institution":"Citrus Heights Beauty College"},{"institution":"City College of San Francisco"},{"institution":"Claremont Graduate University"},{"institution":"Claremont McKenna College"},{"institution":"Milan Institute-Visalia"},{"institution":"Clovis Adult Education"},{"institution":"Coast Community College District Office"},{"institution":"Coastline Community College"},{"institution":"Cogswell College"},{"institution":"Coleman University"},{"institution":"COBA Academy"},{"institution":"Western University of Health Sciences"},{"institution":"Columbia College"},{"institution":"Columbia College-Hollywood"},{"institution":"El Camino College-Compton Center"},{"institution":"Western Beauty Institute"},{"institution":"Contra Costa Community College District Office"},{"institution":"Contra Costa College"},{"institution":"Cosumnes River College"},{"institution":"Crafton Hills College"},{"institution":"Cuesta College"},{"institution":"Cuyamaca College"},{"institution":"Cypress College"},{"institution":"De Anza College"},{"institution":"Marinello Schools of Beauty-Hemet"},{"institution":"International School of Beauty Inc"},{"institution":"Dell\'Arte International School of Physical Theatre"},{"institution":"College of the Desert"},{"institution":"Design Institute of San Diego"},{"institution":"DeVry University-California"},{"institution":"Diablo Valley College"},{"institution":"Dominican University of California"},{"institution":"Dominican School of Philosophy & Theology"},{"institution":"East Los Angeles College"},{"institution":"Marinello Schools of Beauty-Santa Clara"},{"institution":"San Diego Continuing Education"},{"institution":"El Camino Community College District"},{"institution":"Elegance International"},{"institution":"Marinello Schools of Beauty-Burbank"},{"institution":"Marinello Schools of Beauty-Moreno Valley"},{"institution":"Emperor\'s College of Traditional Oriental Medicine"},{"institution":"Empire College School of Business"},{"institution":"Evergreen Valley College"},{"institution":"Fashion Institute of Design & Merchandising-Los Angeles"},{"institution":"Fashion Careers College"},{"institution":"Fashion Institute of Design & Merchandising-San Francisco"},{"institution":"Fashion Institute of Design & Merchandising-Orange County"},{"institution":"Feather River Community College District"},{"institution":"Federico Beauty Institute"},{"institution":"Fielding Graduate University"},{"institution":"Five Branches University"},{"institution":"Hair California Beauty Academy"},{"institution":"Foothill College"},{"institution":"Franciscan School of Theology"},{"institution":"Fredrick and Charles Beauty College"},{"institution":"Fresno City College"},{"institution":"Fresno Pacific University"},{"institution":"Foothill-De Anza Community College District"},{"institution":"Fuller Theological Seminary in California"},{"institution":"Fullerton College"},{"institution":"Galen College of Medical and Dental Assistants"},{"institution":"Gavilan College"},{"institution":"Gemological Institute of America-Carlsbad"},{"institution":"Glendale Community College"},{"institution":"Glendale Career College"},{"institution":"Golden Gate University-San Francisco"},{"institution":"Golden West College"},{"institution":"Graduate Theological Union"},{"institution":"Grossmont-Cuyamaca Community College District"},{"institution":"Grossmont College"},{"institution":"Salon Success Academy-San Bernardino"},{"institution":"Hartnell College"},{"institution":"Harvey Mudd College"},{"institution":"Heald College-Rancho Cordova"},{"institution":"Heald College-Fresno"},{"institution":"Heald College-San Jose"},{"institution":"Heald College-San Francisco"},{"institution":"Heald College-Concord"},{"institution":"Hilltop Beauty School"},{"institution":"Holy Names University"},{"institution":"Pacifica Graduate Institute"},{"institution":"Humboldt State University"},{"institution":"Humphreys College-Stockton and Modesto Campuses"},{"institution":"Imperial Valley College"},{"institution":"Institute for Business and Technology"},{"institution":"LA College International"},{"institution":"Interior Designers Institute"},{"institution":"Toni & Guy Hairdressing Academy-Santa Monica"},{"institution":"Irvine Valley College"},{"institution":"ITT Technical Institute-National City"},{"institution":"ITT Technical Institute-San Dimas"},{"institution":"ITT Technical Institute-Orange"},{"institution":"Bellus Academy-El Cajon"},{"institution":"Joe Blasco Makeup Artist Training Center"},{"institution":"John F Kennedy University"},{"institution":"American Jewish University"},{"institution":"Reedley College"},{"institution":"Life Pacific College"},{"institution":"The Art Institute of California-Argosy University San Diego"},{"institution":"University of La Verne"},{"institution":"Laguna College of Art and Design"},{"institution":"Lake Tahoe Community College"},{"institution":"Lancaster Beauty School"},{"institution":"Laney College"},{"institution":"Lassen Community College"},{"institution":"Life Chiropractic College West"},{"institution":"Lincoln University"},{"institution":"Southern California Seminary"},{"institution":"La Sierra University"},{"institution":"Loma Linda University"},{"institution":"Long Beach City College"},{"institution":"Southern California University of Health Sciences"},{"institution":"Los Angeles Community College District Office"},{"institution":"Los Angeles Harbor College"},{"institution":"Los Angeles Pierce College"},{"institution":"Los Angeles Southwest College"},{"institution":"Los Angeles Trade Technical College"},{"institution":"Los Angeles Valley College"},{"institution":"The Master\'s College and Seminary"},{"institution":"Los Angeles City College"},{"institution":"Los Angeles County College of Nursing and Allied Health"},{"institution":"Los Angeles Mission College"},{"institution":"Los Medanos College"},{"institution":"Los Rios Community College District Office"},{"institution":"The Art Institute of California-Argosy University San Francisco"},{"institution":"Loyola Marymount University"},{"institution":"Lu Ross Academy"},{"institution":"Manchester Beauty College"},{"institution":"Tulare Beauty College"},{"institution":"Lyles Bakersfield College of Beauty"},{"institution":"Lyles Fresno College of Beauty"},{"institution":"Lytles Redwood Empire Beauty College Inc"},{"institution":"MTI Business College Inc"},{"institution":"MTI College"},{"institution":"Kaplan College-Sacramento"},{"institution":"Kaplan College-San Diego"},{"institution":"Kaplan College-Vista"},{"institution":"College of Marin"},{"institution":"Marinello Schools of Beauty-Los Angeles"},{"institution":"Marymount California University"},{"institution":"Mendocino College"},{"institution":"Menlo College"},{"institution":"Merced College"},{"institution":"Merritt College"},{"institution":"Mills College"},{"institution":"MiraCosta College"},{"institution":"Marinello Schools of Beauty-San Francisco"},{"institution":"Mission College"},{"institution":"Modern Beauty Academy"},{"institution":"Kaplan College-North Hollywood"},{"institution":"Modesto Junior College"},{"institution":"Moler Barber College"},{"institution":"Monterey Institute of International Studies"},{"institution":"Monterey Peninsula College"},{"institution":"Moorpark College"},{"institution":"Mt San Antonio College"},{"institution":"Mount St Mary\'s College"},{"institution":"Mt San Jacinto Community College District"},{"institution":"Mueller College"},{"institution":"Musicians Institute"},{"institution":"Napa Valley College"},{"institution":"Everest College-San Francisco"},{"institution":"Everest College-Reseda"},{"institution":"Everest College-LA Wilshire"},{"institution":"Everest College-San Jose"},{"institution":"Everest College-Gardena"},{"institution":"Everest College-Alhambra"},{"institution":"Everest College-San Bernardino"},{"institution":"The National Hispanic University"},{"institution":"National Holistic Institute"},{"institution":"National University"},{"institution":"Naval Postgraduate School"},{"institution":"Newschool of Architecture and Design"},{"institution":"Newberry School of Beauty"},{"institution":"Adrian\'s College of Beauty Modesto"},{"institution":"North Orange County Community College District"},{"institution":"North-West College-Pomona"},{"institution":"North-West College-West Covina"},{"institution":"North-West College-Pasadena"},{"institution":"Northwestern Polytechnic University"},{"institution":"Notre Dame de Namur University"},{"institution":"Occidental College"},{"institution":"Oceanside College of Beauty"},{"institution":"Ohlone College"},{"institution":"Orange Coast College"},{"institution":"Otis College of Art and Design"},{"institution":"Oxnard College"},{"institution":"Hope International University"},{"institution":"Concorde Career College-San Diego"},{"institution":"Palo Alto University"},{"institution":"Pacific Lutheran Theological Seminary"},{"institution":"Pacific Oaks College"},{"institution":"Pacific School of Religion"},{"institution":"Pacific States University"},{"institution":"Pacific Union College"},{"institution":"University of the Pacific"},{"institution":"Palo Verde College"},{"institution":"Palomar College"},{"institution":"Paris Beauty College"},{"institution":"Pasadena City College"},{"institution":"Pepperdine University"},{"institution":"Peralta Community College System Office"},{"institution":"Pitzer College"},{"institution":"Platt College-San Diego"},{"institution":"Point Loma Nazarene University"},{"institution":"Pomona College"},{"institution":"Porterville College"},{"institution":"Westwood College-South Bay"},{"institution":"Professional Institute of Beauty"},{"institution":"Santa Ana College"},{"institution":"Pardee RAND Graduate School"},{"institution":"Shasta School of Cosmetology"},{"institution":"University of Redlands"},{"institution":"College of the Redwoods"},{"institution":"Salon Success Academy-Upland"},{"institution":"Salon Success Academy-Corona"},{"institution":"Rio Hondo College"},{"institution":"Riverside City College"},{"institution":"Argosy University-San Francisco Bay Area"},{"institution":"Rosemead Beauty School"},{"institution":"Dongguk University-Los Angeles"},{"institution":"Sacramento City College"},{"institution":"Saddleback College"},{"institution":"Saint Patrick\'s Seminary and University"},{"institution":"Samuel Merritt University"},{"institution":"San Diego Community College District-District Office"},{"institution":"San Diego City College"},{"institution":"Golf Academy of America-Carlsbad"},{"institution":"San Diego Mesa College"},{"institution":"San Diego Miramar College"},{"institution":"San Diego State University"},{"institution":"University of San Diego"},{"institution":"San Francisco Art Institute"},{"institution":"San Francisco Conservatory of Music"},{"institution":"San Francisco State University"},{"institution":"San Francisco Theological Seminary"},{"institution":"University of San Francisco"},{"institution":"San Joaquin College of Law"},{"institution":"San Joaquin Delta College"},{"institution":"San Joaquin Valley College-Visalia"},{"institution":"San Joaquin Valley College-Bakersfield"},{"institution":"William Jessup University"},{"institution":"San Jose-Evergreen Community College District"},{"institution":"San Jose City College"},{"institution":"San Jose State University"},{"institution":"San Mateo County Community College District Office"},{"institution":"College of San Mateo"},{"institution":"Santa Barbara Business College-Bakersfield"},{"institution":"Westwood College-Los Angeles"},{"institution":"Santa Barbara Business College-Santa Maria"},{"institution":"Santa Barbara City College"},{"institution":"Santa Clara University"},{"institution":"Santa Monica College"},{"institution":"Santa Rosa Junior College"},{"institution":"Saybrook University"},{"institution":"Scripps College"},{"institution":"Wyotech-Fremont"},{"institution":"College of the Sequoias"},{"institution":"Shasta Bible College and Graduate School"},{"institution":"Shasta College"},{"institution":"Sierra College"},{"institution":"Sierra College of Beauty"},{"institution":"Sierra Valley College of Court Reporting"},{"institution":"Trinity Law School"},{"institution":"Simpson University"},{"institution":"College of the Siskiyous"},{"institution":"Charles A Jones Career and Education Center"},{"institution":"Skyline College"},{"institution":"San Bernardino Valley College"},{"institution":"Saint Mary\'s College of California"},{"institution":"Solano Community College"},{"institution":"Sonoma State University"},{"institution":"Pinnacle College"},{"institution":"South Baylo University"},{"institution":"South Coast College"},{"institution":"Vanguard University of Southern California"},{"institution":"Concorde Career College-Garden Grove"},{"institution":"Southwestern College"},{"institution":"St John\'s Seminary"},{"institution":"Starr King School for Ministry"},{"institution":"State Center Community College District"},{"institution":"Marshall B Ketchum University"},{"institution":"Southern California Institute of Architecture"},{"institution":"University of Southern California"},{"institution":"Southwestern Law School"},{"institution":"Taft College"},{"institution":"Claremont School of Theology"},{"institution":"Thomas Aquinas College"},{"institution":"Marinello Schools of Beauty-Lake Forest"},{"institution":"Epic Bible College"},{"institution":"University of California-System Administration Central Office"},{"institution":"United Education Institute-Huntington Park Campus"},{"institution":"Concorde Career College-San Bernardino"},{"institution":"Universal College of Beauty Inc-Los Angeles 1"},{"institution":"Concorde Career College-North Hollywood"},{"institution":"Ventura County Community College System Office"},{"institution":"Ventura College"},{"institution":"The Santa Barbara and Ventura Colleges of Law-Ventura"},{"institution":"Victor Valley Beauty College Inc"},{"institution":"Victor Valley College"},{"institution":"Berkeley City College"},{"institution":"West Valley Mission Community College District Office"},{"institution":"Walden University"},{"institution":"Waynes College of Beauty"},{"institution":"West Hills College-Coalinga"},{"institution":"West Los Angeles College"},{"institution":"West Valley College"},{"institution":"Carrington College California-Sacramento"},{"institution":"Westminster Theological Seminary in California"},{"institution":"Westmont College"},{"institution":"Whittier College"},{"institution":"Woodbury University"},{"institution":"The Wright Institute"},{"institution":"Western State College of Law at Argosy University"},{"institution":"Thomas Jefferson School of Law"},{"institution":"Yeshiva Ohr Elchonon Chabad West Coast Talmudical Seminary"},{"institution":"Yosemite Community College District Office"},{"institution":"Yuba College"},{"institution":"The Salon Professional Academy-Grand Junction"},{"institution":"Adams State University"},{"institution":"Aims Community College"},{"institution":"Arapahoe Community College"},{"institution":"Bel-Rea Institute of Animal Technology"},{"institution":"Everest College-Colorado Springs"},{"institution":"Boulder College of Massage Therapy"},{"institution":"University of Colorado Denver"},{"institution":"University of Colorado Colorado Springs"},{"institution":"Redstone College"},{"institution":"University of Colorado Boulder"},{"institution":"Colorado Christian University"},{"institution":"Colorado College"},{"institution":"Concorde Career College-Aurora"},{"institution":"The Art Institute of Colorado"},{"institution":"Colorado Mountain College"},{"institution":"Colorado Northwestern Community College"},{"institution":"Colorado School of Mines"},{"institution":"Colorado School of Trades"},{"institution":"Colorado State University-Fort Collins"},{"institution":"Colorado Technical University-Colorado Springs"},{"institution":"Empire Beauty School-Lakewood"},{"institution":"Community College of Aurora"},{"institution":"College America-Denver"},{"institution":"Delta Montrose Technical College"},{"institution":"Prince Institute-Rocky Mountains"},{"institution":"Community College of Denver"},{"institution":"Lincoln College of Technology-Denver"},{"institution":"Denver Seminary"},{"institution":"Westwood College-Denver North"},{"institution":"University of Denver"},{"institution":"Emily Griffith Technical College"},{"institution":"Fort Lewis College"},{"institution":"Front Range Community College"},{"institution":"Glenwood Beauty Academy"},{"institution":"Hair Dynamics Education Center"},{"institution":"Iliff School of Theology"},{"institution":"International Salon and Spa Academy"},{"institution":"Lamar Community College"},{"institution":"Colorado Mesa University"},{"institution":"Metropolitan State University of Denver"},{"institution":"Morgan Community College"},{"institution":"Naropa University"},{"institution":"National American University-Colorado Springs"},{"institution":"National American University-Denver"},{"institution":"Nazarene Bible College"},{"institution":"Northeastern Junior College"},{"institution":"University of Northern Colorado"},{"institution":"Otero Junior College"},{"institution":"Everest College-Thornton"},{"institution":"Pikes Peak Community College"},{"institution":"Intellitec Medical Institute"},{"institution":"Pueblo Community College"},{"institution":"Red Rocks Community College"},{"institution":"Regis University"},{"institution":"Rocky Mountain College of Art and Design"},{"institution":"Montessori Education Center of the Rockies"},{"institution":"Colorado State University-Pueblo"},{"institution":"Pickens Technical College"},{"institution":"Intellitec College-Colorado Springs"},{"institution":"Intellitec College-Grand Junction"},{"institution":"Trinidad State Junior College"},{"institution":"University of Colorado System Office"},{"institution":"United States Air Force Academy"},{"institution":"Empire Beauty School-Thornton"},{"institution":"Western State Colorado University"},{"institution":"Yeshiva Toras Chaim Talmudical Seminary"},{"institution":"Albertus Magnus College"},{"institution":"Paul Mitchell the School-Danbury"},{"institution":"Asnuntuck Community College"},{"institution":"Bais Binyomin Academy"},{"institution":"Branford Hall Career Institute-Branford Campus"},{"institution":"Lincoln College of New England-Southington"},{"institution":"Bridgeport Hospital School of Nursing"},{"institution":"University of Bridgeport"},{"institution":"Central Connecticut State University"},{"institution":"Charter Oak State College"},{"institution":"Connecticut Center for Massage Therapy-Newington"},{"institution":"Connecticut College"},{"institution":"Marinello Schools of Beauty-East Hartford"},{"institution":"Porter and Chester Institute of Branford"},{"institution":"University of Connecticut"},{"institution":"Goodwin College"},{"institution":"Lincoln Technical Institute-East Windsor"},{"institution":"Eastern Connecticut State University"},{"institution":"Fairfield University"},{"institution":"Northhaven Academy"},{"institution":"Capital Community College"},{"institution":"Rensselaer Hartford Graduate Center Inc"},{"institution":"Fox Institute of Business-West Hartford"},{"institution":"Hartford Seminary"},{"institution":"University of Hartford"},{"institution":"Holy Apostles College and Seminary"},{"institution":"Housatonic Community College"},{"institution":"Sanford-Brown College-Farmington"},{"institution":"The Leon Institute of Hair Design"},{"institution":"Lyme Academy College of Fine Arts"},{"institution":"Manchester Community College"},{"institution":"Naugatuck Valley Community College"},{"institution":"Middlesex Community College"},{"institution":"Mitchell College"},{"institution":"Three Rivers Community College"},{"institution":"Lincoln Technical Institute-New Britain"},{"institution":"New England Tractor Trailer Training School of Connecticut"},{"institution":"University of New Haven"},{"institution":"Ridley-Lowell Business & Technical Institute-New London"},{"institution":"Norwalk Community College"},{"institution":"Northwestern Connecticut Community College"},{"institution":"Paier College of Art Inc"},{"institution":"Marinello Schools of Beauty-Meriden"},{"institution":"Porter and Chester Institute of Stratford"},{"institution":"Post University"},{"institution":"Quinebaug Valley Community College"},{"institution":"Quinnipiac University"},{"institution":"Sacred Heart University"},{"institution":"University of Saint Joseph"},{"institution":"Gateway Community College"},{"institution":"St Vincent\'s College"},{"institution":"Southern Connecticut State University"},{"institution":"Stone Academy-Hamden"},{"institution":"Tri-State College of Acupuncture"},{"institution":"Trinity College"},{"institution":"Tunxis Community College"},{"institution":"United States Coast Guard Academy"},{"institution":"Wesleyan University"},{"institution":"Western Connecticut State University"},{"institution":"Yale-New Haven Hospital Dietetic Internship"},{"institution":"Yale University"},{"institution":"Beebe Medical Center Margaret H Rollins School of Nursing"},{"institution":"Dawn Career Institute Inc"},{"institution":"Delaware Technical Community College-Central Office"},{"institution":"Delaware Technical Community College-Owens"},{"institution":"Delaware Technical Community College-Terry"},{"institution":"Delaware Technical Community College-Stanton/Wilmington"},{"institution":"Delaware State University"},{"institution":"University of Delaware"},{"institution":"Goldey-Beacom College"},{"institution":"Schilling-Douglas School of Hair Design"},{"institution":"Wesley College"},{"institution":"Wilmington University"},{"institution":"American University"},{"institution":"Catholic University of America"},{"institution":"Corcoran College of Art and Design"},{"institution":"University of the District of Columbia"},{"institution":"Pontifical Faculty of the Immaculate Conception at the Dominican House of Studies"},{"institution":"Gallaudet University"},{"institution":"George Washington University"},{"institution":"Georgetown University"},{"institution":"Howard University"},{"institution":"Medtech Institute"},{"institution":"Strayer University-District of Columbia"},{"institution":"National Conservatory of Dramatic Arts"},{"institution":"Trinity Washington University"},{"institution":"Wesley Theological Seminary"},{"institution":"Wyotech-Daytona"},{"institution":"The Art Institute of Fort Lauderdale"},{"institution":"Atlantic Technical Center"},{"institution":"The Baptist College of Florida"},{"institution":"Barry University"},{"institution":"Gooding Institute of Nurse Anesthesia"},{"institution":"Bethune-Cookman University"},{"institution":"Lynn University"},{"institution":"GUTI The Premier Beauty & Wellness Academy"},{"institution":"Bradford-Union Technical Center"},{"institution":"Eastern Florida State College"},{"institution":"Broward College"},{"institution":"Fortis College-Winter Park"},{"institution":"Carlos Albizu University-Miami"},{"institution":"College of Central Florida"},{"institution":"Johnson University Florida"},{"institution":"University of Central Florida"},{"institution":"Charlotte Technical Center"},{"institution":"Chipola College"},{"institution":"Clearwater Christian College"},{"institution":"Lorenzo Walker Institute of Technology"},{"institution":"Daytona State College"},{"institution":"South University-West Palm Beach"},{"institution":"Eckerd College"},{"institution":"Edison State College"},{"institution":"Edward Waters College"},{"institution":"Embry-Riddle Aeronautical University-Daytona Beach"},{"institution":"Florida Agricultural and Mechanical University"},{"institution":"Florida Atlantic University"},{"institution":"Florida State College at Jacksonville"},{"institution":"Flagler College-St Augustine"},{"institution":"Florida College"},{"institution":"Concorde Career Institute-Jacksonville"},{"institution":"Concorde Career Institute-Miramar"},{"institution":"Concorde Career Institute-Tampa"},{"institution":"Adventist University of Health Sciences"},{"institution":"Florida Institute of Technology"},{"institution":"Florida Institute of Ultrasound Inc"},{"institution":"Florida International University"},{"institution":"Florida Keys Community College"},{"institution":"Florida Memorial University"},{"institution":"Florida Career College-Miami"},{"institution":"Florida School of Massage"},{"institution":"Florida Southern College"},{"institution":"Florida State University"},{"institution":"Florida Technical College"},{"institution":"University of Southernmost Florida"},{"institution":"University of Florida"},{"institution":"Everest University-Pompano Beach"},{"institution":"Fort Pierce Beauty Academy"},{"institution":"Full Sail University"},{"institution":"George Stone Technical Center"},{"institution":"George T Baker Aviation School"},{"institution":"Gulf Coast State College"},{"institution":"Key College"},{"institution":"Hillsborough Community College"},{"institution":"Hobe Sound Bible College"},{"institution":"Hollywood Institute of Beauty Careers"},{"institution":"Cortiva Institute-Florida"},{"institution":"Indian River State College"},{"institution":"International Academy of Design and Technology-Tampa"},{"institution":"International Academy"},{"institution":"AI Miami International University of Art and Design"},{"institution":"ITT Technical Institute-Tampa"},{"institution":"Jacksonville University"},{"institution":"Jones College-Jacksonville"},{"institution":"Keiser University-Ft Lauderdale"},{"institution":"Heritage Institute-Ft Myers"},{"institution":"La Belle Beauty School"},{"institution":"Florida Gateway College"},{"institution":"Lake Technical Center"},{"institution":"Lake-Sumter State College"},{"institution":"Fort Myers Institute of Technology"},{"institution":"Lively Technical Center"},{"institution":"Lindsey Hopkins Technical Education Center"},{"institution":"Loraines Academy Inc"},{"institution":"Luther Rice University & Seminary"},{"institution":"State College of Florida-Manatee-Sarasota"},{"institution":"Manatee Technical Institute"},{"institution":"Manhattan Hairstyling Academy"},{"institution":"Traviss Career Center"},{"institution":"Trinity International University-Florida"},{"institution":"Miami Lakes Educational Center"},{"institution":"Miami Dade College"},{"institution":"University of Miami"},{"institution":"Mid Florida Tech"},{"institution":"Beauty Schools of America-Miami"},{"institution":"Remington College-Tampa Campus"},{"institution":"Everest Institute-North Miami"},{"institution":"Everest Institute-Hialeah"},{"institution":"Academy of Healing Arts Massage & Facial Skin Care"},{"institution":"Lincoln College of Technology-West Palm Beach"},{"institution":"Fortis College-Tampa"},{"institution":"Paul Mitchell the School-Jacksonville"},{"institution":"North Florida Community College"},{"institution":"University of North Florida"},{"institution":"Northwood University-Florida"},{"institution":"Nova Southeastern University"},{"institution":"Northwest Florida State College"},{"institution":"Orange Park International School of Beauty"},{"institution":"Everest University-North Orlando"},{"institution":"Orlando Tech"},{"institution":"Palm Beach Atlantic University"},{"institution":"Palm Beach State College"},{"institution":"Pasco-Hernando Community College"},{"institution":"Pensacola State College"},{"institution":"Pinellas Technical Education Center-Clearwater"},{"institution":"Polk State College"},{"institution":"Radford M Locklin Technical Center"},{"institution":"Saint Vincent de Paul Regional Seminary"},{"institution":"Ridge Career Center"},{"institution":"Ringling College of Art and Design"},{"institution":"Toni & Guy Hairdressing Academy-Jacksonville"},{"institution":"Robert Morgan Educational Center"},{"institution":"Rollins College"},{"institution":"First Coast Technical College"},{"institution":"Saint Leo University"},{"institution":"St Petersburg College"},{"institution":"Pinellas Technical Education Center-St Petersburg"},{"institution":"Santa Fe College"},{"institution":"Sarasota County Technical Institute"},{"institution":"Argosy University-Sarasota"},{"institution":"Seminole State College of Florida"},{"institution":"Sheridan Technical Center"},{"institution":"Saint John Vianney College Seminary"},{"institution":"Saint Johns River State College"},{"institution":"South Florida State College"},{"institution":"University of South Florida-Main Campus"},{"institution":"St Thomas University"},{"institution":"Stenotype Institute of Jacksonville Inc-Jacksonville"},{"institution":"Stetson University"},{"institution":"Southeastern University"},{"institution":"Benes International School of Beauty"},{"institution":"Suwannee-Hamilton Technical Center"},{"institution":"Tallahassee Community College"},{"institution":"Talmudic College of Florida"},{"institution":"Everest University-Tampa"},{"institution":"Everest University-Largo"},{"institution":"The University of Tampa"},{"institution":"Taylor Technical Institute"},{"institution":"Tom P Haney Technical Center"},{"institution":"Trinity Baptist College"},{"institution":"Trinity College of Florida"},{"institution":"Fashion Focus Hair Academy"},{"institution":"Valencia College"},{"institution":"Warner University"},{"institution":"Washington-Holmes Technical Center"},{"institution":"Webber International University"},{"institution":"Rasmussen College-Florida"},{"institution":"The University of West Florida"},{"institution":"Westside Tech"},{"institution":"William T McFatter Technical Center"},{"institution":"Winter Park Tech"},{"institution":"Withlacoochee Technical Institute"},{"institution":"Abraham Baldwin Agricultural College"},{"institution":"Agnes Scott College"},{"institution":"Interactive College of Technology-Chamblee"},{"institution":"Interactive College of Technology-Morrow"},{"institution":"Albany Technical College"},{"institution":"Darton State College"},{"institution":"Albany State University"},{"institution":"Andrew College"},{"institution":"Armstrong Atlantic State University"},{"institution":"The Art Institute of Atlanta"},{"institution":"Georgia Career Institute"},{"institution":"Atlanta Technical College"},{"institution":"Point University"},{"institution":"Atlanta Metropolitan State College"},{"institution":"Atlanta\'s John Marshall Law School"},{"institution":"Atlanta School of Massage"},{"institution":"Clark Atlanta University"},{"institution":"Augusta Technical College"},{"institution":"Augusta State University"},{"institution":"Bainbridge State College"},{"institution":"Bauder College"},{"institution":"Beauty College of America"},{"institution":"Berry College"},{"institution":"Beulah Heights University"},{"institution":"Brenau University"},{"institution":"Brewton-Parker College"},{"institution":"Brown College of Court Reporting"},{"institution":"College of Coastal Georgia"},{"institution":"West Georgia Technical College"},{"institution":"Carver Bible College"},{"institution":"Clayton  State University"},{"institution":"Columbia Theological Seminary"},{"institution":"Columbus Technical College"},{"institution":"Columbus State University"},{"institution":"Georgia Northwestern Technical College"},{"institution":"Covenant College"},{"institution":"Dalton State College"},{"institution":"Pro Way Hair School"},{"institution":"DeVry University-Georgia"},{"institution":"South University-Savannah"},{"institution":"East Georgia State College"},{"institution":"Emmanuel College"},{"institution":"Emory University"},{"institution":"Georgia Highlands College"},{"institution":"Fort Valley State University"},{"institution":"Grady Health System Professional Schools"},{"institution":"Georgia Institute of Technology-Main Campus"},{"institution":"Georgia Southwestern State University"},{"institution":"Gainesville State College"},{"institution":"Georgia College and State University"},{"institution":"Georgia Military College"},{"institution":"Georgia Southern University"},{"institution":"Georgia State University"},{"institution":"University of Georgia"},{"institution":"Gordon State College"},{"institution":"Southern Crescent Technical College"},{"institution":"Gupton Jones College of Funeral Service"},{"institution":"Gwinnett College-Lilburn"},{"institution":"Gwinnett Technical College"},{"institution":"Middle Georgia Technical College"},{"institution":"Interdenominational Theological Center"},{"institution":"Kennesaw State University"},{"institution":"LaGrange College"},{"institution":"Lanier Technical College"},{"institution":"Life University"},{"institution":"Central Georgia Technical College"},{"institution":"Macon State College"},{"institution":"Chattahoochee Technical College"},{"institution":"Herzing University-Atlanta"},{"institution":"Georgia Health Sciences University"},{"institution":"Mercer University"},{"institution":"Middle Georgia College"},{"institution":"Morehouse College"},{"institution":"Morehouse School of Medicine"},{"institution":"Moultrie Technical College"},{"institution":"University of North Georgia"},{"institution":"North Georgia Technical College"},{"institution":"Oglethorpe University"},{"institution":"Paine College"},{"institution":"Piedmont College"},{"institution":"Portfolio Center"},{"institution":"Reinhardt University"},{"institution":"Savannah Technical College"},{"institution":"Savannah College of Art and Design"},{"institution":"Savannah State University"},{"institution":"Shorter University"},{"institution":"South Georgia College"},{"institution":"South Georgia Technical College"},{"institution":"The Creative Circus"},{"institution":"Spelman College"},{"institution":"Southern Polytechnic State University"},{"institution":"Southwest Georgia Technical College"},{"institution":"Thomas University"},{"institution":"Toccoa Falls College"},{"institution":"Truett-McConnell College"},{"institution":"Wiregrass Georgia Technical College"},{"institution":"Valdosta State University"},{"institution":"Waycross College"},{"institution":"Wesleyan College"},{"institution":"University of West Georgia"},{"institution":"Young Harris College"},{"institution":"Heald College-Honolulu"},{"institution":"Chaminade University of Honolulu"},{"institution":"University of Hawaii at Hilo"},{"institution":"University of Hawaii at Manoa"},{"institution":"Hawaii Institute of Hair Design"},{"institution":"Hawaii Pacific University"},{"institution":"Honolulu Community College"},{"institution":"Kapiolani Community College"},{"institution":"Kauai Community College"},{"institution":"Leeward Community College"},{"institution":"University of Hawaii Maui College"},{"institution":"Med-Assist School of Hawaii Inc"},{"institution":"World Medicine Institute"},{"institution":"Travel Institute of the Pacific"},{"institution":"University of Hawaii System Office"},{"institution":"University of Hawaii-West Oahu"},{"institution":"Windward Community College"},{"institution":"Carrington College-Boise"},{"institution":"Boise Bible College"},{"institution":"Boise State University"},{"institution":"Eastern Idaho Technical College"},{"institution":"Idaho State University"},{"institution":"University of Idaho"},{"institution":"The College of Idaho"},{"institution":"Lewis-Clark State College"},{"institution":"ITT Technical Institute-Boise"},{"institution":"Joseph Charles Institute of Cosmetology"},{"institution":"Mr Leon\'s School of Hair Design-Moscow"},{"institution":"North Idaho College"},{"institution":"Northwest Nazarene University"},{"institution":"The School of Hairstyling"},{"institution":"Brigham Young University-Idaho"},{"institution":"College of Southern Idaho"},{"institution":"Adler School of Professional Psychology"},{"institution":"Alvareitas College of Cosmetology-Edwardsville"},{"institution":"Alvareitas College of Cosmetology-Godfrey"},{"institution":"American Academy of Art"},{"institution":"School of the Art Institute of Chicago"},{"institution":"The College of Office Technology"},{"institution":"Augustana College"},{"institution":"Aurora University"},{"institution":"Concept College of Cosmetology"},{"institution":"Southwestern Illinois College"},{"institution":"Bethany Theological Seminary"},{"institution":"Black Hawk College"},{"institution":"Blackburn College"},{"institution":"Blessing Rieman College of Nursing"},{"institution":"Blessing Hospital School of Radiologic Technology"},{"institution":"Bradley University"},{"institution":"Paul Mitchell the School-Bradley"},{"institution":"Cameo Beauty Academy"},{"institution":"Cannella School of Hair Design-Villa Park"},{"institution":"Cannella School of Hair Design-Chicago"},{"institution":"Cannella School of Hair Design-Chicago"},{"institution":"Cannella School of Hair Design-Elgin"},{"institution":"Capri Beauty College"},{"institution":"Empire Beauty School-Hanover Park"},{"institution":"Capri Beauty College"},{"institution":"Carl Sandburg College"},{"institution":"Catholic Theological Union at Chicago"},{"institution":"La James International College-East Moline"},{"institution":"Midwestern University-Downers Grove"},{"institution":"The Chicago School of Professional Psychology at Chicago"},{"institution":"Chicago State University"},{"institution":"Chicago Theological Seminary"},{"institution":"University of Chicago"},{"institution":"City Colleges of Chicago-Kennedy-King College"},{"institution":"City Colleges of Chicago-Malcolm X College"},{"institution":"City Colleges of Chicago-Olive-Harvey College"},{"institution":"City Colleges of Chicago-Harry S Truman College"},{"institution":"City Colleges of Chicago-Richard J Daley College"},{"institution":"City Colleges of Chicago-Harold Washington College"},{"institution":"City Colleges of Chicago-Wilbur Wright College"},{"institution":"Columbia College-Chicago"},{"institution":"Concordia University-Chicago"},{"institution":"Le Cordon Bleu College of Culinary Arts-Chicago"},{"institution":"Coyne College"},{"institution":"City Colleges of Chicago-District Office"},{"institution":"Danville Area Community College"},{"institution":"Concept College of Cosmetology"},{"institution":"DePaul University"},{"institution":"DeVry University-Illinois"},{"institution":"DeVry University-Administrative Office"},{"institution":"Cosmetology & Spa Academy"},{"institution":"College of DuPage"},{"institution":"East-West University"},{"institution":"Eastern Illinois University"},{"institution":"Elgin Community College"},{"institution":"Elmhurst College"},{"institution":"Eureka College"},{"institution":"First Institute Inc"},{"institution":"Fox College"},{"institution":"Garrett-Evangelical Theological Seminary"},{"institution":"Gem City College"},{"institution":"Governors State University"},{"institution":"Graham Hospital School of Nursing"},{"institution":"Greenville College"},{"institution":"Hair Professionals Academy of Cosmetology"},{"institution":"Hair Professionals Career College"},{"institution":"Hair Professionals School of Cosmetology"},{"institution":"Harrington College of Design"},{"institution":"Hebrew Theological College"},{"institution":"Highland Community College"},{"institution":"Rosalind Franklin University of Medicine and Science"},{"institution":"University of Illinois at Chicago"},{"institution":"Benedictine University"},{"institution":"Illinois College of Optometry"},{"institution":"University of Illinois at Urbana-Champaign"},{"institution":"Illinois Wesleyan University"},{"institution":"Illinois Central College"},{"institution":"Illinois College"},{"institution":"Olney Central College"},{"institution":"Illinois Institute of Technology"},{"institution":"Argosy University-Chicago"},{"institution":"Illinois State University"},{"institution":"Illinois Valley Community College"},{"institution":"Institute for Clinical Social Work"},{"institution":"International Academy of Design and Technology-Chicago"},{"institution":"John A Logan College"},{"institution":"The John Marshall Law School"},{"institution":"John Wood Community College"},{"institution":"Joliet Junior College"},{"institution":"Judson University"},{"institution":"Kankakee Community College"},{"institution":"Kaskaskia College"},{"institution":"DeVry University\'s Keller Graduate School of Management-Illinois"},{"institution":"Kendall College"},{"institution":"Kishwaukee College"},{"institution":"Knox College"},{"institution":"Educators of Beauty College of Cosmetology-La Salle"},{"institution":"College of Lake County"},{"institution":"Lake Forest College"},{"institution":"Lake Forest Graduate School of Management"},{"institution":"Lake Land College"},{"institution":"Lakeview College of Nursing"},{"institution":"Lewis and Clark Community College"},{"institution":"Lewis University"},{"institution":"Lexington College"},{"institution":"Lincoln Christian University"},{"institution":"Lincoln College"},{"institution":"Lincoln Land Community College"},{"institution":"Lincoln College of Technology-Melrose Park"},{"institution":"Loyola University Chicago"},{"institution":"Lutheran School of Theology at Chicago"},{"institution":"Trinity College of Nursing & Health Sciences"},{"institution":"CET-Chicago"},{"institution":"Mac Daniels Beauty School"},{"institution":"MacCormac College"},{"institution":"MacMurray College"},{"institution":"McCormick Theological Seminary"},{"institution":"McHenry County College"},{"institution":"McKendree University"},{"institution":"Meadville Lombard Theological School"},{"institution":"Methodist College"},{"institution":"Midstate College"},{"institution":"Millikin University"},{"institution":"Monmouth College"},{"institution":"Moody Bible Institute"},{"institution":"Moraine Valley Community College"},{"institution":"Morrison Institute of Technology"},{"institution":"Morton College"},{"institution":"Mr John\'s School of Cosmetology Esthetics & Nails-Decatur"},{"institution":"National Louis University"},{"institution":"National University of Health Sciences"},{"institution":"Niles School of Cosmetology"},{"institution":"North Central College"},{"institution":"North Park University"},{"institution":"Northern Baptist Theological Seminary"},{"institution":"Northern Illinois University"},{"institution":"Northwestern College-Chicago Campus"},{"institution":"Northwestern University"},{"institution":"Northeastern Illinois University"},{"institution":"Oakton Community College"},{"institution":"Oehrlein School of Cosmetology"},{"institution":"Olivet Nazarene University"},{"institution":"Parkland College"},{"institution":"Pivot Point Academy-Evanston"},{"institution":"Prairie State College"},{"institution":"Principia College"},{"institution":"Professional\'s Choice Hair Design Academy"},{"institution":"Quincy University"},{"institution":"Vatterott College-Quincy"},{"institution":"The Illinois Institute of Art-Chicago"},{"institution":"Rend Lake College"},{"institution":"Richland Community College"},{"institution":"Robert Morris University Illinois"},{"institution":"Rock Valley College"},{"institution":"Madison Media Institute - Rockford Career College"},{"institution":"Rockford University"},{"institution":"Roosevelt University"},{"institution":"Dominican University"},{"institution":"Rush University"},{"institution":"Saint Francis Medical Center College of Nursing"},{"institution":"University of St Francis"},{"institution":"St John\'s College of Nursing"},{"institution":"Saint Xavier University"},{"institution":"University of Illinois at Springfield"},{"institution":"Sauk Valley Community College"},{"institution":"Seabury-Western Theological Seminary"},{"institution":"Shawnee Community College"},{"institution":"Shimer College"},{"institution":"Saint Augustine College"},{"institution":"University of Saint Mary of the Lake"},{"institution":"Southeastern Illinois College"},{"institution":"National Latino Education Institute"},{"institution":"Spertus College"},{"institution":"Spoon River College"},{"institution":"Saint Anthony College of Nursing"},{"institution":"Educators of Beauty College of Cosmetology-Sterling"},{"institution":"Southern Illinois University-Carbondale"},{"institution":"Southern Illinois University-Edwardsville"},{"institution":"Southern Illinois University-System Office"},{"institution":"Taylor Business Institute"},{"institution":"Telshe Yeshiva-Chicago"},{"institution":"South Suburban College"},{"institution":"Tri-County Beauty Academy"},{"institution":"Trinity Christian College"},{"institution":"Trinity International University-Illinois"},{"institution":"Triton College"},{"institution":"University of Spa & Cosmetology Arts"},{"institution":"University of Illinois University Administration"},{"institution":"VanderCook College of Music"},{"institution":"Waubonsee Community College"},{"institution":"Resurrection University"},{"institution":"Western Illinois University"},{"institution":"Wheaton College"},{"institution":"Harper College"},{"institution":"Ancilla College"},{"institution":"Anderson University"},{"institution":"Apex Academy of Hair Design Inc"},{"institution":"Ball State University"},{"institution":"Bethel College-Indiana"},{"institution":"Butler University"},{"institution":"Calumet College of Saint Joseph"},{"institution":"Christian Theological Seminary"},{"institution":"College of Court Reporting Inc"},{"institution":"Concordia Theological Seminary"},{"institution":"Tricoci University of Beauty Culture-Highland"},{"institution":"DePauw University"},{"institution":"Don Roberts School of Hair Design"},{"institution":"Don Roberts Beauty School"},{"institution":"Earlham College"},{"institution":"University of Evansville"},{"institution":"Franklin College"},{"institution":"Good Samaritan Hospital School of Radiologic Technology"},{"institution":"Goshen College"},{"institution":"Grace College and Theological Seminary"},{"institution":"Hair Fashions By Kaye Beauty College-Noblesville"},{"institution":"Hair Fashions By Kaye Beauty College-Indianapolis"},{"institution":"Hanover College"},{"institution":"J Michael Harrold Beauty Academy"},{"institution":"Holy Cross College"},{"institution":"PJ\'s College of Cosmetology-Clarksville"},{"institution":"Huntington University"},{"institution":"Ivy Tech Community College"},{"institution":"Indiana University-Purdue University-Fort Wayne"},{"institution":"Indiana University-Purdue University-Indianapolis"},{"institution":"Harrison College-Indianapolis"},{"institution":"University of Indianapolis"},{"institution":"Indiana Institute of Technology"},{"institution":"University of Southern Indiana"},{"institution":"Indiana State University"},{"institution":"Indiana University-Kokomo"},{"institution":"Indiana University-South Bend"},{"institution":"Indiana University-Bloomington"},{"institution":"Indiana University-Northwest"},{"institution":"Indiana University-Southeast"},{"institution":"Indiana University-East"},{"institution":"International Business College-Fort Wayne"},{"institution":"International Business College-Indianapolis"},{"institution":"ITT Educational Services Inc-System Office"},{"institution":"ITT Technical Institute-Nashville"},{"institution":"ITT Technical Institute-Fort Wayne"},{"institution":"ITT Technical Institute-Indianapolis"},{"institution":"J Everett Light Career Center"},{"institution":"Knox Beauty College"},{"institution":"Lafayette Beauty Academy"},{"institution":"Brown Mackie College-Merrillville"},{"institution":"Brown Mackie College-Michigan City"},{"institution":"Empire Beauty School-Indianapolis"},{"institution":"Lincoln College of Technology-Indianapolis"},{"institution":"Manchester University"},{"institution":"Marian University"},{"institution":"Indiana Wesleyan University"},{"institution":"Martin University"},{"institution":"Masters of Cosmetology College"},{"institution":"Anabaptist Mennonite Biblical Seminary"},{"institution":"Merrillville Beauty College"},{"institution":"Brown Mackie College-South Bend"},{"institution":"Mid-America College of Funeral Service"},{"institution":"West Michigan College of Barbering and Beauty"},{"institution":"University of Notre Dame"},{"institution":"Oakland City University"},{"institution":"PJ\'s College of Cosmetology-Richmond"},{"institution":"Kaplan College-Indianapolis"},{"institution":"Purdue University-Calumet Campus"},{"institution":"Purdue University-North Central Campus"},{"institution":"Ravenscroft Beauty College"},{"institution":"Rogers Academy of Hair Design"},{"institution":"Rose-Hulman Institute of Technology"},{"institution":"Rudae\'s School of Beauty Culture-Kokomo"},{"institution":"University of Saint Francis-Fort Wayne"},{"institution":"Saint Josephs College"},{"institution":"Saint Mary-of-the-Woods College"},{"institution":"Saint Mary\'s College"},{"institution":"Kaplan College-Hammond"},{"institution":"Kaplan College-Merrillville"},{"institution":"Saint Meinrad School of Theology"},{"institution":"Saint Elizabeth School of Nursing"},{"institution":"Taylor University"},{"institution":"Trine University"},{"institution":"Valparaiso University"},{"institution":"Vincennes Beauty College"},{"institution":"Vincennes University"},{"institution":"Wabash College"},{"institution":"Allen College"},{"institution":"AIB College of Business"},{"institution":"Briar Cliff University"},{"institution":"Buena Vista University"},{"institution":"Capri College-Dubuque"},{"institution":"Capri College-Cedar Rapids"},{"institution":"American College of Hairstyling-Cedar Rapids"},{"institution":"Central College"},{"institution":"Clarke University"},{"institution":"Coe College"},{"institution":"Cornell College"},{"institution":"Iowa School of Beauty-Marshalltown"},{"institution":"Des Moines Area Community College"},{"institution":"Divine Word College"},{"institution":"Dordt College"},{"institution":"Drake University"},{"institution":"University of Dubuque"},{"institution":"Ellsworth Community College"},{"institution":"Emmaus Bible College"},{"institution":"Eastern Iowa Community College District"},{"institution":"Faith Baptist Bible College and Theological Seminary"},{"institution":"Faust Institute of Cosmetology-Storm Lake"},{"institution":"Graceland University-Lamoni"},{"institution":"Grand View University"},{"institution":"Grinnell College"},{"institution":"Kaplan University-Mason City Campus"},{"institution":"Kaplan University-Cedar Rapids Campus"},{"institution":"Hamilton Technical College"},{"institution":"Hawkeye Community College"},{"institution":"American Hair Academy"},{"institution":"Indian Hills Community College"},{"institution":"Iowa Central Community College"},{"institution":"Iowa Lakes Community College"},{"institution":"UnityPoint Health-Des Moines School of Radiologic Technology"},{"institution":"American College of Hairstyling-Des Moines"},{"institution":"Iowa School of Beauty-Des Moines"},{"institution":"Iowa State University"},{"institution":"Iowa Wesleyan College"},{"institution":"Iowa Western Community College"},{"institution":"University of Iowa"},{"institution":"Kirkwood Community College"},{"institution":"La James International College-Cedar Falls"},{"institution":"La James International College-Johnston"},{"institution":"La James College of Hairstyling and Cosmetology"},{"institution":"La James International College-Ft Dodge"},{"institution":"Loras College"},{"institution":"Luther College"},{"institution":"Maharishi University of Management"},{"institution":"Marshalltown Community College"},{"institution":"Mercy College of Health Sciences"},{"institution":"Morningside College"},{"institution":"Mount Mercy University"},{"institution":"Ashford University"},{"institution":"North Iowa Area Community College"},{"institution":"University of Northern Iowa"},{"institution":"Northwestern College"},{"institution":"Northeast Iowa Community College-Calmar"},{"institution":"Northwest Iowa Community College"},{"institution":"Des Moines University-Osteopathic Medical Center"},{"institution":"Iowa School of Beauty-Ottumwa"},{"institution":"Palmer College of Chiropractic-Davenport"},{"institution":"PCI Academy-Ames"},{"institution":"Saint Ambrose University"},{"institution":"St Luke\'s College"},{"institution":"La James International College-Davenport"},{"institution":"La James International College-Iowa City"},{"institution":"Simpson College"},{"institution":"Southeastern Community College"},{"institution":"Southwestern Community College"},{"institution":"Capri College-Davenport"},{"institution":"Iowa School of Beauty-Sioux City"},{"institution":"E Q School of Hair Design"},{"institution":"Upper Iowa University"},{"institution":"Waldorf College"},{"institution":"Wartburg College"},{"institution":"Wartburg Theological Seminary"},{"institution":"College of Hair Design"},{"institution":"Western Iowa Tech Community College"},{"institution":"William Penn University"},{"institution":"Allen County Community College"},{"institution":"Baker University"},{"institution":"Barton County Community College"},{"institution":"Benedictine College"},{"institution":"Bethany College"},{"institution":"Bethel College-North Newton"},{"institution":"Brown Mackie College-Kansas City"},{"institution":"Brown Mackie College-Salina"},{"institution":"Bryan University"},{"institution":"Butler Community College"},{"institution":"Central Baptist Theological Seminary"},{"institution":"Central Christian College of Kansas"},{"institution":"Cloud County Community College"},{"institution":"Coffeyville Community College"},{"institution":"Colby Community College"},{"institution":"Cowley County Community College"},{"institution":"Marinello Schools of Beauty-Manhattan"},{"institution":"Dodge City Community College"},{"institution":"Donnelly College"},{"institution":"Emporia State University"},{"institution":"Flint Hills Technical College"},{"institution":"Fort Hays State University"},{"institution":"Barclay College"},{"institution":"Friends University"},{"institution":"Fort Scott Community College"},{"institution":"Garden City Community College"},{"institution":"Haskell Indian Nations University"},{"institution":"Hays Academy of Hair Design"},{"institution":"Hesston College"},{"institution":"Highland Community College"},{"institution":"Hutchinson Community College"},{"institution":"Independence Community College"},{"institution":"Johnson County Community College"},{"institution":"Concorde Career Colleges"},{"institution":"Kansas City Kansas Community College"},{"institution":"University of Kansas"},{"institution":"Newman University"},{"institution":"Old Town Barber College-Wichita"},{"institution":"Kansas State University"},{"institution":"Kansas Wesleyan University"},{"institution":"Washburn Institute of Technology"},{"institution":"La Baron Hairdressing Academy-Overland Park"},{"institution":"Labette Community College"},{"institution":"Manhattan Area Technical College"},{"institution":"Manhattan Christian College"},{"institution":"McPherson College"},{"institution":"MidAmerica Nazarene University"},{"institution":"Neosho County Community College"},{"institution":"North Central Kansas Technical College"},{"institution":"Northwest Kansas Technical College"},{"institution":"Ottawa University-Ottawa"},{"institution":"Ottawa University-Kansas City"},{"institution":"Pittsburg State University"},{"institution":"Pratt Community College"},{"institution":"University of Saint Mary"},{"institution":"Salina Area Technical College"},{"institution":"Seward County Community College and Area Technical School"},{"institution":"Sidneys Hair Dressing College"},{"institution":"Southwestern College"},{"institution":"Sterling College"},{"institution":"Tabor College"},{"institution":"Washburn University"},{"institution":"Wichita Area Technical College"},{"institution":"Wichita State University"},{"institution":"Wichita Technical Institute"},{"institution":"Alice Lloyd College"},{"institution":"Asbury University"},{"institution":"Asbury Theological Seminary"},{"institution":"Ashland Community and Technical College"},{"institution":"Barrett and Company School of Hair Design"},{"institution":"Bellarmine University"},{"institution":"Berea College"},{"institution":"PJ\'s College of Cosmetology-Bowling Green"},{"institution":"Southcentral Kentucky Community and Technical College"},{"institution":"Brescia University"},{"institution":"Campbellsville University"},{"institution":"Bluegrass Community and Technical College"},{"institution":"Centre College"},{"institution":"Clear Creek Baptist Bible College"},{"institution":"Paul Mitchell the School-Lexington"},{"institution":"Collins School of Cosmetology"},{"institution":"Galen College of Nursing-Louisville"},{"institution":"University of the Cumberlands"},{"institution":"Eastern Kentucky University"},{"institution":"Elizabethtown Community and Technical College"},{"institution":"Ezell\'s Cosmetology School"},{"institution":"Frontier Nursing University"},{"institution":"Georgetown College"},{"institution":"PJ\'s College of Cosmetology-Glasgow"},{"institution":"Hazard Community and Technical College"},{"institution":"Paul Mitchell the School-Louisville"},{"institution":"Henderson Community College"},{"institution":"Hopkinsville Community College"},{"institution":"Daymar College-Paducah Main"},{"institution":"Jefferson Community and Technical College"},{"institution":"Jenny Lea Academy of Cosmetology"},{"institution":"The Salon Professional Academy-Lexington"},{"institution":"National College-Lexington"},{"institution":"Kentucky Mountain Bible College"},{"institution":"Kentucky State University"},{"institution":"Kentucky Wesleyan College"},{"institution":"University of Kentucky"},{"institution":"Kentucky Christian University"},{"institution":"Lexington Theological Seminary"},{"institution":"Lindsey Wilson College"},{"institution":"Sullivan College of Technology and Design"},{"institution":"University of Louisville"},{"institution":"Louisville Presbyterian Theological Seminary"},{"institution":"Madisonville Community College"},{"institution":"Maysville Community and Technical College"},{"institution":"Mid-Continent University"},{"institution":"Midway College"},{"institution":"Morehead State University"},{"institution":"Murray State University"},{"institution":"Gateway Community and Technical College"},{"institution":"Northern Kentucky University"},{"institution":"Nutek Academy of Beauty Inc"},{"institution":"Daymar College-Owensboro"},{"institution":"West Kentucky Community and Technical College"},{"institution":"Pat Wilson\'s Beauty College"},{"institution":"University of Pikeville"},{"institution":"Big Sandy Community and Technical College"},{"institution":"Brown Mackie College-Louisville"},{"institution":"Empire Beauty School-Chenoweth"},{"institution":"Saint Catharine College"},{"institution":"Empire Beauty School-Elizabethtown"},{"institution":"Empire Beauty School-Dixie"},{"institution":"Empire Beauty School-Florence"},{"institution":"Brown Mackie College-Northern Kentucky"},{"institution":"Somerset Community College"},{"institution":"Southeast Kentucky Community and Technical College"},{"institution":"The Southern Baptist Theological Seminary"},{"institution":"Spalding University"},{"institution":"Spencerian College-Louisville"},{"institution":"Sullivan University"},{"institution":"Thomas More College"},{"institution":"Transylvania University"},{"institution":"Trend Setters\' Academy of Beauty Culture-Louisville"},{"institution":"Kentucky Community and Technical College System"},{"institution":"Union College"},{"institution":"Western Kentucky University"},{"institution":"Central Louisiana Technical Community College"},{"institution":"American School of Business"},{"institution":"Ayers Career College"},{"institution":"Baton Rouge General Medical Center-School of Nursing"},{"institution":"Baton Rouge General Medical Center-Radiologic Technology"},{"institution":"Baton Rouge School of Computers"},{"institution":"Capital Area Technical College"},{"institution":"Bossier Parish Community College"},{"institution":"Cameron College"},{"institution":"Centenary College of Louisiana"},{"institution":"Cloyd\'s Beauty School 1 Inc"},{"institution":"Crescent City Bartending School"},{"institution":"D\'Jay\'s School of Beauty Arts and Sciences"},{"institution":"Delgado Community College"},{"institution":"Delta School of Business and Technology"},{"institution":"Northeast Louisiana Technical College"},{"institution":"Demmons School of Beauty"},{"institution":"Denham Springs Beauty School"},{"institution":"Dillard University"},{"institution":"Nunez Community College"},{"institution":"Grambling State University"},{"institution":"Guy\'s Shreveport Academy of Cosmetology Inc"},{"institution":"ITI Technical College"},{"institution":"John Jay Beauty College"},{"institution":"John Jay Beauty College"},{"institution":"Louisiana State University Health Sciences Center-New Orleans"},{"institution":"Louisiana State University-Alexandria"},{"institution":"Louisiana State University and Agricultural & Mechanical College"},{"institution":"Louisiana State University-Eunice"},{"institution":"Louisiana State University-Shreveport"},{"institution":"Acadiana Technical College-Lafayette Campus"},{"institution":"Aveda Institute-Baton Rouge"},{"institution":"Aveda Institute-Lafayette"},{"institution":"Louisiana Academy of Beauty"},{"institution":"Louisiana College"},{"institution":"Opelousas School of Cosmetology Inc"},{"institution":"Louisiana State University-System Office"},{"institution":"Louisiana Tech University"},{"institution":"Loyola University New Orleans"},{"institution":"McNeese State University"},{"institution":"University of New Orleans"},{"institution":"New Orleans Baptist Theological Seminary"},{"institution":"Nicholls State University"},{"institution":"University of Louisiana at Monroe"},{"institution":"Northwest Louisiana Technical College"},{"institution":"Notre Dame Seminary Graduate School of Theology"},{"institution":"Northwestern State University of Louisiana"},{"institution":"Our Lady of Holy Cross College"},{"institution":"Our Lady of the Lake College"},{"institution":"Pat Goins Benton Road Beauty School"},{"institution":"Pat Goins Monroe Beauty School"},{"institution":"Pat Goins Ruston Beauty School"},{"institution":"Pineville Beauty School"},{"institution":"Aveda Institute-Covington"},{"institution":"Saint Joseph Seminary College"},{"institution":"Vanguard College of Cosmetology-Slidell"},{"institution":"South Louisiana Beauty College"},{"institution":"L E Fletcher Technical Community College"},{"institution":"Remington College-Lafayette Campus"},{"institution":"Southern University-Board and System"},{"institution":"SOWELA Technical Community College"},{"institution":"Stevensons Academy of Hair Design"},{"institution":"Southeastern Louisiana University"},{"institution":"Southern University and A & M College"},{"institution":"Southern University at New Orleans"},{"institution":"Southern University at Shreveport"},{"institution":"University of Louisiana at Lafayette"},{"institution":"Northshore Technical Community College"},{"institution":"Tulane University of Louisiana"},{"institution":"Xavier University of Louisiana"},{"institution":"South Central Louisiana Technical College-Young Memorial Campus"},{"institution":"Kaplan University-Maine Campus"},{"institution":"College of the Atlantic"},{"institution":"Bangor Theological Seminary"},{"institution":"Bates College"},{"institution":"Beal College"},{"institution":"Bowdoin College"},{"institution":"Central Maine Medical Center College of Nursing and Health Professions"},{"institution":"Central Maine Community College"},{"institution":"Colby College"},{"institution":"Eastern Maine Community College"},{"institution":"Husson University"},{"institution":"Kennebec Valley Community College"},{"institution":"The Landing School"},{"institution":"University of Maine at Augusta"},{"institution":"University of Maine at Farmington"},{"institution":"University of Maine at Fort Kent"},{"institution":"University of Maine at Machias"},{"institution":"University of Maine"},{"institution":"University of Maine-System Central Office"},{"institution":"Maine Maritime Academy"},{"institution":"University of Maine at Presque Isle"},{"institution":"University of New England"},{"institution":"Northern Maine Community College"},{"institution":"Empire Beauty School-Maine"},{"institution":"Maine College of Art"},{"institution":"Saint Joseph\'s College of Maine"},{"institution":"Spa Tech Institute-Westbrook"},{"institution":"Southern Maine Community College"},{"institution":"University of Southern Maine"},{"institution":"Thomas College"},{"institution":"Unity College"},{"institution":"Washington County Community College"},{"institution":"Aaron\'s Academy of Beauty"},{"institution":"Aesthetics Institute of Cosmetology"},{"institution":"Allegany College of Maryland"},{"institution":"Anne Arundel Community College"},{"institution":"TESST College of Technology-Towson"},{"institution":"Award Beauty School"},{"institution":"Baltimore Studio of Hair Design"},{"institution":"Baltimore City Community College"},{"institution":"University of Baltimore"},{"institution":"Bowie State University"},{"institution":"Capitol College"},{"institution":"Cecil College"},{"institution":"College of Southern Maryland"},{"institution":"Chesapeake College"},{"institution":"Washington Adventist University"},{"institution":"Coppin State University"},{"institution":"Delmarva Beauty Academy"},{"institution":"North American Trade Schools"},{"institution":"Frederick Community College"},{"institution":"Frostburg State University"},{"institution":"Garrett College"},{"institution":"Goucher College"},{"institution":"Kaplan University-Hagerstown Campus"},{"institution":"Hagerstown Community College"},{"institution":"Harford Community College"},{"institution":"Hood College"},{"institution":"Howard Community College"},{"institution":"The Colorlab Academy of Hair"},{"institution":"Johns Hopkins University"},{"institution":"L\'Academie de Cuisine"},{"institution":"Lincoln College of Technology-Columbia"},{"institution":"Loyola University Maryland"},{"institution":"Maryland Beauty Academy of Reisterstown"},{"institution":"University of Maryland-University College"},{"institution":"University of Maryland-Baltimore"},{"institution":"University of Maryland-Baltimore County"},{"institution":"University of Maryland-College Park"},{"institution":"Maryland Institute College of Art"},{"institution":"University of Maryland Eastern Shore"},{"institution":"Fortis Institute-Towson"},{"institution":"Montgomery Beauty School"},{"institution":"Montgomery College"},{"institution":"Morgan State University"},{"institution":"Mount St Mary\'s University"},{"institution":"Ner Israel Rabbinical College"},{"institution":"Hair Academy Inc-New Carrollton"},{"institution":"Notre Dame of Maryland University"},{"institution":"Prince George\'s Community College"},{"institution":"TESST College of Technology-Baltimore"},{"institution":"Robert Paul Academy of Cosmetology Arts & Sciences"},{"institution":"Maryland Beauty Academy of Essex"},{"institution":"St Mary\'s Seminary & University"},{"institution":"Salisbury University"},{"institution":"St Mary\'s College of Maryland"},{"institution":"Sojourner-Douglass College"},{"institution":"St John\'s College"},{"institution":"TESST College of Technology-Beltsville"},{"institution":"Towson University"},{"institution":"Maryland University of Integrative Health"},{"institution":"International Beauty School"},{"institution":"University System of Maryland"},{"institution":"United States Naval Academy"},{"institution":"Stevenson University"},{"institution":"Washington Bible College-Capital Bible Seminary"},{"institution":"Washington College"},{"institution":"Washington Theological Union"},{"institution":"McDaniel College"},{"institution":"Wor-Wic Community College"},{"institution":"Hult International Business School"},{"institution":"New England College of Business and Finance"},{"institution":"American International College"},{"institution":"Amherst College"},{"institution":"Andover Newton Theological School"},{"institution":"Anna Maria College"},{"institution":"Assabet Valley Regional Technical School"},{"institution":"Assumption College"},{"institution":"Babson College"},{"institution":"Bancroft School of Massage Therapy"},{"institution":"Boston Baptist College"},{"institution":"Bay Path College"},{"institution":"Bay State College"},{"institution":"Bay State School of Technology"},{"institution":"Becker College"},{"institution":"Bentley University"},{"institution":"Berklee College of Music"},{"institution":"Berkshire Community College"},{"institution":"Empire Beauty School-Boston"},{"institution":"Boston Architectural College"},{"institution":"Boston Graduate School of Psychoanalysis Inc"},{"institution":"Boston College"},{"institution":"The Boston Conservatory"},{"institution":"Boston University"},{"institution":"Brandeis University"},{"institution":"Bridgewater State University"},{"institution":"Bristol Community College"},{"institution":"Signature Healthcare Brockton Hospital School of Nursing"},{"institution":"Bunker Hill Community College"},{"institution":"Cambridge College"},{"institution":"Cape Cod Community College"},{"institution":"Catherine Hinds Institute of Esthetics"},{"institution":"Laboure College"},{"institution":"Clark University"},{"institution":"Conway School of Landscape Design"},{"institution":"Curry College"},{"institution":"Lincoln Technical Institute-Somerville"},{"institution":"Dean College"},{"institution":"Diman Regional Technical Institute"},{"institution":"National Aviation Academy of New England"},{"institution":"Eastern Nazarene College"},{"institution":"Emerson College"},{"institution":"Emmanuel College"},{"institution":"Endicott College"},{"institution":"Episcopal Divinity School"},{"institution":"Rob Roy Academy-Fall River"},{"institution":"Fisher College"},{"institution":"Fitchburg State University"},{"institution":"Framingham State University"},{"institution":"Benjamin Franklin Institute of Technology"},{"institution":"Gordon College"},{"institution":"Gordon-Conwell Theological Seminary"},{"institution":"Greenfield Community College"},{"institution":"Hallmark Institute of Photography"},{"institution":"Hampshire College"},{"institution":"Harvard University"},{"institution":"Hebrew College"},{"institution":"Hellenic College-Holy Cross Greek Orthodox School of Theology"},{"institution":"Henris School of Hair Design"},{"institution":"College of the Holy Cross"},{"institution":"Holyoke Community College"},{"institution":"Sanford-Brown College-Boston"},{"institution":"Kay Harvey Academy of Hair Design"},{"institution":"La Baron Hairdressing Academy-Brockton"},{"institution":"La Baron Hairdressing Academy-New Bedford"},{"institution":"Lasell College"},{"institution":"Lawrence Memorial Hospital School of Nursing"},{"institution":"Lesley University"},{"institution":"Longy School of Music of Bard College"},{"institution":"Lowell Academy Hairstyling Institute"},{"institution":"University of Massachusetts-Lowell"},{"institution":"Mansfield Beauty Schools-Springfield"},{"institution":"Mansfield Beauty Schools-Quincy"},{"institution":"Marian Court College"},{"institution":"University of Massachusetts-Amherst"},{"institution":"University of Massachusetts-Boston"},{"institution":"Massachusetts Bay Community College"},{"institution":"MCPHS University"},{"institution":"University of Massachusetts-Central Office"},{"institution":"Massachusetts College of Art and Design"},{"institution":"Massachusetts Institute of Technology"},{"institution":"Massachusetts Maritime Academy"},{"institution":"University of Massachusetts Medical School Worcester"},{"institution":"Massachusetts School of Professional Psychology"},{"institution":"Massachusetts School of Barbering"},{"institution":"Massasoit Community College"},{"institution":"Merrimack College"},{"institution":"MGH Institute of Health Professions"},{"institution":"Middlesex Community College"},{"institution":"Montserrat College of Art"},{"institution":"Mount Holyoke College"},{"institution":"Mount Ida College"},{"institution":"Mount Wachusett Community College"},{"institution":"Cortiva Institute-Boston"},{"institution":"School of the Museum of Fine Arts-Boston"},{"institution":"Everest Institute-Brighton"},{"institution":"Rob Roy Academy-New Bedford"},{"institution":"The New England Conservatory of Music"},{"institution":"New England College of Optometry"},{"institution":"New England School of Acupuncture"},{"institution":"New England School of Law"},{"institution":"New England School of Photography"},{"institution":"Newbury College"},{"institution":"Nichols College"},{"institution":"Massachusetts College of Liberal Arts"},{"institution":"North Bennet Street School"},{"institution":"North Shore Community College"},{"institution":"The New England Institute of Art"},{"institution":"Northeastern University"},{"institution":"Northern Essex Community College"},{"institution":"College of Our Lady of the Elms"},{"institution":"Pine Manor College"},{"institution":"Blessed John XXIII National Seminary"},{"institution":"Quincy College"},{"institution":"Quinsigamond Community College"},{"institution":"Kaplan Career Institute-Charlestown"},{"institution":"Regis College"},{"institution":"Roxbury Community College"},{"institution":"Saint John\'s Seminary"},{"institution":"Salem State University"},{"institution":"Salter College-West Boylston"},{"institution":"Simmons College"},{"institution":"Bard College at Simon\'s Rock"},{"institution":"Smith College"},{"institution":"Southeastern Technical Institute"},{"institution":"Springfield College"},{"institution":"Springfield Technical Community College"},{"institution":"University of Massachusetts-Dartmouth"},{"institution":"Stonehill College"},{"institution":"Suffolk University"},{"institution":"Rob Roy Academy-Taunton"},{"institution":"Tufts University"},{"institution":"Wellesley College"},{"institution":"Wentworth Institute of Technology"},{"institution":"Western New England University"},{"institution":"Westfield State University"},{"institution":"Wheaton College"},{"institution":"Wheelock College"},{"institution":"Williams College"},{"institution":"Worcester Polytechnic Institute"},{"institution":"Worcester State University"},{"institution":"Adrian College"},{"institution":"Albion College"},{"institution":"Hillsdale Beauty College"},{"institution":"Northwestern Technological Institute"},{"institution":"Alma College"},{"institution":"Alpena Community College"},{"institution":"Andrews University"},{"institution":"Aquinas College"},{"institution":"Baker College of Owosso"},{"institution":"Baker College of Flint"},{"institution":"Bay de Noc Community College"},{"institution":"Bayshire Academy of Beauty Craft Inc"},{"institution":"Cadillac Institute of Cosmetology"},{"institution":"Calvin College"},{"institution":"Calvin Theological Seminary"},{"institution":"Carnegie Institute"},{"institution":"Michigan School of Professional Psychology"},{"institution":"Central Michigan University"},{"institution":"Mott Community College"},{"institution":"Empire Beauty School-Michigan"},{"institution":"Cleary University"},{"institution":"Concordia University-Ann Arbor"},{"institution":"Cranbrook Academy of Art"},{"institution":"College for Creative Studies"},{"institution":"Davenport University"},{"institution":"David Pressley School of Cosmetology"},{"institution":"Delta College"},{"institution":"Detroit Business Institute-Downriver"},{"institution":"Michigan State University-College of Law"},{"institution":"MIAT College of Technology"},{"institution":"University of Detroit Mercy"},{"institution":"Dorsey Business Schools-Madison Heights"},{"institution":"Dorsey Business Schools-Southgate"},{"institution":"Eastern Michigan University"},{"institution":"Ferris State University"},{"institution":"Flint Institute of Barbering Inc"},{"institution":"Glen Oaks Community College"},{"institution":"Kettering University"},{"institution":"Gogebic Community College"},{"institution":"Grace Bible College"},{"institution":"Cornerstone University"},{"institution":"Everest Institute-Grand Rapids"},{"institution":"Grand Rapids Community College"},{"institution":"Grand Valley State University"},{"institution":"Great Lakes Christian College"},{"institution":"Henry Ford Community College"},{"institution":"Hope College"},{"institution":"ITT Technical Institute-Wyoming"},{"institution":"Jackson College"},{"institution":"Wright Beauty Academy"},{"institution":"Kalamazoo College"},{"institution":"Kalamazoo Valley Community College"},{"institution":"Kellogg Community College"},{"institution":"Kirtland Community College"},{"institution":"Michigan College of Beauty-Monroe"},{"institution":"Lake Michigan College"},{"institution":"Lake Superior State University"},{"institution":"Lansing Community College"},{"institution":"Lawrence Technological University"},{"institution":"M J Murphy Beauty College of Mount Pleasant"},{"institution":"Macomb Community College"},{"institution":"Madonna University"},{"institution":"Marygrove College"},{"institution":"Rochester College"},{"institution":"University of Michigan-Ann Arbor"},{"institution":"Michigan Barber School Inc"},{"institution":"Michigan State University"},{"institution":"Michigan Technological University"},{"institution":"University of Michigan-Dearborn"},{"institution":"University of Michigan-Flint"},{"institution":"Mid Michigan Community College"},{"institution":"Monroe County Community College"},{"institution":"Montcalm Community College"},{"institution":"Mr Bela\'s School of Cosmetology Inc"},{"institution":"Baker College of Muskegon"},{"institution":"Muskegon Community College"},{"institution":"Everest College-Skokie"},{"institution":"Everest Institute-Southfield"},{"institution":"North Central Michigan College"},{"institution":"Northern Michigan University"},{"institution":"Paul Mitchell the School-Escanaba"},{"institution":"Northwestern Michigan College"},{"institution":"Northwood University-Michigan"},{"institution":"Oakland Community College"},{"institution":"Oakland University"},{"institution":"Olivet College"},{"institution":"Port Huron Cosmetology College"},{"institution":"Kuyper College"},{"institution":"Ross Medical Education Center-Lansing"},{"institution":"Ross Medical Education Center-Madison Heights"},{"institution":"Ross Medical Education Center-Flint"},{"institution":"Sacred Heart Major Seminary"},{"institution":"Saginaw Valley State University"},{"institution":"Schoolcraft College"},{"institution":"Siena Heights University"},{"institution":"St Clair County Community College"},{"institution":"Southwestern Michigan College"},{"institution":"Specs Howard School of Media Arts"},{"institution":"Spring Arbor University"},{"institution":"Michigan Career and Technical Institute"},{"institution":"Finlandia University"},{"institution":"Thomas M Cooley Law Schoo"},{"institution":"Twin City Beauty College"},{"institution":"Walsh College of Accountancy and Business Administration"},{"institution":"Washtenaw Community College"},{"institution":"Wayne County Community College District"},{"institution":"Wayne State University"},{"institution":"West Shore Community College"},{"institution":"Western Michigan University"},{"institution":"Western Theological Seminary"},{"institution":"Wright Beauty Academy"},{"institution":"Academy College"},{"institution":"Alexandria Technical & Community College"},{"institution":"American Indian OIC Inc"},{"institution":"Anoka Technical College"},{"institution":"Anoka-Ramsey Community College"},{"institution":"Apostolic Bible Institute Inc"},{"institution":"Augsburg College"},{"institution":"Riverland Community College"},{"institution":"Northwest Technical College"},{"institution":"Bemidji State University"},{"institution":"Bethany Lutheran College"},{"institution":"Bethel University"},{"institution":"Bethel Seminary-St Paul"},{"institution":"Central Lakes College-Brainerd"},{"institution":"Carleton College"},{"institution":"Concordia College at Moorhead"},{"institution":"Concordia University-Saint Paul"},{"institution":"Dakota County Technical College"},{"institution":"Martin Luther College"},{"institution":"Lake Superior College"},{"institution":"Cosmetology Careers Unlimited College of Hair Skin and Nails"},{"institution":"Duluth Business University"},{"institution":"Minnesota State Community and Technical College"},{"institution":"Globe University-Woodbury"},{"institution":"Minnesota West Community and Technical College"},{"institution":"Gustavus Adolphus College"},{"institution":"Hamline University"},{"institution":"Hazelden Graduate School of Addiction Studies"},{"institution":"Hennepin Technical College"},{"institution":"Cosmetology Careers Unlimited College of Hair Skin and Nails"},{"institution":"Hibbing Community College"},{"institution":"Aveda Institute-Minneapolis"},{"institution":"Inver Hills Community College"},{"institution":"Itasca Community College"},{"institution":"The Art Institutes International-Minnesota"},{"institution":"Luther Seminary"},{"institution":"Macalester College"},{"institution":"South Central College"},{"institution":"Minnesota State University-Mankato"},{"institution":"Regency Beauty Institute-Blaine"},{"institution":"Mayo Medical School"},{"institution":"Mayo School of Health Sciences"},{"institution":"Argosy University-Twin Cities"},{"institution":"Mesabi Range Community and Technical College"},{"institution":"Metropolitan State University"},{"institution":"University of Minnesota-Twin Cities"},{"institution":"University of Minnesota-Crookston"},{"institution":"Minneapolis Business College"},{"institution":"Minneapolis College of Art and Design"},{"institution":"Minneapolis Community and Technical College"},{"institution":"Herzing University-Minneapolis"},{"institution":"Minnesota School of Cosmetology-Woodbury Campus"},{"institution":"Crossroads College"},{"institution":"University of Minnesota-Duluth"},{"institution":"University of Minnesota-Morris"},{"institution":"Minnesota School of Business-Richfield"},{"institution":"Model College of Hair Design"},{"institution":"Minnesota State University-Moorhead"},{"institution":"North Hennepin Community College"},{"institution":"National American University-Roseville"},{"institution":"Brown College-Mendota Heights"},{"institution":"Normandale Community College"},{"institution":"North Central University"},{"institution":"Northland Community and Technical College"},{"institution":"Northwest Technical Institute"},{"institution":"University of Northwestern-St Paul"},{"institution":"Northwestern Health Sciences University"},{"institution":"Oak Hills Christian College"},{"institution":"Regency Beauty Institute-Burnsville"},{"institution":"Pine Technical College"},{"institution":"Rainy River Community College"},{"institution":"Rochester Community and Technical College"},{"institution":"College of Saint Benedict"},{"institution":"St Cloud Technical and Community College"},{"institution":"Regency Beauty Institute-St Cloud"},{"institution":"Saint Cloud State University"},{"institution":"Saint Johns University"},{"institution":"Saint Mary\'s University of Minnesota"},{"institution":"St Olaf College"},{"institution":"Crown College"},{"institution":"The College of Saint Scholastica"},{"institution":"University of St Thomas"},{"institution":"College of Visual Arts"},{"institution":"Empire Beauty School-Bloomington"},{"institution":"St Catherine University"},{"institution":"Rasmussen College-Minnesota"},{"institution":"Saint Paul College"},{"institution":"Southwest Minnesota State University"},{"institution":"Summit Academy Opportunities Industrialization Center"},{"institution":"United Theological Seminary of the Twin Cities"},{"institution":"Vermilion Community College"},{"institution":"Dunwoody College of Technology"},{"institution":"Ridgewater College"},{"institution":"Minnesota State College-Southeast Technical"},{"institution":"Winona State University"},{"institution":"William Mitchell College of Law"},{"institution":"Century College"},{"institution":"Alcorn State University"},{"institution":"Belhaven University"},{"institution":"Blue Mountain College"},{"institution":"Chris Beauty College"},{"institution":"Coahoma Community College"},{"institution":"Antonelli College-Jackson"},{"institution":"Copiah-Lincoln Community College"},{"institution":"Creations College of Cosmetology"},{"institution":"Delta Beauty College"},{"institution":"Delta State University"},{"institution":"East Central Community College"},{"institution":"East Mississippi Community College"},{"institution":"Fosters Cosmetology College"},{"institution":"Academy of Hair Design-Grenada"},{"institution":"Hinds Community College"},{"institution":"Holmes Community College"},{"institution":"Itawamba Community College"},{"institution":"Jackson State University"},{"institution":"Jones County Junior College"},{"institution":"Meridian Community College"},{"institution":"Millsaps College"},{"institution":"Board of Trustees-Mississippi State Institutions of Higher Learning"},{"institution":"Mississippi Delta Community College"},{"institution":"University of Mississippi"},{"institution":"University of Mississippi Medical Center"},{"institution":"Mississippi University for Women"},{"institution":"Mississippi Valley State University"},{"institution":"Mississippi College"},{"institution":"Mississippi College of Beauty Culture"},{"institution":"Mississippi Gulf Coast Community College"},{"institution":"Mississippi State University"},{"institution":"Northeast Mississippi Community College"},{"institution":"Northwest Mississippi Community College"},{"institution":"Pearl River Community College"},{"institution":"Rust College"},{"institution":"Southeastern Baptist College"},{"institution":"Southwest Mississippi Community College"},{"institution":"University of Southern Mississippi"},{"institution":"Magnolia College of Cosmetology"},{"institution":"Tougaloo College"},{"institution":"Wesley Biblical Seminary"},{"institution":"William Carey University"},{"institution":"Anthem College-Maryland Heights"},{"institution":"Aquinas Institute of Theology"},{"institution":"Assemblies of God Theological Seminary"},{"institution":"Avila University"},{"institution":"ITT Technical Institute-Earth City"},{"institution":"Baptist Bible College"},{"institution":"House of Heavilin Beauty College-Blue Springs"},{"institution":"Boonslick Technical Education Center"},{"institution":"Cox College"},{"institution":"Calvary Bible College and Theological Seminary"},{"institution":"Cape Girardeau Career and Technology Center"},{"institution":"Central Christian College of the Bible"},{"institution":"Central Bible College"},{"institution":"Central Methodist University-College of Liberal Arts and Sciences"},{"institution":"University of Central Missouri"},{"institution":"Grand River Technical School"},{"institution":"Chillicothe Beauty Academy Inc"},{"institution":"Cleveland University-Kansas City"},{"institution":"Columbia Area Career Center"},{"institution":"Columbia College"},{"institution":"Conception Seminary College"},{"institution":"Concordia Seminary"},{"institution":"Cottey College"},{"institution":"Covenant Theological Seminary"},{"institution":"Crowder College"},{"institution":"Culver-Stockton College"},{"institution":"DeVry University-Missouri"},{"institution":"Drury University"},{"institution":"East Central College"},{"institution":"Eden Theological Seminary"},{"institution":"Elaine Steven Beauty College"},{"institution":"Pinnacle Career Institute-South Kansas City"},{"institution":"Evangel University"},{"institution":"Fontbonne University"},{"institution":"Forest Institute of Professional Psychology"},{"institution":"Four Rivers Career Center"},{"institution":"Ozarks Technical Community College"},{"institution":"Hannibal-LaGrange University"},{"institution":"Harris-Stowe State University"},{"institution":"Hickey College"},{"institution":"House of Heavilin Beauty College-Kansas City"},{"institution":"Independence College of Cosmetology"},{"institution":"Jefferson College"},{"institution":"Cosmetology Concepts Institute"},{"institution":"Barnes-Jewish College Goldfarb School of Nursing"},{"institution":"Kansas City Art Institute"},{"institution":"Kennett Career and Technology Center"},{"institution":"Kenrick Glennon Seminary"},{"institution":"A T Still University of Health Sciences"},{"institution":"Lake Career and Technical Center"},{"institution":"Lex La-Ray Technical Center"},{"institution":"Lincoln University"},{"institution":"Lindenwood University"},{"institution":"Linn State Technical College"},{"institution":"Logan University"},{"institution":"Metropolitan Community College-Kansas City"},{"institution":"Lutheran School of Nursing"},{"institution":"Maryville University of Saint Louis"},{"institution":"Merrell University of Beauty Arts and Science"},{"institution":"Metro Business College-Cape Girardeau"},{"institution":"Metropolitan Community College-Kansas City"},{"institution":"Midwest Institute"},{"institution":"Midwestern Baptist Theological Seminary"},{"institution":"Mineral Area College"},{"institution":"Westwood College-O\'Hare Airport"},{"institution":"Missouri Baptist University"},{"institution":"National Academy of Beauty Arts-Farmington"},{"institution":"Missouri College"},{"institution":"Missouri School of Barbering & Hairstyling"},{"institution":"Missouri Southern State University"},{"institution":"Missouri Tech"},{"institution":"Missouri Valley College"},{"institution":"Missouri Western State University"},{"institution":"University of Missouri-Columbia"},{"institution":"University of Missouri-Kansas City"},{"institution":"Missouri University of Science and Technology"},{"institution":"University of Missouri-St Louis"},{"institution":"University of Missouri-System Office"},{"institution":"Moberly Area Community College"},{"institution":"Hillyard Technical Center"},{"institution":"National Academy of Beauty Arts-St Louis"},{"institution":"Nazarene Theological Seminary"},{"institution":"Neosho Beauty College"},{"institution":"Nichols Career Center"},{"institution":"Northwest Technical School"},{"institution":"Truman State University"},{"institution":"Northwest Missouri State University"},{"institution":"Ozark Christian College"},{"institution":"College of the Ozarks"},{"institution":"Park University"},{"institution":"Stevens Institute of Business & Arts"},{"institution":"Poplar Bluff Technical Career Center"},{"institution":"Ranken Technical College"},{"institution":"Research College of Nursing"},{"institution":"Rockhurst University"},{"institution":"Rolla Technical Institute"},{"institution":"Everest College-Springfield"},{"institution":"Saint Louis University"},{"institution":"Salem College of Hairstyling"},{"institution":"Sanford-Brown College-Fenton"},{"institution":"American College of Hair Design Inc"},{"institution":"Sikeston Career and Technology Center"},{"institution":"Saint Louis Christian College"},{"institution":"St Louis College of Pharmacy"},{"institution":"Saint Louis Community College"},{"institution":"Saint Paul School of Theology"},{"institution":"Southwest Baptist University"},{"institution":"Missouri State University-West Plains"},{"institution":"Mercy Hospital Springfield-School of Radiologic Technology"},{"institution":"Saint Luke\'s College of Health Sciences"},{"institution":"St Louis College of Health Careers-St Louis"},{"institution":"State Fair Community College"},{"institution":"Stephens College"},{"institution":"Southeast Missouri State University"},{"institution":"Missouri State University-Springfield"},{"institution":"Three Rivers Community College"},{"institution":"North Central Missouri College"},{"institution":"Eldon Career Center"},{"institution":"Truman Medical Center School of Nurse Anesthesia"},{"institution":"Kansas City University of Medicine and Biosciences"},{"institution":"Washington University in St Louis"},{"institution":"Webster University"},{"institution":"Wentworth Military Academy & Junior College"},{"institution":"Westminster College"},{"institution":"William Jewell College"},{"institution":"William Woods University"},{"institution":"Academy of Cosmetology"},{"institution":"Blackfeet Community College"},{"institution":"Butte Academy of Beauty Culture"},{"institution":"Highlands College of Montana Tech"},{"institution":"Crevier\'s School of Cosmetology"},{"institution":"Carroll College"},{"institution":"Dawson Community College"},{"institution":"Chief Dull Knife College"},{"institution":"Montana State University-Billings"},{"institution":"Flathead Valley Community College"},{"institution":"Aaniiih Nakoda College"},{"institution":"Fort Peck Community College"},{"institution":"Great Falls College Montana State University"},{"institution":"University of Great Falls"},{"institution":"Helena College University of Montana"},{"institution":"Little Big Horn College"},{"institution":"Miles Community College"},{"institution":"Modern Beauty School Inc"},{"institution":"Montana Tech of the University of Montana"},{"institution":"Montana State University"},{"institution":"The University of Montana"},{"institution":"Montana State University-Northern"},{"institution":"Rocky Mountain College"},{"institution":"Salish Kootenai College"},{"institution":"The University of Montana-Western"},{"institution":"La\'James International College"},{"institution":"Bellevue University"},{"institution":"Clarkson College"},{"institution":"Bryan College of Health Sciences"},{"institution":"Central Community College"},{"institution":"Chadron State College"},{"institution":"College of Hair Design-Downtown"},{"institution":"Concordia University-Nebraska"},{"institution":"Creighton University"},{"institution":"Doane College-Crete"},{"institution":"Grace University"},{"institution":"Hastings College"},{"institution":"Fullen School of Hair Design"},{"institution":"Alegent Creighton Health School of Radiologic Technology"},{"institution":"Joseph\'s College"},{"institution":"University of Nebraska at Kearney"},{"institution":"Kaplan University-Lincoln Campus"},{"institution":"Nebraska Methodist College of Nursing & Allied Health"},{"institution":"Metropolitan Community College Area"},{"institution":"Mid-Plains Community College"},{"institution":"Midland University"},{"institution":"Nebraska Christian College"},{"institution":"University of Nebraska at Omaha"},{"institution":"Kaplan University-Omaha Campus"},{"institution":"Nebraska Indian Community College"},{"institution":"University of Nebraska Medical Center"},{"institution":"Nebraska Wesleyan University"},{"institution":"University of Nebraska-Lincoln"},{"institution":"Northeast Community College"},{"institution":"Peru State College"},{"institution":"Summit Christian College"},{"institution":"College of Saint Mary"},{"institution":"Southeast Community College Area"},{"institution":"Union College"},{"institution":"University of Nebraska-Central Administration System Office"},{"institution":"Vatterott College-Spring Valley"},{"institution":"Nebraska College of Technical Agriculture"},{"institution":"Wayne State College"},{"institution":"Regional West Medical Center School of Radiologic Technology"},{"institution":"Western Nebraska Community College"},{"institution":"York College"},{"institution":"Academy of Hair Design-Las Vegas"},{"institution":"Career College of Northern Nevada"},{"institution":"College of Southern Nevada"},{"institution":"The Art Institute of Las Vegas"},{"institution":"Everest College-Henderson"},{"institution":"Marinello Schools of Beauty-Las Vegas"},{"institution":"University of Nevada-Las Vegas"},{"institution":"University of Nevada-Reno"},{"institution":"Great Basin College"},{"institution":"Marinello Schools of Beauty-Reno"},{"institution":"Morrison University"},{"institution":"Sierra Nevada College"},{"institution":"Truckee Meadows Community College"},{"institution":"Nevada System of Higher Education-System Office"},{"institution":"Western Nevada College"},{"institution":"Colby-Sawyer College"},{"institution":"Continental Academie of Hair Design-Hudson"},{"institution":"Daniel Webster College"},{"institution":"Dartmouth College"},{"institution":"Empire Beauty School-Laconia"},{"institution":"Empire Beauty School-Somersworth"},{"institution":"Franklin Pierce University"},{"institution":"University of New Hampshire-School of Law"},{"institution":"Mount Washington College"},{"institution":"Keene Beauty Academy"},{"institution":"Lebanon College"},{"institution":"College of St Mary Magdalen"},{"institution":"Michaels School of Hair Design and Esthetics-Paul Mitchell Partner School"},{"institution":"New England College"},{"institution":"New England School of Hair Design Inc"},{"institution":"Southern New Hampshire University"},{"institution":"New Hampshire Institute for Therapeutic Arts"},{"institution":"University of New Hampshire-Main Campus"},{"institution":"Keene State College"},{"institution":"University of New Hampshire at Manchester"},{"institution":"Plymouth State University"},{"institution":"NHTI-Concord\'s Community College"},{"institution":"White Mountains Community College"},{"institution":"River Valley Community College"},{"institution":"Lakes Region Community College"},{"institution":"Manchester Community College"},{"institution":"Nashua Community College"},{"institution":"Great Bay Community College"},{"institution":"Paul Mitchell the School-Portsmouth"},{"institution":"Rivier University"},{"institution":"Saint Anselm College"},{"institution":"St Joseph School of Nursing"},{"institution":"Granite State College"},{"institution":"Thomas More College of Liberal Arts"},{"institution":"University System of New Hampshire System Office"},{"institution":"Eastwick College-Hackensack"},{"institution":"Assumption College for Sisters"},{"institution":"Atlantic Cape Community College"},{"institution":"Fortis Institute-Wayne"},{"institution":"Bergen Community College"},{"institution":"Berkeley College-Woodland Park"},{"institution":"Beth Medrash Govoha"},{"institution":"Bloomfield College"},{"institution":"Brookdale Community College"},{"institution":"Burlington County College"},{"institution":"Caldwell College"},{"institution":"Camden County College"},{"institution":"Centenary College"},{"institution":"Adult and Continuing Education-BCTS"},{"institution":"Anthem Institute-Parsippany"},{"institution":"Lincoln Technical Institute-Edison"},{"institution":"Fox Institute of Business-Clifton"},{"institution":"Dover Business College"},{"institution":"Empire Beauty School-Ocean"},{"institution":"Cooper Health System Center for Allied Health Education"},{"institution":"County College of Morris"},{"institution":"Cumberland County College"},{"institution":"DeVry University-New Jersey"},{"institution":"Divers Academy International"},{"institution":"Drake College of Business-Elizabeth"},{"institution":"Drew University"},{"institution":"duCret School of Arts"},{"institution":"Lincoln Technical Institute-South Plainfield"},{"institution":"Essex County College"},{"institution":"Empire Beauty School-Union"},{"institution":"Fairleigh Dickinson University-Metropolitan Campus"},{"institution":"Felician College"},{"institution":"Fairleigh Dickinson University-College at Florham"},{"institution":"Hohokus School of Trade and Technical Sciences"},{"institution":"Georgian Court University"},{"institution":"Rowan University"},{"institution":"Gloucester County College"},{"institution":"Empire Beauty School-Cherry Hill"},{"institution":"Harris School of Business-Cherry Hill Campus"},{"institution":"Eastwick College-Ramsey"},{"institution":"Holy Name Medical Center School of Nursing"},{"institution":"Hudson County Community College"},{"institution":"New Jersey City University"},{"institution":"Joe Kubert School of Cartoon and Graphic Art"},{"institution":"Kean University"},{"institution":"Harris School of Business-Voorhees Campus"},{"institution":"Lincoln Technical Institute-Union"},{"institution":"Rizzieri Aveda School for Beauty and Wellness"},{"institution":"Mercer County Community College"},{"institution":"Middlesex County College"},{"institution":"Monmouth University"},{"institution":"Montclair State University"},{"institution":"Mountainside School of Nursing"},{"institution":"Muhlenberg Harold B and Dorothy A Snyder Schools-School of Imaging"},{"institution":"Muhlenberg Harold B and Dorothy A Snyder Schools-School of Nursing"},{"institution":"Hohokus School-RETS Nutley"},{"institution":"Empire Beauty School-Jersey City"},{"institution":"New Brunswick Theological Seminary"},{"institution":"Robert Fiance Beauty Schools-West New York"},{"institution":"New Jersey Institute of Technology"},{"institution":"Ocean County College"},{"institution":"Omega Institute"},{"institution":"P B Cosmetology Education Center"},{"institution":"Parisian Beauty School"},{"institution":"Passaic County Community College"},{"institution":"Pennco Tech-Blackwood"},{"institution":"Princeton Theological Seminary"},{"institution":"Princeton University"},{"institution":"Rabbinical College of America"},{"institution":"Ramapo College of New Jersey"},{"institution":"Robert Fiance Beauty Schools-Perth Amboy"},{"institution":"Rider University"},{"institution":"Roman Academy of Beauty Culture"},{"institution":"Rutgers University-Camden"},{"institution":"Rutgers University-New Brunswick"},{"institution":"Rutgers University-Newark"},{"institution":"St Francis Medical Center-School of Radiologic Technology"},{"institution":"Saint Francis Medical Center School of Nursing"},{"institution":"Saint Peter\'s University"},{"institution":"Salem Community College"},{"institution":"Seton Hall University"},{"institution":"Atlantic Beauty & Spa Academy LLC"},{"institution":"College of Saint Elizabeth"},{"institution":"Raritan Valley Community College"},{"institution":"Stevens Institute of Technology"},{"institution":"The Richard Stockton College of New Jersey"},{"institution":"Talmudical Academy-New Jersey"},{"institution":"Teterboro School of Aeronautics"},{"institution":"Thomas Edison State College"},{"institution":"The College of New Jersey"},{"institution":"Sanford-Brown Institute-Iselin"},{"institution":"Union County College"},{"institution":"University of Medicine and Dentistry of New Jersey"},{"institution":"William Paterson University of New Jersey"},{"institution":"Olympian University of Cosmetology"},{"institution":"Central New Mexico Community College"},{"institution":"Navajo Technical University"},{"institution":"De Wolff College Hair Styling and Cosmetology"},{"institution":"New Mexico State University-Dona Ana"},{"institution":"Clovis Community College"},{"institution":"Eastern New Mexico University-Main Campus"},{"institution":"Eastern New Mexico University-Roswell Campus"},{"institution":"Institute of American Indian and Alaska Native Culture"},{"institution":"New Mexico Highlands University"},{"institution":"New Mexico Junior College"},{"institution":"New Mexico Military Institute"},{"institution":"University of New Mexico-Gallup Campus"},{"institution":"New Mexico Institute of Mining and Technology"},{"institution":"University of New Mexico-Los Alamos Campus"},{"institution":"University of New Mexico-Main Campus"},{"institution":"New Mexico State University-Alamogordo"},{"institution":"New Mexico State University-Carlsbad"},{"institution":"New Mexico State University-Grants"},{"institution":"New Mexico State University-Main Campus"},{"institution":"University of New Mexico-Valencia County Campus"},{"institution":"Northern New Mexico College"},{"institution":"San Juan College"},{"institution":"Santa Fe Community College"},{"institution":"Santa Fe University of Art and Design"},{"institution":"University of the Southwest"},{"institution":"Southwestern College"},{"institution":"Southwestern Indian Polytechnic Institute"},{"institution":"University of New Mexico-Taos Campus"},{"institution":"Mesalands Community College"},{"institution":"Vogue College of Cosmetology-Santa Fe"},{"institution":"Western New Mexico University"},{"institution":"Vaughn College of Aeronautics and Technology"},{"institution":"Adelphi University"},{"institution":"Adirondack Community College"},{"institution":"Globe Institute of Technology"},{"institution":"Bryant & Stratton College-Albany"},{"institution":"Albany College of Pharmacy and Health Sciences"},{"institution":"Albany Law School"},{"institution":"Albany Medical College"},{"institution":"Alfred University"},{"institution":"Allen School-Brooklyn"},{"institution":"The Ailey School"},{"institution":"American Academy of Dramatic Arts-New York"},{"institution":"American Academy McAllister Institute of Funeral Service"},{"institution":"Joffrey Ballet School"},{"institution":"American Musical and Dramatic Academy"},{"institution":"Apex Technical School"},{"institution":"Arnot Ogden Medical Center"},{"institution":"Associated Beth Rivkah Schools"},{"institution":"Austin\'s School of Spa Technology"},{"institution":"Bank Street College of Education"},{"institution":"Bard College"},{"institution":"Barnard College"},{"institution":"Berk Trade and Business School"},{"institution":"Berkeley College-New York"},{"institution":"Beth Hatalmud Rabbinical College"},{"institution":"Beth Hamedrash Shaarei Yosher Institute"},{"institution":"Phillips Beth Israel School of Nursing"},{"institution":"Hair Design Institute at Fifth Avenue-Brooklyn"},{"institution":"Boricua College"},{"institution":"Bramson ORT College"},{"institution":"Briarcliffe College"},{"institution":"Brittany Beauty School"},{"institution":"American Beauty School"},{"institution":"Brooklyn Law School"},{"institution":"SUNY Broome Community College"},{"institution":"Bryant & Stratton College-Amherst"},{"institution":"Bryant & Stratton College-Syracuse North"},{"institution":"Bryant & Stratton College-Syracuse"},{"institution":"Bryant & Stratton College-Buffalo"},{"institution":"Bryant & Stratton College-Greece"},{"institution":"Business Informatics Center Inc"},{"institution":"Canisius College"},{"institution":"Capri School of Hair Design"},{"institution":"St Paul\'s School of Nursing-Queens"},{"institution":"Cayuga County Community College"},{"institution":"Cazenovia College"},{"institution":"Central Yeshiva Tomchei Tmimim Lubavitz"},{"institution":"Cheryl Fells School of Business"},{"institution":"Christ the King Seminary"},{"institution":"Circle in the Square Theater School"},{"institution":"CUNY System Office"},{"institution":"Clarkson University"},{"institution":"Clinton Community College"},{"institution":"Cochran School of Nursing"},{"institution":"Colgate Rochester Crozer Divinity School"},{"institution":"Colgate University"},{"institution":"Metropolitan College of New York"},{"institution":"Columbia University in the City of New York"},{"institution":"Columbia-Greene Community College"},{"institution":"Empire Beauty School-Queens"},{"institution":"Concordia College-New York"},{"institution":"Continental School of Beauty Culture-Buffalo"},{"institution":"Continental School of Beauty Culture-Batavia"},{"institution":"Continental School of Beauty Culture-Rochester"},{"institution":"Cooper Union for the Advancement of Science and Art"},{"institution":"Cornell University"},{"institution":"Weill Cornell Medical College"},{"institution":"Corning Community College"},{"institution":"Crouse Hospital College of Nursing"},{"institution":"Culinary Institute of America"},{"institution":"CUNY Bernard M Baruch College"},{"institution":"CUNY Borough of Manhattan Community College"},{"institution":"CUNY Bronx Community College"},{"institution":"CUNY Brooklyn College"},{"institution":"College of Staten Island CUNY"},{"institution":"CUNY City College"},{"institution":"CUNY Graduate School and University Center"},{"institution":"CUNY Hostos Community College"},{"institution":"CUNY Hunter College"},{"institution":"CUNY John Jay College of Criminal Justice"},{"institution":"CUNY Kingsborough Community College"},{"institution":"CUNY LaGuardia Community College"},{"institution":"CUNY Lehman College"},{"institution":"CUNY Medgar Evers College"},{"institution":"CUNY New York City College of Technology"},{"institution":"CUNY Queens College"},{"institution":"CUNY Queensborough Community College"},{"institution":"CUNY School of Law at Queens College"},{"institution":"CUNY York College"},{"institution":"CVPH Medical Center School of Radiologic Technology"},{"institution":"D\'Youville College"},{"institution":"Daemen College"},{"institution":"Yeshiva of Far Rockaway Derech Ayson Rabbinical Seminary"},{"institution":"Dominican College of Blauvelt"},{"institution":"Dowling College"},{"institution":"Dutchess Community College"},{"institution":"Belanger School of Nursing"},{"institution":"Elmira Business Institute"},{"institution":"Elmira College"},{"institution":"Erie Community College"},{"institution":"Fashion Institute of Technology"},{"institution":"Finger Lakes Community College"},{"institution":"Five Towns College"},{"institution":"Fordham University"},{"institution":"The International Culinary Center"},{"institution":"Fulton-Montgomery Community College"},{"institution":"Gemological Institute of America-New York"},{"institution":"The General Theological Seminary"},{"institution":"Genesee Community College"},{"institution":"Global Business Institute"},{"institution":"Global Business Institute"},{"institution":"Hamilton College"},{"institution":"Hartwick College"},{"institution":"Helene Fuld College of Nursing"},{"institution":"Herkimer County Community College"},{"institution":"Hilbert College"},{"institution":"Hobart William Smith Colleges"},{"institution":"Hofstra University"},{"institution":"Houghton College"},{"institution":"Hudson Valley Community College"},{"institution":"Hunter Business School"},{"institution":"Institute of Design and Construction"},{"institution":"Institute of Audio Research"},{"institution":"Iona College"},{"institution":"Isabella Graham Hart School of Practical Nursing"},{"institution":"Island Drafting and Technical Institute"},{"institution":"Ithaca College"},{"institution":"Jamestown Community College"},{"institution":"Jamestown Business College"},{"institution":"Jefferson Community College"},{"institution":"Jewish Theological Seminary of America"},{"institution":"The Juilliard School"},{"institution":"SBI Campus-An Affiliate of Sanford-Brown"},{"institution":"Kehilath Yakov Rabbinical Seminary"},{"institution":"Keuka College"},{"institution":"LIM College"},{"institution":"Le Moyne College"},{"institution":"LIU Brooklyn"},{"institution":"LIU Post"},{"institution":"LIU-University Center Campus"},{"institution":"Long Island Beauty School-Hempstead"},{"institution":"Long Island Business Institute"},{"institution":"LIU Hudson at Rockland"},{"institution":"LIU Brentwood"},{"institution":"Machzikei Hadath Rabbinical College"},{"institution":"Mandl School-The College of Allied Health"},{"institution":"Manhattan College"},{"institution":"Manhattan School of Music"},{"institution":"Manhattanville College"},{"institution":"Maria College of Albany"},{"institution":"Marion S Whelan School of Nursing of Geneva General Hospital"},{"institution":"Marist College"},{"institution":"MarJon School of Beauty ltd-Tonawanda"},{"institution":"Marymount Manhattan College"},{"institution":"Medaille College"},{"institution":"Memorial School of Nursing"},{"institution":"Memorial Hospital School of Radiation Therapy Technology"},{"institution":"Mercy College"},{"institution":"Mesivta Torah Vodaath Rabbinical Seminary"},{"institution":"Mesivta of Eastern Parkway-Yeshiva Zichron Meilech"},{"institution":"Mesivtha Tifereth Jerusalem of America"},{"institution":"Southern Westchester BOCES-Practical Nursing Program"},{"institution":"Midway Paris Beauty School"},{"institution":"Mildred Elley School-Albany Campus"},{"institution":"Mirrer Yeshiva Cent Institute"},{"institution":"Modern Welding School"},{"institution":"Mohawk Valley Community College"},{"institution":"Molloy College"},{"institution":"Monroe College"},{"institution":"Monroe Community College"},{"institution":"Mount Saint Mary College"},{"institution":"Dorothea Hopfer School of Nursing-Mt Vernon Hospital"},{"institution":"College of Mount Saint Vincent"},{"institution":"Icahn School of Medicine at Mount Sinai"},{"institution":"Nassau Community College"},{"institution":"Nazareth College"},{"institution":"Neighborhood Playhouse School of the Theater"},{"institution":"The College of New Rochelle"},{"institution":"The New School"},{"institution":"New School of Radio and Television"},{"institution":"New York Chiropractic College"},{"institution":"Star Career Academy-New York"},{"institution":"New York Institute of English and Business"},{"institution":"New York Law School"},{"institution":"New York Medical College"},{"institution":"New York School for Medical and Dental Assistants"},{"institution":"New York Theological Seminary"},{"institution":"New York University"},{"institution":"Niagara County Community College"},{"institution":"Niagara University"},{"institution":"Empire Beauty School-Peekskill"},{"institution":"North Country Community College"},{"institution":"New York College of Podiatric Medicine"},{"institution":"New York Institute of Technology"},{"institution":"New York School of Interior Design"},{"institution":"Nyack College"},{"institution":"Ohr Hameir Theological Seminary"},{"institution":"Olean Business Institute"},{"institution":"Onondaga Community College"},{"institution":"Orange County Community College"},{"institution":"Otsego Area BOCES-Practical Nursing Program"},{"institution":"Pace University-New York"},{"institution":"Paul Smiths College of Arts and Science"},{"institution":"Continental School of Beauty Culture-West Seneca"},{"institution":"Plaza College"},{"institution":"Polytechnic Institute of New York University"},{"institution":"Davis College"},{"institution":"Pratt Institute-Main"},{"institution":"Professional Business College"},{"institution":"Rabbinical Academy Mesivta Rabbi Chaim Berlin"},{"institution":"Rabbinical College Bobover Yeshiva Bnei Zion"},{"institution":"Rabbinical College of Ch\'san Sofer New York"},{"institution":"Rabbinical College Beth Shraga"},{"institution":"Rabbinical Seminary M\'kor Chaim"},{"institution":"Rabbinical College of Long Island"},{"institution":"Rabbinical Seminary of America"},{"institution":"Rensselaer Polytechnic Institute"},{"institution":"Ridley-Lowell Business & Technical Institute-Binghamton"},{"institution":"Roberts Wesleyan College"},{"institution":"Everest Institute-Rochester"},{"institution":"Rochester Institute of Technology"},{"institution":"University of Rochester"},{"institution":"Rockefeller University"},{"institution":"Rockland Community College"},{"institution":"Empire Beauty School-Manhattan"},{"institution":"The Sage Colleges"},{"institution":"St Bernard\'s School of Theology and Ministry"},{"institution":"St Bonaventure University"},{"institution":"St Francis College"},{"institution":"St Joseph\'s College of Nursing at St Joseph\'s Hospital Health Center"},{"institution":"St Lawrence University"},{"institution":"The College of Saint Rose"},{"institution":"St Thomas Aquinas College"},{"institution":"Samaritan Hospital School of Nursing"},{"institution":"Sarah Lawrence College"},{"institution":"Schenectady County Community College"},{"institution":"Sh\'or Yoshuv Rabbinical College"},{"institution":"Siena College"},{"institution":"Simmons Institute of Funeral Service Inc"},{"institution":"Skidmore College"},{"institution":"Saint Joseph\'s College-New York"},{"institution":"Saint Vladimirs Orthodox Theological Seminary"},{"institution":"Spanish-American Institute"},{"institution":"Faxton-St Luke\'s Healthcare School of Radiologic Technology"},{"institution":"Saint Elizabeth College of Nursing"},{"institution":"Saint Elizabeth Medical Center School of Radiography"},{"institution":"Saint John Fisher College"},{"institution":"St Paul\'s School of Nursing-Staten Island"},{"institution":"St James Mercy Hospital School of Radiologic Science"},{"institution":"St John\'s University-New York"},{"institution":"SUNY-System Office"},{"institution":"New York Career Institute"},{"institution":"Suburban Technical School"},{"institution":"Branford Hall Career Institute-Bohemia Campus"},{"institution":"Sullivan County Community College"},{"institution":"SUNY College of Technology at Alfred"},{"institution":"SUNY College of Technology at Canton"},{"institution":"SUNY College of Technology at Delhi"},{"institution":"SUNY College of Agriculture and Technology at Cobleskill"},{"institution":"Farmingdale State College"},{"institution":"Morrisville State College"},{"institution":"SUNY at Albany"},{"institution":"SUNY at Binghamton"},{"institution":"University at Buffalo"},{"institution":"Stony Brook University"},{"institution":"SUNY College of Environmental Science and Forestry"},{"institution":"SUNY Institute of Technology at Utica-Rome"},{"institution":"SUNY College at Brockport"},{"institution":"Buffalo State SUNY"},{"institution":"SUNY College at Cortland"},{"institution":"SUNY at Fredonia"},{"institution":"SUNY College at Geneseo"},{"institution":"State University of New York at New Paltz"},{"institution":"SUNY Oneonta"},{"institution":"SUNY College at Oswego"},{"institution":"SUNY College at Potsdam"},{"institution":"SUNY at Purchase College"},{"institution":"SUNY College of Optometry"},{"institution":"SUNY College at Old Westbury"},{"institution":"SUNY College at Plattsburgh"},{"institution":"SUNY Downstate Medical Center"},{"institution":"SUNY Empire State College"},{"institution":"SUNY Maritime College"},{"institution":"Upstate Medical University"},{"institution":"Swedish Institute a College of Health Sciences"},{"institution":"Syracuse University"},{"institution":"Talmudical Seminary Oholei Torah"},{"institution":"Talmudical Institute of Upstate New York"},{"institution":"Teachers College at Columbia University"},{"institution":"Technical Career Institutes"},{"institution":"Tompkins Cortland Community College"},{"institution":"Torah Temimah Talmudical Seminary"},{"institution":"Touro College"},{"institution":"Trocaire College"},{"institution":"Excelsior College"},{"institution":"Ulster County Community College"},{"institution":"Sanford-Brown Institute-New York"},{"institution":"Union College"},{"institution":"Union Theological Seminary in the City of New York"},{"institution":"United Talmudical Seminary"},{"institution":"United States Merchant Marine Academy"},{"institution":"United States Military Academy"},{"institution":"Utica College"},{"institution":"Utica School of Commerce"},{"institution":"Vassar College"},{"institution":"Villa Maria College"},{"institution":"School of Visual Arts"},{"institution":"Wagner College"},{"institution":"Webb Institute"},{"institution":"Wells College"},{"institution":"The College of Westchester"},{"institution":"SUNY Westchester Community College"},{"institution":"Westchester School of Beauty Culture"},{"institution":"Wood Tobe-Coburn School"},{"institution":"Word of Life Bible Institute"},{"institution":"Yeshiva Karlin Stolin"},{"institution":"Yeshivat Mikdash Melech"},{"institution":"Yeshiva Derech Chaim"},{"institution":"Yeshiva of Nitra Rabbinical College"},{"institution":"Yeshiva Shaar Hatorah"},{"institution":"Yeshiva University"},{"institution":"Yeshivath Viznitz"},{"institution":"Yeshivath Zichron Moshe"},{"institution":"College of the Albemarle"},{"institution":"The Art Institute of Charlotte"},{"institution":"South Piedmont Community College"},{"institution":"Appalachian State University"},{"institution":"Asheville-Buncombe Technical Community College"},{"institution":"Barton College"},{"institution":"Beaufort County Community College"},{"institution":"Belmont Abbey College"},{"institution":"Bennett College"},{"institution":"Bladen Community College"},{"institution":"Blue Ridge Community College"},{"institution":"Brevard College"},{"institution":"Brookstone College-Charlotte"},{"institution":"Brunswick Community College"},{"institution":"Cabarrus College of Health Sciences"},{"institution":"Caldwell Community College and Technical Institute"},{"institution":"Campbell University"},{"institution":"Cape Fear Community College"},{"institution":"Carolina School of Broadcasting"},{"institution":"Carteret Community College"},{"institution":"Catawba College"},{"institution":"Catawba Valley Community College"},{"institution":"South College-Asheville"},{"institution":"Central Carolina Community College"},{"institution":"Central Piedmont Community College"},{"institution":"Chowan University"},{"institution":"Cleveland Community College"},{"institution":"Coastal Carolina Community College"},{"institution":"Craven Community College"},{"institution":"Davidson County Community College"},{"institution":"Davidson College"},{"institution":"Duke University"},{"institution":"Durham Technical Community College"},{"institution":"East Carolina University"},{"institution":"Edgecombe Community College"},{"institution":"Elizabeth City State University"},{"institution":"Elon University"},{"institution":"Fayetteville Beauty College"},{"institution":"Fayetteville Technical Community College"},{"institution":"Fayetteville State University"},{"institution":"Forsyth Technical Community College"},{"institution":"Gardner-Webb University"},{"institution":"Gaston College"},{"institution":"Greensboro College"},{"institution":"Guilford College"},{"institution":"Guilford Technical Community College"},{"institution":"Halifax Community College"},{"institution":"Haywood Community College"},{"institution":"Heritage Bible College"},{"institution":"High Point University"},{"institution":"Isothermal Community College"},{"institution":"James Sprunt Community College"},{"institution":"Laurel University"},{"institution":"Johnson C Smith University"},{"institution":"Johnston Community College"},{"institution":"Lees-McRae College"},{"institution":"Lenoir Community College"},{"institution":"Lenoir-Rhyne University"},{"institution":"Leons Beauty School Inc"},{"institution":"Livingstone College"},{"institution":"Louisburg College"},{"institution":"Mars Hill University"},{"institution":"Martin Community College"},{"institution":"Mayland Community College"},{"institution":"McDowell Technical Community College"},{"institution":"Mercy School of Nursing"},{"institution":"Meredith College"},{"institution":"Methodist University"},{"institution":"Miller-Motte College-Wilmington"},{"institution":"Mitchell Community College"},{"institution":"Mitchells Hairstyling Academy-Greenville"},{"institution":"Mitchells Hairstyling Academy-Wilson"},{"institution":"Regina\'s College of Beauty-Monroe"},{"institution":"Montgomery Community College"},{"institution":"Montreat College"},{"institution":"Mount Olive College"},{"institution":"College of Wilmington"},{"institution":"Nash Community College"},{"institution":"North Carolina A & T State University"},{"institution":"University of North Carolina at Asheville"},{"institution":"University of North Carolina at Chapel Hill"},{"institution":"University of North Carolina at Charlotte"},{"institution":"University of North Carolina at Greensboro"},{"institution":"North Carolina Central University"},{"institution":"University of North Carolina System Office"},{"institution":"University of North Carolina School of the Arts"},{"institution":"North Carolina State University at Raleigh"},{"institution":"North Carolina Wesleyan College"},{"institution":"University of North Carolina Wilmington"},{"institution":"Pamlico Community College"},{"institution":"William Peace University"},{"institution":"University of North Carolina at Pembroke"},{"institution":"Pfeiffer University"},{"institution":"Piedmont International University"},{"institution":"Piedmont Community College"},{"institution":"Pitt Community College"},{"institution":"Queens University of Charlotte"},{"institution":"Randolph Community College"},{"institution":"Richmond Community College"},{"institution":"Mid-Atlantic Christian University"},{"institution":"Roanoke-Chowan Community College"},{"institution":"Robeson Community College"},{"institution":"Rockingham Community College"},{"institution":"Rowan-Cabarrus Community College"},{"institution":"Saint Augustine\'s University"},{"institution":"Salem College"},{"institution":"Sampson Community College"},{"institution":"Sandhills Community College"},{"institution":"Shaw University"},{"institution":"Paul Mitchell the School-Fayetteville"},{"institution":"St Andrews University"},{"institution":"Empire Beauty School-Matthews"},{"institution":"Southeastern Community College"},{"institution":"Southwestern Community College"},{"institution":"Stanly Community College"},{"institution":"Southeastern Baptist Theological Seminary"},{"institution":"Surry Community College"},{"institution":"Alamance Community College"},{"institution":"Tri-County Community College"},{"institution":"Vance-Granville Community College"},{"institution":"Wake Forest University"},{"institution":"Wake Technical Community College"},{"institution":"Warren Wilson College"},{"institution":"Watts School of Nursing"},{"institution":"Wayne Community College"},{"institution":"Western Piedmont Community College"},{"institution":"Wilkes Community College"},{"institution":"Wilson Community College"},{"institution":"Wingate University"},{"institution":"Carolina Christian College"},{"institution":"Winston Salem Barber School"},{"institution":"Winston-Salem State University"},{"institution":"Western Carolina University"},{"institution":"Rasmussen College-North Dakota"},{"institution":"Bismarck State College"},{"institution":"Dickinson State University"},{"institution":"Fort Berthold Community College"},{"institution":"Josef\'s School of Hair Design Inc-Grand Forks"},{"institution":"Headquarters Academy of Hair Design Inc"},{"institution":"University of Jamestown"},{"institution":"Josef\'s School of Hair Design Inc-Fargo Downtown"},{"institution":"Lake Region State College"},{"institution":"Cankdeska Cikana Community College"},{"institution":"University of Mary"},{"institution":"Mayville State University"},{"institution":"Sanford College of Nursing"},{"institution":"Minot State University"},{"institution":"Moler Barber College"},{"institution":"University of North Dakota"},{"institution":"North Dakota State College of Science"},{"institution":"Dakota College at Bottineau"},{"institution":"North Dakota State University-Main Campus"},{"institution":"Williston State College"},{"institution":"JZ Trend Academy Paul Mitchell Partner School"},{"institution":"Sitting Bull College"},{"institution":"Trinity Bible College"},{"institution":"Turtle Mountain Community College"},{"institution":"United Tribes Technical College"},{"institution":"Valley City State University"},{"institution":"ETI Technical College"},{"institution":"The Art Institute of Cincinnati"},{"institution":"Miami-Jacobs Career College-Independence"},{"institution":"Air Force Institute of Technology-Graduate School of Engineering & Management"},{"institution":"Akron Institute of Herzing University"},{"institution":"University of Akron Main Campus"},{"institution":"Akron School of Practical Nursing"},{"institution":"University of Akron Wayne College"},{"institution":"Allegheny Wesleyan College"},{"institution":"Antonelli College-Cincinnati"},{"institution":"Apollo Career Center"},{"institution":"Art Academy of Cincinnati"},{"institution":"Ashland County-West Holmes Career Center"},{"institution":"Ashland University"},{"institution":"Ashtabula County Technical and Career Campus"},{"institution":"Athenaeum of Ohio"},{"institution":"Auburn Career Center"},{"institution":"Aultman College of Nursing and Health Sciences"},{"institution":"Baldwin Wallace University"},{"institution":"Belmont College"},{"institution":"Bluffton University"},{"institution":"Fortis College-Ravenna"},{"institution":"Bowling Green State University-Firelands"},{"institution":"Bowling Green State University-Main Campus"},{"institution":"Bryant & Stratton College-Parma"},{"institution":"Buckeye Hills Career Center"},{"institution":"Butler Tech-D Russel Lee Career Center"},{"institution":"Canton City Schools Adult Career and Technical Education"},{"institution":"Capital University"},{"institution":"Valley Beauty School"},{"institution":"Carousel Beauty College-Middletown"},{"institution":"Carousel Beauty College-Dayton"},{"institution":"Carousel of Miami Valley Beauty College"},{"institution":"Case Western Reserve University"},{"institution":"Cedarville University"},{"institution":"Central Ohio Technical College"},{"institution":"Central School of Practical Nursing"},{"institution":"Central State University"},{"institution":"Chatfield College"},{"institution":"Choffin Career  and Technical Center"},{"institution":"The Christ College of Nursing and Health Sciences"},{"institution":"Cincinnati Christian University"},{"institution":"Cincinnati College of Mortuary Science"},{"institution":"University of Cincinnati-Main Campus"},{"institution":"Cincinnati State Technical and Community College"},{"institution":"University of Cincinnati-Clermont College"},{"institution":"University of Cincinnati-Blue Ash College"},{"institution":"Ohio Christian University"},{"institution":"Clark State Community College"},{"institution":"Scott College of Cosmetology"},{"institution":"Cleveland Institute of Art"},{"institution":"Cleveland Institute of Dental-Medical Assistants-Cleveland"},{"institution":"Cleveland Institute of Music"},{"institution":"Cleveland State University"},{"institution":"Columbiana County Career and Technical Center"},{"institution":"Bradford School"},{"institution":"Columbus College of Art and Design"},{"institution":"Kaplan College-Columbus"},{"institution":"Columbus State Community College"},{"institution":"Cuyahoga Community College District"},{"institution":"Davis College"},{"institution":"Dayton Barber College"},{"institution":"University of Dayton"},{"institution":"Defiance College"},{"institution":"Denison University"},{"institution":"DeVry University-Ohio"},{"institution":"Chancellor University"},{"institution":"Eastern Hills Academy of Hair Design"},{"institution":"Edison State Community College"},{"institution":"EHOVE Career Center"},{"institution":"Bryant & Stratton College-Cleveland"},{"institution":"Regency Beauty Institute-Cleveland"},{"institution":"The University of Findlay"},{"institution":"Franklin University"},{"institution":"Gerbers Akron Beauty School"},{"institution":"Gods Bible School and College"},{"institution":"Good Samaritan College of Nursing and Health Science"},{"institution":"Great Oaks Institute of Technology and Career Development"},{"institution":"Hannah E Mullins School of Practical Nursing"},{"institution":"Adult and Community Education-Hudson"},{"institution":"Hebrew Union College-Jewish Institute of Religion"},{"institution":"Heidelberg University"},{"institution":"Hiram College"},{"institution":"Hobart Institute of Welding Technology"},{"institution":"Hocking College"},{"institution":"American School of Technology"},{"institution":"Ross Medical Education Center-Cincinnati"},{"institution":"International College of Broadcasting"},{"institution":"ITT Technical Institute-Dayton"},{"institution":"Eastern Gateway Community College"},{"institution":"John Carroll University"},{"institution":"Hondros College"},{"institution":"Casal Aveda Institute"},{"institution":"Kent State University at Ashtabula"},{"institution":"Kent State University at East Liverpool"},{"institution":"Kent State University at Stark"},{"institution":"Kent State University at Trumbull"},{"institution":"Kent State University at Tuscarawas"},{"institution":"Kent State University at Salem"},{"institution":"Kent State University at Kent"},{"institution":"Kent State University at Geauga"},{"institution":"Kenyon College"},{"institution":"Kettering College"},{"institution":"Lake Erie College"},{"institution":"Lakeland Community College"},{"institution":"O C Collins Career Center"},{"institution":"James A Rhodes State College"},{"institution":"Ohio Business College-Sheffield"},{"institution":"Ohio Business College-Sandusky"},{"institution":"Lorain County Community College"},{"institution":"Lourdes University"},{"institution":"Malone University"},{"institution":"Marietta College"},{"institution":"Marion Technical College"},{"institution":"Medina County Career Center"},{"institution":"Mercy College of Ohio"},{"institution":"Methodist Theological School in Ohio"},{"institution":"Miami University-Hamilton"},{"institution":"Miami University-Middletown"},{"institution":"Miami University-Oxford"},{"institution":"Miami-Jacobs Career College-Dayton"},{"institution":"Moler Hollywood Beauty Academy"},{"institution":"Miami Valley Career Technology Center"},{"institution":"Mount Carmel College of Nursing"},{"institution":"University of Mount Union"},{"institution":"Mount Vernon Nazarene University"},{"institution":"College of Mount St Joseph"},{"institution":"Zane State College"},{"institution":"Muskingum University"},{"institution":"Fortis College-Cuyahoga Falls"},{"institution":"Brown Mackie College-North Canton"},{"institution":"National Beauty College"},{"institution":"North Central State College"},{"institution":"Northern Institute of Cosmetology"},{"institution":"Northwest State Community College"},{"institution":"Toledo Public Schools Adult and Continuing Education"},{"institution":"Notre Dame College"},{"institution":"Northeast Ohio Medical University"},{"institution":"University of Northwestern Ohio"},{"institution":"Oberlin College"},{"institution":"Ohio College of Massotherapy Inc"},{"institution":"Ohio Technical College"},{"institution":"Ohio Dominican University"},{"institution":"Kaplan College-Dayton"},{"institution":"Ohio Northern University"},{"institution":"Ohio State University Agricultural Technical Institute"},{"institution":"Ohio State University-Lima Campus"},{"institution":"Ohio State University-Mansfield Campus"},{"institution":"Ohio State University-Marion Campus"},{"institution":"Ohio State University-Newark Campus"},{"institution":"Ohio State Beauty Academy"},{"institution":"Ohio State College of Barber Styling"},{"institution":"Ohio State School of Cosmetology & Experts Barber School"},{"institution":"The Spa School"},{"institution":"Ohio State School of Cosmetology-Canal Winchester"},{"institution":"Ohio State University-Main Campus"},{"institution":"Ohio University-Eastern Campus"},{"institution":"Ohio University-Chillicothe Campus"},{"institution":"Ohio University-Southern Campus"},{"institution":"Ohio University-Lancaster Campus"},{"institution":"Ohio University-Main Campus"},{"institution":"Ohio University-Zanesville Campus"},{"institution":"Ohio Valley College of Technology"},{"institution":"Trinity Health System School of Nursing"},{"institution":"Ohio Wesleyan University"},{"institution":"Otterbein University"},{"institution":"Owens Community College"},{"institution":"Paramount Beauty Academy"},{"institution":"Cuyahoga Valley Career Center"},{"institution":"Payne Theological Seminary"},{"institution":"Pontifical College Josephinum"},{"institution":"Professional Skills Institute"},{"institution":"Firelands Regional Medical Center School of Nursing"},{"institution":"Rabbinical College Telshe"},{"institution":"Raphael\'s School of Beauty Culture Inc-Niles"},{"institution":"Fortis College-Centerville"},{"institution":"University of Rio Grande"},{"institution":"Advertising Art Educational Services DBA School of Advertising Art"},{"institution":"Shawnee State University"},{"institution":"Sinclair Community College"},{"institution":"Gallipolis Career College"},{"institution":"Daymar College-New Boston"},{"institution":"Daymar College-Jackson"},{"institution":"Daymar College-Lancaster"},{"institution":"Daymar College-Chillicothe"},{"institution":"Brown Mackie College-Cincinnati"},{"institution":"Brown Mackie College-Akron"},{"institution":"Lincoln College of Technology-Franklin LCT"},{"institution":"Lincoln College of Technology-Tri-County"},{"institution":"Lincoln College of Technology-Vine Street"},{"institution":"Lincoln College of Technology-Dayton"},{"institution":"Stark State College"},{"institution":"Stautzenberger College-Maumee"},{"institution":"Franciscan University of Steubenville"},{"institution":"Southern State Community College"},{"institution":"Ohio Mid-Western College"},{"institution":"Terra State Community College"},{"institution":"Tiffin Academy of Hair Design"},{"institution":"Tiffin University"},{"institution":"University of Toledo"},{"institution":"Kaplan Career Institute-Cleveland"},{"institution":"Tri-State Bible College"},{"institution":"Tri-County Adult Career Center"},{"institution":"Tri-Rivers Career Center"},{"institution":"Trinity Lutheran Seminary"},{"institution":"Trumbull Business College"},{"institution":"Union Institute & University"},{"institution":"United Theological Seminary"},{"institution":"Upper Valley Career Center"},{"institution":"Urbana University"},{"institution":"Ursuline College"},{"institution":"Valley Beauty School"},{"institution":"Virginia Marti College of Art and Design"},{"institution":"Cut Beauty School"},{"institution":"W Howard Nicol School of Practical Nursing"},{"institution":"Walsh University"},{"institution":"Washington State Community College"},{"institution":"Western Hills School of Beauty and Hair Design"},{"institution":"Wilberforce University"},{"institution":"Wilmington College"},{"institution":"Winebrenner Theological Seminary"},{"institution":"Wittenberg University"},{"institution":"The College of Wooster"},{"institution":"Wright State University-Main Campus"},{"institution":"Wright State University-Lake Campus"},{"institution":"Xavier University"},{"institution":"ITT Technical Institute-Youngstown"},{"institution":"Youngstown State University"},{"institution":"American Broadcasting School-Oklahoma City"},{"institution":"Bacone College"},{"institution":"Oklahoma Wesleyan University"},{"institution":"Southern Nazarene University"},{"institution":"Broken Arrow Beauty College-Broken Arrow"},{"institution":"Pontotoc Technology Center"},{"institution":"Cameron University"},{"institution":"Carl Albert State College"},{"institution":"Central State Beauty Academy"},{"institution":"University of Central Oklahoma"},{"institution":"Claremore Beauty College"},{"institution":"Connors State College"},{"institution":"East Central University"},{"institution":"Eastern Oklahoma State College"},{"institution":"Redlands Community College"},{"institution":"Enid Beauty College"},{"institution":"Eves College of Hairstyling"},{"institution":"Hillsdale Free Will Baptist College"},{"institution":"Hollywood Cosmetology Center"},{"institution":"Langston University"},{"institution":"Murray State College"},{"institution":"Spartan College of Aeronautics and Technology"},{"institution":"Northeastern State University"},{"institution":"Beauty Technical College Inc"},{"institution":"Northern Oklahoma College"},{"institution":"Northeastern Oklahoma A&M College"},{"institution":"Northwestern Oklahoma State University"},{"institution":"Oklahoma State University Center for Health Sciences"},{"institution":"Oklahoma Christian University"},{"institution":"University of Oklahoma-Health Sciences Center"},{"institution":"Oklahoma Panhandle State University"},{"institution":"Oklahoma State University-Main Campus"},{"institution":"Oklahoma State University-Oklahoma City"},{"institution":"Oklahoma Baptist University"},{"institution":"Oklahoma City Community College"},{"institution":"Oklahoma City University"},{"institution":"University of Oklahoma-Norman Campus"},{"institution":"Oklahoma School of Photography"},{"institution":"Oklahoma State University Institute of Technology"},{"institution":"Oral Roberts University"},{"institution":"Tulsa Technology Center-Peoria Campus"},{"institution":"Platt College-Central OKC"},{"institution":"Rogers State University"},{"institution":"Rose State College"},{"institution":"Saint Gregory\'s University"},{"institution":"Standard Beauty College of Oklahoma"},{"institution":"University of Science and Arts of Oklahoma"},{"institution":"Seminole State College"},{"institution":"Southern School of Beauty Inc"},{"institution":"Southeastern Oklahoma State University"},{"institution":"Southwestern Christian University"},{"institution":"Southwestern Oklahoma State University"},{"institution":"Tulsa Community College"},{"institution":"Tulsa Welding School-Tulsa"},{"institution":"University of Tulsa"},{"institution":"Virgil\'s Beauty College"},{"institution":"Indian Capital Technology Center-Tahlequah"},{"institution":"Western Oklahoma State College"},{"institution":"Woodward Beauty College"},{"institution":"High Plains Technology Center"},{"institution":"Academy of Hair Design-Salem"},{"institution":"Abdill Career College Inc"},{"institution":"Paul Mitchell the School-Portland"},{"institution":"The Art Institute of Portland"},{"institution":"Beau Monde College of Hair Design"},{"institution":"Blue Mountain Community College"},{"institution":"Central Oregon Community College"},{"institution":"Chemeketa Community College"},{"institution":"Clackamas Community College"},{"institution":"Clatsop Community College"},{"institution":"College of Hair Design Careers"},{"institution":"Concorde Career College-Portland"},{"institution":"Concordia University-Portland"},{"institution":"Sumner College"},{"institution":"East West College of the Healing Arts"},{"institution":"Eastern Oregon University"},{"institution":"Phagans School of Hair Design-Portland"},{"institution":"New Hope Christian College-Eugene"},{"institution":"George Fox University"},{"institution":"Phagans Grants Pass College of Beauty"},{"institution":"ITT Technical Institute-Portland"},{"institution":"Lane Community College"},{"institution":"Lewis & Clark College"},{"institution":"Linfield College-McMinnville Campus"},{"institution":"Linn-Benton Community College"},{"institution":"Northwest College-Beaverton"},{"institution":"Marylhurst University"},{"institution":"Phagans Medford Beauty School"},{"institution":"Northwest College-Clackamas"},{"institution":"Mount Angel Seminary"},{"institution":"Mt Hood Community College"},{"institution":"Multnomah University"},{"institution":"National College of Natural Medicine"},{"institution":"Northwest Nannies Institute"},{"institution":"Northwest Christian University"},{"institution":"Oregon University System"},{"institution":"Oregon Health & Science University"},{"institution":"Oregon Institute of Technology"},{"institution":"Oregon College of Art and Craft"},{"institution":"Oregon State University"},{"institution":"University of Oregon"},{"institution":"Pacific Northwest College of Art"},{"institution":"Pacific University"},{"institution":"Phagans Beauty College"},{"institution":"Phagans Central Oregon Beauty College"},{"institution":"Phagans School of Beauty"},{"institution":"Phagans School of Hair Design"},{"institution":"Phagans Tigard Beauty School"},{"institution":"Portland Community College"},{"institution":"Portland State University"},{"institution":"University of Portland"},{"institution":"Reed College"},{"institution":"Rogue Community College"},{"institution":"Roseburg Beauty College"},{"institution":"Pioneer Pacific College"},{"institution":"Springfield College of Beauty"},{"institution":"Southern Oregon University"},{"institution":"Southwestern Oregon Community College"},{"institution":"Treasure Valley Community College"},{"institution":"Umpqua Community College"},{"institution":"Warner Pacific College"},{"institution":"Corban University"},{"institution":"College of Cosmetology"},{"institution":"Everest College-Portland"},{"institution":"Western Seminary"},{"institution":"Willamette University"},{"institution":"Western Oregon University"},{"institution":"University of Western States"},{"institution":"Abington Memorial Hospital Dixon School of Nursing"},{"institution":"Jolie Hair and Beauty Academy-Hazleton"},{"institution":"Keystone Technical Institute"},{"institution":"Bryn Athyn College of the New Church"},{"institution":"Academy of Vocal Arts"},{"institution":"Albright College"},{"institution":"All-State Career School-Lester"},{"institution":"Community College of Allegheny County"},{"institution":"Allegheny College"},{"institution":"The Vision Academy"},{"institution":"DeSales University"},{"institution":"Altoona Beauty School Inc"},{"institution":"Alvernia University"},{"institution":"Magnolia School"},{"institution":"American College of Financial Services"},{"institution":"Antonelli Institute"},{"institution":"The Art Institutes of York-PA"},{"institution":"The Art Institute of Philadelphia"},{"institution":"Career Training Academy-New Kensington"},{"institution":"The Art Institute of Pittsburgh"},{"institution":"Automotive Training Center-Exton"},{"institution":"Baptist Bible College & Seminary of Pennsylvania"},{"institution":"Community College of Beaver County"},{"institution":"Arcadia University"},{"institution":"Biblical Theological Seminary"},{"institution":"Bidwell Training Center Inc"},{"institution":"Bloomsburg University of Pennsylvania"},{"institution":"Bradford School"},{"institution":"Bryn Mawr College"},{"institution":"Bucknell University"},{"institution":"Bucks County Community College"},{"institution":"Buck\'s County School of Beauty Culture Inc"},{"institution":"Butler Beauty Academy"},{"institution":"Butler County Community College"},{"institution":"Cabrini College"},{"institution":"California University of Pennsylvania"},{"institution":"Calvary Baptist Theological Seminary"},{"institution":"Cambria-Rowe Business College-Johnstown"},{"institution":"Carlow University"},{"institution":"Carnegie Mellon University"},{"institution":"Cedar Crest College"},{"institution":"Central Penn College"},{"institution":"Chatham University"},{"institution":"Chestnut Hill College"},{"institution":"Cheyney University of Pennsylvania"},{"institution":"Kaplan Career Institute-Franklin Mills"},{"institution":"Citizens School of Nursing"},{"institution":"Clarion University of Pennsylvania"},{"institution":"YTI Career Institute-Capital Region"},{"institution":"Conemaugh Valley Memorial Hospital"},{"institution":"Consolidated School of Business-York"},{"institution":"Curtis Institute of Music"},{"institution":"Dean Institute of Technology"},{"institution":"Delaware County Community College"},{"institution":"Delaware Valley College"},{"institution":"Dickinson College"},{"institution":"The Dickinson School of Law of the Pennsylvania State University"},{"institution":"Douglas Education Center"},{"institution":"Drexel University"},{"institution":"Du Bois Business College-Du Bois"},{"institution":"Everest Institute-Pittsburgh"},{"institution":"Duquesne University"},{"institution":"East Stroudsburg University of Pennsylvania"},{"institution":"Eastern University"},{"institution":"Edinboro University of Pennsylvania"},{"institution":"Elizabethtown College"},{"institution":"Empire Beauty School-State College"},{"institution":"Empire Beauty School-Lebanon"},{"institution":"Empire Beauty School-York"},{"institution":"Empire Beauty School-Lancaster"},{"institution":"Empire Beauty School-Williamsport"},{"institution":"Empire Beauty School-Shamokin Dam"},{"institution":"Empire Beauty School-Pottsville"},{"institution":"Empire Beauty  School-Lehigh Valley"},{"institution":"Empire Beauty School-Gwinnett"},{"institution":"Empire Beauty School-Wyoming Valley"},{"institution":"Empire Beauty School-Warminster"},{"institution":"Empire Beauty School-Harrisburg"},{"institution":"Empire Beauty School-Reading"},{"institution":"Erie Business Center-Erie"},{"institution":"Erie Institute of Technology Inc"},{"institution":"Evangelical Theological Seminary"},{"institution":"Faith Theological Seminary"},{"institution":"Aria Health School of Nursing"},{"institution":"Franklin and Marshall College"},{"institution":"Gannon University"},{"institution":"Geneva College"},{"institution":"Gettysburg College"},{"institution":"Empire Beauty School-Exton"},{"institution":"Empire Beauty School-Laurel Springs"},{"institution":"Empire Beauty School-NE Philadelphia"},{"institution":"Gratz College"},{"institution":"Grove City College"},{"institution":"Gwynedd Mercy University"},{"institution":"Harcum College"},{"institution":"Harrisburg Area Community College-Harrisburg"},{"institution":"Haverford College"},{"institution":"Commonwealth Technical Institute"},{"institution":"Holy Family University"},{"institution":"Hussian School of Art"},{"institution":"Kaplan Career Institute-Pittsburgh"},{"institution":"Immaculata University"},{"institution":"Indiana University of Pennsylvania-Main Campus"},{"institution":"Pennsylvania School of Business"},{"institution":"Jameson Health System"},{"institution":"Great Lakes Institute of Technology"},{"institution":"Jolie Hair and Beauty Academy-Wilkes-Barre"},{"institution":"Johnson College"},{"institution":"Juniata College"},{"institution":"Keystone College"},{"institution":"Anthem Institute-Springfield"},{"institution":"King\'s College"},{"institution":"Kittanning Beauty School"},{"institution":"Kutztown University of Pennsylvania"},{"institution":"La Roche College"},{"institution":"La Salle University"},{"institution":"Lackawanna College"},{"institution":"Lafayette College"},{"institution":"Lancaster Bible College"},{"institution":"Lancaster Theological Seminary"},{"institution":"Lancaster School of Cosmetology"},{"institution":"Lansdale School of Business"},{"institution":"Lansdale School of Cosmetology Inc"},{"institution":"Lebanon Valley College"},{"institution":"Lehigh Carbon Community College"},{"institution":"Berks Technical Institute"},{"institution":"Lehigh University"},{"institution":"Levittown Beauty Academy"},{"institution":"Lincoln Technical Institute-Allentown"},{"institution":"Lincoln Technical Institute-Philadelphia"},{"institution":"Lincoln University of Pennsylvania"},{"institution":"Lock Haven University"},{"institution":"St Margaret School of Nursing"},{"institution":"Lutheran Theological Seminary at Gettysburg"},{"institution":"Lutheran Theological Seminary at Philadelphia"},{"institution":"Luzerne County Community College"},{"institution":"Lycoming College"},{"institution":"Erie Business Center-New Castle"},{"institution":"Manor College"},{"institution":"Mansfield University of Pennsylvania"},{"institution":"Marywood University"},{"institution":"Vet Tech Institute"},{"institution":"Roxborough Memorial Hospital School of Nursing"},{"institution":"Mercyhurst University"},{"institution":"Messiah College"},{"institution":"Metropolitan Career Center Computer Technology Institute"},{"institution":"Millersville University of Pennsylvania"},{"institution":"Misericordia University"},{"institution":"Montgomery County Community College"},{"institution":"Moore College of Art and Design"},{"institution":"Moravian College"},{"institution":"Mount Aloysius College"},{"institution":"Muhlenberg College"},{"institution":"Kaplan Career Institute-Philadelphia"},{"institution":"Neumann University"},{"institution":"New Castle School of Trades"},{"institution":"Newport Business Institute-Lower Burrell"},{"institution":"Northampton County Area Community College"},{"institution":"Pittsburgh\'s Ohio Valley Hospital School of Nursing"},{"institution":"Orleans Technical Institute"},{"institution":"Pennsylvania Academy of Cosmetology Arts and Sciences-Johnstown"},{"institution":"Salus University"},{"institution":"Pennsylvania Institute of Technology"},{"institution":"Pennsylvania State University-Penn State Erie-Behrend College"},{"institution":"Pennsylvania State University-Penn State Great Valley"},{"institution":"Pennsylvania State University-College of Medicine"},{"institution":"Pennsylvania State University-Penn State New Kensington"},{"institution":"Pennsylvania State University-Penn State Shenango"},{"institution":"Pennsylvania State University-Penn State Wilkes-Barre"},{"institution":"Pennsylvania State University-Penn State Worthington Scranton"},{"institution":"Pennsylvania State System of Higher Education-Central Office"},{"institution":"Pennsylvania State University-Penn State Lehigh Valley"},{"institution":"Pennsylvania State University-Penn State Altoona"},{"institution":"Pennsylvania State University-Penn State Beaver"},{"institution":"Pennsylvania State University-Penn State Berks"},{"institution":"Pennsylvania State University-Penn State Harrisburg"},{"institution":"Pennsylvania State University-Penn State Brandywine"},{"institution":"Pennsylvania State University-Penn State Dubois"},{"institution":"Pennsylvania State University-Penn State Fayette- Eberly"},{"institution":"Pennsylvania State University-Penn State Hazleton"},{"institution":"Pennsylvania State University-Main Campus"},{"institution":"Pennsylvania State University-Penn State Greater Allegheny"},{"institution":"Pennsylvania State University-Penn State Mont Alto"},{"institution":"Pennsylvania State University-Penn State Abington"},{"institution":"Pennsylvania State University-Penn State Schuylkill"},{"institution":"Pennsylvania State University-Penn State York"},{"institution":"Pace Institute"},{"institution":"Peirce College"},{"institution":"Penn Commercial Business/Technical School"},{"institution":"Pennco Tech-Bristol"},{"institution":"Pennsylvania Academy of Cosmetology Arts and Sciences-Du Bois"},{"institution":"Pennsylvania Academy of the Fine Arts"},{"institution":"Pennsylvania Gunsmith School"},{"institution":"Pennsylvania Institute of Taxidermy Inc"},{"institution":"Cortiva Institute-Pennsylvania School of Muscle Therapy"},{"institution":"Pennsylvania College of Art and Design"},{"institution":"University of Pennsylvania"},{"institution":"Philadelphia University"},{"institution":"The University of the Arts"},{"institution":"Cairn University-Langhorne"},{"institution":"Philadelphia College of Osteopathic Medicine"},{"institution":"University of the Sciences"},{"institution":"Community College of Philadelphia"},{"institution":"University of Pittsburgh-Bradford"},{"institution":"University of Pittsburgh-Greensburg"},{"institution":"University of Pittsburgh-Johnstown"},{"institution":"University of Pittsburgh-Pittsburgh Campus"},{"institution":"University of Pittsburgh-Titusville"},{"institution":"Beaver Falls Beauty Academy"},{"institution":"Pittsburgh Institute of Aeronautics"},{"institution":"Pittsburgh Institute of Mortuary Science Inc"},{"institution":"Pittsburgh Technical Institute"},{"institution":"Pittsburgh Theological Seminary"},{"institution":"Prism Career Institute-Upper Darby"},{"institution":"Point Park University"},{"institution":"Joseph F McCloskey School of Nursing at Schuylkill Health"},{"institution":"The Salon Professional Academy-Altoona"},{"institution":"Reading Area Community College"},{"institution":"Reading Hospital School of Health Sciences"},{"institution":"Reconstructionist Rabbinical College"},{"institution":"Reformed Presbyterian Theological Seminary"},{"institution":"The Restaurant School at Walnut Hill College"},{"institution":"Kaplan Career Institute-Broomall"},{"institution":"Robert Morris University"},{"institution":"Rosedale Technical Institute"},{"institution":"Rosemont College"},{"institution":"Saint Francis University"},{"institution":"Saint Joseph\'s University"},{"institution":"Saint Vincent College"},{"institution":"Saint Vincent Seminary"},{"institution":"Schuylkill Technology Center"},{"institution":"University of Scranton"},{"institution":"Seton Hill University"},{"institution":"Heritage Valley Sewickley School of Nursing"},{"institution":"University of Pittsburgh Medical Center-Shadyside School of Nursing"},{"institution":"Sharon Regional Health System School of Nursing"},{"institution":"Laurel Technical Institute"},{"institution":"Shippensburg University of Pennsylvania"},{"institution":"Slippery Rock University of Pennsylvania"},{"institution":"Saint Charles Borromeo Seminary-Overbrook"},{"institution":"South Hills Beauty Academy Inc"},{"institution":"South Hills School of Business & Technology"},{"institution":"St Lukes Hospital School of Nursing"},{"institution":"Stroudsburg School of Cosmetology"},{"institution":"Susquehanna University"},{"institution":"Swarthmore College"},{"institution":"Thaddeus Stevens College of Technology"},{"institution":"Talmudical Yeshiva of Philadelphia"},{"institution":"Temple University"},{"institution":"Theological Seminary of the Reformed Episcopal Church"},{"institution":"Thiel College"},{"institution":"Thomas Jefferson University"},{"institution":"Fortis Institute-Erie"},{"institution":"Triangle Tech Inc-Erie"},{"institution":"Triangle Tech Inc-Pittsburgh"},{"institution":"Triangle Tech Inc-Greensburg"},{"institution":"Triangle Tech Inc-Dubois"},{"institution":"Trinity Episcopal School for Ministry"},{"institution":"Ursinus College"},{"institution":"Valley Forge Christian College"},{"institution":"Valley Forge Military College"},{"institution":"Venus Beauty Academy"},{"institution":"Villanova University"},{"institution":"Washington Hospital School of Nursing"},{"institution":"Washington Hospital School of Radiography"},{"institution":"Washington & Jefferson College"},{"institution":"Waynesburg University"},{"institution":"Welder Training and Testing Institute"},{"institution":"West Chester University of Pennsylvania"},{"institution":"Western Pennsylvania Hospital School of Nursing"},{"institution":"Sanford-Brown Institute-Pittsburgh"},{"institution":"Westminster College"},{"institution":"Westminster Theological Seminary"},{"institution":"Westmoreland County Community College"},{"institution":"Widener University-Main Campus"},{"institution":"Wilkes University"},{"institution":"Newport Business Institute-Williamsport"},{"institution":"Wilson College"},{"institution":"Yeshivath Beth Moshe"},{"institution":"York College Pennsylvania"},{"institution":"YTI Career Institute-York"},{"institution":"Yorktowne Business Institute"},{"institution":"Empire Beauty School-Providence"},{"institution":"Brown University"},{"institution":"Bryant University"},{"institution":"Johnson & Wales University-Providence"},{"institution":"Sanford-Brown Institute-Cranston"},{"institution":"New England Institute of Technology"},{"institution":"New England Tractor Trailer Training School of Rhode Island"},{"institution":"Newport School of Hairdressing-Main Campus"},{"institution":"Providence College"},{"institution":"Rhode Island College"},{"institution":"Community College of Rhode Island"},{"institution":"University of Rhode Island"},{"institution":"Rhode Island School of Design"},{"institution":"Roger Williams University"},{"institution":"Salve Regina University"},{"institution":"St Joseph School of Nursing"},{"institution":"Empire Beauty School-Warwick"},{"institution":"Northpoint Bible College"},{"institution":"Aiken Technical College"},{"institution":"Allen University"},{"institution":"Anderson University"},{"institution":"Charleston Southern University"},{"institution":"Technical College of the Lowcountry"},{"institution":"Benedict College"},{"institution":"Bob Jones University"},{"institution":"Southern Wesleyan University"},{"institution":"Charleston Cosmetology Institute"},{"institution":"College of Charleston"},{"institution":"Charzanne Beauty College"},{"institution":"Northeastern Technical College"},{"institution":"Citadel Military College of South Carolina"},{"institution":"Claflin University"},{"institution":"Clemson University"},{"institution":"Clinton College"},{"institution":"Coker College"},{"institution":"Columbia International University"},{"institution":"Columbia College"},{"institution":"Converse College"},{"institution":"Denmark Technical College"},{"institution":"Erskine College"},{"institution":"Florence-Darlington Technical College"},{"institution":"Forrest College"},{"institution":"Francis Marion University"},{"institution":"Furman University"},{"institution":"Cathedral Bible College"},{"institution":"Greenville Technical College"},{"institution":"Horry-Georgetown Technical College"},{"institution":"Kenneth Shuler School of Cosmetology-North Augusta"},{"institution":"Kenneth Shuler School of Cosmetology and Nails-Columbia"},{"institution":"Lander University"},{"institution":"Limestone College"},{"institution":"Lenoir-Rhyne University-Lutheran Theological Southern Seminary"},{"institution":"Medical University of South Carolina"},{"institution":"Midlands Technical College"},{"institution":"Morris College"},{"institution":"Newberry College"},{"institution":"North Greenville University"},{"institution":"Orangeburg Calhoun Technical College"},{"institution":"Piedmont Technical College"},{"institution":"Presbyterian College"},{"institution":"University of South Carolina-Aiken"},{"institution":"University of South Carolina-Beaufort"},{"institution":"University of South Carolina-Columbia"},{"institution":"University of South Carolina-Lancaster"},{"institution":"University of South Carolina-Salkehatchie"},{"institution":"University of South Carolina-Sumter"},{"institution":"University of South Carolina-Union"},{"institution":"Coastal Carolina University"},{"institution":"South Carolina State University"},{"institution":"University of South Carolina-Upstate"},{"institution":"Sherman College of Straight Chiropractic"},{"institution":"Spartanburg Methodist College"},{"institution":"Spartanburg Community College"},{"institution":"Central Carolina Technical College"},{"institution":"Sumter Beauty College"},{"institution":"Tri-County Technical College"},{"institution":"Trident Technical College"},{"institution":"Voorhees College"},{"institution":"Williamsburg Technical College"},{"institution":"Winthrop University"},{"institution":"Wofford College"},{"institution":"York Technical College"},{"institution":"Augustana College"},{"institution":"Black Hills Beauty College"},{"institution":"Black Hills State University"},{"institution":"Kilian Community College"},{"institution":"Dakota State University"},{"institution":"Dakota Wesleyan University"},{"institution":"Headlines Academy Inc"},{"institution":"Lake Area Technical Institute"},{"institution":"Avera McKennan Hospital School of Radiologic Technology"},{"institution":"Mitchell Technical Institute"},{"institution":"Mount Marty College"},{"institution":"National American University-Rapid City"},{"institution":"National American University-Sioux Falls"},{"institution":"Sioux Falls Seminary"},{"institution":"Northern State University"},{"institution":"Oglala Lakota College"},{"institution":"Presentation College"},{"institution":"Avera Sacred Heart Hospital"},{"institution":"South Dakota School of Mines and Technology"},{"institution":"South Dakota State University"},{"institution":"Sinte Gleska University"},{"institution":"University of Sioux Falls"},{"institution":"Sanford Medical Center"},{"institution":"Sisseton Wahpeton College"},{"institution":"Southeast Technical Institute"},{"institution":"Stewart School"},{"institution":"University of South Dakota"},{"institution":"Western Dakota Technical Institute"},{"institution":"American Baptist College"},{"institution":"Aquinas College"},{"institution":"Arnolds Beauty School"},{"institution":"Tennessee College of Applied Technology-Athens"},{"institution":"Austin Peay State University"},{"institution":"Baptist Memorial College of Health Sciences"},{"institution":"Belmont University"},{"institution":"Bethel University"},{"institution":"Bryan College-Dayton"},{"institution":"Carson-Newman University"},{"institution":"Chattanooga State Community College"},{"institution":"Christian Brothers University"},{"institution":"Pentecostal Theological Seminary"},{"institution":"Cleveland State Community College"},{"institution":"Columbia State Community College"},{"institution":"Concorde Career College-Memphis"},{"institution":"Tennessee College of Applied Technology-Covington"},{"institution":"Cumberland University"},{"institution":"Lipscomb University"},{"institution":"Tennessee College of Applied Technology-Dickson"},{"institution":"Daymar Institute-Nashville"},{"institution":"Dyersburg State Community College"},{"institution":"East Tennessee State University"},{"institution":"Chattanooga College Medical Dental and Technical Careers"},{"institution":"Tennessee College of Applied Technology-Elizabethton"},{"institution":"Emmanuel Christian Seminary"},{"institution":"Fayetteville College of Cosmetology Arts and Sciences"},{"institution":"Fisk University"},{"institution":"Welch College"},{"institution":"Freed-Hardeman University"},{"institution":"Tennessee College of Applied Technology-Harriman"},{"institution":"Tennessee College of Applied Technology-Hartsville"},{"institution":"Hiwassee College"},{"institution":"Tennessee College of Applied Technology-Hohenwald"},{"institution":"Tennessee College of Applied Technology-Jacksboro"},{"institution":"Jackson State Community College"},{"institution":"John A Gupton College"},{"institution":"Johnson University"},{"institution":"Paul Mitchell the School-Nashville"},{"institution":"King University"},{"institution":"South College"},{"institution":"Knoxville Institute of Hair Design"},{"institution":"Lane College"},{"institution":"Le Moyne-Owen College"},{"institution":"Lee University"},{"institution":"Lincoln Memorial University"},{"institution":"Tennessee College of Applied Technology-Livingston"},{"institution":"Martin Methodist College"},{"institution":"Maryville College"},{"institution":"Tennessee College of Applied Technology-McKenzie"},{"institution":"Genesis Career College-Cookeville"},{"institution":"Meharry Medical College"},{"institution":"Memphis College of Art"},{"institution":"Tennessee College of Applied Technology-Memphis"},{"institution":"University of Memphis"},{"institution":"Memphis Theological Seminary"},{"institution":"Victory University"},{"institution":"Middle Tennessee State University"},{"institution":"Middle Tennessee School of Anesthesia Inc"},{"institution":"Milligan College"},{"institution":"Tennessee College of Applied Technology-Morristown"},{"institution":"Motlow State Community College"},{"institution":"Tennessee College of Applied Technology-Murfreesboro"},{"institution":"Lincoln College of Technology-Nashville"},{"institution":"Nashville College of Medical Careers"},{"institution":"Nashville State Community College"},{"institution":"Tennessee College of Applied Technology-Newbern"},{"institution":"O\'More College of Design"},{"institution":"Tennessee College of Applied Technology-Paris"},{"institution":"Plaza Beauty School"},{"institution":"Tennessee College of Applied Technology-Pulaski"},{"institution":"Rhodes College"},{"institution":"Tennessee College of Applied Technology-Ripley"},{"institution":"Roane State Community College"},{"institution":"Tennessee College of Applied Technology-Crump"},{"institution":"Southwest Tennessee Community College"},{"institution":"Tennessee College of Applied Technology-Shelbyville"},{"institution":"Sewanee-The University of the South"},{"institution":"Tennessee College of Applied Technology-Oneida-Huntsville"},{"institution":"Tennessee College of Applied Technology-Crossville"},{"institution":"Tennessee College of Applied Technology-McMinnville"},{"institution":"Tennessee College of Applied Technology-Jackson"},{"institution":"Tennessee College of Applied Technology-Knoxville"},{"institution":"Tennessee College of Applied Technology-Whiteville"},{"institution":"Pellissippi State Community College"},{"institution":"Southern Adventist University"},{"institution":"Southern College of Optometry"},{"institution":"Tennessee Wesleyan College"},{"institution":"The University of Tennessee-Chattanooga"},{"institution":"The University of Tennessee-Knoxville"},{"institution":"The University of Tennessee-Martin"},{"institution":"Fountainhead College of Technology"},{"institution":"Tennessee School of Beauty of Knoxville Inc"},{"institution":"Tennessee State University"},{"institution":"Tennessee Technological University"},{"institution":"Tennessee Temple University"},{"institution":"Trevecca Nazarene University"},{"institution":"Northeast State Community College"},{"institution":"Tusculum College"},{"institution":"Union University"},{"institution":"New Concepts School of Cosmetology"},{"institution":"Vanderbilt University"},{"institution":"Volunteer Beauty Academy-Dyersburg"},{"institution":"Volunteer State Community College"},{"institution":"Walters State Community College"},{"institution":"West Tennessee Business College"},{"institution":"William Moore College of Technology"},{"institution":"Abilene Christian University"},{"institution":"Alamo Community College District Central Office"},{"institution":"Alvin Community College"},{"institution":"Amarillo College"},{"institution":"Amberton University"},{"institution":"American Commercial College-San Angelo"},{"institution":"American Commercial College-Abilene"},{"institution":"American Commercial College-Odessa"},{"institution":"Angelina College"},{"institution":"Angelo State University"},{"institution":"Arlington Baptist College"},{"institution":"Arlington Career Institute"},{"institution":"The Art Institute of Houston"},{"institution":"Austin College"},{"institution":"Austin Community College District"},{"institution":"Austin Presbyterian Theological Seminary"},{"institution":"Baldwin Beauty School-South Austin"},{"institution":"Baptist Health System School of Health Professions"},{"institution":"Baptist Missionary Association Theological Seminary"},{"institution":"Texas A & M University Health Science Center"},{"institution":"Baylor College of Medicine"},{"institution":"Baylor University"},{"institution":"Coastal Bend College"},{"institution":"Blinn College"},{"institution":"Remington College-Dallas Campus"},{"institution":"Vet Tech Institute of Houston"},{"institution":"Brazosport College"},{"institution":"Brookhaven College"},{"institution":"Capitol City Trade and Technical School"},{"institution":"Capitol City Careers"},{"institution":"Cedar Valley College"},{"institution":"Central Texas College"},{"institution":"Charles and Sues School of Hair Design"},{"institution":"Cisco College"},{"institution":"Clarendon College"},{"institution":"Concordia University-Texas"},{"institution":"Conlee\'s College of Cosmetology"},{"institution":"North Central Texas College"},{"institution":"Texas A & M University-Corpus Christi"},{"institution":"Cosmetology Career Center LLC"},{"institution":"Court Reporting Institute of Dallas"},{"institution":"Dallas Baptist University"},{"institution":"Dallas Christian College"},{"institution":"Dallas County Community College District"},{"institution":"Dallas Institute of Funeral Service"},{"institution":"Dallas Theological Seminary"},{"institution":"University of Dallas"},{"institution":"Del Mar College"},{"institution":"DeVry University-Texas"},{"institution":"Career Point College"},{"institution":"East Texas Baptist University"},{"institution":"Texas A & M University-Texarkana"},{"institution":"Texas A & M University-Commerce"},{"institution":"Eastfield College"},{"institution":"El Centro College"},{"institution":"El Paso Community College"},{"institution":"Western Technical College"},{"institution":"Western Technical College"},{"institution":"Episcopal Theological Seminary of the Southwest"},{"institution":"Exposito School of Hair Design"},{"institution":"South University-The Art Institute of Dallas"},{"institution":"Fort Worth Beauty School"},{"institution":"Frank Phillips College"},{"institution":"Franklin Beauty School"},{"institution":"Galveston College"},{"institution":"Grayson College"},{"institution":"Hallmark College"},{"institution":"Hardin-Simmons University"},{"institution":"Trinity Valley Community College"},{"institution":"Hill College"},{"institution":"Houston Baptist University"},{"institution":"University of Houston-Clear Lake"},{"institution":"Houston Community College"},{"institution":"University of Houston-Downtown"},{"institution":"University of Houston-Victoria"},{"institution":"University of Houston"},{"institution":"Howard College"},{"institution":"Howard Payne University"},{"institution":"Huston-Tillotson University"},{"institution":"University of the Incarnate Word"},{"institution":"International Business College-El Paso"},{"institution":"International Business College-El Paso"},{"institution":"International Business College-El Paso"},{"institution":"ITT Technical Institute-Arlington"},{"institution":"ITT Technical Institute-Houston West"},{"institution":"Jacksonville College-Main Campus"},{"institution":"Jarvis Christian College"},{"institution":"KD College Conservatory of Film and Dramatic Arts"},{"institution":"Kilgore College"},{"institution":"Lamar University"},{"institution":"Lamar State College-Orange"},{"institution":"Lamar State College-Port Arthur"},{"institution":"Laredo Beauty College Inc"},{"institution":"Laredo Community College"},{"institution":"Texas A & M International University"},{"institution":"Lee College"},{"institution":"LeTourneau University"},{"institution":"Lincoln College of Technology-Grand Prairie"},{"institution":"Lubbock Hair Academy"},{"institution":"Lubbock Christian University"},{"institution":"College of the Mainland"},{"institution":"University of Mary Hardin-Baylor"},{"institution":"McLennan Community College"},{"institution":"McMurry University"},{"institution":"Covenant School of Nursing and Allied Health"},{"institution":"Metroplex Beauty School"},{"institution":"Midland College"},{"institution":"Midwestern State University"},{"institution":"Mims Classic Beauty College"},{"institution":"Wade College"},{"institution":"Southern Careers Institute-Austin"},{"institution":"Mountain View College"},{"institution":"Everest Institute-San Antonio"},{"institution":"Tint School of Makeup and Cosmetology-Irving"},{"institution":"Navarro College"},{"institution":"Neilson Beauty College"},{"institution":"Lone Star College System"},{"institution":"North Lake College"},{"institution":"University of North Texas"},{"institution":"Northeast Texas Community College"},{"institution":"Northwood University-Texas"},{"institution":"Oblate School of Theology"},{"institution":"Ocean Corporation"},{"institution":"Odessa College"},{"institution":"Ogle School Hair Skin Nails-Arlington"},{"institution":"Ogle School Hair Skin Nails-Ft Worth"},{"institution":"Our Lady of the Lake University"},{"institution":"The University of Texas-Pan American"},{"institution":"The University of Texas at Brownsville"},{"institution":"Panola College"},{"institution":"Paris Junior College"},{"institution":"Paul Quinn College"},{"institution":"Prairie View A & M University"},{"institution":"Ranger College"},{"institution":"Aviation Institute of Maintenance-Houston"},{"institution":"Rice University"},{"institution":"Richland College"},{"institution":"Kaplan College-McAllen"},{"institution":"Saint Edward\'s University"},{"institution":"St Philip\'s College"},{"institution":"University of St Thomas"},{"institution":"Sam Houston State University"},{"institution":"San Antonio College"},{"institution":"San Jacinto Community College"},{"institution":"Schreiner University"},{"institution":"Seguin Beauty School-Seguin"},{"institution":"St Mary\'s University"},{"institution":"South Plains College"},{"institution":"South Texas Barber College Inc"},{"institution":"South Texas College of Law"},{"institution":"South Texas Vo-Tech Institute"},{"institution":"South Texas Vocational Technical Institute-McAllen"},{"institution":"Southern Methodist University"},{"institution":"Southwest School of Business and Technical Careers-San Antonio"},{"institution":"Southwest Institute of Technology"},{"institution":"Southwest Texas Junior College"},{"institution":"Southwestern Assemblies of God University"},{"institution":"Southwestern University"},{"institution":"Stephen F Austin State University"},{"institution":"Texas State University"},{"institution":"Southwestern Adventist University"},{"institution":"Southwestern Christian College"},{"institution":"Sul Ross State University"},{"institution":"Tarleton State University"},{"institution":"Tarrant County College District"},{"institution":"Temple College"},{"institution":"University of Texas Southwestern Medical Center"},{"institution":"The University of Texas Health Science Center at San Antonio"},{"institution":"The University of Texas Medical Branch"},{"institution":"Texas State Technical College-System"},{"institution":"Texas State Technical College-Waco"},{"institution":"Texarkana College"},{"institution":"Texas A & M University-Kingsville"},{"institution":"Texas A & M University-Galveston"},{"institution":"Texas A & M University-College Station"},{"institution":"Texas A & M University-System Office"},{"institution":"The University of Texas at Arlington"},{"institution":"The University of Texas at Austin"},{"institution":"The University of Texas at Dallas"},{"institution":"The University of Texas at El Paso"},{"institution":"The University of Texas at Tyler"},{"institution":"Texas Chiropractic College Foundation Inc"},{"institution":"Texas Christian University"},{"institution":"Texas College"},{"institution":"University of North Texas Health Science Center"},{"institution":"Texas Lutheran University"},{"institution":"The University of Texas of the Permian Basin"},{"institution":"The University of Texas at San Antonio"},{"institution":"Texas School of Business-North Campus"},{"institution":"Texas Southern University"},{"institution":"The University of Texas System Office"},{"institution":"Texas Tech University"},{"institution":"Texas Vocational Schools Inc"},{"institution":"Texas Wesleyan University"},{"institution":"Texas Woman\'s University"},{"institution":"Trinity University"},{"institution":"The University of Texas Health Science Center at Houston"},{"institution":"Texas State Technical College-Harlingen"},{"institution":"Texas State Technical College-West Texas"},{"institution":"Texas Tech University Health Sciences Center"},{"institution":"Tyler Junior College"},{"institution":"University of Houston-System Administration"},{"institution":"Universal Technical Institute of Texas Inc."},{"institution":"University of Cosmetology Arts & Sciences-McAllen"},{"institution":"Vernon College"},{"institution":"Victoria Beauty College Inc"},{"institution":"Victoria College"},{"institution":"Vogue College of Cosmetology-McAllen"},{"institution":"Wayland Baptist University"},{"institution":"Weatherford College"},{"institution":"West Texas A & M University"},{"institution":"Western Texas College"},{"institution":"Wharton County Junior College"},{"institution":"Wiley College"},{"institution":"AmeriTech College-Provo"},{"institution":"Bridgerland Applied Technology College"},{"institution":"Brigham Young University-Provo"},{"institution":"Brigham Young University-Hawaii"},{"institution":"Broadview University-West Jordan"},{"institution":"Cameo College of Essential Beauty"},{"institution":"Sherman Kendall Academy-Salt Lake City"},{"institution":"Sherman Kendall Academy-Midvale"},{"institution":"Davis Applied Technology College"},{"institution":"Dixie State University"},{"institution":"Evans Hairstyling College-Cedar City"},{"institution":"Evans Hairstyling College-St George"},{"institution":"Paul Mitchell the School-Salt Lake City"},{"institution":"Eagle Gate College-Murray"},{"institution":"ITT Technical Institute-Murray"},{"institution":"Latter-day Saints Business College"},{"institution":"Everest College-Salt Lake City"},{"institution":"Ogden-Weber Applied Technology College"},{"institution":"Snow College"},{"institution":"Southern Utah University"},{"institution":"Stevens-Henager College-Ogden"},{"institution":"Stevens-Henager College of Business-Provo"},{"institution":"Uintah Basin Applied Technology College"},{"institution":"Utah State University"},{"institution":"Utah Valley University"},{"institution":"Salt Lake Community College"},{"institution":"University of Utah"},{"institution":"Weber State University"},{"institution":"Westminster College"},{"institution":"Bennington College"},{"institution":"Burlington College"},{"institution":"Castleton State College"},{"institution":"Champlain College"},{"institution":"Community College of Vermont"},{"institution":"Goddard College"},{"institution":"Green Mountain College"},{"institution":"Johnson State College"},{"institution":"Lyndon State College"},{"institution":"Marlboro College"},{"institution":"Middlebury College"},{"institution":"New England Culinary Institute"},{"institution":"Norwich University"},{"institution":"O\'Briens Aveda Institute"},{"institution":"Saint Michael\'s College"},{"institution":"SIT Graduate Institute"},{"institution":"College of St Joseph"},{"institution":"Southern Vermont College"},{"institution":"Sterling College"},{"institution":"Vermont Law School"},{"institution":"Vermont State Colleges-Office of the Chancellor"},{"institution":"Vermont Technical College"},{"institution":"University of Vermont"},{"institution":"Bar Palma Beauty Careers Academy"},{"institution":"Advanced Technology Institute"},{"institution":"Averett University"},{"institution":"Blue Ridge Community College"},{"institution":"Bluefield College"},{"institution":"Bridgewater College"},{"institution":"College of William and Mary"},{"institution":"Regent University"},{"institution":"Central School of Practical Nursing"},{"institution":"Central Virginia Community College"},{"institution":"Christopher Newport University"},{"institution":"Suffolk Beauty Academy"},{"institution":"Bryant & Stratton College-Virginia Beach"},{"institution":"Bryant & Stratton College-Richmond"},{"institution":"Jefferson College of Health Sciences"},{"institution":"Dabney S Lancaster Community College"},{"institution":"Danville Community College"},{"institution":"Eastern Virginia Medical School"},{"institution":"Centura College-Virginia Beach"},{"institution":"Emory & Henry College"},{"institution":"Eastern Mennonite University"},{"institution":"Eastern Shore Community College"},{"institution":"Ferrum College"},{"institution":"George Mason University"},{"institution":"Germanna Community College"},{"institution":"Hampden-Sydney College"},{"institution":"Hampton University"},{"institution":"Hollins University"},{"institution":"J Sargeant Reynolds Community College"},{"institution":"James Madison University"},{"institution":"John Tyler Community College"},{"institution":"Everest College-Newport News"},{"institution":"Liberty University"},{"institution":"Longwood University"},{"institution":"Lord Fairfax Community College"},{"institution":"Lynchburg College"},{"institution":"Lynchburg General Hospital School of Nursing"},{"institution":"Mary Baldwin College"},{"institution":"University of Mary Washington"},{"institution":"Marymount University"},{"institution":"Danville Regional Medical Center School of Health Professions"},{"institution":"Mountain Empire Community College"},{"institution":"American National University"},{"institution":"New River Community College"},{"institution":"Sentara College of Health Sciences"},{"institution":"Tidewater Tech-Trades"},{"institution":"Norfolk State University"},{"institution":"Northern Virginia Community College"},{"institution":"Old Dominion University"},{"institution":"Patrick Henry Community College"},{"institution":"Paul D Camp Community College"},{"institution":"Southside Regional Medical Center Professional Schools"},{"institution":"Miller-Motte Technical College-Lynchburg"},{"institution":"Piedmont Virginia Community College"},{"institution":"Radford University"},{"institution":"Sylvain Melloul International Hair Academy"},{"institution":"Randolph-Macon College"},{"institution":"Randolph College"},{"institution":"Rappahannock Community College"},{"institution":"Fortis College-Norfolk"},{"institution":"Richard Bland College of the College of William and Mary"},{"institution":"Bon Secours Memorial College of Nursing"},{"institution":"University of Richmond"},{"institution":"Riverside School of Health Careers"},{"institution":"Roanoke College"},{"institution":"Bon Secours St Mary\'s Hospital School of Medical Imaging"},{"institution":"Saint Pauls College"},{"institution":"Shenandoah University"},{"institution":"Southern Virginia University"},{"institution":"Southside Virginia Community College"},{"institution":"Southwest Virginia Community College"},{"institution":"Springfield Beauty Academy"},{"institution":"Staunton School of Cosmetology"},{"institution":"Strayer University-Virginia"},{"institution":"Sweet Briar College"},{"institution":"Thomas Nelson Community College"},{"institution":"Tidewater Community College"},{"institution":"Union Presbyterian Seminary"},{"institution":"The University of Virginia\'s College at Wise"},{"institution":"Virginia Highlands Community College"},{"institution":"Virginia Intermont College"},{"institution":"Virginia Polytechnic Institute and State University"},{"institution":"Virginia Western Community College"},{"institution":"Virginia Commonwealth University"},{"institution":"University of Virginia"},{"institution":"Virginia Military Institute"},{"institution":"Virginia School of Hair Design"},{"institution":"Virginia University of Lynchburg"},{"institution":"Virginia State University"},{"institution":"Virginia Union University"},{"institution":"Virginia Wesleyan College"},{"institution":"Wards Corner Beauty Academy-Norfolk"},{"institution":"Washington and Lee University"},{"institution":"Sanford-Brown College-Tysons Corner"},{"institution":"Washington County Adult Skill Center"},{"institution":"Woodrow Wilson Rehabilitation Center"},{"institution":"Wytheville Community College"},{"institution":"Beauty Academy"},{"institution":"The Art Institute of Seattle"},{"institution":"Evergreen Beauty and Barber College-Bellevue"},{"institution":"Bellevue College"},{"institution":"Bellingham Beauty School"},{"institution":"Bellingham Technical College"},{"institution":"Big Bend Community College"},{"institution":"Everest College-Bremerton"},{"institution":"Everest College-Renton"},{"institution":"Central Washington University"},{"institution":"Centralia College"},{"institution":"City University of Seattle"},{"institution":"Lucas Marc Academy"},{"institution":"Clark College"},{"institution":"Clover Park Technical College"},{"institution":"Columbia Basin College"},{"institution":"Cornish College of the Arts"},{"institution":"Divers Institute of Technology"},{"institution":"Eastern Washington University"},{"institution":"Edmonds Community College"},{"institution":"Everett Community College"},{"institution":"Paroba College of Cosmetology"},{"institution":"The Evergreen State College"},{"institution":"Pierce College at Fort Steilacoom"},{"institution":"Glen Dow Academy of Hair Design"},{"institution":"Gonzaga University"},{"institution":"Grays Harbor College"},{"institution":"Green River Community College"},{"institution":"Toni & Guy Hairdressing Academy-Shoreline"},{"institution":"Heritage University"},{"institution":"Highline Community College"},{"institution":"Interface College-Spokane"},{"institution":"International Air and Hospitality Academy"},{"institution":"ITT Technical Institute-Seattle"},{"institution":"ITT Technical Institute-Spokane Valley"},{"institution":"Bastyr University"},{"institution":"Gene Juarez Academy of Beauty-Mountlake Terrace"},{"institution":"Bates Technical College"},{"institution":"Lake Washington Institute of Technology"},{"institution":"Lower Columbia College"},{"institution":"Trinity Lutheran College"},{"institution":"Cascade Beauty College"},{"institution":"BJ\'s Beauty & Barber College"},{"institution":"Northwest Hair Academy"},{"institution":"Seattle Community College-North Campus"},{"institution":"Northwest University"},{"institution":"Olympic College"},{"institution":"Perry Technical Institute"},{"institution":"Pacific Lutheran University"},{"institution":"Peninsula College"},{"institution":"University of Puget Sound"},{"institution":"Renton Technical College"},{"institution":"Saint Martin\'s University"},{"institution":"Seattle Community College-South Campus"},{"institution":"Seattle Central College"},{"institution":"Everest College-Seattle"},{"institution":"Seattle Pacific University"},{"institution":"Seattle University"},{"institution":"Shoreline Community College"},{"institution":"Skagit Valley College"},{"institution":"South Puget Sound Community College"},{"institution":"Spokane Community College"},{"institution":"Spokane Falls Community College"},{"institution":"Stylemaster College of Hair Design"},{"institution":"Tacoma Community College"},{"institution":"The Hair School"},{"institution":"Walla Walla Community College"},{"institution":"Walla Walla University"},{"institution":"Washington State University"},{"institution":"University of Washington-Seattle Campus"},{"institution":"Wenatchee Valley College"},{"institution":"Everest College-Vancouver"},{"institution":"Western Washington University"},{"institution":"Whatcom Community College"},{"institution":"Whitman College"},{"institution":"Whitworth University"},{"institution":"Yakima Valley Community College"},{"institution":"Alderson Broaddus University"},{"institution":"Appalachian Beauty School"},{"institution":"Appalachian Bible College"},{"institution":"B M Spurr School of Practical Nursing"},{"institution":"Ben Franklin Career Center"},{"institution":"Bethany College"},{"institution":"Bluefield State College"},{"institution":"Cabell County Career Technology Center"},{"institution":"Charleston School of Beauty Culture"},{"institution":"University of Charleston"},{"institution":"Clarksburg Beauty Academy and School of Massage Therapy"},{"institution":"Concord University"},{"institution":"Davis & Elkins College"},{"institution":"Fairmont State University"},{"institution":"Glenville State College"},{"institution":"HRDE-Stanley Technical Institute-Clarksburg"},{"institution":"Huntington Junior College"},{"institution":"James Rumsey Technical Institute"},{"institution":"Ralph R Willis Career and Technical Center"},{"institution":"Human Resource Development and Employment Inc"},{"institution":"Marshall University"},{"institution":"Mercer County Technical Education Center"},{"institution":"Meredith Manor International Equestrian Center"},{"institution":"Monongalia County Technical Education Center"},{"institution":"Morgantown Beauty College Inc"},{"institution":"Mountain State College"},{"institution":"Everest Institute-Cross Lanes"},{"institution":"Opportunities Industrialization Center"},{"institution":"Ohio Valley University"},{"institution":"West Virginia University at Parkersburg"},{"institution":"Potomac State College of West Virginia University"},{"institution":"Academy of Careers and Technology"},{"institution":"Salem International University"},{"institution":"Shepherd University"},{"institution":"Southern West Virginia Community and Technical College"},{"institution":"Fred W Eberle Technical Center"},{"institution":"West Virginia School of Osteopathic Medicine"},{"institution":"West Virginia State University"},{"institution":"West Virginia University Hospital Departments of Rad Tech and Nutrition"},{"institution":"West Liberty University"},{"institution":"West Virginia University Institute of Technology"},{"institution":"West Virginia Wesleyan College"},{"institution":"West Virginia Business College-Wheeling"},{"institution":"West Virginia Junior College-Charleston"},{"institution":"West Virginia Junior College-Morgantown"},{"institution":"International Beauty School 4"},{"institution":"West Virginia Northern Community College"},{"institution":"West Virginia University"},{"institution":"Wheeling Jesuit University"},{"institution":"Wood County School of Practical Nursing"},{"institution":"Advanced Institute of Hair Design-Glendale"},{"institution":"VICI Aveda Institute"},{"institution":"Alverno College"},{"institution":"Madison Area Technical College"},{"institution":"Bellin College"},{"institution":"Beloit College"},{"institution":"Blackhawk Technical College"},{"institution":"Cardinal Stritch University"},{"institution":"Carroll University"},{"institution":"Carthage College"},{"institution":"Columbia College of Nursing"},{"institution":"Concordia University-Wisconsin"},{"institution":"Edgewood College"},{"institution":"Fox Valley Technical College"},{"institution":"Gateway Technical College"},{"institution":"Gill-Tech Academy of Hair Design"},{"institution":"The Salon Professional Academy-Eau Claire"},{"institution":"ITT Technical Institute-Greenfield"},{"institution":"DeVry University-Wisconsin"},{"institution":"Lakeland College"},{"institution":"Lakeshore Technical College"},{"institution":"Lawrence University"},{"institution":"Maranatha Baptist University"},{"institution":"Marian University"},{"institution":"Marquette University"},{"institution":"Empire Beauty School-Madison"},{"institution":"Medical College of Wisconsin"},{"institution":"Mid-State Technical College"},{"institution":"Milwaukee Area Technical College"},{"institution":"Milwaukee Institute of Art & Design"},{"institution":"Milwaukee School of Engineering"},{"institution":"Moraine Park Technical College"},{"institution":"Mount Mary University"},{"institution":"Nashotah House"},{"institution":"Nicolet Area Technical College"},{"institution":"Northcentral Technical College"},{"institution":"Northeast Wisconsin Technical College"},{"institution":"Northland International University"},{"institution":"Northland College"},{"institution":"Ripon College"},{"institution":"Sacred Heart School of Theology"},{"institution":"Saint Norbert College"},{"institution":"Silver Lake College of the Holy Family"},{"institution":"State College of Beauty Culture Inc"},{"institution":"Southwest Wisconsin Technical College"},{"institution":"Bryant & Stratton College-Milwaukee"},{"institution":"University of Wisconsin Colleges"},{"institution":"Viterbo University"},{"institution":"Chippewa Valley Technical College"},{"institution":"Waukesha County Technical College"},{"institution":"Western Technical College"},{"institution":"University of Wisconsin-Whitewater"},{"institution":"Wisconsin Indianhead Technical College"},{"institution":"Wisconsin School of Professional Psychology"},{"institution":"Paul Mitchell the School-Green Bay"},{"institution":"University of Wisconsin-Eau Claire"},{"institution":"University of Wisconsin-Green Bay"},{"institution":"University of Wisconsin-La Crosse"},{"institution":"Wisconsin Lutheran College"},{"institution":"University of Wisconsin-Oshkosh"},{"institution":"University of Wisconsin-Parkside"},{"institution":"Herzing University-Madison"},{"institution":"University of Wisconsin-Stout"},{"institution":"University of Wisconsin-Superior"},{"institution":"University of Wisconsin-System Administration"},{"institution":"University of Wisconsin-Madison"},{"institution":"University of Wisconsin-Milwaukee"},{"institution":"University of Wisconsin-Platteville"},{"institution":"University of Wisconsin-River Falls"},{"institution":"University of Wisconsin-Stevens Point"},{"institution":"Casper College"},{"institution":"Central Wyoming College"},{"institution":"Eastern Wyoming College"},{"institution":"Laramie County Community College"},{"institution":"Northwest College"},{"institution":"Sheridan College"},{"institution":"Western Wyoming Community College"},{"institution":"Cheeks International Academy of Beauty Culture-Cheyenne"},{"institution":"Wyotech-Laramie"},{"institution":"University of Wyoming"},{"institution":"American Samoa Community College"},{"institution":"Guam Community College"},{"institution":"University of Guam"},{"institution":"Northern Marianas College"},{"institution":"Institute of Beauty Careers"},{"institution":"Educational Technical College-Recinto de Bayamon"},{"institution":"American University of Puerto Rico"},{"institution":"American University of Puerto Rico"},{"institution":"American Educational College"},{"institution":"Antilles School of Technical Careers"},{"institution":"Universidad Adventista de las Antillas"},{"institution":"Atlantic University College"},{"institution":"Bayamon Central University"},{"institution":"Columbia Centro Universitario-Caguas"},{"institution":"Carlos Albizu University-San Juan"},{"institution":"Caribbean University-Bayamon"},{"institution":"Caribbean University-Carolina"},{"institution":"Pontifical Catholic University of Puerto Rico-Arecibo"},{"institution":"Pontifical Catholic University of Puerto Rico-Ponce"},{"institution":"Centro de Estudios Multidisciplinarios-San Juan"},{"institution":"Universidad Teologica del Caribe"},{"institution":"Colegio Universitario de San Juan"},{"institution":"Universidad Metropolitana"},{"institution":"Puerto Rico Conservatory of Music"},{"institution":"Center for Advanced Studies On Puerto Rico and the Caribbean"},{"institution":"EDP University of Puerto Rico Inc-San Sebastian"},{"institution":"Emma\'s Beauty Academy-Mayaguez"},{"institution":"Escuela de Artes Plasticas de Puerto Rico"},{"institution":"Instituto Tecnologico de Puerto Rico-Recinto de Manati"},{"institution":"Sistema Universitario Ana G Mendez"},{"institution":"Huertas College"},{"institution":"Humacao Community College"},{"institution":"ICPR Junior College-Arecibo"},{"institution":"ICPR Junior College-Mayaguez"},{"institution":"Instituto de Educacion Tecnica Ocupacional La Reine-Manati"},{"institution":"Hispanic American College"},{"institution":"Instituto de Banca y Comercio Inc"},{"institution":"Instituto Tecnologico de Puerto Rico-Recinto de Guayama"},{"institution":"Instituto Tecnologico de Puerto Rico-Recinto de Ponce"},{"institution":"Instituto Tecnologico de Puerto Rico-Recinto de San Juan"},{"institution":"Inter American University of Puerto Rico-San German"},{"institution":"Inter American University of Puerto Rico-Aguadilla"},{"institution":"Inter American University of Puerto Rico-Arecibo"},{"institution":"Inter American University of Puerto Rico-Barranquitas"},{"institution":"Inter American University of Puerto Rico-Metro"},{"institution":"Inter American University of Puerto Rico-Ponce"},{"institution":"Inter American University of Puerto Rico-Central Office"},{"institution":"Inter American University of Puerto Rico-Fajardo"},{"institution":"Inter American University of Puerto Rico-Guayama"},{"institution":"Inter American University of Puerto Rico-Bayamon"},{"institution":"Inter American University of Puerto Rico-School of Law"},{"institution":"International Technical College"},{"institution":"Liceo de Arte y Tecnologia"},{"institution":"MBTI Business Training Institute"},{"institution":"Modern Hairstyling Institute-Bayamon"},{"institution":"Modern Hairstyling Institute-Arecibo"},{"institution":"National University College-Bayamon"},{"institution":"National University College-Arecibo"},{"institution":"Ponce Paramedical College Inc"},{"institution":"Ponce School of Medicine and Health Sciences"},{"institution":"University of Puerto Rico-Aguadilla"},{"institution":"University of Puerto Rico-Arecibo"},{"institution":"University of Puerto Rico-Bayamon"},{"institution":"University of Puerto Rico-Carolina"},{"institution":"University of Puerto Rico-Cayey"},{"institution":"University of Puerto Rico-Central Administration"},{"institution":"University of Puerto Rico-Humacao"},{"institution":"University of Puerto Rico-Utuado"},{"institution":"University of Puerto Rico-Mayaguez"},{"institution":"University of Puerto Rico-Medical Sciences"},{"institution":"University of Puerto Rico-Ponce"},{"institution":"University of Puerto Rico-Rio Piedras"},{"institution":"Universidad Del Este"},{"institution":"Ryder Memorial School for Practical Nursing"},{"institution":"Rogies School of Beauty Culture"},{"institution":"Universidad del Sagrado Corazon"},{"institution":"Seminario Evangelico de Puerto Rico"},{"institution":"Universidad Central Del Caribe"},{"institution":"Universidad Politecnica de Puerto Rico"},{"institution":"Pontifical Catholic University of Puerto Rico-Mayaguez"},{"institution":"Universidad Del Turabo"},{"institution":"College of Micronesia-FSM"},{"institution":"Palau Community College"},{"institution":"University of the Virgin Islands"},{"institution":"Stanford University"},{"institution":"Purdue University-Main Campus"},{"institution":"Blue Hills Regional Technical School"},{"institution":"Parker University"},{"institution":"EDP Univeristy of Puerto Rico Inc-San Juan"},{"institution":"ICPR Junior College-General Institutional"},{"institution":"ITT Technical Institute-Sylmar"},{"institution":"ITT Technical Institute-Westminster"},{"institution":"Widener University-Delaware Campus"},{"institution":"City College-Fort Lauderdale"},{"institution":"Meridian College"},{"institution":"Georgia Perimeter College"},{"institution":"Georgia Piedmont Technical College"},{"institution":"Toni & Guy Hairdressing Academy-Coeur D Alene"},{"institution":"Cortiva Institute-Chicago"},{"institution":"ETI School of Skilled Trades"},{"institution":"Lincoln College of Technology-Florence"},{"institution":"Trend Setters\' Academy of Beauty Culture-Elizabethtown"},{"institution":"Traxlers School of Hair"},{"institution":"Infinity Career College"},{"institution":"Vatterott College-Berkeley"},{"institution":"Metro Business College-Rolla"},{"institution":"Metro Business College-Jefferson City"},{"institution":"Warren County Community College"},{"institution":"St John\'s College"},{"institution":"Yeshiva and Kollel Harbotzas Torah"},{"institution":"Bais Medrash Elyon"},{"institution":"Antioch University-Los Angeles"},{"institution":"Antioch University-Santa Barbara"},{"institution":"Antioch University-New England"},{"institution":"Antioch University-Seattle"},{"institution":"Antioch University-Midwest"},{"institution":"Mid-America Christian University"},{"institution":"Platt College-Tulsa"},{"institution":"Ponca City Beauty College"},{"institution":"Francis Tuttle Technology Center"},{"institution":"Career Point College"},{"institution":"Central Technology Center"},{"institution":"Carrington College-Portland"},{"institution":"Career Technology Center of Lackawanna County"},{"institution":"Kaplan Career Institute-Nashville"},{"institution":"Kaplan College-El Paso"},{"institution":"Houston Graduate School of Theology"},{"institution":"Palo Alto College"},{"institution":"Sebring Career Schools-Huntsville"},{"institution":"University of Cosmetology Arts & Sciences-San Antonio Perrin"},{"institution":"Central Texas Beauty College-Round Rock"},{"institution":"Empire Beauty School-Manitowoc"},{"institution":"Unification Theological Seminary"},{"institution":"Athens Technical College"},{"institution":"Maricopa Skill Center"},{"institution":"Carrington College California-San Leandro"},{"institution":"Headmasters School of Hair Design"},{"institution":"Razzle Dazzle College of Hair Design Inc"},{"institution":"Beckfield College-Florence"},{"institution":"University of Louisiana-System Administration"},{"institution":"Dorsey Business Schools-Wayne"},{"institution":"Ecumenical Theological Seminary"},{"institution":"Ross Medical Education Center-Saginaw"},{"institution":"Sussex County Community College"},{"institution":"Landmark College"},{"institution":"National American University-Independence"},{"institution":"Mississippi Community College Board"},{"institution":"Yeshiva Gedolah of Greater Detroit"},{"institution":"Austin Graduate School of Theology"},{"institution":"Collin County Community College District"},{"institution":"Owensboro Community and Technical College"},{"institution":"Heads West Kentucky Beauty College"},{"institution":"Jenny Lea Academy of Cosmetology"},{"institution":"Empire Beauty School-Hurstborne"},{"institution":"Southeast School of Cosmetology"},{"institution":"Cloyd\'s Beauty School 3 Inc"},{"institution":"Moore Norman Technology Center"},{"institution":"Fayette County Career & Technical Institute Practical Nursing Program"},{"institution":"Franklin County Career and Technology Center"},{"institution":"Paul Mitchell the School-Knoxville"},{"institution":"Ogle School Hair Skin Nails-Hurst"},{"institution":"Okefenokee Technical College"},{"institution":"Fashion Institute of Design & Merchandising-San Diego"},{"institution":"National American University-Albuquerque"},{"institution":"Tennessee College of Applied Technology-Nashville"},{"institution":"ECPI University"},{"institution":"Ms Robert\'s Academy of Beauty Culture-Villa Park"},{"institution":"Anthem Institute-Jersey City"},{"institution":"Paul Mitchell the School-Houston"},{"institution":"ATI Career Training Center-Dallas"},{"institution":"TDDS Technical Institute"},{"institution":"Fortis Institute-Forty Fort"},{"institution":"Laurel Business Institute"},{"institution":"Antonelli Medical and Professional Institute"},{"institution":"Aviation Institute of Maintenance-Philadelphia"},{"institution":"Sanford-Brown Institute-Trevose"},{"institution":"Fortis Institute-Mulberry"},{"institution":"Carrington College-Phoenix Westside"},{"institution":"Dorsey Business Schools-Roseville"},{"institution":"The Salon Professional Academy-Williston"},{"institution":"Moler-Pickens Beauty Academy"},{"institution":"Red River Technology Center"},{"institution":"Kaplan Career Institute-Harrisburg"},{"institution":"ITT Technical Institute-Newburgh"},{"institution":"Southern Union State Community College"},{"institution":"South University-Columbia"},{"institution":"Everest University-Brandon"},{"institution":"Clinton Technical School"},{"institution":"Consolidated School of Business-Lancaster"},{"institution":"Greene County Career and Technology Center"},{"institution":"Lac Courte Oreilles Ojibwa Community College"},{"institution":"University of Wisconsin Extension"},{"institution":"Diesel Driving Academy-Shreveport"},{"institution":"Pima Medical Institute-Mesa"},{"institution":"Platt College-Los Angeles"},{"institution":"Platt College-Aurora"},{"institution":"Kaplan University-Davenport Campus"},{"institution":"Kaplan University-Cedar Falls Campus"},{"institution":"Paul Mitchell the School-Boise"},{"institution":"Christian Life College"},{"institution":"Knowledge Systems Institute"},{"institution":"Educators of Beauty College of Cosmetology-Rockford"},{"institution":"ITT Technical Institute-Arlington Heights"},{"institution":"Northwestern College-Southwestern Campus"},{"institution":"Tulsa Technology Center-Lemley Campus"},{"institution":"Tulsa Technology Center-Riverside Campus"},{"institution":"Tulsa Technology Center-Broken Arrow Campus"},{"institution":"Douglas J Aveda Institute"},{"institution":"ITT Technical Institute-Troy"},{"institution":"Ross Medical Education Center-Brighton"},{"institution":"Ross Medical Education Center-Ann Arbor"},{"institution":"Taylortown School of Beauty Inc"},{"institution":"Pike-Lincoln Technical Center"},{"institution":"Pennsylvania Institute of Health and Technology"},{"institution":"Skyline College-Roanoke"},{"institution":"Bethel Seminary-San Diego"},{"institution":"St Charles Community College"},{"institution":"Brandman University"},{"institution":"New College of Florida"},{"institution":"Montana Bible College"},{"institution":"Arizona Academy of Beauty-North"},{"institution":"Empire Beauty School-Prescott"},{"institution":"Le Cordon Bleu College of Culinary Arts-Scottsdale"},{"institution":"Conservatory of Recording Arts and Sciences"},{"institution":"Adrian\'s College of Beauty Turlock"},{"institution":"California Career School"},{"institution":"San Joaquin Valley College-Fresno"},{"institution":"Rolf Institute of Structural Integration"},{"institution":"Heritage College-Denver"},{"institution":"Empire Beauty School-Highland"},{"institution":"Sunstate Academy"},{"institution":"Elizabeth Grady School of Esthetics and Massage Therapy"},{"institution":"Ross Medical Education Center-Port Huron"},{"institution":"Capri Institute of Hair Design-Clifton"},{"institution":"Raphael\'s School of Beauty Culture Inc-Alliance"},{"institution":"Metro Technology Centers"},{"institution":"Heald College-Roseville"},{"institution":"Daymar College-Bowling Green"},{"institution":"Everest College-Everett"},{"institution":"Luna Community College"},{"institution":"Grabber School of Hair Design"},{"institution":"Yeshivah Gedolah Rabbinical College"},{"institution":"University of the District of Columbia-David A Clarke School of Law"},{"institution":"Raphael\'s School of Beauty Culture Inc-Brunswick"},{"institution":"Caribbean University-Ponce"},{"institution":"Caribbean University-Vega Baja"},{"institution":"University of Advancing Technology"},{"institution":"Paradise Valley Community College"},{"institution":"Chandler-Gilbert Community College"},{"institution":"St John\'s Hospital School of Clinical Lab Science"},{"institution":"Madison Media Institute"},{"institution":"Sanford-Brown Institute-Landover"},{"institution":"Sanford-Brown Institute-White Plains"},{"institution":"Sanford-Brown Institute-Garden City"},{"institution":"Great Plains Technology Center"},{"institution":"Montebello Beauty College"},{"institution":"Roane-Jackson Technical Center"},{"institution":"Total Cosmetology Training Center"},{"institution":"Iverson Business School"},{"institution":"Lawrence County Career and Technical Center-Practical Nursing Program"},{"institution":"Pioneer Technology Center"},{"institution":"Portage Lakes Career Center"},{"institution":"Eastern College of Health Vocations-New Orleans"},{"institution":"Bell Mar Beauty College"},{"institution":"Cannella School of Hair Design-Chicago"},{"institution":"Caddo Kiowa Technology Center"},{"institution":"Kaplan College-San Antonio-San Pedro"},{"institution":"Oswego County BOCES"},{"institution":"Le Cordon Bleu College of Culinary Arts-Austin"},{"institution":"The Art Institute of New York City"},{"institution":"Paris II Educational Center"},{"institution":"International School of Skin Nailcare & Massage Therapy"},{"institution":"Palomar Institute of Cosmetology"},{"institution":"Southern Oklahoma Technology Center"},{"institution":"Vista College"},{"institution":"Autry Technology Center"},{"institution":"Greene County Vocational School District"},{"institution":"Canadian Valley Technology Center"},{"institution":"Wilkes-Barre Area Career and Technical Center Practical Nursing"},{"institution":"Mayo Graduate School"},{"institution":"American Beauty Institute"},{"institution":"Meridian Technology Center"},{"institution":"Waynesville Career Center"},{"institution":"Connecticut Institute of Hair Design"},{"institution":"Capitol School of Hairstyling and Esthetics"},{"institution":"Morris County Vocational School District"},{"institution":"Ross Medical Education Center-Roosevelt Park"},{"institution":"Ross Medical Education Center-Kentwood"},{"institution":"South Florida Bible College and Theological Seminary"},{"institution":"Cloyd\'s Barber School 2 Inc"},{"institution":"Universal Technical Institute of Illinois Inc"},{"institution":"Pennsylvania College of Technology"},{"institution":"Commonwealth Institute of Funeral Service"},{"institution":"Delta College of Arts & Technology"},{"institution":"InterCoast Colleges-Orange"},{"institution":"Stone Child College"},{"institution":"New York Academy of Art"},{"institution":"Suffolk County Community College"},{"institution":"Las Positas College"},{"institution":"Blades School of Hair Design"},{"institution":"Altamaha Technical College"},{"institution":"Ogeechee Technical College"},{"institution":"Remington College-Mobile Campus"},{"institution":"Everest College-Aurora"},{"institution":"Southwest Florida College"},{"institution":"Mercy-St Luke\'s School of Radiologic Technology"},{"institution":"ITT Technical Institute-Norwood"},{"institution":"Southwest Acupuncture College-Santa Fe"},{"institution":"Northwest Technology Center-Alva"},{"institution":"Mercer County Career Center"},{"institution":"ITT Technical Institute-Knoxville"},{"institution":"ITT Technical Institute-Austin"},{"institution":"ITT Technical Institute-Houston North"},{"institution":"DeVry University\'s Keller Graduate School of Management-Arizona"},{"institution":"California State University-San Marcos"},{"institution":"Argosy University-Hawaii"},{"institution":"DeVry University\'s Keller Graduate School of Management-Missouri"},{"institution":"Baptist Theological Seminary at Richmond"},{"institution":"Kaplan College-Modesto"},{"institution":"Kaplan University-Des Moines Campus"},{"institution":"Hairmasters Institute of Cosmetology"},{"institution":"Hair Arts Academy"},{"institution":"Pinnacle Career Institute-Lawrence"},{"institution":"Interactive College of Technology-Newport"},{"institution":"Career Technical College-Monroe"},{"institution":"Empire Beauty School-Lowell"},{"institution":"Ross Medical Education Center-Taylor"},{"institution":"McNally Smith College of Music"},{"institution":"Allied Health Careers"},{"institution":"National Tractor Trailer School Inc-Liverpool"},{"institution":"Interactive Learning Systems-Houston"},{"institution":"Star Career Academy\ufffdBrick"},{"institution":"New Castle Beauty Academy"},{"institution":"NorthWest Arkansas Community College"},{"institution":"Madera Beauty College"},{"institution":"Colorado Heights University"},{"institution":"Brewster Technical Center"},{"institution":"Hodges University"},{"institution":"Everest University-Lakeland"},{"institution":"Argosy University-Atlanta"},{"institution":"University of St Augustine for Health Sciences"},{"institution":"Capital Area School of Practical Nursing"},{"institution":"Hair Professionals Career College"},{"institution":"Alexandria School of Scientific Therapeutics"},{"institution":"Empire Beauty School-Bloomfield"},{"institution":"Southwest Technology Center"},{"institution":"Western Area Career and Technology Center"},{"institution":"Daymar Institute-Clarksville"},{"institution":"Nossi College of Art"},{"institution":"Seguin Beauty School-New Braunfels"},{"institution":"ITT Technical Institute-Norfolk"},{"institution":"Pima Medical Institute-Seattle"},{"institution":"Mineral County Vocational Technical Center"},{"institution":"Hypnosis Motivation Institute"},{"institution":"Los Angeles ORT College-Los Angeles Campus"},{"institution":"Everest College-West Los Angeles"},{"institution":"Thanh Le College School of Cosmetology"},{"institution":"Southeastern Technical College"},{"institution":"Massachusetts School of Law"},{"institution":"ITT Technical Institute-Albuquerque"},{"institution":"Community Services Division-Alliance City"},{"institution":"Universal Technical Institute-Auto Motorcycle & Marine Mechanics Institute Division-Orlando"},{"institution":"D G Erwin Technical Center"},{"institution":"Rosel School of Cosmetology"},{"institution":"Worsham College of Mortuary Science"},{"institution":"Bryan University"},{"institution":"Oregon College of Oriental Medicine"},{"institution":"Central Pennsylvania Institute of Science and Technology"},{"institution":"Northwest Educational Center"},{"institution":"Sebring Career Schools-Houston"},{"institution":"PCI Health Training Center"},{"institution":"Windham Memorial Hospital-Radiologic Technology Program"},{"institution":"Bethel Seminary of the East"},{"institution":"Miami-Jacobs Career College-Columbus"},{"institution":"Bryant & Stratton College-Eastlake"},{"institution":"Hamrick School"},{"institution":"Alabama State College of Barber Styling"},{"institution":"Fortis College-Mobile"},{"institution":"Arkansas Beauty School"},{"institution":"Everest College-Ontario"},{"institution":"Downey Adult School"},{"institution":"Heald College-Stockton"},{"institution":"Heald College-Hayward"},{"institution":"CRU Institute"},{"institution":"Modern Technology School"},{"institution":"National Career Education"},{"institution":"Everest College-Anaheim"},{"institution":"Thuy Princess Beauty College"},{"institution":"North-West College-Glendale"},{"institution":"Everest College-City of Industry"},{"institution":"Fremont College"},{"institution":"Pomona Unified School District Adult and Career Education"},{"institution":"University of Phoenix-Online Campus"},{"institution":"University of Phoenix-San Diego Campus"},{"institution":"Universal College of Beauty Inc-Los Angeles 2"},{"institution":"IBMC College"},{"institution":"Xenon International Academy-Denver"},{"institution":"Academy of Cosmetology"},{"institution":"ITT Technical Institute-Lake Mary"},{"institution":"Sunstate Academy"},{"institution":"Heritage Institute-Jacksonville"},{"institution":"Fortis College-Smyrna"},{"institution":"Remington College-Honolulu Campus"},{"institution":"Vatterott College-Des Moines"},{"institution":"Brown Mackie College-Quad Cities"},{"institution":"ETI School of Skilled Trades"},{"institution":"Pivot Point Academy-Bloomingdale"},{"institution":"Xenon International Academy-Kansas City"},{"institution":"Baton Rouge College"},{"institution":"Diesel Driving Academy-Baton Rouge"},{"institution":"Jonesville Beauty School"},{"institution":"New England Hair Academy"},{"institution":"Rob Roy Academy-Worcester"},{"institution":"Upper Cape Cod Regional Technical School"},{"institution":"All-State Career-Baltimore"},{"institution":"New England School of Communications"},{"institution":"Everest Institute-Kalamazoo"},{"institution":"Adler Graduate School"},{"institution":"Lebanon Technology and Career Center"},{"institution":"Academy of Hair Design-Jackson"},{"institution":"KC\'s School of Hair Design"},{"institution":"Mitchells Hairstyling Academy-Goldsboro"},{"institution":"Lincoln Technical Institute-Moorestown"},{"institution":"Monmouth County Vocational School District"},{"institution":"Kaplan College-Las Vegas"},{"institution":"Beauty School of Middletown"},{"institution":"Bryant & Stratton College-Southtowns"},{"institution":"Continental School of Beauty Culture-Olean"},{"institution":"National Tractor Trailer School Inc-Buffalo"},{"institution":"Yeshiva Gedolah Imrei Yosef D\'spinka"},{"institution":"Cleveland Institute of Dental-Medical Assistants-Mentor"},{"institution":"Cleveland Institute of Dental-Medical Assistants-Lyndhurst"},{"institution":"Knox County Career Center"},{"institution":"Madison Adult Career Center"},{"institution":"Remington College-Cleveland Campus"},{"institution":"Brown Mackie College-Findlay"},{"institution":"Toledo Academy of Beauty Culture-East"},{"institution":"U S Grant Joint Vocational School"},{"institution":"CC\'s Cosmetology College"},{"institution":"Chisholm Trail Technology Center"},{"institution":"Gordon Cooper Technology Center"},{"institution":"Kiamichi Technology Center-Atoka"},{"institution":"Kiamichi Technology Center-Durant"},{"institution":"Kiamichi Technology Center-Hugo"},{"institution":"Kiamichi Technology Center-McAlester"},{"institution":"Kiamichi Technology Center-Idabel"},{"institution":"Kiamichi Technology Center-Poteau"},{"institution":"Kiamichi Technology Center-Spiro"},{"institution":"Kiamichi Technology Center-Talihina"},{"institution":"Le Cordon Bleu College of Culinary Arts-Portland"},{"institution":"YTI Career Institute-Altoona"},{"institution":"Eastern Center for Arts and Technology"},{"institution":"Empire Beauty School-Center City Philadelphia"},{"institution":"Oakbridge Academy of Arts"},{"institution":"Sanford-Brown Institute-Wilkins Township"},{"institution":"Centro de Estudios Multidisciplinarios-Humacao"},{"institution":"Colegio Mayor de Tecnologia Inc"},{"institution":"Institucion Chaviano de Mayaguez"},{"institution":"EDIC College"},{"institution":"Liceo de Arte-Dise-O y Comercio"},{"institution":"Universal Technology College of Puerto Rico"},{"institution":"Academy of Hair Technology"},{"institution":"Mr Wayne\'s School of Unisex Hair Design"},{"institution":"Southern Institute of Cosmetology"},{"institution":"Queen City College"},{"institution":"College of the Marshall Islands"},{"institution":"American National College"},{"institution":"ITT Technical Institute-San Antonio"},{"institution":"Remington College-Fort Worth Campus"},{"institution":"University of Cosmetology Arts & Sciences-San Antonio Jamar"},{"institution":"School of Automotive Machinists"},{"institution":"SW School of Business and Technical Careers-Cosmetology"},{"institution":"SW School of Business and Technical Careers"},{"institution":"Texas College of Cosmetology-Abilene"},{"institution":"Vista College-Online"},{"institution":"Centura College-Newport News"},{"institution":"Centura College-Norfolk"},{"institution":"Virginia Beach City Public Schools School of Practical Nursing"},{"institution":"Northwest College of Art & Design"},{"institution":"University of Washington-Bothell Campus"},{"institution":"University of Washington-Tacoma Campus"},{"institution":"Huntington School of Beauty Culture-Main Campus"},{"institution":"Valley College-Beckley"},{"institution":"Valley College-Martinsburg"},{"institution":"Valley College-Princeton"},{"institution":"Bellus Academy-Poway"},{"institution":"Capstone College"},{"institution":"Central Coast College"},{"institution":"ITT Technical Institute-Torrance"},{"institution":"Pacific College of Oriental Medicine-San Diego"},{"institution":"Artistic Nails and Beauty Academy-Tampa"},{"institution":"National Aviation Academy of Tampa Bay"},{"institution":"Sanford-Brown Institute-Tampa"},{"institution":"Cain\'s Barber College Inc"},{"institution":"Lawton Career Institute-Oak Park Campus"},{"institution":"Madison Oneida BOCES-Practical Nursing Program"},{"institution":"Astrodome Career Centers"},{"institution":"Center for Advanced Legal Studies"},{"institution":"Houston Training School-Main Campus"},{"institution":"Remington College-Houston Campus"},{"institution":"Bay Mills Community College"},{"institution":"Fond du Lac Tribal and Community College"},{"institution":"Northwest Indian College"},{"institution":"Marinello Schools of Beauty-Provo"},{"institution":"Provo College"},{"institution":"Paul Mitchell the School-Provo"},{"institution":"University of Phoenix-Utah Campus"},{"institution":"Utah College of Massage Therapy-Salt Lake City"},{"institution":"CET-Coachella"},{"institution":"CET-Oxnard"},{"institution":"CET-Santa Maria"},{"institution":"CET-Rancho Temecula"},{"institution":"Colorado School of Traditional Chinese Medicine"},{"institution":"Massage Therapy Institute of Colorado"},{"institution":"Michigan College of Beauty-Troy"},{"institution":"Ogle School Hair Skin Nails-Dallas"},{"institution":"Phoenix Seminary"},{"institution":"Faust Institute of Cosmetology-Spirit Lake"},{"institution":"Seattle Vocational Institute"},{"institution":"Baker College of Port Huron"},{"institution":"Empire Beauty School-Hyannis"},{"institution":"Brookstone College-Greensboro"},{"institution":"Cheeks International Academy of Beauty Culture-Fort Collins"},{"institution":"Cheeks International Academy of Beauty Culture-Greeley"},{"institution":"Colorado School of Healing Arts"},{"institution":"Remington College-Colorado Springs Campus"},{"institution":"Empire Beauty School-Arvada"},{"institution":"Westwood College-Denver South"},{"institution":"Kaplan College-Denver"},{"institution":"Healing Arts Institute"},{"institution":"ITT Technical Institute-San Bernardino"},{"institution":"Los Angeles ORT College-Van Nuys Campus"},{"institution":"Texas School of Business-Southwest"},{"institution":"University of Phoenix-Puerto Rico Campus"},{"institution":"Mt Diablo Adult Education"},{"institution":"Royale College of Beauty"},{"institution":"Westech College"},{"institution":"Greater Lowell Technical School"},{"institution":"Academy of Hair Design-Pearl"},{"institution":"King\'s College"},{"institution":"Miller-Motte Technical College-Clarksville"},{"institution":"Genesis Career College-Lebanon"},{"institution":"Kaplan College-Dallas"},{"institution":"Star College of Cosmetology 2"},{"institution":"Southwest Collegiate Institute for the Deaf"},{"institution":"Fortis College-Richmond"},{"institution":"Midwest College of Oriental Medicine-Racine"},{"institution":"Hacienda La Puente Adult Education"},{"institution":"La Belle Beauty Academy"},{"institution":"Advanced Technical Centers"},{"institution":"Hawaii Community College"},{"institution":"Regency Beauty Institute-Winston-Salem"},{"institution":"Robert Fiance Beauty Schools-North Plainfield"},{"institution":"Long Island Beauty School-Hauppauge"},{"institution":"Buckeye Joint Vocational School"},{"institution":"Sandusky Career Center"},{"institution":"Greater Altoona Career & Technology Center"},{"institution":"Northeastern Hospital School of Nursing"},{"institution":"Central Texas Beauty College-Temple"},{"institution":"Dance Theatre of Harlem Inc"},{"institution":"Erie 2 Chautauqua Cattaraugus BOCES-Practical Nursing Program"},{"institution":"Empire Beauty School-Brooklyn"},{"institution":"Houston Training School-Gulfgate"},{"institution":"Star Career Academy-Philadelphia"},{"institution":"Antonelli College-Hattiesburg"},{"institution":"Eastern New Mexico University-Ruidoso Campus"},{"institution":"Newbridge College-Santa Ana"},{"institution":"Kaplan College-Stockton"},{"institution":"The Bryman School of Arizona"},{"institution":"Beacon College"},{"institution":"Acupuncture and Integrative Medicine College-Berkeley"},{"institution":"Estrella Mountain Community College"},{"institution":"Heartland Community College"},{"institution":"University of the Potomac-Washington DC Campus"},{"institution":"Rabbi Jacob Joseph School"},{"institution":"Sanford-Brown Institute-Ft Lauderdale"},{"institution":"The Salon Professional Academy-Melbourne"},{"institution":"Fortis Institute-Scranton"},{"institution":"Milan Institute of Cosmetology-Amarillo"},{"institution":"Everglades University"},{"institution":"Seminar L\'moros Bais Yaakov"},{"institution":"Herzing University-Winter Park"},{"institution":"Coral Ridge Nurses Assistant Training School Inc"},{"institution":"Emil Fries Piano Hospital and Training Center"},{"institution":"Fairview Beauty Academy"},{"institution":"Florida College of Natural Health-Pompano Beach"},{"institution":"National College-Nashville"},{"institution":"College of Biblical Studies-Houston"},{"institution":"Inner State Beauty School"},{"institution":"Virginia College-Pensacola"},{"institution":"Mid-EastCTC-Adult Education"},{"institution":"Everest University-South Orlando"},{"institution":"Polaris Career Center"},{"institution":"P&A Scholars Beauty School"},{"institution":"Rensselaer BOCES-Practical Nursing Program"},{"institution":"ASM Beauty World Academy"},{"institution":"The Salter School-Tewksbury Campus"},{"institution":"Sanford-Brown College-Collinsville"},{"institution":"Sharps Academy of Hair Styling"},{"institution":"ICC Technical Institute"},{"institution":"College of Health Care Professions-Northwest"},{"institution":"School of Professional Horticulture at the New York Botanical Garden"},{"institution":"Fortis College-Houston"},{"institution":"Volunteer Beauty Academy-Madison"},{"institution":"Watkins College of Art Design & Film"},{"institution":"Chicago ORT Technical Institute"},{"institution":"Alhambra Beauty College"},{"institution":"American Auto Institute"},{"institution":"Asian American International Beauty College"},{"institution":"Avance Beauty College"},{"institution":"Colton-Redlands-Yucaipa Regional Occupational Program"},{"institution":"Copper Mountain Community College"},{"institution":"Diversified Vocational College"},{"institution":"Bristol University"},{"institution":"UEI College-Fresno"},{"institution":"Mt Sierra College"},{"institution":"Wyotech-Long Beach"},{"institution":"Santiago Canyon College"},{"institution":"Southern California Institute of Technology"},{"institution":"Soka University of America"},{"institution":"Summit College"},{"institution":"Advance Beauty College"},{"institution":"Career Colleges of America"},{"institution":"World Mission University"},{"institution":"Yo San University of Traditional Chinese Medicine"},{"institution":"Coast Career Institute"},{"institution":"Cannella School of Hair Design-Blue Island"},{"institution":"Delta College Inc"},{"institution":"Colorado Technical University-Sioux Falls"},{"institution":"Southwest University of Visual Arts-Albuquerque"},{"institution":"Tri-State Cosmetology Institute"},{"institution":"Widener University-Harrisburg Campus"},{"institution":"Volunteer Beauty Academy-System Office"},{"institution":"Volunteer Beauty Academy-Nashville"},{"institution":"Frontier Community College"},{"institution":"Lincoln Trail College"},{"institution":"Wabash Valley College"},{"institution":"American Institute of Interior Design"},{"institution":"Brookline College-Tempe"},{"institution":"Baker College of Auburn Hills"},{"institution":"Baker College of Clinton Township"},{"institution":"Inter American University of Puerto Rico-School of Optometry"},{"institution":"Schiller International University"},{"institution":"Vatterott College-Springfield"},{"institution":"Vatterott College-Joplin"},{"institution":"Vatterott College-Kansas City"},{"institution":"Coconino Community College"},{"institution":"University System of Maryland-Research Centers"},{"institution":"Sanford-Brown College-Houston"},{"institution":"Sanford-Brown Institute-Jacksonville"},{"institution":"Sanford-Brown College-Dallas"},{"institution":"Baker College of Cadillac"},{"institution":"Emma\'s Beauty Academy-Juana Diaz"},{"institution":"Franklin Academy"},{"institution":"Columbia Centro Universitario-Yauco"},{"institution":"Pima Medical Institute-Denver"},{"institution":"Fortis College-Miami"},{"institution":"ASA College"},{"institution":"Ohio State School of Cosmetology-Westerville"},{"institution":"Nationwide Beauty Academy"},{"institution":"Yeshivas Novominsk"},{"institution":"Southern Careers Institute-Corpus Christi"},{"institution":"Kiamichi Technology Center-Stigler"},{"institution":"Rabbinical College of Ohr Shimon Yisroel"},{"institution":"Carroll Community College"},{"institution":"University of Phoenix-Southern Arizona Campus"},{"institution":"University of Phoenix-Colorado Campus"},{"institution":"University of Phoenix-Albuquerque Campus"},{"institution":"University of Phoenix-Bay Area Campus"},{"institution":"University of Phoenix-Southern California Campus"},{"institution":"Galen College of Nursing-Tampa Bay"},{"institution":"Galen College of Nursing-San Antonio"},{"institution":"Southeastern Beauty School-Columbus North Lumpkin"},{"institution":"Southeastern Beauty School-Columbus Midtown"},{"institution":"Sarasota School of Massage Therapy"},{"institution":"Westwood College-Dupage"},{"institution":"Wright Career College"},{"institution":"Daymar College-Louisville"},{"institution":"Sanford-Brown College-Hazelwood"},{"institution":"Schuyler Steuben Chemung Tioga Allegany BOCES"},{"institution":"Delaware Chenango Madison Otsego BOCES-Practical Nursing Program"},{"institution":"DCI Career Institute"},{"institution":"Central Susquehanna Intermediate Unit LPN Career"},{"institution":"Myotherapy College of Utah"},{"institution":"Graham Webb International Academy of Hair"},{"institution":"City College-Gainesville"},{"institution":"Arizona State University-West"},{"institution":"Connecticut Center for Massage Therapy-Westport"},{"institution":"ITT Technical Institute-Jacksonville"},{"institution":"G Skin & Beauty Institute"},{"institution":"Cosmetology Training Center"},{"institution":"Stage One-The Hair School"},{"institution":"Empire Beauty School-Malden"},{"institution":"Minnesota School of Business-Brooklyn Center"},{"institution":"ITT Technical Institute-Omaha"},{"institution":"Omaha School of Massage and Healthcare of Herzing University"},{"institution":"Xenon International Academy-Omaha"},{"institution":"Capri Institute of Hair Design-Brick"},{"institution":"Capri Institute of Hair Design-Kenilworth"},{"institution":"Capri Institute of Hair Design-Paramus"},{"institution":"Orlo School of Hair Design and Cosmetology"},{"institution":"Delaware Area Career Center"},{"institution":"Eastland-Fairfield Career and Technical Schools"},{"institution":"Empire Beauty School-Cincinnati"},{"institution":"Mahoning County Career and Technical Center"},{"institution":"Ohio Hi Point Joint Vocational School District"},{"institution":"Pickaway Ross Joint Vocational School District"},{"institution":"Pioneer Career and Technology Center"},{"institution":"Raphael\'s School of Beauty Culture Inc-Boardman"},{"institution":"Scioto County Career Technical Center"},{"institution":"Trumbull Career & Technical Center"},{"institution":"Northwest Technology Center-Fairview"},{"institution":"Lake Erie College of Osteopathic Medicine"},{"institution":"University of Cosmetology Arts & Sciences-Harlingen"},{"institution":"Gene Juarez Academy of Beauty-Federal Way"},{"institution":"Empire Beauty School-Appleton"},{"institution":"Empire Beauty School-Green Bay"},{"institution":"Warren County Career Center"},{"institution":"Brown Mackie College-Fort Wayne"},{"institution":"Paul Mitchell the School-Wichita"},{"institution":"Pinnacle Institute of Cosmetology"},{"institution":"Career Training Academy-Monroeville"},{"institution":"Southern Careers Institute-Pharr"},{"institution":"Texas State Technical College-Marshall"},{"institution":"Florida National University-Main Campus"},{"institution":"Georgia Institute of Cosmetology"},{"institution":"Nouvelle Institute"},{"institution":"ITT Technical Institute-Fort Lauderdale"},{"institution":"Franklin Technology-MSSU"},{"institution":"Carson City Beauty Academy"},{"institution":"Professional Technical Institution Inc"},{"institution":"Erikson Institute"},{"institution":"South Texas College"},{"institution":"Tennessee Board of Regents"},{"institution":"Pike County Joint Vocational School District"},{"institution":"Lorain County Joint Vocational School District"},{"institution":"Roger Williams University School of Law"},{"institution":"Everest Institute-Kendall"},{"institution":"California State University-Monterey Bay"},{"institution":"Sanford-Brown College-St Peters"},{"institution":"Colorado Technical University-Kansas City"},{"institution":"Heald College-Salinas"},{"institution":"Academy of Somatic Healing Arts"},{"institution":"Heritage College-Oklahoma City"},{"institution":"Ann Arbor Institute of Massage Therapy"},{"institution":"Brown Mackie College-Atlanta"},{"institution":"Bryant & Stratton College-Henrietta"},{"institution":"The Art Institute of California-Argosy University Hollywood"},{"institution":"Sage College"},{"institution":"Anthem College-Denver"},{"institution":"Lincoln Technical Institute-Hartford"},{"institution":"Ohio Center for Broadcasting-Valley View"},{"institution":"EINE Inc"},{"institution":"Laurus Technical Institute"},{"institution":"Illinois School of Health Careers-Chicago Campus"},{"institution":"Marian Health Careers Center-Los Angeles Campus"},{"institution":"Cleveland Clinic Health System-School of Diagnostic Imaging"},{"institution":"National Institute of Massotherapy"},{"institution":"Academy for Nursing and Health Occupations"},{"institution":"Shawsheen Valley Regional Vocational Technical School"},{"institution":"Shear Ego International School of Hair Design"},{"institution":"Remington College-Memphis Campus"},{"institution":"Star Truck Driving School-Hickory Hills"},{"institution":"Fayette Institute of Technology"},{"institution":"Professional Beauty School"},{"institution":"Capella University"},{"institution":"College of Menominee Nation"},{"institution":"Leech Lake Tribal College"},{"institution":"Anthem College-Sacramento"},{"institution":"Southwest Acupuncture College-Albuquerque"},{"institution":"Crimson Technical College"},{"institution":"Stone Academy-Waterbury"},{"institution":"East San Gabriel Valley Regional Occupational Program"},{"institution":"Yukon Beauty College Inc"},{"institution":"ITT Technical Institute-Little Rock"},{"institution":"ITT Technical Institute-Oxnard"},{"institution":"ITT Technical Institute-Louisville"},{"institution":"ITT Technical Institute-Greenville"},{"institution":"ITT Technical Institute-Cordova"},{"institution":"Cairn University-Wisconsin Wilderness"},{"institution":"Toni & Guy Hairdressing Academy-Atlanta"},{"institution":"Mitchell\'s Hair Styling Academy-Raleigh"},{"institution":"Salon Academy"},{"institution":"Artistic Academy of Hair Design"},{"institution":"Motoring Technical Training Institute"},{"institution":"Baker College of Jackson"},{"institution":"Phagans Newport Academy of Cosmetology Careers"},{"institution":"Mech-Tech College"},{"institution":"Baldwin Beauty School-North Austin"},{"institution":"ITT Technical Institute-Everett"},{"institution":"Jean Madeline Aveda Institute"},{"institution":"Cosmetology Schools Inc"},{"institution":"ITT Technical Institute-Bessemer"},{"institution":"ITT Technical Institute-Orland Park"},{"institution":"Pacific College of Oriental Medicine-New York"},{"institution":"Baker College Center for Graduate Studies"},{"institution":"Johnson & Wales University-North Miami"},{"institution":"ITT Technical Institute-Pittsburgh"},{"institution":"Tricoci University of Beauty Culture-Indianapolis"},{"institution":"Trine University-Regional/Non-Traditional Campuses"},{"institution":"Pennsylvania Highlands Community College"},{"institution":"Nevada Career Institute"},{"institution":"Phillips Theological Seminary"},{"institution":"Empire Beauty School-Hanover"},{"institution":"Industrial Management Training Institute"},{"institution":"Faris Technical Institute Inc"},{"institution":"Four-D College"},{"institution":"Allen School-Jamaica"},{"institution":"Premiere Career College"},{"institution":"Tennessee Academy of Cosmetology-Stage Road"},{"institution":"The University of Texas MD Anderson Cancer Center"},{"institution":"University of Phoenix-Las Vegas Campus"},{"institution":"Carousel Beauty College-Springfield"},{"institution":"Carousel Beauty College-Kettering"},{"institution":"Paul Mitchell the School-Huntsville"},{"institution":"Estes Institute of Cosmetology Arts and Science"},{"institution":"Baldwin Park Adult & Community Education"},{"institution":"Ventura Adult and Continuing Education"},{"institution":"Marinello Schools of Beauty-Sacramento"},{"institution":"Albert I Prince Technical High School"},{"institution":"Bullard-Havens Technical High School"},{"institution":"Howell Cheney Technical High School"},{"institution":"W F Kaynor Technical High School"},{"institution":"Platt Technical High School"},{"institution":"College of Business and Technology-Kendall"},{"institution":"City College-Altamonte Springs"},{"institution":"Augusta Area Dietetic Internship-University Hospital"},{"institution":"Empire Beauty School-Dunwoody"},{"institution":"Michael\'s School of Beauty"},{"institution":"Cobb Beauty College Inc"},{"institution":"Career Center of Southern Illinois"},{"institution":"Xenon International Academy-Wichita"},{"institution":"Camelot College"},{"institution":"Mr Bernard\'s School of Hair Fashion Inc"},{"institution":"Hastings Beauty School"},{"institution":"Kirksville Area Technical Center"},{"institution":"South Central Career Center"},{"institution":"Saline County Career Center"},{"institution":"Warrensburg Area Career Center"},{"institution":"Nevada Regional Technical Center"},{"institution":"Cass Career Center"},{"institution":"Applied Technology Services"},{"institution":"Central College of Cosmetology"},{"institution":"Southeast Missouri Hospital College of Nursing and Health Sciences"},{"institution":"Dallas County Technical Center"},{"institution":"Messenger College"},{"institution":"Tennessee Academy of Cosmetology-Shelby Drive"},{"institution":"Cheveux School of Hair Design"},{"institution":"Durham Beauty Academy"},{"institution":"Union County Vocational Technical School"},{"institution":"Prism Career Institute-Philadelphia"},{"institution":"Clinton Essex Warren Washington BOCES-Practical Nursing Program"},{"institution":"Jefferson Lewis BOCES-Practical Nursing Program"},{"institution":"Rochester General Hospital School of Medical Technology"},{"institution":"Veeb Nassau County School of Practical Nursing"},{"institution":"Syracuse City Schools Practical Nursing Program"},{"institution":"Cattaraugus Allegany BOCES-Practical Nursing Program"},{"institution":"Orange Ulster BOCES-Practical Nursing Program"},{"institution":"Wayne Finger Lakes BOCES-Practical Nursing Program"},{"institution":"Broome Delaware Tioga BOCES-Practical Nursing Program"},{"institution":"Washington Saratoga Warren Hamilton Essex BOCES-Practical Nursing Program"},{"institution":"Albany BOCES-Adult Practical Nursing Program"},{"institution":"Ulster County BOCES-Practical Nursing Program"},{"institution":"Eastern Suffolk BOCES-Practical Nursing Program"},{"institution":"Rockland County BOCES-Practical Nursing Program"},{"institution":"New York College of Health Professions"},{"institution":"Career Institute of Health and Technology"},{"institution":"Charles Stuart School of Diamond Setting"},{"institution":"Penta County Joint Vocational School"},{"institution":"Career and Technology Education Centers of Licking County"},{"institution":"Willoughby-Eastlake School of Practical Nursing"},{"institution":"Washington County Career Center-Adult Technical Training"},{"institution":"Ohio Center for Broadcasting-Cincinnati"},{"institution":"Vantage Career Center"},{"institution":"Tri County Technology Center"},{"institution":"Indian Capital Technology Center-Muskogee"},{"institution":"Western Technology Center"},{"institution":"Mid-America Technology Center"},{"institution":"Northeast Technology Center-Pryor"},{"institution":"Eastern Oklahoma County Technology Center"},{"institution":"Wes Watkins Technology Center"},{"institution":"Technical Institute of Cosmetology Arts and Sciences"},{"institution":"York County School of Technology-Adult & Continuing Education"},{"institution":"Chester County Intermediate Unit"},{"institution":"Jefferson County Dubois Area Vocational Technical Practical Nursing Program"},{"institution":"Greater Johnstown Career and Technology Center"},{"institution":"Mifflin-Juniata Career and Technology Center"},{"institution":"Hanover Public School District Practical Nursing Program"},{"institution":"Lenape Technical School Practical Nursing Program"},{"institution":"Venango County Area Vocational Technical School"},{"institution":"Lancaster County Career and Technology Center"},{"institution":"Lebanon County Area Vocational Technical School"},{"institution":"Indiana County Technology Center"},{"institution":"Northern Tier Career Center"},{"institution":"Clarion County Career Center Practical Nursing Program"},{"institution":"Hazleton Area Career Center"},{"institution":"All-State Career School-Pittsburgh"},{"institution":"Carlos F Daniels Area Vocational School"},{"institution":"Serbias Technical College"},{"institution":"Colegio Tecnologico y Comercial de Puerto Rico"},{"institution":"Quality Technical and Beauty College"},{"institution":"D\'Mart Institute"},{"institution":"Automeca Technical College-Aguadilla"},{"institution":"Fortis Institute-Cookeville"},{"institution":"North Central Institute"},{"institution":"Pipo Academy of Hair Design"},{"institution":"Tint School of Makeup and Cosmetology-Dallas"},{"institution":"United Technical Center"},{"institution":"Charles H McCann Technical School"},{"institution":"Ailano School of Cosmetology"},{"institution":"Carsten Institute of Cosmetology"},{"institution":"Central California School"},{"institution":"Mercy Hospital School of Practical Nursing-Plantation General Hospital"},{"institution":"Marion County Community Technical and Adult Education Center"},{"institution":"Rivertown School of Beauty Barber Skin Care and Nails"},{"institution":"Atlanta Institute of Music"},{"institution":"Illinois Center for Broadcasting"},{"institution":"Marion Community Schools-Tucker Career & Technology Center"},{"institution":"St Louis Hair Academy"},{"institution":"New Dimensions School of Hair Design"},{"institution":"Adirondack Beauty School"},{"institution":"Forbes Road Career and Technology Center"},{"institution":"Jna Institute of Culinary Arts"},{"institution":"Cortiva Institute-Seattle"},{"institution":"Putnam Career and Technical Center"},{"institution":"Argosy University-Washington DC"},{"institution":"Crawford County Career and Technical Center Practical Nursing Program"},{"institution":"University of Phoenix-Sacramento Valley Campus"},{"institution":"DeVry University\'s Keller Graduate School of Management-Georgia"},{"institution":"Texas College of Cosmetology-San Angelo"},{"institution":"Beauty Schools of America-Hialeah"},{"institution":"Automeca Technical College-Bayamon"},{"institution":"Automeca Technical College-Caguas"},{"institution":"Automeca Technical College-Ponce"},{"institution":"Everest University-Melbourne"},{"institution":"Centura College-Chesapeake"},{"institution":"University of Phoenix-Hawaii Campus"},{"institution":"Florida College of Natural Health-Miami"},{"institution":"Prism Career Institute-Cherry Hill"},{"institution":"Amerian National College"},{"institution":"Francois D College of Hair Skin and Nails"},{"institution":"Southwest College of Naturopathic Medicine & Health Sciences"},{"institution":"Escuela de Peritos Electricistas de Isabela Inc"},{"institution":"Virginia College-Birmingham"},{"institution":"Virginia College-Huntsville"},{"institution":"Yeshiva D\'monsey Rabbinical College"},{"institution":"Lincoln Technical Institute-Mahwah"},{"institution":"Career Technical Institute"},{"institution":"Northwest Vista College"},{"institution":"ITT Technical Institute-Getzville"},{"institution":"Oconee Fall Line Technical College"},{"institution":"York County Community College"},{"institution":"Northeast Technology Center-Afton"},{"institution":"Western Suffolk BOCES"},{"institution":"Sanford-Brown College-Atlanta"},{"institution":"Sanford-Brown College-Middleburg Heights"},{"institution":"Arkansas State University-Mountain Home"},{"institution":"Columbia Gorge Community College"},{"institution":"Arizona State University-Polytechnic"},{"institution":"Colleen O\'Haras Beauty Academy"},{"institution":"Bakke Graduate University"},{"institution":"Tillamook Bay Community College"},{"institution":"Arizona Board of Regents"},{"institution":"Argosy University-Schaumburg"},{"institution":"DeVry University\'s Keller Graduate School of Management-California"},{"institution":"Manhattan School of Computer Technology"},{"institution":"University of Phoenix-Louisiana Campus"},{"institution":"University of Phoenix-Detroit Campus"},{"institution":"Brown Mackie College-Hopkinsville"},{"institution":"Indian Capital Technology Center-Sallisaw"},{"institution":"Indian Capital Technology Center-Stilwell"},{"institution":"Globelle Technical Institute"},{"institution":"Hairitage Hair Academy"},{"institution":"Houghton Lake Institute of Cosmetology"},{"institution":"Arizona College-Glendale"},{"institution":"Vanguard-Sentinel Adult Career and Technology Center"},{"institution":"House of Heavilin Beauty College-Raymore"},{"institution":"Living Arts College"},{"institution":"New York Conservatory for Dramatic Arts"},{"institution":"Eastern International College-Jersey City"},{"institution":"Academia Serrant Inc"},{"institution":"San Joaquin Valley College-Fresno Aviation"},{"institution":"Champion Institute of Cosmetology"},{"institution":"Pacific College"},{"institution":"American College of Healthcare"},{"institution":"Compu-Med Vocational Careers Corp"},{"institution":"Professional Electrical School Inc"},{"institution":"American Commercial College-Wichita Falls"},{"institution":"Midwestern University-Glendale"},{"institution":"Oregon Coast Community College"},{"institution":"Le Cordon Bleu College of Culinary Arts-Pasadena"},{"institution":"Gwinnett College-Sandy Springs"},{"institution":"Central Mass School of Massage and Therapy Inc"},{"institution":"Lincoln Technical Institute-Brockton"},{"institution":"Mildred Elley-Pittsfield Campus"},{"institution":"Embry-Riddle Aeronautical University-Worldwide"},{"institution":"Computer Systems Institute"},{"institution":"Merkaz Bnos-Business School"},{"institution":"Lia Schorr Institute of Cosmetic Skin Care Training"},{"institution":"ITT Technical Institute-Webster"},{"institution":"CET-Alexandria"},{"institution":"CET-Durham"},{"institution":"Aviation Institute of Maintenance-Chesapeake"},{"institution":"Centura College-Richmond Main"},{"institution":"Technical Education Center-Osceola"},{"institution":"Miami Ad School-Miami Beach"},{"institution":"Green Country Technology Center"},{"institution":"Nova College de Puerto Rico"},{"institution":"Styles and Profiles Beauty College"},{"institution":"John Wesley International Barber and Beauty College"},{"institution":"Platt College-Lawton"},{"institution":"Southeastern College-Greenacres"},{"institution":"Ottawa University-Milwaukee"},{"institution":"Argosy University-Tampa"},{"institution":"The Illinois Institute of Art-Schaumburg"},{"institution":"Star Truck Driving School-Bensenville"},{"institution":"Cambria-Rowe Business College-Indiana"},{"institution":"Facultad de Derecho Eugenio Maria de Hostos"},{"institution":"Klamath Community College"},{"institution":"San Bernardino Community College District"},{"institution":"The Art Institute of Phoenix"},{"institution":"Aerosim Flight Academy"},{"institution":"American College of Acupuncture and Oriental Med"},{"institution":"AOMA Graduate School of Integrative Medicine"},{"institution":"Arlington Medical Institute"},{"institution":"Urban College of Boston"},{"institution":"ITT Technical Institute-Henderson"},{"institution":"Anthem College-Minnesota"},{"institution":"Colorado Technical University-Greenwood Village"},{"institution":"Branford Hall Career Institute-Windsor Campus"},{"institution":"Heald College-Portland"},{"institution":"Golf Academy of America-Altamonte Springs"},{"institution":"Golf Academy of America-Phoenix"},{"institution":"Everest College-Merrillville"},{"institution":"Strayer University-Maryland"},{"institution":"Empire Beauty School-Bordentown"},{"institution":"Empire Beauty School-Monroeville"},{"institution":"Southern Careers Institute-San Antonio"},{"institution":"Virginia School of Massage"},{"institution":"ITT Technical Institute-Miami"},{"institution":"Cayce Reilly School of Massotherapy"},{"institution":"CET-Sacramento"},{"institution":"ITT Technical Institute-Harrisburg"},{"institution":"ITT Technical Institute-Tarentum"},{"institution":"ITT Technical Institute-Norwood"},{"institution":"ITT Technical Institute-Strongsville"},{"institution":"Prism Career Institute-West Atlantic City"},{"institution":"Everest Institute-Marietta"},{"institution":"The Creative Center"},{"institution":"Studio Jewelers"},{"institution":"Praxis Institute"},{"institution":"American College of Traditional Chinese Medicine"},{"institution":"Herndon Career Center"},{"institution":"San Juan Bautista School of Medicine"},{"institution":"Texas Health and Science University"},{"institution":"Carver Career Center"},{"institution":"New Hampshire Institute of Art"},{"institution":"StenoTech Career Institute-Fairfield"},{"institution":"Cayuga Onondaga BOCES-Practical Nursing Program"},{"institution":"Clearfield County Career and Technology Center"},{"institution":"Colegio de Cinematograf\ufffda Artes y Television"},{"institution":"Delaware County Technical School-Practical Nursing Program"},{"institution":"Everest College-Torrance"},{"institution":"The Institute for Health Education"},{"institution":"Mid-Del Technology Center"},{"institution":"BIR Training Center"},{"institution":"New York Institute of Massage Inc"},{"institution":"Jolie Hair and Beauty Academy-Ludlow"},{"institution":"Dutchess BOCES-Practical Nursing Program"},{"institution":"Escuela Tecnica de Electricidad"},{"institution":"Institute of Technology Inc"},{"institution":"Garnet Career Center"},{"institution":"Bristol Technical Education Center"},{"institution":"Genesee Valley BOCES-Practical Nursing Program"},{"institution":"Hamilton Fulton Montgomery BOCES-Practical Nursing Program"},{"institution":"Henrico County-Saint Marys Hospital School of Practical Nursing"},{"institution":"Herkimer County BOCES-Practical Nursing Program"},{"institution":"International Beauty College"},{"institution":"Dewey University-Hato Rey"},{"institution":"Cape Coral Institute of Technology"},{"institution":"Massachusetts General Hospital Dietetic Internship"},{"institution":"Mercy Hospital School of Nursing"},{"institution":"American Beauty Academy"},{"institution":"Northland Career Center"},{"institution":"Norwich Technical High School"},{"institution":"Ocean County Vocational-Technical School"},{"institution":"Putnam Westchester BOCES-Practical Nursing Program"},{"institution":"Sullivan County BOCES-Practical Nursing Program"},{"institution":"Kaplan College-San Antonio-Ingram"},{"institution":"Trinity College of Puerto Rico"},{"institution":"Virginia Sewing Machines and School Center"},{"institution":"Vogue Beauty and Barber School"},{"institution":"Yeshiva of the Telshe Alumni"},{"institution":"Northeast Technology Center-Kansas"},{"institution":"Kenneth Shuler School of Cosmetology-Rock Hill"},{"institution":"South Orange County Community College District"},{"institution":"DeVry College of New York"},{"institution":"DeVry University-Indiana"},{"institution":"University of Phoenix-Western Washington Campus"},{"institution":"University of Phoenix-Central Florida Campus"},{"institution":"University of Phoenix-Oregon Campus"},{"institution":"CET-El Paso"},{"institution":"Kaplan College-Riverside"},{"institution":"Appalachian School of Law"},{"institution":"LIU Hudson at Westchester"},{"institution":"Platt College-Ontario"},{"institution":"Delaware College of Art and Design"},{"institution":"The Art Institute of California-Argosy University Los Angeles"},{"institution":"American University of Health Sciences"},{"institution":"Career Networks Institute"},{"institution":"Monty Tech"},{"institution":"CHOICE High School and Technical Center"},{"institution":"Lincoln Technical Institute-Lincoln"},{"institution":"Wayne County Schools Career Center"},{"institution":"Blessing Hospital School of Medical Laboratory Technology"},{"institution":"Carolinas College of Health Sciences"},{"institution":"Lester E Cox Medical Center-School of Medical Technology"},{"institution":"Western Governors University"},{"institution":"Santa Barbara Business College-Ventura"},{"institution":"Sullivan and Cogliano Training Center"},{"institution":"Herzing University-Kenner"},{"institution":"Spencerian College-Lexington"},{"institution":"Florida Gulf Coast University"},{"institution":"Seacoast Career Schools-Sanford Campus"},{"institution":"Little Priest Tribal College"},{"institution":"National Labor College"},{"institution":"ITT Technical Institute-Richardson"},{"institution":"South Louisiana Community College"},{"institution":"HRDE-Stanley Technical Institute-Parkersburg"},{"institution":"Pima Medical Institute-Chula Vista"},{"institution":"Lincoln College of Technology-Marietta"},{"institution":"Academy of Hair Design-Lufkin"},{"institution":"Academy of Hair Design-Beaumont"},{"institution":"Baltimore School of Massage-Linthicum"},{"institution":"Charter College-Canyon Country"},{"institution":"Toni & Guy Hairdressing Academy-Worcester"},{"institution":"Northwest HVAC/R Training Center"},{"institution":"L T International Beauty School"},{"institution":"Michigan Jewish Institute"},{"institution":"Myotherapy Institute"},{"institution":"Florida College of Integrative Medicine"},{"institution":"New Professions Technical Institute"},{"institution":"Strand College of Hair Design"},{"institution":"Cosmetology Career Institute"},{"institution":"Branford Hall Career Institute-Southington Campus"},{"institution":"City College-Miami"},{"institution":"ITT Technical Institute-Arnold"},{"institution":"ITT Technical Institute-Oak Brook"},{"institution":"ITT Technical Institute-Albany"},{"institution":"ITT Technical Institute-Liverpool"},{"institution":"Ilisagvik College"},{"institution":"The Community College of Baltimore County"},{"institution":"Golf Academy of America-Myrtle Beach"},{"institution":"Florida Coastal School of Law"},{"institution":"White Earth Tribal and Community College"},{"institution":"Centura College-North Charleston"},{"institution":"Blue Cliff College-Metairie"},{"institution":"Creative Images Institute of Cosmetology-North Dayton"},{"institution":"Dewey University-Carolina"},{"institution":"Yeshiva College of the Nations Capital"},{"institution":"University of Phoenix-South Florida Campus"},{"institution":"University of Phoenix-North Florida Campus"},{"institution":"University of Phoenix-West Florida Campus"},{"institution":"University of Phoenix-Maryland Campus"},{"institution":"University of Phoenix-Oklahoma City Campus"},{"institution":"University of Phoenix-Tulsa Campus"},{"institution":"Louisiana State University Health Sciences Center-Shreveport"},{"institution":"Central Career Institute LLC"},{"institution":"Franklin Career Institute"},{"institution":"Montessori Institute of Milwaukee"},{"institution":"Hair Academy II"},{"institution":"Pryor Beauty College"},{"institution":"Argosy University-Phoenix"},{"institution":"Mr Leon\'s School of Hair Design-Lewiston"},{"institution":"Vatterott College-St Joseph"},{"institution":"Vatterott College-Sunset Hills"},{"institution":"Anthem College-Orlando"},{"institution":"Southwest Acupuncture College-Boulder"},{"institution":"Utah College of Massage Therapy-Utah Valley"},{"institution":"River Parishes Community College"},{"institution":"Watson School of Biological Sciences at Cold Spring Harbor Laboratory"},{"institution":"Los Angeles Film School"},{"institution":"Argosy University-Orange County"},{"institution":"Dewey University-Bayamon"},{"institution":"National American University-Bloomington"},{"institution":"A.B.I. School of Barbering & Cosmetology of Chelsea Inc."},{"institution":"Century College"},{"institution":"FINE Mortuary College"},{"institution":"International Baptist College and Seminary"},{"institution":"The Medical Arts School"},{"institution":"Fortis College-Foley"},{"institution":"Medical Training College"},{"institution":"Professional Training Centers"},{"institution":"Toni & Guy Hairdressing Academy-Carrollton"},{"institution":"University of Connecticut-Tri-Campus"},{"institution":"University of Connecticut-Avery Point"},{"institution":"University of Connecticut-Stamford"},{"institution":"ITT Technical Institute-Saint Rose"},{"institution":"ITT Technical Institute-Richmond"},{"institution":"Vatterott College-Oklahoma City"},{"institution":"University of Management and Technology"},{"institution":"Baton Rouge Community College"},{"institution":"ITT Technical Institute-Lathrop"},{"institution":"International Yacht Restoration School"},{"institution":"Linfield College-School of Nursing"},{"institution":"Linfield College-Adult Degree Program"},{"institution":"DeVry University\'s Keller Graduate School of Management-Virginia"},{"institution":"DeVry University\'s Keller Graduate School of Management-Wisconsin"},{"institution":"Academy of Massage Therapy"},{"institution":"Star Career Academy-Syosset"},{"institution":"Midwest Technical Institute-Springfield"},{"institution":"Advanced Barber College and Hair Design"},{"institution":"The College of Health Care Professions-Austin"},{"institution":"The English Center"},{"institution":"ICDC College"},{"institution":"Monteclaro Escuela de Hoteleria y Artes Culinarias"},{"institution":"New Community Workforce Development Center"},{"institution":"Dallas Nursing Institute"},{"institution":"Professional Golfers Career College"},{"institution":"Richmond School of Health and Technology"},{"institution":"Milan Institute-San Antonio Ingram"},{"institution":"Westwood College-Anaheim"},{"institution":"Rudae\'s School of Beauty Culture-Ft Wayne"},{"institution":"InterCoast Colleges-Burbank"},{"institution":"Carrington College California-Antioch"},{"institution":"Carrington College California-San Jose"},{"institution":"Lincoln Technical Institute-Cromwell"},{"institution":"Stevens-Henager College-Murray"},{"institution":"Brookline College-Tucson"},{"institution":"Everest Institute-Jonesboro"},{"institution":"McCann School of Business & Technology"},{"institution":"Carrington College California-Pleasant Hill"},{"institution":"Ridley-Lowell Business & Technical Institute-Poughkeepsie"},{"institution":"Florida College of Natural Health-Maitland"},{"institution":"Florida College of Natural Health-Bradenton"},{"institution":"Modern Hairstyling Institute-Carolina"},{"institution":"University of Phoenix-Southern Colorado Campus"},{"institution":"University of Phoenix-West Michigan Campus"},{"institution":"Stratford University"},{"institution":"Universal Technical Institute of California Inc"},{"institution":"American InterContinental University-Atlanta"},{"institution":"American InterContinental University-South Florida"},{"institution":"University of Phoenix-Philadelphia Campus"},{"institution":"University of Phoenix-Pittsburgh Campus"},{"institution":"Everest Institute-Decatur"},{"institution":"Everest College-Chesapeake"},{"institution":"Everest Institute-Greenspoint"},{"institution":"Rancho Santiago Community College District Office"},{"institution":"The Academy of Hair Design Six"},{"institution":"Eastern West Virginia Community and Technical College"},{"institution":"Aviation Institute of Maintenance-Indianapolis"},{"institution":"Branford Hall Career Institute-Springfield Campus"},{"institution":"Remington College-Little Rock Campus"},{"institution":"Newbridge College-San Diego East"},{"institution":"Everest University-Jacksonville"},{"institution":"IVAEM College"},{"institution":"Midwest College of Oriental Medicine-Chicago"},{"institution":"Lincoln Technical Institute-Hamden"},{"institution":"Argosy University-Seattle"},{"institution":"Carrington College-Spokane"},{"institution":"Texas School of Business-Friendswood"},{"institution":"ITT Technical Institute-Wilmington"},{"institution":"Pierce College at Puyallup"},{"institution":"Texas Tech University System Administration"},{"institution":"DeVry University-Florida"},{"institution":"Cascadia Community College"},{"institution":"University of Phoenix-St Louis Campus"},{"institution":"Johnson & Wales University-Denver"},{"institution":"University of Phoenix-Cleveland Campus"},{"institution":"Du Bois Business College-Huntingdon"},{"institution":"Du Bois Business College-Oil City"},{"institution":"DeVry University-Maryland"},{"institution":"CBD College"},{"institution":"East West College of Natural Medicine"},{"institution":"Infinity Career College"},{"institution":"Lincoln Technical Institute-Fern Park"},{"institution":"Atlantic Institute of Oriental Medicine"},{"institution":"ATS Institute of Technology"},{"institution":"Bennett Career Institute"},{"institution":"Blue Cliff College-Shreveport"},{"institution":"Blue Cliff College-Lafayette"},{"institution":"Quest College"},{"institution":"Central Florida Institute"},{"institution":"Community Care College"},{"institution":"Marinello Schools of Beauty-Topeka"},{"institution":"Crossroads Bible College"},{"institution":"Erie 1 BOCES"},{"institution":"Fayette Beauty Academy"},{"institution":"HDS Truck Driving Institute"},{"institution":"International Training Careers"},{"institution":"King\'s University"},{"institution":"Lacy Cosmetology School-Aiken"},{"institution":"Fortis College-Baton Rouge"},{"institution":"My Le\'s Beauty College"},{"institution":"New Concept Massage and Beauty School"},{"institution":"New York College of Traditional Chinese Medicine"},{"institution":"Fortis College-Orange Park"},{"institution":"Northeastern Seminary"},{"institution":"Bryan College-Gold River"},{"institution":"Omega Institute of Cosmetology"},{"institution":"Pacific Islands University"},{"institution":"PCI College"},{"institution":"Rosedale Bible College"},{"institution":"American Career College at St Francis"},{"institution":"Seattle Institute of Oriental Medicine"},{"institution":"Shawnee Beauty College"},{"institution":"Acupuncture and Massage College"},{"institution":"Southeastern School of Cosmetology"},{"institution":"Universal Therapeutic Massage Institute"},{"institution":"Upper Valley Educators Institute"},{"institution":"Keck Graduate Institute"},{"institution":"Aviation Institute of Maintenance-Atlanta"},{"institution":"National Beauty College"},{"institution":"Star Career Academy-Egg Harbor"},{"institution":"Empire Beauty School-Kennesaw"},{"institution":"Anthem Career College-Nashville"},{"institution":"Anthem College-Irving"},{"institution":"Antioch University-System Administration"},{"institution":"Westwood College-River Oaks"},{"institution":"ITT Technical Institute-Green Bay"},{"institution":"Career Training Academy-Pittsburgh"},{"institution":"Huntingdon County Career and Technology Center"},{"institution":"Missouri College of Cosmetology North"},{"institution":"New York Automotive and Diesel Institute"},{"institution":"Remington College-Baton Rouge Campus"},{"institution":"Everest College-Ontario Metro"},{"institution":"Kaplan College-Beaumont"},{"institution":"Kaplan College-Laredo"},{"institution":"The Art Institute of Washington"},{"institution":"Everest Institute-Dearborn"},{"institution":"Centura College-Richmond Westend"},{"institution":"New Saint Andrews College"},{"institution":"Arkansas State University-Newport"},{"institution":"Marlboro College-Graduate School"},{"institution":"University of Phoenix-Boston Campus"},{"institution":"University of Phoenix-Dallas Campus"},{"institution":"University of Phoenix-Houston Campus"},{"institution":"University of Phoenix-Milwaukee Campus"},{"institution":"University of Phoenix-Idaho Campus"},{"institution":"Westwood College-Inland Empire"},{"institution":"DeVry University-Virginia"},{"institution":"DeVry University-Washington"},{"institution":"DeVry University\'s Keller Graduate School of Management-Ohio"},{"institution":"DeVry University\'s Keller Graduate School of Management-Texas"},{"institution":"DeVry University-Colorado"},{"institution":"Louisiana Delta Community College"},{"institution":"ITT Technical Institute-Levittown"},{"institution":"Atenas College"},{"institution":"Southwest Skill Center-Campus of Estrella Mountain Community College"},{"institution":"Onondaga Cortland Madison BOCES"},{"institution":"National American University-Ellsworth AFB Extension"},{"institution":"National American University-Albuquerque West"},{"institution":"National American University-Brooklyn Center"},{"institution":"Interactive Learning Systems-Pasadena"},{"institution":"Pillar College"},{"institution":"Miami Ad School-Minneapolis"},{"institution":"Miami Ad School-San Francisco"},{"institution":"Oregon State University-Cascades Campus"},{"institution":"Milan Institute-Boise"},{"institution":"Milan Institute-Amarillo"},{"institution":"Vatterott College-Dividend"},{"institution":"Vatterott College-Tulsa"},{"institution":"Vatterott College-Wichita"},{"institution":"Star Career Academy-Newark"},{"institution":"Southern University Law Center"},{"institution":"International Academy of Design and Technology-Orlando"},{"institution":"Lincoln Technical Institute-Lowell"},{"institution":"Everest College-Vancouver Massage Therapy"},{"institution":"Texas Barber Colleges and Hairstyling Schools"},{"institution":"Everest Institute-Hobby"},{"institution":"Miller-Motte Technical College-North Charleston"},{"institution":"American Career College-Anaheim"},{"institution":"Saginaw Chippewa Tribal College"},{"institution":"Wyo Tech-Blairsville"},{"institution":"Richmont Graduate University"},{"institution":"The Seattle School of Theology & Psychology"},{"institution":"DeVry University\'s Keller Graduate School of Management-Washington"},{"institution":"Northwest College-Hillsboro"},{"institution":"San Diego State University-Imperial Valley Campus"},{"institution":"American Broadcasting School-Arlington"},{"institution":"Miami-Jacobs Career College-Sharonville"},{"institution":"East Valley Institute of Technology"},{"institution":"West Coast Ultrasound Institute"},{"institution":"Irell & Manella Graduate School of Biological Sciences at City of Hope"},{"institution":"Design\'s School of Cosmetology"},{"institution":"Paul Mitchell the School-Santa Barbara"},{"institution":"University of the Rockies"},{"institution":"Eli Whitney Technical High School"},{"institution":"Vinal Technical High School"},{"institution":"Windham Technical High School"},{"institution":"Harris School of Business-Wilmington Campus"},{"institution":"Ultimate Medical Academy-Clearwater"},{"institution":"Florida Barber Academy"},{"institution":"Jacksonville Beauty Institute"},{"institution":"M-DCPS The English Center"},{"institution":"Florida Education Institute"},{"institution":"Superior Career Institute"},{"institution":"Institute of Technical Arts"},{"institution":"National Graduate School of Quality Management"},{"institution":"Texas County Technical College"},{"institution":"Aviation Institute of Maintenance-Kansas City"},{"institution":"Blue Cliff College-Gulfport"},{"institution":"Apex School of Theology"},{"institution":"Institute for Therapeutic Massage"},{"institution":"Metropolitan Learning Institute"},{"institution":"Orleans Niagara BOCES-Practical Nursing Program"},{"institution":"Yeshiva Shaarei Torah of Rockland"},{"institution":"Leon Studio One School of Hair Design"},{"institution":"St Joseph\'s Medical Center School of Radiography"},{"institution":"American Institute of Alternative Medicine"},{"institution":"Brown Aveda Institute-Mentor"},{"institution":"Institute of Technology Inc"},{"institution":"Susquehanna County Career and Technology Center"},{"institution":"Centro de Capacitacion y Asesoramiento Vetelba"},{"institution":"Universidad Pentecostal Mizpa"},{"institution":"Caribbean Forensic and Technical College"},{"institution":"Concorde Career College-Grand Prairie"},{"institution":"Kussad Institute of Court Reporting"},{"institution":"Lamar Institute of Technology"},{"institution":"MJ\'s Beauty Academy Inc"},{"institution":"Aviation Institute of Maintenance-Dallas"},{"institution":"Healing Mountain Massage School"},{"institution":"Career Training Solutions"},{"institution":"Rudy & Kelly Academy of Hair and Nails"},{"institution":"South Branch Career and Technical Center"},{"institution":"Nevada State College"},{"institution":"Virginia College-Jackson"},{"institution":"Virginia College-Austin"},{"institution":"California State University-Channel Islands"},{"institution":"ITT Technical Institute-Springfield"},{"institution":"ITT Technical Institute-Chantilly"},{"institution":"The Art Institute of California-Argosy University Orange County"},{"institution":"Franklin W Olin College of Engineering"},{"institution":"Lincoln Technical Institute-Northeast Philadelphia"},{"institution":"Lincoln Technical Institute-Center City Philadelphia"},{"institution":"Won Institute of Graduate Studies"},{"institution":"Lincoln Technical Institute-Paramus"},{"institution":"Pima Medical Institute-Colorado Springs"},{"institution":"University of Phoenix-Kansas City Campus"},{"institution":"University of Phoenix-Atlanta Campus"},{"institution":"University of Phoenix-Chicago Campus"},{"institution":"University of Phoenix-Nashville Campus"},{"institution":"University of Phoenix-Northern Virginia Campus"},{"institution":"David\'s Academy of Beauty"},{"institution":"Birthwise Midwifery School"},{"institution":"Argosy University-Dallas"},{"institution":"Le Cordon Bleu College of Culinary Arts-Orlando"},{"institution":"Paul Mitchell the School-Costa Mesa"},{"institution":"Ave Maria School of Law"},{"institution":"Everest College-Arlington"},{"institution":"Tulsa Welding School-Jacksonville"},{"institution":"ITT Technical Institute-Canton"},{"institution":"ITT Technical Institute-Plymouth Meeting"},{"institution":"Pennsylvania College of Health Sciences"},{"institution":"DeVry University-North Carolina"},{"institution":"West Virginia Junior College-Bridgeport"},{"institution":"Antioch University-PhD Program in Leadership and Change"},{"institution":"Vatterott College-Cleveland"},{"institution":"St Louis College of Health Careers-Fenton"},{"institution":"Interactive College of Technology-Gainesville"},{"institution":"San Joaquin Valley College-Ontario"},{"institution":"Anthem Institute-Cherry Hill"},{"institution":"Westwood College-Ft Worth"},{"institution":"Westwood College-Dallas"},{"institution":"Alaska Christian College"},{"institution":"Grantham University"},{"institution":"Minnesota School of Business-Plymouth"},{"institution":"Carrington College-Albuquerque"},{"institution":"NASCAR Technical Institute"},{"institution":"Everest Institute-Tigard"},{"institution":"University of the Potomac-VA Campus"},{"institution":"Anthem Institute-Las Vegas"},{"institution":"Milan Institute-Palm Desert"},{"institution":"Stenotype Institute of Jacksonville Inc-Orlando"},{"institution":"National American University-Overland Park"},{"institution":"Everest Institute-Austin"},{"institution":"Everest College-Burr Ridge"},{"institution":"Medvance Institute-West Palm"},{"institution":"Tohono O\'Odham Community College"},{"institution":"Everest College-Dallas"},{"institution":"Edward Via College of Osteopathic Medicine"},{"institution":"The Salter School-Malden Campus"},{"institution":"DeVry University-Pennsylvania"},{"institution":"Pacific College of Oriental Medicine-Chicago"},{"institution":"Ronny J\'s Barber Styling"},{"institution":"Southwest Institute of Healing Arts"},{"institution":"InterCoast Colleges-Riverside"},{"institution":"Ottawa University-Jeffersonville"},{"institution":"University of Antelope Valley"},{"institution":"Birthingway College of Midwifery"},{"institution":"Blue Water College of Cosmetology Inc"},{"institution":"Pima Medical Institute-Albuquerque West"},{"institution":"Brighton Center\'s Center for Employment Training"},{"institution":"California Healing Arts College"},{"institution":"Dallas Barber & Stylist College"},{"institution":"NorthShore University HealthSystem School of Nurse Anesthesia"},{"institution":"Faith Evangelical College & Seminary"},{"institution":"Family of Faith College"},{"institution":"Hood Theological Seminary"},{"institution":"Colegio Educativo Tecnologico Industrial Inc"},{"institution":"International Technological University"},{"institution":"Irene\'s Myomassology Institute"},{"institution":"Jay\'s Technical Institute"},{"institution":"Mr John\'s School of Cosmetology Esthetics & Nails-Jacksonville"},{"institution":"NTMA Training Centers of Southern California"},{"institution":"P C Age-Jersey City"},{"institution":"P C Age-Edison"},{"institution":"American Institute-Margate"},{"institution":"South Florida Institute of Technology"},{"institution":"Southeastern Institute-Charleston"},{"institution":"Southeastern College-Jacksonville"},{"institution":"Toni & Guy Hairdressing Academy-Colorado Springs"},{"institution":"Trend Barber College"},{"institution":"Illinois CareerPath Institute"},{"institution":"Valley Grande Institute for Academic Studies"},{"institution":"West Coast University-Los Angeles"},{"institution":"Williamson Christian College"},{"institution":"International Barber & Style College"},{"institution":"Illinois Eastern Community College-System Office"},{"institution":"Triangle Tech Inc-Sunbury"},{"institution":"DigiPen Institute of Technology"},{"institution":"California College of Vocational Careers"},{"institution":"Fortis Institute-Fort Lauderdale"},{"institution":"University of Phoenix-Cincinnati Campus"},{"institution":"University of Phoenix-Wichita Campus"},{"institution":"University of Phoenix-Charlotte Campus"},{"institution":"Connecticut Center for Massage Therapy-Groton"},{"institution":"Pierpont Community and Technical College"},{"institution":"ITT Technical Institute-Duluth"},{"institution":"ITT Technical Institute-Hilliard"},{"institution":"University of Phoenix-Indianapolis Campus"},{"institution":"Career Institute of Health and Technology"},{"institution":"Dewey University-Hato Rey"},{"institution":"InterCoast Colleges-West Covina"},{"institution":"American College of Healthcare Sciences"},{"institution":"Texas School of Business-East"},{"institution":"Le Cordon Bleu College of Culinary Arts-Atlanta"},{"institution":"Colorado Media School"},{"institution":"Paul Mitchell the School-Rhode Island"},{"institution":"Miller-Motte Technical College-Chattanooga"},{"institution":"Milan Institute-Sparks"},{"institution":"Empire Beauty School-Framingham"},{"institution":"Westwood College-Chicago Loop"},{"institution":"Interactive Learning Systems-North Houston"},{"institution":"Bexley Hall Episcopal Seminary"},{"institution":"University of North Texas System"},{"institution":"Anthem College-Fenton"},{"institution":"Everest Institute-Norcross"},{"institution":"Strayer University-Tennessee"},{"institution":"Strayer University-Pennsylvania"},{"institution":"Kaplan College-Brownsville"},{"institution":"Kaplan College-Corpus Christi"},{"institution":"School of Health"},{"institution":"Everest College-Arlington"},{"institution":"University of Phoenix-Columbus Georgia Campus"},{"institution":"University of Phoenix-Memphis Campus"},{"institution":"University of Phoenix-Columbus Ohio Campus"},{"institution":"University of Phoenix-Little Rock Campus"},{"institution":"Toni & Guy Hairdressing Academy-Boise"},{"institution":"Charlie\'s Guard-Detective Bureau and Academy Inc"},{"institution":"PCI Academy-Plymouth"},{"institution":"DeVry University\'s Keller Graduate School of Management-Pennsylvania"},{"institution":"DeVry University-Nevada"},{"institution":"Everest College-Tacoma"},{"institution":"DeVry University-Oregon"},{"institution":"National University College-Rio Grande"},{"institution":"Creative Images Institute of Cosmetology-South Dayton"},{"institution":"Westwood College-Houston South"},{"institution":"Fortis Institute-Jacksonville"},{"institution":"Brookline College-Albuquerque"},{"institution":"Byzantine Catholic Seminary of Saints Cyril and Methodius"},{"institution":"Remington College-Cleveland West Campus"},{"institution":"Northcentral University"},{"institution":"Colorado Technical University-Online"},{"institution":"Baker College of Allen Park"},{"institution":"Bayamon Community College"},{"institution":"Harris School of Business-Dover Campus"},{"institution":"Folsom Lake College"},{"institution":"LeGrand Institute of Cosmetology Inc"},{"institution":"Everest Institute-Detroit"},{"institution":"Daymar Institute-Murfreesboro"},{"institution":"Cambridge Technical Institute"},{"institution":"Empire Beauty School-Midlothian"},{"institution":"Empire Beauty School-Owings Mills"},{"institution":"Empire Beauty School-West Mifflin"},{"institution":"Bold Beauty Academy"},{"institution":"ATI College-Norwalk"},{"institution":"Advance Science Institute"},{"institution":"Advanced College"},{"institution":"Advance Tech College"},{"institution":"Advanced Training Associates"},{"institution":"American Advanced Technicians Institute"},{"institution":"Anamarc College-El Paso Central"},{"institution":"Baptist University of the Americas"},{"institution":"The Beauty Institute"},{"institution":"Beis Medrash Heichal Dovid"},{"institution":"Bellefonte Academy of Beauty"},{"institution":"Blue Cliff Career College"},{"institution":"Career Beauty College"},{"institution":"Paul Mitchell the School-Gastonia"},{"institution":"CES College"},{"institution":"Computer Tutor Business and Technical Institute"},{"institution":"Court Reporting Institute of Louisiana"},{"institution":"Auguste Escoffier School of Culinary Arts-Austin"},{"institution":"Culinary Institute Inc"},{"institution":"Dade Medical College-Miami"},{"institution":"Escuela Hotelera de San Juan"},{"institution":"Expertise Cosmetology Institute"},{"institution":"Paul Mitchell the School-Monroe"},{"institution":"Healing Arts Institute"},{"institution":"Health Works Institute"},{"institution":"In Session Arts of Cosmetology Beauty School"},{"institution":"Moore Career College"},{"institution":"Industrial Technical College"},{"institution":"Institute of Beauty Occupation and Technology Course"},{"institution":"Institute of Clinical Acupuncture & Oriental Med"},{"institution":"Institute of Hair Design"},{"institution":"MedTech Institute-Atlanta Campus"},{"institution":"Jones International University"},{"institution":"Leston College"},{"institution":"Lynndale Fundamentals of Beauty School"},{"institution":"Medical Professional Institute"},{"institution":"New Life Theological Seminary"},{"institution":"Nightingale College"},{"institution":"Omnitech Institute"},{"institution":"PITC Institute"},{"institution":"Skinworks School of Advanced Skincare"},{"institution":"Southeastern Institute-Columbia"},{"institution":"Technical Learning Centers Inc"},{"institution":"Total Look School of Cosmetology & Massage Therapy"},{"institution":"The Art Institute of Tucson"},{"institution":"Turning Point Beauty College"},{"institution":"Unitech Training Academy-Lafayette"},{"institution":"Mountwest Community and Technical College"},{"institution":"Centura College-Columbia"},{"institution":"Flagler College-Tallahassee"},{"institution":"Kanawha Valley Community and Technical College"},{"institution":"American InterContinental University-Online"},{"institution":"Westwood College-Atlanta Midtown"},{"institution":"ITT Technical Institute-Eden Prairie"},{"institution":"Virginia College-Mobile"},{"institution":"Le Cordon Bleu College of Culinary Arts-Las Vegas"},{"institution":"International Academy of Design and Technology-Troy"},{"institution":"American InterContinental University-Houston"},{"institution":"Sanford-Brown College-Houston North Loop"},{"institution":"University of California-Merced"},{"institution":"Everest College-Fort Worth"},{"institution":"Remington College-North Houston Campus"},{"institution":"Paul Mitchell the School-Orlando"},{"institution":"Regency Beauty Institute-Maplewood"},{"institution":"Pima Medical Institute-Las Vegas"},{"institution":"Remington College-Nashville Campus"},{"institution":"Platt College-North OKC"},{"institution":"Central Methodist University-College of Graduate and Extended Studies"},{"institution":"Westwood College-Northlake"},{"institution":"University of Phoenix-Jersey City Campus"},{"institution":"University of Phoenix-Minneapolis St Paul Campus"},{"institution":"Kaplan College-Fort Worth"},{"institution":"Kaplan College-Midland"},{"institution":"Kaplan College-Lubbock"},{"institution":"Carrington College California-Emeryville"},{"institution":"North-West College-Riverside"},{"institution":"Everest Institute-Chelsea"},{"institution":"Everest Institute-Eagan"},{"institution":"University of Phoenix-Louisville Campus"},{"institution":"DeVry University-Minnesota"},{"institution":"Kaplan University-Council Bluffs Campus"},{"institution":"Everest University-Orange Park"},{"institution":"Wyotech-West Sacramento"},{"institution":"Everest Institute-Bissonnet"},{"institution":"Everest College-McLean"},{"institution":"Colegio Tecnico de Electricidad Galloza"},{"institution":"Empire Beauty School-St Paul"},{"institution":"Arthur\'s Beauty School Inc-Pine Bluff"},{"institution":"Arthur\'s Beauty School Inc-Conway"},{"institution":"Vatterott College-St Charles"},{"institution":"Anthem Institute-North Brunswick"},{"institution":"Anthem Career College-Memphis"},{"institution":"Anthem College-Kansas City"},{"institution":"Spa Tech Institute-Ipswich"},{"institution":"Spa Tech Institute-Westboro"},{"institution":"Spa Tech Institute-Plymouth"},{"institution":"Milan Institute of Cosmetology-San Antonio Walzem"},{"institution":"Bridgemont Community and Technical College"},{"institution":"Wards Corner Beauty Academy-Virginia Beach"},{"institution":"Neumont University"},{"institution":"Johnson & Wales University-Charlotte"},{"institution":"University of Phoenix-Central Valley Campus"},{"institution":"L\'Ecole Culinaire-St Louis"},{"institution":"Roseman University of Health Sciences"},{"institution":"Fortis Institute-Port Saint Lucie"},{"institution":"Fortis Institute-Miami"},{"institution":"Aviation Institute of Maintenance-Manassas"},{"institution":"Everest College-North Aurora"},{"institution":"Cosmetology School of Arts and Sciences"},{"institution":"Universal Technical Institute of Pennsylvania Inc"},{"institution":"Heritage College-Kansas City"},{"institution":"Kenneth Shuler School of Cosmetology-Spartanburg"},{"institution":"Kenneth Shuler School of Cosmetology-Columbia"},{"institution":"Institute for the Psychological Sciences"},{"institution":"Pivot Point Academy-Chicago"},{"institution":"Lincoln Technical Institute-Shelton"},{"institution":"Minnesota School of Business-Waite Park"},{"institution":"Minnesota School of Business-Shakopee"},{"institution":"Northwest Career College"},{"institution":"Soma Institute-The National School of Clinical Massage Therapy"},{"institution":"Xtreme Career Institute"},{"institution":"Marinello Schools of Beauty-Niantic"},{"institution":"American Academy of Acupuncture and Oriental Medicine"},{"institution":"Arizona School of Acupuncture and Oriental Medicine"},{"institution":"Ave Maria University"},{"institution":"Blue Sky School of Professional Massage and Therapeutic Bodywork"},{"institution":"Buchanan Beauty College"},{"institution":"CALC Institute of Technology"},{"institution":"Cambridge Junior College-Yuba City"},{"institution":"Cambridge Institute of Allied Health & Technology"},{"institution":"Career Care Institute"},{"institution":"ATA Career Education"},{"institution":"Career Quest Learning Centers-Lansing"},{"institution":"Central State Massage Academy"},{"institution":"Community Christian College"},{"institution":"Crossett School of Cosmetology"},{"institution":"Culpeper Cosmetology Training Center"},{"institution":"Day Spa Career College"},{"institution":"Eastern School of Acupuncture and Traditional Medicine"},{"institution":"Ecclesia College"},{"institution":"Employment Solutions-College for Technical Education"},{"institution":"European Massage Therapy School-Skokie"},{"institution":"Evergreen Beauty and Barber College-Everett"},{"institution":"Paul Mitchell the School-Great Lakes"},{"institution":"Healthcare Training Institute"},{"institution":"John D Rockefeller IV Career Center"},{"institution":"Ladera Career Paths Training Centers"},{"institution":"Los Angeles Music Academy"},{"institution":"Maple Springs Baptist Bible College and Seminary"},{"institution":"MCI Institute of Technology"},{"institution":"Oregon Career & Technology Center"},{"institution":"Performance Training Institute"},{"institution":"Pacific Coast Trade School"},{"institution":"Centura Institute"},{"institution":"Precision Manufacturing Institute"},{"institution":"Professional Massage Training Center"},{"institution":"Regency School of Hair Design"},{"institution":"Renaissance College-Massage Program"},{"institution":"Rosslyn Training Academy of Cosmetology"},{"institution":"SAE Institute of Technology-Nashville"},{"institution":"eClips School of Cosmetology and Barbering"},{"institution":"Shear Academy"},{"institution":"Southern Technical College"},{"institution":"Stanbridge College"},{"institution":"Styletrends Barber and Hairstyling Academy"},{"institution":"Universal Career School"},{"institution":"Universal College of Healing Arts"},{"institution":"Uta Mesivta of Kiryas Joel"},{"institution":"W L Bonner College"},{"institution":"Harrisburg University of Science and Technology"},{"institution":"The Art Institute of Ohio-Cincinnati"},{"institution":"Stevens-Henager College-Logan"},{"institution":"University of Phoenix-Cheyenne Campus"},{"institution":"University of Phoenix-Springfield  Campus"},{"institution":"University of Phoenix-Des Moines Campus"},{"institution":"University of Phoenix-San Antonio Campus"},{"institution":"University of Phoenix-Austin Campus"},{"institution":"University of Phoenix-Richmond-Virginia Beach Campus"},{"institution":"University of Phoenix-Raleigh Campus"},{"institution":"Blue Ridge Community and Technical College"},{"institution":"Lincoln Technical Institute-Suffield"},{"institution":"International Academy of Design and Technology-Henderson"},{"institution":"International Academy of Design and Technology-Seattle"},{"institution":"International Academy of Design and Technology-Nashville"},{"institution":"Le Cordon Bleu College of Culinary Arts-Miami"},{"institution":"Le Cordon Bleu College of Culinary Arts-Minneapolis"},{"institution":"Anthem College-Portland"},{"institution":"Career Technical College-Shreveport"},{"institution":"ITT Technical Institute-Kansas City"},{"institution":"ITT Technical Institute-Kennesaw"},{"institution":"ITT Technical Institute-Owings Mills"},{"institution":"ITT Technical Institute-Warrensville Heights"},{"institution":"Union Graduate College"},{"institution":"Colorado State University-System Office"},{"institution":"Chambersburg Beauty School"},{"institution":"Daytona College"},{"institution":"Delta Technical College"},{"institution":"United States University"},{"institution":"Westwood College-Arlington Ballston"},{"institution":"Kaplan College-Bakersfield"},{"institution":"Kaplan College-Fresno"},{"institution":"Empire Beauty School-Avondale"},{"institution":"Empire Beauty School-North Tucson"},{"institution":"Empire Beauty School-Littleton"},{"institution":"Empire Beauty School-Aurora"},{"institution":"Everest Institute-Gahanna"},{"institution":"Everest College-Merrionette Park"},{"institution":"Everest College-Earth City"},{"institution":"Everest College-Mesa"},{"institution":"Everest Institute-Silver Spring"},{"institution":"Alvareitas College of Cosmetology-Belleville"},{"institution":"AmeriTech College-Draper"},{"institution":"Argosy University-Los Angeles"},{"institution":"Brown Mackie College-Miami"},{"institution":"Regency Beauty Institute-Darien"},{"institution":"Regency Beauty Institute-Aurora"},{"institution":"Regency Beauty Institute-Madison"},{"institution":"Regency Beauty Institute-Ridgedale"},{"institution":"San Joaquin Valley College-Modesto"},{"institution":"Fortis College-Largo"},{"institution":"Platt College-Moore"},{"institution":"Platt College-Dallas"},{"institution":"Universal Technical Institute of Massachusetts Inc"},{"institution":"Eagle Gate College-Layton"},{"institution":"Carsten Institute of Cosmetology"},{"institution":"Academy of Hair Design-Jasper"},{"institution":"Expression College for Digital Arts"},{"institution":"Unitech Training Academy-West Monroe"},{"institution":"Daymar College-Bellevue"},{"institution":"DeVry University-Oklahoma"},{"institution":"Salter School-Fall River"},{"institution":"Seacoast Career School-Manchester Campus"},{"institution":"Instituto de Educacion Tecnica Ocupacional La Reine-Aguadilla"},{"institution":"New River Community and Technical College"},{"institution":"The College of Health Care Professions-Southwest Houston"},{"institution":"Eagle Gate College-Salt Lake City"},{"institution":"Kaplan College-Palm Springs"},{"institution":"University of Phoenix-Savannah Campus"},{"institution":"University of Phoenix-Northern Nevada Campus"},{"institution":"Minnesota School of Business-Rochester"},{"institution":"Georgia Gwinnett College"},{"institution":"Phoenix Institute of Herbal Medicine & Acupuncture"},{"institution":"Tucson College of Beauty"},{"institution":"California Career College"},{"institution":"Palladium Technical Academy"},{"institution":"Palace Beauty College"},{"institution":"National Polytechnic College"},{"institution":"American Career College-Ontario"},{"institution":"Asher College"},{"institution":"American Institute of Massage Therapy"},{"institution":"University of East-West Medicine"},{"institution":"Blake Austin College"},{"institution":"Mojave Barber College"},{"institution":"Aviator College of Aeronautical Science and Technology"},{"institution":"Total International Career Institute"},{"institution":"Trendsetters School of Beauty & Barbering"},{"institution":"CDA Technical Institute"},{"institution":"American Institute of Beauty"},{"institution":"North Florida Cosmetology Institute Inc"},{"institution":"Florida Academy of Health & Beauty"},{"institution":"Augusta School of Massage"},{"institution":"ATA College"},{"institution":"SUM Bible College and Theological Seminary"},{"institution":"Compass Career College"},{"institution":"Hair Expressions Academy"},{"institution":"Nuvo College of Cosmetology"},{"institution":"WellSpring School of Allied Health-Kansas City"},{"institution":"Hair Academy 110"},{"institution":"Healing Touch Career College"},{"institution":"The Salon Professional Academy-Fargo"},{"institution":"Massage Therapy Trainining Institute"},{"institution":"Institute of Professional Careers"},{"institution":"Elite Academy of Beauty Arts"},{"institution":"Aveda Institute-New York"},{"institution":"Brookline College-Oklahoma City"},{"institution":"Northwest Regional Technology Institute"},{"institution":"National Massage Therapy Institute"},{"institution":"MyrAngel Beauty Institute"},{"institution":"Institute of Hair Design"},{"institution":"Tennessee Career Institute"},{"institution":"Texas Health School"},{"institution":"Mai-trix Beauty College"},{"institution":"North West Beauty School"},{"institution":"Maximum Style Tec School of Cosmetology"},{"institution":"Careers Unlimited"},{"institution":"Mountainland Applied Technology College"},{"institution":"Avi Career Training"},{"institution":"Yakima Beauty School"},{"institution":"Mountain State School of Massage"},{"institution":"Doane College-Lincoln Grand Island and Master"},{"institution":"Shorter University-College of Adult & Professional Programs"},{"institution":"Arkansas State University-System Office"},{"institution":"The Art Institute of Indianapolis"},{"institution":"Eastern International College-Belleville"},{"institution":"San Joaquin Valley College-Rancho Cordova"},{"institution":"San Joaquin Valley College-Central Administrative Office"},{"institution":"Illinois School of Health Careers-O\'Hare Campus"},{"institution":"MedTech College"},{"institution":"Broken Arrow Beauty College-Tulsa"},{"institution":"Universal Technical Institute of Northern California Inc"},{"institution":"ITT Technical Institute-Charlotte South"},{"institution":"ITT Technical Institute-Clovis"},{"institution":"ITT Technical Institute-Dunmore"},{"institution":"ITT Technical Institute-Swartz Creek"},{"institution":"ITT Technical Institute-Lexington"},{"institution":"ITT Technical Institute-Maumee"},{"institution":"ITT Technical Institute-Oklahoma City"},{"institution":"ITT Technical Institute-Tulsa"},{"institution":"University of Phoenix-Omaha Campus"},{"institution":"University of Phoenix-Northwest Arkansas Campus"},{"institution":"University of Phoenix-Madison Campus"},{"institution":"University of Phoenix-Columbia Campus"},{"institution":"The Art Institute of California-Argosy University Inland Empire"},{"institution":"National American University-Zona Rosa"},{"institution":"West Hills College-Lemoore"},{"institution":"Stautzenberger College-Brecksville"},{"institution":"Stone Academy-East Hartford"},{"institution":"Westwood College-Annandale"},{"institution":"West Hills Community College District"},{"institution":"Unitech Training Academy-Houma"},{"institution":"Kaplan College-Milwaukee"},{"institution":"Miller-Motte Technical College-Madison"},{"institution":"Rasmussen College-Illinois"},{"institution":"International Institute for Restorative Practices"},{"institution":"Educational Technical College-Recinto de Coamo"},{"institution":"Educational Technical College-Recinto de san Sebastian"},{"institution":"Argosy University-Denver"},{"institution":"College America-Colorado Springs"},{"institution":"College America-Fort Collins"},{"institution":"Automotive Training Center-Warminster"},{"institution":"Sanford-Brown College-West Allis"},{"institution":"Empire Beauty School-Milwaukee"},{"institution":"The Robert B Miller College"},{"institution":"University of Phoenix-Fairfield County Campus"},{"institution":"University of Phoenix-Harrisburg Campus"},{"institution":"University of South Florida-St Petersburg"},{"institution":"Triangle Tech Inc-Bethlehem"},{"institution":"DeVry University-Utah"},{"institution":"Arizona State University-Downtown Phoenix"},{"institution":"Milan Institute-Clovis"},{"institution":"Branford Hall Career Institute-Albany Campus"},{"institution":"Harris School of Business-Linwood Campus"},{"institution":"The Art Institute of Tennessee-Nashville"},{"institution":"Strayer University-Florida"},{"institution":"Pima Medical Institute-Renton"},{"institution":"College of Business and Technology-Flagler"},{"institution":"College of Business and Technology-Hialeah"},{"institution":"Miller-Motte College-Cary"},{"institution":"Miami-Jacobs Career College-Springboro"},{"institution":"Dewey University-Juana D\ufffdaz"},{"institution":"Dewey University-Fajardo"},{"institution":"Dewey University-Arroyo"},{"institution":"Regency Beauty Institute-Independence"},{"institution":"Regency Beauty Institute-St Peters"},{"institution":"Regency Beauty Institute-Peoria"},{"institution":"Regency Beauty Institute-Greenwood"},{"institution":"Regency Beauty Institute-Mehlville"},{"institution":"Regency Beauty Institute-Duluth"},{"institution":"Regency Beauty Institute-Fairview Heights"},{"institution":"Regency Beauty Institute-Champaign"},{"institution":"Regency Beauty Institute-Olathe"},{"institution":"The College of Health Care Professions-San Antonio"},{"institution":"Everest Institute-South Plainfield"},{"institution":"Kaplan Career Institute-Detroit"},{"institution":"Daymar College-Madisonville"},{"institution":"Brittany Beauty School"},{"institution":"Lincoln Technical Institute-Whitestone"},{"institution":"American Public University System"},{"institution":"Huntsville Bible College"},{"institution":"Beaumont Adult School"},{"institution":"Make-up Designory"},{"institution":"Video Symphony EnterTraining Inc"},{"institution":"Gnomon School of Visual Effects"},{"institution":"Coachella Valley Beauty College"},{"institution":"Career College of California"},{"institution":"Valley College of Medical Careers"},{"institution":"Academy of Natural Therapy Inc"},{"institution":"Academy Di Capelli-School of Cosmetology"},{"institution":"Delaware Learning Institute of Cosmetology"},{"institution":"Dragon Rises College of Oriental Medicine"},{"institution":"Palm Beach Academy of Health & Beauty"},{"institution":"SABER College"},{"institution":"Taylor College"},{"institution":"Pensacola School of Massage Therapy & Health Careers"},{"institution":"Hawaii College of Oriental Medicine"},{"institution":"Ideal Beauty Academy"},{"institution":"Success Schools"},{"institution":"Louisiana Culinary Institute"},{"institution":"Bais Medrash Toras Chesed"},{"institution":"Center for Natural Wellness School of Massage Therapy"},{"institution":"Ace Computer Training Center"},{"institution":"New Age Training"},{"institution":"Dayton School of Medical Massage"},{"institution":"Northcoast Medical Training Academy"},{"institution":"American Institute of Medical Technology"},{"institution":"Carib Technological Institute"},{"institution":"Visible Music College"},{"institution":"CCI Training Center-Arlington"},{"institution":"Champion Beauty College"},{"institution":"Professional Careers Institute"},{"institution":"Southeast Texas Career Institute"},{"institution":"Southwest Applied Technology Center"},{"institution":"Academy of Cosmetology"},{"institution":"Milwaukee Career College"},{"institution":"University of the West"},{"institution":"American College of Education"},{"institution":"South University-Tampa"},{"institution":"Milan Institute of Cosmetology-San Antonio Military"},{"institution":"Appalachian College of Pharmacy"},{"institution":"Averett University-Non-Traditional Programs"},{"institution":"Paul Mitchell the School-Tampa"},{"institution":"Paul Mitchell the School-San Diego"},{"institution":"Paul Mitchell the School-Michigan"},{"institution":"Paul Mitchell the School-Sherman Oaks"},{"institution":"Paul Mitchell the School-Mclean"},{"institution":"Miami-Jacobs Career College-Troy"},{"institution":"ATI College-Santa Ana"},{"institution":"Blue Cliff College-Houma"},{"institution":"The Art Institute of Salt Lake City"},{"institution":"Fortis College-Columbus"},{"institution":"Fortis College-Cincinnati"},{"institution":"Fortis Institute-Baltimore"},{"institution":"The Art Institute of Charleston"},{"institution":"The Art Institute of California-Argosy University Sacramento"},{"institution":"Blue Cliff College-Fayetteville"},{"institution":"Blue Cliff College-Alexandria"},{"institution":"StenoTech Career Institute-Piscataway"},{"institution":"Anthem College-Brookfield"},{"institution":"Ultimate Medical Academy-Tampa"},{"institution":"Beauty Schools of America-North Miami Beach"},{"institution":"Virginia College-Biloxi"},{"institution":"ITT Technical Institute-St Petersburg"},{"institution":"ITT Technical Institute-Baton Rouge"},{"institution":"ITT Technical Institute-Columbia"},{"institution":"ITT Technical Institute-Wichita"},{"institution":"ITT Technical Institute-Atlanta"},{"institution":"ITT Technical Institute-Mobile"},{"institution":"ITT Technical Institute-Chattanooga"},{"institution":"ITT Technical Institute-South Bend"},{"institution":"Virginia College-School of Business and Health-Chattanooga"},{"institution":"Strayer University-Delaware"},{"institution":"Brite Divinity School"},{"institution":"Strayer University-Alabama"},{"institution":"Brown Aveda Institute-Rocky River"},{"institution":"Clary Sage College"},{"institution":"Broadview University-Layton"},{"institution":"International Academy of Design and Technology-Sacramento"},{"institution":"University of Phoenix-Birmingham Campus"},{"institution":"International Academy of Design and Technology-San Antonio"},{"institution":"University of Phoenix-Augusta Campus"},{"institution":"University of Phoenix-Washington DC Campus"},{"institution":"University of Phoenix-Chattanooga Campus"},{"institution":"DeVry University-Michigan"},{"institution":"DeVry University-Tennessee"},{"institution":"Argosy University-Inland Empire"},{"institution":"Argosy University-Nashville"},{"institution":"Argosy University-San Diego"},{"institution":"Rasmussen College-Wisconsin"},{"institution":"Empire Beauty School-Lisle"},{"institution":"Empire Beauty School-Richmond"},{"institution":"Empire Beauty School-North Hills"},{"institution":"Empire Beauty School-Concord"},{"institution":"Empire Beauty School-Arlington Heights"},{"institution":"Lexington Healing Arts Academy"},{"institution":"Empire Beauty School-Hooksett"},{"institution":"The Institute of Beauty and Wellness"},{"institution":"InterCoast Colleges-Carson"},{"institution":"InterCoast Career Institute-South Portland"},{"institution":"Carrington College California-Stockton"},{"institution":"Carrington College California-Citrus Heights"},{"institution":"Euphoria Institute of Beauty Arts & Sciences-Summerlin"},{"institution":"Euphoria Institute of Beauty Arts & Sciences-Green Valley"},{"institution":"Empire Beauty School-Portsmouth"},{"institution":"LIU Riverhead"},{"institution":"Newbridge College-Long Beach"},{"institution":"Regency Beauty Institute-Lakewood"},{"institution":"Regency Beauty Institute-Westminster"},{"institution":"Regency Beauty Institute-Avon"},{"institution":"Regency Beauty Institute-Joliet"},{"institution":"Regency Beauty Institute-Rockford"},{"institution":"Regency Beauty Institute-Greenfield"},{"institution":"Regency Beauty Institute-Metro Center"},{"institution":"Regency Beauty Institute-East Tucson"},{"institution":"Regency Beauty Institute-Tri-County"},{"institution":"Regency Beauty Institute-Eastgate"},{"institution":"Regency Beauty Institute-Topeka"},{"institution":"Columbia Southern University"},{"institution":"Arizona Summit Law School"},{"institution":"Arizona Culinary Institute"},{"institution":"InfoTech Career College"},{"institution":"Trident University International"},{"institution":"Coastline Beauty College"},{"institution":"Career College Consultants"},{"institution":"San Diego College"},{"institution":"Montessori Casa International"},{"institution":"Branford Academy of Hair and Cosmetology"},{"institution":"Academy of Massage and Bodywork"},{"institution":"Digital Media Arts College"},{"institution":"Academy for Five Element Acupuncture"},{"institution":"Academy of Career Training"},{"institution":"Management Resources Institute"},{"institution":"Paul Mitchell the School-Miami"},{"institution":"Wolford College"},{"institution":"Aveda Institute-South Florida"},{"institution":"Aveda Institute-Tallahassee"},{"institution":"Shear Excellence Hair Academy"},{"institution":"Carlson College of Massage Therapy"},{"institution":"Bio-Chi Institute of Massage Therapy"},{"institution":"SOLEX Medical Academy"},{"institution":"MyComputerCareer.com-Indianapolis"},{"institution":"Z Hair Academy"},{"institution":"DiGrigoli School of Cosmetology"},{"institution":"Millennium Training Institute"},{"institution":"Gallery College of Beauty"},{"institution":"Lakewood School of Therapeutic Massage"},{"institution":"The Salon Spa Academy"},{"institution":"Trend Setters School of Cosmetology"},{"institution":"Academy of Hair Design-Springfield"},{"institution":"Corinth Academy of Cosmetology"},{"institution":"Southeastern Institute-Charlotte"},{"institution":"Gentle Healing School of Massage"},{"institution":"Yeshivas Be\'er Yitzchok"},{"institution":"Yeshiva Toras Chaim"},{"institution":"Talmudical Seminary of Bobov"},{"institution":"New York Methodist Hospital Center for Allied Health Education"},{"institution":"Institute of Allied Medical Professions-New York"},{"institution":"Micropower Career Institute"},{"institution":"Monroe 2 Orleans BOCES-Center for Workforce Development"},{"institution":"Aveda Fredric\'s Institute-Cincinnati"},{"institution":"MyComputerCareer.com-TechSkills"},{"institution":"CDE Career Institute"},{"institution":"Instituto Educativo Premier"},{"institution":"Charleston School of Law"},{"institution":"Elite College of Cosmetology"},{"institution":"Memphis Institute of Barbering"},{"institution":"Manuel and Theresa\'s School of Hair Design-Bryan"},{"institution":"Southwest University at El Paso"},{"institution":"Paul Mitchell the School-Austin"},{"institution":"Aveda Institute-Provo"},{"institution":"Dixie Applied Technology College"},{"institution":"Centura College-Alexandria"},{"institution":"Southeast Culinary & Hospitality College"},{"institution":"Dominion School of Hair Design"},{"institution":"Victoria\'s Academy of Cosmetology"},{"institution":"Inland Massage Institute"},{"institution":"Sunnyside Beauty Academy"},{"institution":"Wisconsin Academy"},{"institution":"The Art Institute of Pittsburgh-Online Division"},{"institution":"University of South Florida-Sarasota-Manatee"},{"institution":"Brown Mackie College-Indianapolis"},{"institution":"College America-Cheyenne"},{"institution":"Paul Mitchell the School-San Antonio"},{"institution":"Centro de Estudios Multidisciplinarios-Bayamon"},{"institution":"Bryant & Stratton College-Wauwatosa"},{"institution":"Minnesota School of Business-Blaine"},{"institution":"The Art Institute of Michigan"},{"institution":"Lacy Cosmetology School-Lexington"},{"institution":"Lacy Cosmetology School-Goose Creek"},{"institution":"The Art Institute of Austin"},{"institution":"The Art Institute of California-Argosy University-Silicon Valley"},{"institution":"Remington College-Houston Southeast Campus"},{"institution":"Remington College-Shreveport Campus"},{"institution":"National American University-Austin"},{"institution":"National American University-Wichita"},{"institution":"Lawton Career Institute-Warren Main Campus"},{"institution":"Fortis College-Landover"},{"institution":"Jenny Lea Academy of Cosmetology and Aesthetics"},{"institution":"ITT Technical Institute-Cary"},{"institution":"ITT Technical Institute-Madison"},{"institution":"ITT Technical Institute-Clive"},{"institution":"ITT Technical Institute-Columbus"},{"institution":"ITT Technical Institute-Phoenix"},{"institution":"ITT Technical Institute-Madison"},{"institution":"ITT Technical Institute-High Point"},{"institution":"The Hair Academy"},{"institution":"The Art Institutes International\ufffdKansas City"},{"institution":"The Art Institute of Raleigh-Durham"},{"institution":"Le Cordon Bleu College of Culinary Arts-Sacramento"},{"institution":"Le Cordon Bleu College of Culinary Arts-Seattle"},{"institution":"Le Cordon Bleu College of Culinary Arts-Cambridge"},{"institution":"Le Cordon Bleu College of Culinary Arts-Dallas"},{"institution":"Ross Medical Education Center-New Baltimore"},{"institution":"Ross College-Sylvania"},{"institution":"Argosy University-Salt Lake City"},{"institution":"Escuela De Troqueleria Y Herramentaje"},{"institution":"Virginia College-Montgomery"},{"institution":"Fortis Institute-Nashville"},{"institution":"Beckfield College-Tri-County"},{"institution":"Community Technology Learning Center of Portage"},{"institution":"David-Curtis School of Floral Design"},{"institution":"Dental Assistant Pro LLC-Columbus"},{"institution":"Dental Assistant Pro-Lebanon"},{"institution":"Iverson Institute"},{"institution":"Galen College of Nursing-Cincinnati"},{"institution":"Harmony Path School of Massage Therapy"},{"institution":"Institute of Therapeutic Massage"},{"institution":"Pinnacle Career Institute-North Kansas City"},{"institution":"Strayer University-Kentucky"},{"institution":"Strayer University-North Carolina"},{"institution":"Strayer University-New Jersey"},{"institution":"International Culinary Arts and Sciences Institute"},{"institution":"Kaplan College-Cincinnati"},{"institution":"National College-Dayton"},{"institution":"National College-Youngstown"},{"institution":"National College-Cincinnati"},{"institution":"National College-Stow"},{"institution":"Harris School of Business-Hamilton Campus"},{"institution":"Empire Beauty School-Eden Prairie"},{"institution":"Ohio Business College-Hilliard"},{"institution":"Ohio Center for Broadcasting-Columbus"},{"institution":"Ohio Medical Career Center"},{"institution":"Ohio Technical College-PowerSport Institute"},{"institution":"Reflexology Certification Institute"},{"institution":"Toledo Restaurant Training Center"},{"institution":"Dade Medical College-Miami Lakes"},{"institution":"The King\ufffds College"},{"institution":"DeVry University-Kentucky"},{"institution":"Chamberlain College of Nursing-Administrative Office"},{"institution":"Chamberlain College of Nursing-Illinois"},{"institution":"Chamberlain College of Nursing-Ohio"},{"institution":"Chamberlain College of Nursing-Arizona"},{"institution":"Career Quest Learning Centers-Jackson"},{"institution":"Regency Beauty Institute-Fort Collins"},{"institution":"Regency Beauty Institute-Tolleson"},{"institution":"Regency Beauty Institute-Pasadena"},{"institution":"Regency Beauty Institute-Dayton"},{"institution":"Regency Beauty Institute-Akron"},{"institution":"Regency Beauty Institute-Detroit Southgate"},{"institution":"Regency Beauty Institute-Flint"},{"institution":"Regency Beauty Institute-Grand Rapids"},{"institution":"Regency Beauty Institute-Cypresswood"},{"institution":"Bryan University"},{"institution":"Regency Beauty Institute-Austin"},{"institution":"Regency Beauty Institute-Mesa"},{"institution":"Regency Beauty Institute-Nashville"},{"institution":"Regency Beauty Institute-Charlotte"},{"institution":"Regency Beauty Institute-North Olmsted"},{"institution":"Regency Beauty Institute-Columbus"},{"institution":"Regency Beauty Institute-Elgin"},{"institution":"The Salon Professional Academy-Appleton"},{"institution":"Milan Institute of Cosmetology-Fairfield"},{"institution":"Milan Institute of Cosmetology-Reno"},{"institution":"Milan Institute of Cosmetology-Visalia"},{"institution":"Ottawa University-Online"},{"institution":"Broadview University-Orem"},{"institution":"Paul Mitchell the School-Esani"},{"institution":"Institute of Production and Recording"},{"institution":"Virginia College-Greenville"},{"institution":"Paul Mitchell the School-Birmingham"},{"institution":"Taft University System"},{"institution":"Mayfield College"},{"institution":"International Polytechnic Institute"},{"institution":"Academy of Esthetics and Cosmetology"},{"institution":"BioHealth College"},{"institution":"International Professional School of Bodywork"},{"institution":"Borner\'s Barber College"},{"institution":"Paul Mitchell the School-Pasadena"},{"institution":"San Francisco Institute of Esthetics and Cosmetology"},{"institution":"Laurus College"},{"institution":"Healing Hands School of Holistic Health"},{"institution":"Career Development Institute"},{"institution":"Auguste Escoffier School of Culinary Arts-Boulder"},{"institution":"Aspen University"},{"institution":"Institute of Taoist Education and Acupuncture"},{"institution":"National Beauty College"},{"institution":"Denver School of Nursing"},{"institution":"Cambridge Institute of Health & Technology"},{"institution":"Cozmo The School"},{"institution":"Allied Health Institute"},{"institution":"North Florida Academy"},{"institution":"Professional Hands Institute"},{"institution":"Celebrity School of Beauty"},{"institution":"Paul Mitchell the School-Atlanta"},{"institution":"Evans Hairstyling College-Rexburg"},{"institution":"Hair Academy Paul Mitchell Partner School"},{"institution":"University of Aesthetics-Chicago"},{"institution":"University of Aesthetics-Downers Grove"},{"institution":"Tricoci University of Beauty Culture-Chicago"},{"institution":"Tricoci University of Beauty Culture-Glendale Heights"},{"institution":"Tricoci University of Beauty Culture-Peoria"},{"institution":"Tricoci University of Beauty Culture-Rockford"},{"institution":"Frederick School of Cosmetology"},{"institution":"Omega Studios\' School of Applied Recording Arts & Sciences"},{"institution":"Focus-Hope Information Technologies Center"},{"institution":"International Cosmetology Academy"},{"institution":"French Academy of Cosmetology"},{"institution":"Healing Arts Center"},{"institution":"Paul Mitchell the School-Springfield"},{"institution":"Urshan Graduate School of Theology"},{"institution":"Mississippi Institute of Aesthetics Nails & Cosmetology"},{"institution":"College of Western Idaho"},{"institution":"Aveda Institute-Chapel Hill"},{"institution":"Charlotte School of Law"},{"institution":"Daoist Traditions College of Chinese Medical Arts"},{"institution":"Total Image Beauty Academy"},{"institution":"Jersey College"},{"institution":"American Institute of Medical Sciences & Education"},{"institution":"Casal Institute of Nevada"},{"institution":"Career School of NY"},{"institution":"John Paolo\'s Xtreme Beauty Institute-Goldwell Product Artistry"},{"institution":"Ann Marie\'s World of Beauty School"},{"institution":"Yeshiva of Machzikai Hadas"},{"institution":"Aveda Institute-Columbus"},{"institution":"Paul Mitchell the School-Cincinnati"},{"institution":"Cutter\'s Edge School of Cosmetology"},{"institution":"Hands on Therapy"},{"institution":"MediaTech Institute-Dallas"},{"institution":"PCCenter"},{"institution":"Aveda Institute-San Antonio"},{"institution":"Skin Institute"},{"institution":"Skin Science Institute"},{"institution":"Global Health College"},{"institution":"Pacific Northwest University of Health Sciences"},{"institution":"Visions in Hair Design Institute of Cosmetology"},{"institution":"Brensten Education"},{"institution":"The Chicago School of Professional Psychology at Irvine"},{"institution":"California InterContinental University"},{"institution":"Fortis College-Dothan"},{"institution":"Fortis Institute-Pensacola"},{"institution":"Fortis College-Montgomery"},{"institution":"Fortis College School of Cosmetology"},{"institution":"Woodland Community College"},{"institution":"Dorsey Business Schools-Farmington Hills"},{"institution":"Dorsey Business Schools-Roseville Culinary Academy"},{"institution":"Vatterott College-Appling Farms"},{"institution":"Minnesota School of Business-Moorhead"},{"institution":"Brown Mackie College-Boise"},{"institution":"Brown Mackie College-Tulsa"},{"institution":"Fortis Institute-Birmingham"},{"institution":"Daymar College-Scottsville"},{"institution":"Miller-Motte College-Greenville"},{"institution":"The Chicago School of Professional Psychology at Los Angeles"},{"institution":"Metro Business College-Arnold"},{"institution":"The Chicago School of Professional Psychology at Westwood"},{"institution":"Cardiac and Vascular Institute of Ultrasound"},{"institution":"Virginia College-Jacksonville"},{"institution":"Studio Academy of Beauty"},{"institution":"California Nurses Educational Institute"},{"institution":"Central Nursing College"},{"institution":"RWM Fiber Optics"},{"institution":"Paul Mitchell the School-Sacramento"},{"institution":"Providence Christian College"},{"institution":"Summit Salon & Beauty School"},{"institution":"Oxford Academy of Hair Design"},{"institution":"Institute of World Politics"},{"institution":"Pontifical John Paul II Institute for Studies on Marriage and Family"},{"institution":"Medical Institute of Palm Beach"},{"institution":"Lake Lanier School of Massage"},{"institution":"Oliver Finley Academy of Cosmetology"},{"institution":"National Career College"},{"institution":"Aveda Institute-Chicago"},{"institution":"Tricoci University of Beauty Culture-Libertyville"},{"institution":"Tricoci University of Beauty Culture-Bridgeview"},{"institution":"The Temple-A Paul Mitchell Partner School"},{"institution":"Center for Massage & Natural Health"},{"institution":"Academy of Hair Design-Oklahoma City"},{"institution":"Education and Technology Institute"},{"institution":"Pulse Beauty Academy-A Paul Mitchell Partner School"},{"institution":"Liberty Technical College"},{"institution":"Toni & Guy Hairdressing Academy-Cranston"},{"institution":"South Texas Training Center"},{"institution":"Columbia College"},{"institution":"Vermont College of Fine Arts"},{"institution":"Advanced Welding Institute"},{"institution":"The Art Institute of Washington-Dulles"},{"institution":"Paul Mitchell the School-Memphis"},{"institution":"Pima Medical Institute-East Valley"},{"institution":"Virginia College-Charleston"},{"institution":"The Ohio Academy Paul Mitchell Partner School-Cleveland"},{"institution":"The Ohio Academy Paul Mitchell Partner School-Columbus"},{"institution":"Georgia Beauty Academy"},{"institution":"Stautzenberger Institute-Allen Park"},{"institution":"Empire Beauty School-Lauderhill"},{"institution":"Empire Beauty School-Spring Lake Park"},{"institution":"MediaTech Institute-Austin"},{"institution":"MediaTech Institute-Houston"},{"institution":"Fortis College-Phoenix"},{"institution":"Miller-Motte College-Raleigh"},{"institution":"Lamson Institute"},{"institution":"Euphoria Institute of Beauty Arts & Sciences-Las Vegas"},{"institution":"Lincoln College of Technology-Toledo"},{"institution":"College of Hair Design-East Campus"},{"institution":"International Academy of Design and Technology-Online"},{"institution":"Le Cordon Bleu College of Culinary Arts-St Louis"},{"institution":"Sanford-Brown College-San Antonio"},{"institution":"Heritage College-Wichita"},{"institution":"Heritage College-Little Rock"},{"institution":"Argosy University-Phoenix Online Division"},{"institution":"MedTech College-Greenwood Campus"},{"institution":"MedTech College-Ft Wayne Campus"},{"institution":"MedTech College-Lexington Campus"},{"institution":"ITT Technical Institute-Madison"},{"institution":"ITT Technical Institute-Springfield"},{"institution":"ITT Technical Institute-Huntington"},{"institution":"ITT Technical Institute-Concord"},{"institution":"ITT Technical Institute-Fort Myers"},{"institution":"ITT Technical Institute-Charlotte North"},{"institution":"Fortis College-Salt Lake City"},{"institution":"Polytechnic University of Puerto Rico-Miami"},{"institution":"Polytechnic University of Puerto Rico-Orlando"},{"institution":"Ross Medical Education Center-Fort Wayne"},{"institution":"Ross Medical Education Center-Portage"},{"institution":"The Commonwealth Medical College"},{"institution":"Josef\'s School of Hair Design Inc-Fargo West"},{"institution":"Northeast Technology Center-Claremore"},{"institution":"Salon Success Academy-Fontana"},{"institution":"Salon Success Academy-Redlands"},{"institution":"Brown Mackie College-Phoenix"},{"institution":"Strayer University-West Virginia"},{"institution":"Strayer University-Utah"},{"institution":"Strayer University-Ohio"},{"institution":"Regency Beauty Institute-Tinley Park"},{"institution":"Regency Beauty Institute-Columbia"},{"institution":"Regency Beauty Institute-South Bend"},{"institution":"Regency Beauty Institute-Detroit Lakeside"},{"institution":"Regency Beauty Institute-Fort Myers"},{"institution":"Regency Beauty Institute-Arlington"},{"institution":"Regency Beauty Institute-Durham"},{"institution":"Minnesota School of Business-Elk River"},{"institution":"Brown Mackie College-Greenville"},{"institution":"Globe University-Sioux Falls"},{"institution":"Globe University-Eau Claire"},{"institution":"Vanguard College of Cosmetology-Baton Rouge"},{"institution":"Globe University-Minneapolis"},{"institution":"San Joaquin Valley College-Hesperia"},{"institution":"Beauty Schools of America-Homestead"},{"institution":"ATI Career Training Center-Dallas"},{"institution":"South Texas Vocational Technical Institute-Brownsville"},{"institution":"South Texas Vocational Technical Institute-Corpus Christi"},{"institution":"L\'Ecole Culinaire-Memphis"},{"institution":"University of Minnesota-Rochester"},{"institution":"Health And Style Institute"},{"institution":"CBT College-Cutler Bay"},{"institution":"Provo College\ufffdAmerican Fork"},{"institution":"National College-Columbus"},{"institution":"Kaplan Career Institute-Boston"},{"institution":"Herzing University-Toledo"},{"institution":"Capri Beauty College"},{"institution":"Milan Institute of Cosmetology-Concord"},{"institution":"Milan Institute-Bakersfield"},{"institution":"Homestead Schools"},{"institution":"Carrington College-Las Vegas"},{"institution":"Carrington College-Reno"},{"institution":"Chamberlain College of Nursing-Florida"},{"institution":"Remington College-Columbia Campus"},{"institution":"Remington College of Nursing Orlando"},{"institution":"Washington Barber College Inc"},{"institution":"InterCoast Colleges-Elk Grove"},{"institution":"Universal Barber College"},{"institution":"Horizon University"},{"institution":"San Diego Culinary Institute"},{"institution":"Beyond 21st Century Beauty Academy"},{"institution":"Franklin Career College"},{"institution":"Academy for Jewish Religion-California"},{"institution":"Hollywood Beauty College"},{"institution":"Angeles College"},{"institution":"Angeles Institute"},{"institution":"Paul Mitchell the School-Temecula"},{"institution":"European Academy of Cosmetology and Hairdressing"},{"institution":"International Institute of Cosmetology"},{"institution":"Florida School of Traditional Midwifery"},{"institution":"Walton Career Development Center"},{"institution":"Immokalee Technical Center"},{"institution":"American Academy of Cosmetology"},{"institution":"University of Fort Lauderdale"},{"institution":"Aviation Institute of Maintenance-Orlando"},{"institution":"The Salon Professional Academy-Tampa"},{"institution":"The Salon Professional Academy-Gainesville"},{"institution":"The Salon Professional Academy-The Villages"},{"institution":"The Hair Academy Inc"},{"institution":"Profile Institute of Barber-Styling"},{"institution":"The Process Institute of Cosmetology"},{"institution":"New Hope Christian College-Honolulu"},{"institution":"D & L Academy of Hair Design"},{"institution":"Master Educators Beauty School"},{"institution":"Ambria College of Nursing"},{"institution":"Midwestern Career College"},{"institution":"Paul Mitchell the School-Normal"},{"institution":"Innovations Design Academy"},{"institution":"Aveda Fredric\'s Institute-Indianapolis"},{"institution":"The Salon Professional Academy-Anderson"},{"institution":"Eric Fisher Academy"},{"institution":"A & W Healthcare Educators"},{"institution":"My Le\'s Beauty College"},{"institution":"Blackstone Valley Vocational Regional School District"},{"institution":"Southern Worcester County Regional Voc School District"},{"institution":"L\'esprit Academy"},{"institution":"Marketti Academy of Cosmetology"},{"institution":"CenterPoint Massage and Shiatsu Therapy School and Clinic"},{"institution":"Avalon School of Cosmetology"},{"institution":"American Business and Technology University"},{"institution":"City Vision College"},{"institution":"Transformed Barber and Cosmetology Academy"},{"institution":"Bitterroot School of Cosmetology"},{"institution":"Atlanta Beauty & Barber Academy"},{"institution":"The Salon Professional Academy-Great Falls"},{"institution":"Park West Barber School"},{"institution":"National Career Institute"},{"institution":"Toni & Guy Hairdressing Academy-Albuquerque"},{"institution":"International Academy of Style"},{"institution":"EDP School of Computer Programming"},{"institution":"New York Medical Career Training Center"},{"institution":"Institute of Culinary Education"},{"institution":"New Life Business Institute"},{"institution":"The Salon Professional Academy-Tonawanda"},{"institution":"Onondaga School of Therapeutic Massage-Syracuse"},{"institution":"Academy of Cosmetology and Esthetics NYC"},{"institution":"Finger Lakes School of Massage"},{"institution":"Four County Career Center"},{"institution":"Vanity School of Cosmetology"},{"institution":"Tolles Career and Technical Center"},{"institution":"The Salon Professional Academy-Perrysburg"},{"institution":"Portland Actors Conservatory"},{"institution":"Somerset County Technology Center"},{"institution":"Metro Beauty Academy"},{"institution":"Barone Beauty Academy"},{"institution":"Academy for Careers and Technology"},{"institution":"Aiken School of Cosmetology"},{"institution":"Love Beauty School Inc"},{"institution":"Professional Career Training Institute"},{"institution":"Cannon Institute of Higher Learning"},{"institution":"Cardiotech Ultrasound School"},{"institution":"DuVall\'s School of Cosmetology"},{"institution":"Advanced Beauty College"},{"institution":"Texas Beauty College"},{"institution":"Avenue Five Institute"},{"institution":"Corpus Christi Beauty Academy"},{"institution":"The Salon Professional Academy-Lewisville"},{"institution":"Renaissance Academie"},{"institution":"Bethel College"},{"institution":"Institute of Advanced Medical Esthetics"},{"institution":"Gary Manuel Aveda Institute"},{"institution":"Northwest School of Wooden Boat Building"},{"institution":"Bainbridge Graduate Institute"},{"institution":"The Salon Professional Academy-Onalaska"},{"institution":"Regency Beauty Institute-North Tucson"},{"institution":"Kaplan College-Chula Vista"},{"institution":"InterCoast Colleges-Roseville"},{"institution":"West Coast University-Orange County"},{"institution":"West Coast University-Ontario"},{"institution":"Kaplan College-Pembroke Pines"},{"institution":"Dade Medical College-Homestead"},{"institution":"Virginia College-Augusta"},{"institution":"Midwest Technical Institute-East Peoria"},{"institution":"Paul Mitchell the School-Chicago"},{"institution":"Kaplan College-Indianapolis"},{"institution":"Regency Beauty Institute-Evansville"},{"institution":"Regency Beauty Institute-Wichita"},{"institution":"Regency Beauty Institute-Shreveport"},{"institution":"Regency Beauty Institute-Springfield"},{"institution":"Regency Beauty Institute-Canton"},{"institution":"Regency Beauty Institute-Spartanburg"},{"institution":"Regency Beauty Institute-Chattanooga"},{"institution":"Regency Beauty Institute-Mesquite"},{"institution":"Kaplan Career Institute-Dearborn"},{"institution":"Dorsey Business Schools-Waterford Pontiac"},{"institution":"Regina\'s College of Beauty-High Point"},{"institution":"Miller-Motte College-Fayetteville"},{"institution":"Drake College of Business-Newark"},{"institution":"European Massage Therapy School-Las Vegas"},{"institution":"Harrison College-Grove City"},{"institution":"Miller-Motte Technical College-Columbus"},{"institution":"National University College-Ponce"},{"institution":"Fortis Institute-Grand Prairie"},{"institution":"Paul Mitchell the School-St George"},{"institution":"The Art Institute of Virginia Beach"},{"institution":"Bryant & Stratton College-Bayshore"},{"institution":"Gerstner Sloan-Kettering Graduate School of Biomedical Sciences"},{"institution":"Daymar College-Online"},{"institution":"Virginia College-Columbia"},{"institution":"Sanford-Brown College-Dearborn"},{"institution":"Sanford-Brown College-Grand Rapids"},{"institution":"Sanford-Brown College-Indianapolis"},{"institution":"Sanford-Brown College-Hillside"},{"institution":"Sanford-Brown College-Tinley Park"},{"institution":"Sanford-Brown College-Phoenix"},{"institution":"Sanford-Brown Institute-Orlando"},{"institution":"Fortis College-Indianapolis"},{"institution":"Kaplan College-Arlington"},{"institution":"Kaplan College-Charlotte"},{"institution":"Kaplan College-Jacksonville"},{"institution":"Globe University-Madison East"},{"institution":"Minnesota School of Business-Lakeville"},{"institution":"Globe University\ufffdGreen Bay"},{"institution":"Globe University\ufffdMadison West"},{"institution":"Globe University\ufffdWausau"},{"institution":"Dade Medical College-Hollywood"},{"institution":"Empire Beauty School-E Memphis"},{"institution":"Empire Beauty School-Nashville"},{"institution":"Empire Beauty School-Jackson"},{"institution":"Empire Beauty School-Springfield"},{"institution":"Empire Beauty School-Paramus"},{"institution":"Empire Beauty School-Speedway"},{"institution":"Empire Beauty School-Morrow"},{"institution":"Strayer University-Arkansas"},{"institution":"Strayer University-Georgia"},{"institution":"Strayer University-Louisiana"},{"institution":"Strayer University-Mississippi"},{"institution":"Strayer University-South Carolina"},{"institution":"Strayer University-Texas"},{"institution":"The Art Institute of San Antonio"},{"institution":"Globe University-La Crosse"},{"institution":"The Hair Design School-S Memphis"},{"institution":"The Hair Design School-Charlotte"},{"institution":"The Hair Design School-Durham"},{"institution":"The Hair Design School-E Greensboro"},{"institution":"The Hair Design School-Winston-Salem"},{"institution":"Empire Beauty School-West Palm"},{"institution":"Empire Beauty School-Pineville"},{"institution":"The Hair Design School-N Memphis"},{"institution":"Broadview Entertainment Arts University"},{"institution":"Bryant & Stratton College-Hampton"},{"institution":"Paul Mitchell the School-Phoenix"},{"institution":"All Beauty College"},{"institution":"Northern California Institute of Cosmetology Inc"},{"institution":"Golden State College of Court Reporting"},{"institution":"Preferred College of Nursing-Los Angeles"},{"institution":"Trinity Vocational Center"},{"institution":"SICE Paul Mitchell Partner School"},{"institution":"Cosmo Beauty Academy"},{"institution":"Paul Mitchell the School-Fresno"},{"institution":"Unitek College"},{"institution":"Gurnick Academy of Medical Arts"},{"institution":"Southern California University SOMA"},{"institution":"Paul Mitchell the School-East Bay"},{"institution":"South University\ufffdRichmond"},{"institution":"South University\ufffdVirginia Beach"},{"institution":"Aveda Institute-Denver"},{"institution":"Paul Mitchell the School-Colorado Springs"},{"institution":"The Salon Professional Academy-Colorado Springs"},{"institution":"Paul Mitchell the School-Delaware"},{"institution":"Future-Tech Institute"},{"institution":"Marchman Technical Education Center"},{"institution":"Eureka Institute of Health and Beauty"},{"institution":"The Salon Professional Academy-Ft Myers"},{"institution":"SOLEX College"},{"institution":"Unity Cosmetology College"},{"institution":"Universal Spa Training Academy"},{"institution":"The Salon Professional Academy-Evansville"},{"institution":"Tri County Regional Vocational Technical High School"},{"institution":"Compass College of Cinematic Arts"},{"institution":"Nova Academy of Cosmetology"},{"institution":"Victory Trade School"},{"institution":"Starting Points Inc"},{"institution":"The Lab-Paul Mitchell Partner School"},{"institution":"SAE Institute of Technology-New York"},{"institution":"John Paolo\'s Xtreme Beauty Institute-Goldwell Product Artistry"},{"institution":"The Artisan College of Cosmetology"},{"institution":"Sage School of Massage"},{"institution":"Lawyer\'s Assistant School of Dallas"},{"institution":"ABC Beauty Academy"},{"institution":"Salon & Spa Institute"},{"institution":"American Beauty Academy"},{"institution":"The Salon Professional Academy-Tacoma"},{"institution":"Academy of Cosmetology"},{"institution":"The Academy Waukesha"},{"institution":"ITT Technical Institute-Merrillville"},{"institution":"ITT Technical Institute-Tallahassee"},{"institution":"ITT Technical Institute-Salem"},{"institution":"ITT Technical Institute-Akron"},{"institution":"ITT Technical Institute-Cedar Rapids"},{"institution":"ITT Technical Institute-Corona"},{"institution":"ITT Technical Institute-Johnson City"},{"institution":"ITT Technical Institute-DeSoto"},{"institution":"ITT Technical Institute-North Charleston"},{"institution":"ITT Technical Institute-Aurora"},{"institution":"ITT Technical Institute-West Covina"},{"institution":"ITT Technical Institute-Culver City"},{"institution":"ITT Technical Institute-Dearborn"},{"institution":"ITT Technical Institute-Las Vegas"},{"institution":"Touro University Worldwide"},{"institution":"Touro University California"},{"institution":"The Chicago School of Professional Psychology at Washington DC"},{"institution":"Anamarc College-Santa Teresa"},{"institution":"Touro University Nevada"},{"institution":"National College-Willoughby Hills"},{"institution":"Herzing University-Kenosha"},{"institution":"Herzing University-Brookfield"},{"institution":"Heald College-Modesto"},{"institution":"Fortis Institute-Houston"},{"institution":"Southern Careers Institute-Brownsville"},{"institution":"Southern Careers Institute-Corpus Christi 2"},{"institution":"Southern Careers Institute-Harlingen"},{"institution":"Strayer University-Global Region"},{"institution":"Regina\'s College of Beauty-Charlotte"},{"institution":"Kenneth Shuler School of Cosmetology-Florence"},{"institution":"Fortis College-Columbia"},{"institution":"Brown Mackie College-Albuquerque"},{"institution":"Brown Mackie College-St Louis"},{"institution":"Avant Gard The School"},{"institution":"Toni & Guy Hairdressing Academy-Bellingham"},{"institution":"California University of Management and Sciences"},{"institution":"Ross Medical Education Center-Davison"},{"institution":"Ross Medical Education Center-Granger"},{"institution":"Ross Medical Education Center-Niles"},{"institution":"Ross Medical Education Center-Canton"},{"institution":"Pima Medical Institute-Houston"},{"institution":"Illinois Center for Broadcasting\ufffdChicago Campus"},{"institution":"South Texas Vocational Technical Institute-San Antonio"},{"institution":"Concorde Career Institute-Dallas"},{"institution":"Concorde Career Institute-Orlando"},{"institution":"Concorde Career Institute-San Antonio"},{"institution":"Ecotech Institute"},{"institution":"Johnson & Wales University-Online"},{"institution":"Everest College-Fort Worth South"},{"institution":"Everest College-Santa Ana"},{"institution":"Geisinger-Lewistown Hospital School of Nursing"},{"institution":"Moreno Valley College"},{"institution":"Hair Design Institute at Fifth Avenue-New York"},{"institution":"Onondaga School of Therapeutic Massage-Rochester"},{"institution":"Norco College"},{"institution":"Daymar College-Louisville"},{"institution":"Dorsey Business Schools-Saginaw"},{"institution":"Milan Institute of Cosmetology-La Quinta"},{"institution":"Milan Institute-Nampa"},{"institution":"Milan Institute of Cosmetology-El Paso"},{"institution":"Universal Technical Institute - Dallas Fort Worth"},{"institution":"Finger Lakes School of Massage"},{"institution":"Park Avenue School of Cosmetology"},{"institution":"Salter School of Nursing and Allied Health"},{"institution":"Salter School-New Bedford"},{"institution":"Harris School of Business-Upper Darby Campus"},{"institution":"Stratford School of Aviation Maintenance Technicians"},{"institution":"Brown Mackie College-San Antonio"},{"institution":"Hollywood Institute of Beauty Careers"},{"institution":"Cortiva Institute-New Jersey"},{"institution":"Cambridge Junior College-Woodland"},{"institution":"Anthem College-Atlanta"},{"institution":"ICPR Junior College-Manati"},{"institution":"Western Beauty Institute"},{"institution":"Ridley-Lowell Business & Technical Institute-Danbury"},{"institution":"Artistic Nails and Beauty Academy-Lakeland"},{"institution":"Paul Mitchell the School-Murfreesboro"},{"institution":"Allied American University"},{"institution":"American Sentinel University"},{"institution":"Tribeca Flashpoint Media Arts Academy"},{"institution":"Hawaii Medical College"},{"institution":"Carolina College of Hair Design"},{"institution":"Virginia College-Baton Rouge"},{"institution":"Remington College-Heathrow Campus"},{"institution":"College of Massage Therapy"},{"institution":"Miller-Motte College-Jacksonville"},{"institution":"Miller-Motte Technical College-Augusta"},{"institution":"Miller-Motte Technical College-Conway"},{"institution":"Virginia College-Macon"},{"institution":"Virginia College-Spartanburg"},{"institution":"Aveda Institute-Portland"},{"institution":"Chamberlain College of Nursing-Virginia"},{"institution":"Stevens-Henager College-Boise"},{"institution":"The Salon Professional Academy-Cincinnati"},{"institution":"Penrose Academy"},{"institution":"Virginia College-Richmond"},{"institution":"Skin Institute"},{"institution":"Northwest Institute of Literary Arts"},{"institution":"Body Therapy Institute"},{"institution":"Beauty Academy of South Florida"},{"institution":"Ogle School Hair Skin Nails-North Dallas"},{"institution":"The Salon Professional Academy-North Little Rock"},{"institution":"The Salon Professional Academy-St Charles"},{"institution":"American Institute"},{"institution":"Mildred Elley-New York Campus"},{"institution":"National Paralegal College"},{"institution":"Carolina College of Biblical Studies"},{"institution":"Star Career Academy-Audubon"},{"institution":"St Luke University"},{"institution":"Northeast Technology Center-System Office"},{"institution":"Allstate Hairstyling & Barber College"},{"institution":"Oxford Graduate School"},{"institution":"Jung Tao School of Classical Chinese Medicine"},{"institution":"New York Film Academy"},{"institution":"The Collective School Of Music"},{"institution":"International College of Cosmetology"},{"institution":"GP Institute of Cosmetology"},{"institution":"Bella Capelli Academy"},{"institution":"Institute of Medical Careers"},{"institution":"Toni & Guy Hairdressing Academy-Modesto"},{"institution":"Georgia Christian University"},{"institution":"Flagler Technical Institute"},{"institution":"Galaxy Medical College"},{"institution":"American Medical Sciences Center"},{"institution":"Mandalyn Academy"},{"institution":"Jose Maria Vargas University"},{"institution":"Laird Institute of Spa Therapy"},{"institution":"D A Dorsey Educational Center"},{"institution":"Keweenaw Bay Ojibwa Community College"},{"institution":"Meridian Institute of Surgical Assisting"},{"institution":"Mauna Loa Helicopters"},{"institution":"Acaydia School of Aesthetics"},{"institution":"Manhattan Institute"},{"institution":"Cosmetic Arts Institute"},{"institution":"Holistic Massage Training Institute"},{"institution":"Diamonds Cosmetology College"},{"institution":"Tramy Beauty School"},{"institution":"Scholars Cosmetology University"},{"institution":"Northern Virginia School of Therapeutic Massage"},{"institution":"Paul Mitchell the School-St Louis"},{"institution":"Advanced Training Institute"},{"institution":"Cosmopolitan Beauty and Tech School"},{"institution":"The Salon Professional Academy-Elgin"},{"institution":"CCIC Beauty College"},{"institution":"Salon 496 Barber Academy"},{"institution":"Shepherds Theological Seminary"},{"institution":"Taylor Andrews Academy of Hair Design-West Jordan"},{"institution":"Santa Ana Beauty Academy"},{"institution":"Grace College of Divinity"},{"institution":"Cosmetology College of Franklin County"},{"institution":"Rochester School of Hair Design"},{"institution":"Aveda Institute-New Mexico"},{"institution":"Nashville Barber and Style Academy"},{"institution":"American Trade School"},{"institution":"Estelle Skin Care and Spa Institute"},{"institution":"Paul Mitchell the School-Honolulu"},{"institution":"Elite Cosmetology School"},{"institution":"Academy of Aesthetic Arts"},{"institution":"American Technical Institute"},{"institution":"Twin Rivers Adult School"},{"institution":"Bergin University of Canine Studies"},{"institution":"Aveda Institute-Boise"},{"institution":"Progressive Training Centers"},{"institution":"American Health Institute"},{"institution":"Pima Medical Institute-South Denver"},{"institution":"Real Barbers College"},{"institution":"Capilo School of Hair Design"},{"institution":"Pure Aesthetics"},{"institution":"Lindsey Institute of Cosmetology"},{"institution":"The Salon Professional Academy-Iowa City"},{"institution":"Buckner Barber School"},{"institution":"Simmons College of Kentucky"},{"institution":"Atelier Esthetique Institute of Esthetics"},{"institution":"Ashdown College of Health Sciences"},{"institution":"Advanced College of Cosmetology"},{"institution":"North American University"},{"institution":"Entourage Institute of Beauty and Esthetics"},{"institution":"United Beauty College"},{"institution":"Cinta Aveda Institute"},{"institution":"Long Island Nail & Skin Care Institute"},{"institution":"Mesivta Keser Torah"},{"institution":"Southern California Health Institute"},{"institution":"Best Care Training Institute"},{"institution":"First Class Cosmetology School"},{"institution":"Millennia Atlantic University"},{"institution":"Abcott Institute"},{"institution":"The Salon Professional Academy-Kenosha"},{"institution":"Paul Mitchell the School-Indianapolis"},{"institution":"Taylor Andrews Academy-St George"},{"institution":"Seymour Beauty Academy"},{"institution":"Protege Academy"},{"institution":"Colorado Academy of Veterinary Technology"},{"institution":"Northeast Technical Institute"},{"institution":"Salinas Beauty College Inc"},{"institution":"Academy for Salon Professionals"},{"institution":"Elite School of Cosmetology"},{"institution":"Paul Mitchell the School-Las Vegas"},{"institution":"The Salon Professional Academy-Kokomo"},{"institution":"Hair Academy"},{"institution":"Florida Academy"},{"institution":"Institute for Doctoral Studies in the Visual Arts"},{"institution":"State Career College"},{"institution":"Academy for Salon Professionals"},{"institution":"Paul Mitchell The School-Spokane"},{"institution":"DeVry University\'s Keller Graduate School of Management-Maryland"},{"institution":"DeVry University\'s Keller Graduate School of Management-North Carolina"},{"institution":"DeVry University\'s Keller Graduate School of Management-Florida"},{"institution":"DeVry College of New York\'s Keller Graduate School of Management"},{"institution":"DeVry University\'s Keller Graduate School of Management-Indiana"},{"institution":"DeVry University\'s Keller Graduate School of Management-Nevada"},{"institution":"DeVry University\'s Keller Graduate School of Management-Colorado"},{"institution":"DeVry University\'s Keller Graduate School of Management-Minnesota"},{"institution":"DeVry University\'s Keller Graduate School of Management-Oklahoma"},{"institution":"DeVry University\'s Keller Graduate School of Management-Utah"},{"institution":"DeVry University\'s Keller Graduate School of Management-Tennessee"},{"institution":"DeVry University\'s Keller Graduate School of Management-Michigan"},{"institution":"DeVry University\'s Keller Graduate School of Management-Kentucky"},{"institution":"DeVry University\'s Keller Graduate School of Management-New Jersey"},{"institution":"DeVry University\'s Keller Graduate School of Management-Oregon"},{"institution":"Lincoln College of New England-Hartford"},{"institution":"Lincoln College of Technology-Columbus"},{"institution":"Lincoln College of Technology-Cleveland"},{"institution":"Northwestern Institute of Health and Technology"},{"institution":"J Renee Career Facilitation"},{"institution":"National Personal Training Institute of Colorado"},{"institution":"National Personal Training Institute of Colorado"},{"institution":"International College of Beauty Arts & Sciences"},{"institution":"The Salon Professional Academy-Shorewood"},{"institution":"John Paul the Great Catholic University"},{"institution":"ITT Technical Institute-Durham"},{"institution":"ITT Technical Institute-Hanover"},{"institution":"University of Phoenix-Jackson Campus"},{"institution":"University of Phoenix-Delaware Campus"},{"institution":"Everest College-Milwaukee"},{"institution":"Independence University"},{"institution":"National American University-Tulsa"},{"institution":"National American University-Centennial"},{"institution":"National American University-Lee\'s Summit"},{"institution":"National American University-Colorado Springs South"},{"institution":"Globe University-Appleton"},{"institution":"Salter College-Chicopee"},{"institution":"Chamberlain College of Nursing-Missouri"},{"institution":"Chamberlain College of Nursing-Texas"},{"institution":"ITT Technical Institute-Oakland"},{"institution":"Continental School of Beauty Culture-Mattydale"},{"institution":"Everest College-Bedford Park"},{"institution":"Fortis College-Akron"},{"institution":"Carrington College California-Pomona"},{"institution":"Regency Beauty Institute-Copperwood"},{"institution":"Regency Beauty Institute-Little Rock"},{"institution":"Regency Beauty Institute-Baltimore Golden Ring"},{"institution":"Regency Beauty Institute-El Paso"},{"institution":"Regency Beauty Institute-Jacksonville Regency"},{"institution":"Regency Beauty Institute-Knoxville"},{"institution":"Regency Beauty Institute-Fayetteville"},{"institution":"Regency Beauty Institute-Lansing"},{"institution":"Regency Beauty Institute-Jacksonville Orange Park"},{"institution":"Regency Beauty Institute-Crystal Lake"},{"institution":"Regency Beauty Institute-Manassas"},{"institution":"Regency Beauty Institute-Castleton"},{"institution":"Regency Beauty Institute-North Nashville"},{"institution":"Regency Beauty Institute-Round Rock"},{"institution":"Regency Beauty Institute-Merrillville"},{"institution":"Regency Beauty Institute-Roanoke"},{"institution":"Regency Beauty Institute-Toledo"},{"institution":"Regency Beauty Institute-SW Houston"},{"institution":"Everest College-Atlanta West"},{"institution":"Broadview University-Boise"},{"institution":"Advanced Institute of Hair Design-Madison"},{"institution":"Paul Mitchell The School-Columbia"},{"institution":"Paul Mitchell The School-Charleston"},{"institution":"Everest College-Melrose Park"},{"institution":"Kenneth Shuler School of Cosmetology-Greenville"},{"institution":"South University-Accelerated Graduate Programs"},{"institution":"South University-The Art Institute of Fort Worth"},{"institution":"South University-Novi"},{"institution":"Northwest College-Eugene"},{"institution":"Northwest College-Tualatin"},{"institution":"Harrison College-Morrisville"},{"institution":"Trend Setters\' Academy of Beauty Culture-Louisville"},{"institution":"National University College-Caguas"},{"institution":"Beauty Schools of America"},{"institution":"CET-Soledad"},{"institution":"MarJon School of Beauty ltd-Lockport"},{"institution":"Houston Training Schools-Southwest"},{"institution":"Vanguard College of Cosmetology-Metairie"},{"institution":"New England Tractor Trailer Training School of Massachusetts"},{"institution":"Heritage College-Columbus"},{"institution":"Utah College of Massage Therapy-Vegas"},{"institution":"Utah College of Massage Therapy-Tempe"},{"institution":"Utah College of Massage Therapy-Phoenix"},{"institution":"Utah College of Massage Therapy-Westminster"},{"institution":"Utah College of Massage Therapy-Aurora"},{"institution":"Sanford-Brown College-Portland"},{"institution":"Tint School of Makeup and Cosmetology-Grand Prairie"},{"institution":"Dewey University-Yabucoa"},{"institution":"Dewey University-Hatillo"},{"institution":"Dewey University-Manati"},{"institution":"Sanford-Brown College-Skokie"},{"institution":"Baltimore School of Massage-York"},{"institution":"Allen School-Phoenix"},{"institution":"Oklahoma Technical College"},{"institution":"Midwest Technical Institute-Moline"},{"institution":"Star Career Academy-Clifton"},{"institution":"Unitech Training Academy-Alexandria"},{"institution":"Unitech Training Academy-Lake Charles"},{"institution":"Aveda Institute-Los Angeles"},{"institution":"Career Quest Learning Center-Kalamazoo"},{"institution":"Buchanan Beauty College"},{"institution":"WellSpring School of Allied Health-Lawrence"},{"institution":"The Art Institute of Wisconsin"},{"institution":"Brown Mackie College-Birmingham"},{"institution":"Regina\'s College of Beauty"},{"institution":"New York Film Academy"},{"institution":"Manuel and Theresa\'s School of Hair Design-Victoria"},{"institution":"Coast Career Institute"},{"institution":"Tricoci University of Beauty Culture-Chicago NE"},{"institution":"ITT Technical Institute-Bradenton"},{"institution":"ITT Technical Institute-Phoenix West"},{"institution":"ITT Technical Institute-Brooklyn Center"},{"institution":"ITT Technical Institute-Orlando"},{"institution":"ITT Technical Institute-Waco"},{"institution":"ITT Technical Institute-Myrtle Beach"},{"institution":"University of Phoenix-Knoxville Campus"},{"institution":"Azusa Pacific Online University"},{"institution":"Minneapolis Media Institute"},{"institution":"College America-Phoenix"},{"institution":"CollegeAmerica-Stevens Henager College"},{"institution":"Avalon School of Cosmetology-Phoenix"},{"institution":"Avalon School of Cosmetology-Layton"},{"institution":"Hair Design Institute"},{"institution":"Hair Design Institute"},{"institution":"University of Phoenix-Baton Rouge Campus"},{"institution":"University of Phoenix-Lafayette Campus"},{"institution":"University of Phoenix-Shreveport-Bossier Campus"},{"institution":"All-State Career School-Allied Health Campus"},{"institution":"Aveda Institute-Des Moines"},{"institution":"Fortis Institute-Lawrenceville"},{"institution":"Relay Graduate School of Education"},{"institution":"Brown Mackie College-Oklahoma City"},{"institution":"Sanford-Brown College-Austin"},{"institution":"Miller-Motte Technical College-Macon"},{"institution":"Miller-Motte Technical College-Gulfport"},{"institution":"International Academy of Medical Reflexology"},{"institution":"International Culinary Center-California"},{"institution":"South University\ufffdSavannah Online"},{"institution":"Fortis College-Montgomery"},{"institution":"San Joaquin Valley College-Temecula"},{"institution":"Rio Grande Bible Institute"},{"institution":"Miller-Motte Technical College-Roanoke"},{"institution":"Whitworth University-Adult Degree Programs"},{"institution":"The Santa Barbara and Ventura Colleges of Law\ufffdSanta Barbara"},{"institution":"The University of America"},{"institution":"Kaplan College-Chesapeake"},{"institution":"American Broadcasting School-Online Program"},{"institution":"Springfield College-School of Human Services"},{"institution":"Marian Health Careers Center-Van Nuys Campus"},{"institution":"Brown College-Brooklyn Center"},{"institution":"Milan Institute-Las Vegas"},{"institution":"Williamson Free School of Mechanical Trades"},{"institution":"Virginia College-Savannah"},{"institution":"Virginia College-Columbus"},{"institution":"Donna\'s Academy of Hair Design"},{"institution":"New York School of Esthetics & Day Spa"},{"institution":"Panache Academy of Beauty"},{"institution":"Finger Lakes Health College of Nursing"},{"institution":"ASI Career Institute"},{"institution":"Chicago School for Piano Technology"},{"institution":"Midwest Technical Institute-Ridgeland"},{"institution":"Christine Valmy International School of Esthetics & Cosmetology"},{"institution":"City College-Hollywood"},{"institution":"Paul Mitchell the School-Arlington"},{"institution":"Rocky Mountain University of Health Professions"},{"institution":"MediaTech Institute-Oceanside"},{"institution":"Christie\'s Education"},{"institution":"Prince Institute-Great Lakes"},{"institution":"Palmetto Beauty School"},{"institution":"Paul Mitchell the School-Fort Myers"},{"institution":"Paul Mitchell The School-Raleigh"},{"institution":"Stella and Charles Guttman Community College"},{"institution":"Lil Lou\'s Barber College"},{"institution":"Bryan University"},{"institution":"Virginia College-Tulsa"},{"institution":"Criswell College"},{"institution":"Virginia College-Knoxville"},{"institution":"Columbia Academy of Cosmetology"},{"institution":"Academy of Couture Art"},{"institution":"Global Institute"},{"institution":"Shear Learning Academy of Cosmetology"},{"institution":"University of Cosmetology Arts & Sciences-La Joya"},{"institution":"Preferred College of Nursing-Van Nuys"},{"institution":"Bryant & Stratton College-Akron"},{"institution":"Annenberg School of Nursing"},{"institution":"American Medical Academy"},{"institution":"Tooele Applied Technology College"},{"institution":"Chamberlain College of Nursing-Georgia"},{"institution":"Chamberlain College of Nursing-Indiana"},{"institution":"Carrington College-Mesquite"},{"institution":"Universidad Internacional Iberoamericana"},{"institution":"Sessions College for Professional Design"},{"institution":"Southeastern Technical Careers Institute Inc"},{"institution":"Virginia College-Shreveport Bossier City"},{"institution":"Strayer University-Wisconsin"},{"institution":"Strayer University-Indiana"},{"institution":"Tulsa Welding School-Jacksonville"},{"institution":"Herzing University"},{"institution":"Regency Beauty Institute-Hoover"},{"institution":"Regency Beauty Institute-San Antonio"},{"institution":"Regency Beauty Institute-Carrollwood"},{"institution":"Regency Beauty Institute-Clearwater"},{"institution":"Regency Beauty Institute-Newport News"},{"institution":"Regency Beauty Institute-Lewisville"},{"institution":"Regency Beauty Institute-Dallas"},{"institution":"Regency Beauty Institute-Plano"},{"institution":"Empire Beauty School-Virginia Beach"},{"institution":"Sanford-Brown College-Columbus"},{"institution":"Ross Medical Education Center-Morgantown"},{"institution":"Paul Mitchell the School-Ogden"},{"institution":"CollegeAmerica-Colorado Springs South"},{"institution":"Everest Institute-Bensalem"},{"institution":"Golf Academy of America-Farmers Branch"},{"institution":"Utah College of Massage Therapy-Dallas"},{"institution":"Miami Ad School-New York"},{"institution":"Lacy Cosmetology School-West Ashley"},{"institution":"Dade Medical College-West Palm Beach"},{"institution":"Dade Medical College-Jacksonville"},{"institution":"WestMed College"},{"institution":"Larry\'s Barber College"},{"institution":"Futura Career Institute"},{"institution":"Access Careers"},{"institution":"Flair Beauty College"},{"institution":"Eternity Cosmetology School"},{"institution":"Tri-State Institute of Hair Design"},{"institution":"Vogue College of Cosmetology-San Antonio Fredericksburg"},{"institution":"Vogue College of Cosmetology"},{"institution":"Tomorrow\'s Image Barber Academy of Virginia"},{"institution":"Excel Learning Center"},{"institution":"College of International Esthetics Inc"},{"institution":"Medical Allied Career Center"},{"institution":"Bais HaMedrash and Mesivta of Baltimore"},{"institution":"Long Island Barber Institute"},{"institution":"Toni & Guy Hairdressing Academy-Toledo"},{"institution":"American Institute of Medical Sonography"},{"institution":"Destination Academy for Spa and Salon Professionals"},{"institution":"Classic Cooking Academy"},{"institution":"School of Court Reporting"},{"institution":"Curve Metric School of Hair Design"},{"institution":"Athena Career Academy"},{"institution":"Yeshiva Gedolah Zichron Leyma"},{"institution":"The Barber School"},{"institution":"Be\'er Yaakov Talmudic Seminary"},{"institution":"RGV Careers"},{"institution":"Alexander Academy"},{"institution":"LeMelange Academy of Hair"},{"institution":"Aveda Institute-Tucson"},{"institution":"Velvet Touch Academy of Cosmetology"},{"institution":"Ambiance Beauty & Barber Academy Inc"},{"institution":"Diamond Beauty College"},{"institution":"NCP College of Nursing-South San Francisco"},{"institution":"University Academy of Hair Design"},{"institution":"Florida Institute of Recording Sound and Technology"},{"institution":"New Dimensions Beauty Academy Inc"},{"institution":"Jolei\'s Hair Institute"},{"institution":"Paul Mitchell the School-Reno"},{"institution":"Boise Barber College"},{"institution":"Austin Kade Academy"},{"institution":"Aesthetic Science Institute"},{"institution":"Elaine Sterling Institute"},{"institution":"Wade Gordon Hairdressing Academy"},{"institution":"Mitsu Sato Hair Academy"},{"institution":"SAE Institute of Technology-Los Angeles"},{"institution":"Florida Vocational Institute"},{"institution":"SAE Institute of Technology-Atlanta"},{"institution":"Academy di Firenze"},{"institution":"SAE Institute of Technology-Miami"},{"institution":"Colorado State University-Global Campus"},{"institution":"Paul Mitchell the School-Overland Park"},{"institution":"Medspa Academies"},{"institution":"Brighton Institute of Cosmetology"},{"institution":"Strayer University-Minnesota"},{"institution":"Strayer University-Illinois"},{"institution":"West Coast University-Dallas"},{"institution":"Stevens-Henager College-St George"},{"institution":"National American University-Bellevue"},{"institution":"National American University-Burnsville"},{"institution":"National American University-Mesquite"},{"institution":"Empire Beauty School-Savannah"},{"institution":"Ogle School Hair Skin Nails-Denton"},{"institution":"Empire Beauty School-West Greensboro"},{"institution":"California College San Diego"},{"institution":"California College San Diego"},{"institution":"Old Town Barber College-Topeka"},{"institution":"Jolie Hair and Beauty Academy-Northfield"},{"institution":"Hays Academy of Hair Design"},{"institution":"Bellus Academy"},{"institution":"Cortiva Institute-Seattle"},{"institution":"MotoRing Technical Training Institute"},{"institution":"Leon Studio One School of Hair Design & Career Training Center"},{"institution":"Columbia College"},{"institution":"NCP College of Nursing-Hayward"},{"institution":"ITT Technical Institute-Philadelphia"},{"institution":"ITT Technical Institute-Marlton"},{"institution":"ITT Technical Institute-Germantown"},{"institution":"ITT Technical Institute-Grand Rapids"},{"institution":"ITT Technical Institute-Southfield"},{"institution":"ITT Technical Institute-West Palm Beach"},{"institution":"ITT Technical Institute-Salem"},{"institution":"ITT Technical Institute-Deerfield Beach"},{"institution":"ITT Technical Institute-Indianapolis East"},{"institution":"ITT Technical Institute-Douglasville"},{"institution":"ITT Technical Institute-Overland Park"},{"institution":"ITT Technical Institute-Springfield"},{"institution":"ITT Technical Institute-West Chester"},{"institution":"University of Phoenix-McAllen Campus"},{"institution":"Pennsylvania State University-World Campus"},{"institution":"Medical Career Institute"},{"institution":"Advance Beauty Techs Academy"},{"institution":"Longs Peak Academy"},{"institution":"Brand College"},{"institution":"Hinton Barber College"},{"institution":"Advanced Career Institute"},{"institution":"Digital Film Academy"},{"institution":"MyComputerCareer.com-Raleigh"},{"institution":"Kaplan University-Augusta Campus"},{"institution":"South University-Austin"},{"institution":"South University-Cleveland"},{"institution":"Bryant & Stratton College-Online"},{"institution":"Virginia College-Florence"},{"institution":"Ogle School Hair Skin Nails-San Antonio"},{"institution":"Elizabethtown College School of Continuing and Professional Studies"},{"institution":"Fortis College-Cutler Bay"},{"institution":"Anamarc College-El Paso East"},{"institution":"Ideal Beauty Academy"},{"institution":"Minnesota School of Cosmetology-Plymouth Campus"},{"institution":"Mercyhurst University-North East Campus"},{"institution":"Warner Pacific College Adult Degree Program"},{"institution":"Platt College-Riverside"},{"institution":"Savannah Law School"},{"institution":"Empire Beauty School-Glen Burnie"},{"institution":"Everest College-Woodbridge"},{"institution":"Everest College-Kansas City"},{"institution":"International School of Cosmetology-Toni & Guy Hairdressing Academy"},{"institution":"InterCoast Career Institute-Salem"},{"institution":"International Sports Sciences Association"},{"institution":"Abraham Lincoln University"},{"institution":"National College-Canton"},{"institution":"Shiloh University"},{"institution":"Court Reporting Institute of Arlington"},{"institution":"Vatterott College-Fairview Heights"},{"institution":"Ross Medical Education Center-Dayton"},{"institution":"Ross Medical Education Center-Ontario"},{"institution":"Ross Medical Education Center-Bowling Green"},{"institution":"Florida Institute of Technology-Online"},{"institution":"Rasmussen College-Kansas"},{"institution":"NewCourtland Education Center"},{"institution":"Columbia Institute"},{"institution":"Wadsworth Center-NY State Dept of Health"},{"institution":"EMS Training Institute"},{"institution":"School of Missionary Aviation Technology"},{"institution":"Ace Cosmetology and Barber Training Center"},{"institution":"Salt Lake Baptist College"},{"institution":"Manthano Christian College"},{"institution":"California Miramar University"},{"institution":"Rocky Vista University"},{"institution":"Virginia College-Greensboro"},{"institution":"The College of Health Care Professions-Dallas"},{"institution":"The College of Health Care Professions-Fort Worth"},{"institution":"Shear Finesse Hairstyling Academy"},{"institution":"Redstone College-Denver East"},{"institution":"Academy of Salon Professionals"},{"institution":"CyberTex Institute of Technology"},{"institution":"UEI College-Santa Cruz"},{"institution":"New England Tractor Trailer Training School of CT-Bridgeport"},{"institution":"Gemini School of Visual Arts & Communication"},{"institution":"Paul Mitchell the School-Woodbridge"},{"institution":"College of the Muscogee Nation"},{"institution":"The Salon Professional Academy-Huntsville"},{"institution":"Midwives College of Utah"},{"institution":"Aspen Beauty Academy of Laurel"},{"institution":"M T Training Center"},{"institution":"Berks Career & Technology Center"},{"institution":"Future Generations Graduate School"},{"institution":"Carthage R9 School District-Carthage Technical Center"},{"institution":"Grace Mission University"},{"institution":"World A Cuts Barber Institute"},{"institution":"Photographic Center Northwest"},{"institution":"PCCTI IT and Healthcare"},{"institution":"Sotheby\'s Institute of Art-NY"},{"institution":"Top Nails & Hair Beauty School"},{"institution":"Radians College"},{"institution":"Santa Ana Beauty College"},{"institution":"Shepherds College"},{"institution":"Woodruff Medical Training and Testing"},{"institution":"Helms College"},{"institution":"American Academy of Personal Training"},{"institution":"Technology Center"},{"institution":"Ukiah Adult School"},{"institution":"Riverside County Office of Education"},{"institution":"Institute of Health Sciences"},{"institution":"Mid-America Baptist Theological Seminary"},{"institution":"Mid-South Christian College"},{"institution":"Advanced Computing Institute"},{"institution":"New York Institute of Beauty"},{"institution":"Ultrasound Medical Institute"},{"institution":"Beautiful You School of Nail Technology"},{"institution":"Harmon\'s Beauty School"},{"institution":"Xavier College School of Nursing"},{"institution":"Lawrence & Company College of Cosmetology"},{"institution":"Cactus Academy"},{"institution":"Kaizen Beauty Academy"},{"institution":"Southern Texas Careers Academy"},{"institution":"Sharp Edgez Barber Institute"},{"institution":"Salon Professional Academy"},{"institution":"Cosmotech School of Cosmetology"},{"institution":"Prestige Health & Beauty Sciences Academy"},{"institution":"Grace College of Barbering"},{"institution":"California Career Institute"},{"institution":"Cosmo Factory Cosmetology Academy"},{"institution":"Grace School of Theology"},{"institution":"Yeshiva Gedolah Kesser Torah"},{"institution":"Universal Training Institute"},{"institution":"Yeshiva Yesodei Hatorah"},{"institution":"Rizzieri Institute"},{"institution":"Bonnie Joseph Academy of Cosmetology and Barbering"},{"institution":"Healthcare Training Institute"},{"institution":"W Academy of Salon and Spa"},{"institution":"Boca Beauty Academy"},{"institution":"United Medical and Business Institute"},{"institution":"Paul Mitchell the School-Jersey Shore"},{"institution":"City Pointe Beauty Academy"},{"institution":"Chrysm Institute of Esthetics"},{"institution":"Sanford-Burnham Medical Research Institute"},{"institution":"National Personal Training Institute of Columbus"},{"institution":"Bly\'s School of Cosmetology"},{"institution":"Toni & Guy Hairdressing Academy-Manteca"},{"institution":"Belle Academy of Cosmetology"},{"institution":"Strayer University-Missouri"},{"institution":"Dorsey Business Schools-Lansing"},{"institution":"ITT Technical Institute-Pensacola"},{"institution":"ITT Technical Institute-San Antonio East"},{"institution":"MedTech Institute-Orlando Campus"},{"institution":"Tulsa Welding School-Tulsa"},{"institution":"Empire Beauty School-Augusta"},{"institution":"South University-High Point"},{"institution":"Empire Beauty School-Vernon Hills"},{"institution":"Empire Beauty School-Stone Park"},{"institution":"Court Reporting Institute of St Louis"},{"institution":"San Joaquin Valley College-Lancaster"},{"institution":"San Joaquin Valley College-San Diego"},{"institution":"Ohio Business College-Dayton"},{"institution":"Empire Beauty School-Rochester"},{"institution":"American Career College-Long Beach"},{"institution":"Ross Medical Education Center-Kokomo"},{"institution":"Ross Medical Education Center-Erlanger"},{"institution":"Ross Medical Education Center-Charleston"},{"institution":"L\'Ecole Culinaire-Kansas City"},{"institution":"Utah College of Massage Therapy-Houston"},{"institution":"InterCoast Colleges-Fairfield"},{"institution":"Vatterott College-ex\'treme Institute by Nelly-St Louis"},{"institution":"Personal Fitness & Nutrition Center"},{"institution":"Southern Careers Institute-San Antonio"},{"institution":"College of Business and Technology-Miami Gardens"},{"institution":"Milan Institute of Cosmetology-Nampa"},{"institution":"Milan Institute-Merced"},{"institution":"Midwest Technical Institute-Springfield"},{"institution":"Finger Lakes School of Massage"},{"institution":"Georgia Regents University"},{"institution":"Middle Georgia State College"},{"institution":"Trenz Beauty Academy"},{"institution":"Paul Mitchell the School-Denver"},{"institution":"Academy of Interactive Entertainment"},{"institution":"Arrojo Cosmetology School"},{"institution":"Cosmetology Academy of Texarkana"},{"institution":"Virginia Baptist College"},{"institution":"Lynnes Welding Training"},{"institution":"Aviation Institute of Maintenance-Las Vegas"},{"institution":"Tulsa Technology Center-Owasso Campus"},{"institution":"Tulsa Technology Center-Sand Springs Campus"},{"institution":"National American University-Austin South"},{"institution":"National American University-Lewisville"},{"institution":"National American University-Georgetown"},{"institution":"National American University-Richardson"},{"institution":"National American University-Rochester"},{"institution":"National American University-Weldon Spring"},{"institution":"National American University-Wichita West"},{"institution":"National American University-Indianapolis"},{"institution":"National American University-Tigard"},{"institution":"The Art Institute of St Louis"},{"institution":"DeVry College of New York"},{"institution":"DeVry University-Arizona"},{"institution":"DeVry University-California"},{"institution":"DeVry University-Colorado"},{"institution":"DeVry University-Florida"},{"institution":"DeVry University-Georgia"},{"institution":"DeVry University-Illinois"},{"institution":"DeVry University-Indiana"},{"institution":"DeVry University-Kentucky"},{"institution":"DeVry University-Maryland"},{"institution":"DeVry University-Michigan"},{"institution":"DeVry University-Minnesota"},{"institution":"DeVry University-Missouri"},{"institution":"DeVry University-Nevada"},{"institution":"DeVry University-New Jersey"},{"institution":"DeVry University-North Carolina"},{"institution":"DeVry University-Ohio"},{"institution":"DeVry University-Oklahoma"},{"institution":"DeVry University-Oregon"},{"institution":"DeVry University-Pennsylvania"},{"institution":"DeVry University-Tennessee"},{"institution":"DeVry University-Texas"},{"institution":"DeVry University-Utah"},{"institution":"DeVry University-Virginia"},{"institution":"DeVry University-Washington"},{"institution":"DeVry University-Wisconsin"},{"institution":"University of North Georgia"},{"institution":"South Georgia State College"},{"institution":"Northeastern University Global Network"},{"institution":"Georgia Military College-Distance Learning Campuses"},{"institution":"Florida Polytechnic University"},{"institution":"Brown Mackie College-Dallas"},{"institution":"American Institute-Toms River"},{"institution":"Texas Covenant Education"},{"institution":"Arizona College-Mesa"},{"institution":"American College of Healthcare"},{"institution":"Antioch College"},{"institution":"Texas A & M University-Central Texas"},{"institution":"Central Georgia Technical College"},{"institution":"Barber School of Pittsburgh"},{"institution":"EDMC Central Administrative Office"},{"institution":"The Salon Professional Academy-South Plainfield"},{"institution":"Arizona State University-Skysong"},{"institution":"Louisiana Delta Community College"}]'),Zt=t=>{let{onUniversitySelect:e}=t;const[i,o]=(0,n.useState)([]),[r,s]=(0,n.useState)([]),[a,l]=(0,n.useState)(""),[u,c]=(0,n.useState)(!1);(0,n.useEffect)((()=>{o(qt),s(qt)}),[]);return(0,Pt.jsxs)("div",{className:"university-dropdown",children:[(0,Pt.jsx)("input",{type:"text",value:a,onChange:t=>{const e=t.target.value;if(l(e),""===e)s(i),c(!1);else{const t=i.filter((t=>t.institution.toLowerCase().includes(e.toLowerCase())));s(t),c(t.length>0)}},placeholder:"Search for a university...",className:"university-input",onFocus:()=>c(!0)}),u&&r.length>0&&(0,Pt.jsx)("ul",{className:"university-list",children:r.map(((t,i)=>(0,Pt.jsx)("li",{onClick:()=>{return l((i=t).institution),c(!1),void(e&&e(i.institution));var i},children:t.institution},i)))})]})};function $t(t,e){return function(){return t.apply(e,arguments)}}const{toString:Kt}=Object.prototype,{getPrototypeOf:Yt}=Object,Jt=(Xt=Object.create(null),t=>{const e=Kt.call(t);return Xt[e]||(Xt[e]=e.slice(8,-1).toLowerCase())});var Xt;const Qt=t=>(t=t.toLowerCase(),e=>Jt(e)===t),te=t=>e=>typeof e===t,{isArray:ee}=Array,ie=te("undefined");const ne=Qt("ArrayBuffer");const oe=te("string"),re=te("function"),se=te("number"),ae=t=>null!==t&&"object"===typeof t,le=t=>{if("object"!==Jt(t))return!1;const e=Yt(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},ue=Qt("Date"),ce=Qt("File"),he=Qt("Blob"),de=Qt("FileList"),fe=Qt("URLSearchParams"),[pe,me,ge,ye]=["ReadableStream","Request","Response","Headers"].map(Qt);function _e(t,e){let i,n,{allOwnKeys:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==t&&"undefined"!==typeof t)if("object"!==typeof t&&(t=[t]),ee(t))for(i=0,n=t.length;i<n;i++)e.call(null,t[i],i,t);else{const n=o?Object.getOwnPropertyNames(t):Object.keys(t),r=n.length;let s;for(i=0;i<r;i++)s=n[i],e.call(null,t[s],s,t)}}function ve(t,e){e=e.toLowerCase();const i=Object.keys(t);let n,o=i.length;for(;o-- >0;)if(n=i[o],e===n.toLowerCase())return n;return null}const xe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,be=t=>!ie(t)&&t!==xe;const Ce=(we="undefined"!==typeof Uint8Array&&Yt(Uint8Array),t=>we&&t instanceof we);var we;const Se=Qt("HTMLFormElement"),Te=(t=>{let{hasOwnProperty:e}=t;return(t,i)=>e.call(t,i)})(Object.prototype),Ae=Qt("RegExp"),Me=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};_e(i,((i,o)=>{let r;!1!==(r=e(i,o,t))&&(n[o]=r||i)})),Object.defineProperties(t,n)};const Ie=Qt("AsyncFunction"),Ee=((t,e)=>{return t?setImmediate:e?(i=`axios@${Math.random()}`,n=[],xe.addEventListener("message",(t=>{let{source:e,data:o}=t;e===xe&&o===i&&n.length&&n.shift()()}),!1),t=>{n.push(t),xe.postMessage(i,"*")}):t=>setTimeout(t);var i,n})("function"===typeof setImmediate,re(xe.postMessage)),Pe="undefined"!==typeof queueMicrotask?queueMicrotask.bind(xe):"undefined"!==typeof process&&process.nextTick||Ee,ke={isArray:ee,isArrayBuffer:ne,isBuffer:function(t){return null!==t&&!ie(t)&&null!==t.constructor&&!ie(t.constructor)&&re(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&("function"===typeof FormData&&t instanceof FormData||re(t.append)&&("formdata"===(e=Jt(t))||"object"===e&&re(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){let e;return e="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&ne(t.buffer),e},isString:oe,isNumber:se,isBoolean:t=>!0===t||!1===t,isObject:ae,isPlainObject:le,isReadableStream:pe,isRequest:me,isResponse:ge,isHeaders:ye,isUndefined:ie,isDate:ue,isFile:ce,isBlob:he,isRegExp:Ae,isFunction:re,isStream:t=>ae(t)&&re(t.pipe),isURLSearchParams:fe,isTypedArray:Ce,isFileList:de,forEach:_e,merge:function t(){const{caseless:e}=be(this)&&this||{},i={},n=(n,o)=>{const r=e&&ve(i,o)||o;le(i[r])&&le(n)?i[r]=t(i[r],n):le(n)?i[r]=t({},n):ee(n)?i[r]=n.slice():i[r]=n};for(let o=0,r=arguments.length;o<r;o++)arguments[o]&&_e(arguments[o],n);return i},extend:function(t,e,i){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return _e(e,((e,n)=>{i&&re(e)?t[n]=$t(e,i):t[n]=e}),{allOwnKeys:n}),t},trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,e,i,n)=>{let o,r,s;const a={};if(e=e||{},null==t)return e;do{for(o=Object.getOwnPropertyNames(t),r=o.length;r-- >0;)s=o[r],n&&!n(s,t,e)||a[s]||(e[s]=t[s],a[s]=!0);t=!1!==i&&Yt(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},kindOf:Jt,kindOfTest:Qt,endsWith:(t,e,i)=>{t=String(t),(void 0===i||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return-1!==n&&n===i},toArray:t=>{if(!t)return null;if(ee(t))return t;let e=t.length;if(!se(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},forEachEntry:(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=i.next())&&!n.done;){const i=n.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let i;const n=[];for(;null!==(i=t.exec(e));)n.push(i);return n},isHTMLForm:Se,hasOwnProperty:Te,hasOwnProp:Te,reduceDescriptors:Me,freezeMethods:t=>{Me(t,((e,i)=>{if(re(t)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const n=t[i];re(n)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(t,e)=>{const i={},n=t=>{t.forEach((t=>{i[t]=!0}))};return ee(t)?n(t):n(String(t).split(e)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,i){return e.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(t,e)=>null!=t&&Number.isFinite(t=+t)?t:e,findKey:ve,global:xe,isContextDefined:be,isSpecCompliantForm:function(t){return!!(t&&re(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),i=(t,n)=>{if(ae(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[n]=t;const o=ee(t)?[]:{};return _e(t,((t,e)=>{const r=i(t,n+1);!ie(r)&&(o[e]=r)})),e[n]=void 0,o}}return t};return i(t,0)},isAsyncFn:Ie,isThenable:t=>t&&(ae(t)||re(t))&&re(t.then)&&re(t.catch),setImmediate:Ee,asap:Pe};function Be(t,e,i,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}ke.inherits(Be,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ke.toJSONObject(this.config),code:this.code,status:this.status}}});const De=Be.prototype,Re={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{Re[t]={value:t}})),Object.defineProperties(Be,Re),Object.defineProperty(De,"isAxiosError",{value:!0}),Be.from=(t,e,i,n,o,r)=>{const s=Object.create(De);return ke.toFlatObject(t,s,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),Be.call(s,t.message,e,i,n,o),s.cause=t,s.name=t.name,r&&Object.assign(s,r),s};const Le=Be;function ze(t){return ke.isPlainObject(t)||ke.isArray(t)}function Oe(t){return ke.endsWith(t,"[]")?t.slice(0,-2):t}function Ue(t,e,i){return t?t.concat(e).map((function(t,e){return t=Oe(t),!i&&e?"["+t+"]":t})).join(i?".":""):e}const Fe=ke.toFlatObject(ke,{},null,(function(t){return/^is[A-Z]/.test(t)}));const Ne=function(t,e,i){if(!ke.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const n=(i=ke.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!ke.isUndefined(e[t])}))).metaTokens,o=i.visitor||u,r=i.dots,s=i.indexes,a=(i.Blob||"undefined"!==typeof Blob&&Blob)&&ke.isSpecCompliantForm(e);if(!ke.isFunction(o))throw new TypeError("visitor must be a function");function l(t){if(null===t)return"";if(ke.isDate(t))return t.toISOString();if(!a&&ke.isBlob(t))throw new Le("Blob is not supported. Use a Buffer instead.");return ke.isArrayBuffer(t)||ke.isTypedArray(t)?a&&"function"===typeof Blob?new Blob([t]):Buffer.from(t):t}function u(t,i,o){let a=t;if(t&&!o&&"object"===typeof t)if(ke.endsWith(i,"{}"))i=n?i:i.slice(0,-2),t=JSON.stringify(t);else if(ke.isArray(t)&&function(t){return ke.isArray(t)&&!t.some(ze)}(t)||(ke.isFileList(t)||ke.endsWith(i,"[]"))&&(a=ke.toArray(t)))return i=Oe(i),a.forEach((function(t,n){!ke.isUndefined(t)&&null!==t&&e.append(!0===s?Ue([i],n,r):null===s?i:i+"[]",l(t))})),!1;return!!ze(t)||(e.append(Ue(o,i,r),l(t)),!1)}const c=[],h=Object.assign(Fe,{defaultVisitor:u,convertValue:l,isVisitable:ze});if(!ke.isObject(t))throw new TypeError("data must be an object");return function t(i,n){if(!ke.isUndefined(i)){if(-1!==c.indexOf(i))throw Error("Circular reference detected in "+n.join("."));c.push(i),ke.forEach(i,(function(i,r){!0===(!(ke.isUndefined(i)||null===i)&&o.call(e,i,ke.isString(r)?r.trim():r,n,h))&&t(i,n?n.concat(r):[r])})),c.pop()}}(t),e};function Ve(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function He(t,e){this._pairs=[],t&&Ne(t,this,e)}const je=He.prototype;je.append=function(t,e){this._pairs.push([t,e])},je.toString=function(t){const e=t?function(e){return t.call(this,e,Ve)}:Ve;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};const Ge=He;function We(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qe(t,e,i){if(!e)return t;const n=i&&i.encode||We;ke.isFunction(i)&&(i={serialize:i});const o=i&&i.serialize;let r;if(r=o?o(e,i):ke.isURLSearchParams(e)?e.toString():new Ge(e,i).toString(n),r){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+r}return t}const Ze=class{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ke.forEach(this.handlers,(function(e){null!==e&&t(e)}))}},$e={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ke={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Ge,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Ye="undefined"!==typeof window&&"undefined"!==typeof document,Je="object"===typeof navigator&&navigator||void 0,Xe=Ye&&(!Je||["ReactNative","NativeScript","NS"].indexOf(Je.product)<0),Qe="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,ti=Ye&&window.location.href||"http://localhost",ei={...t,...Ke};const ii=function(t){function e(t,i,n,o){let r=t[o++];if("__proto__"===r)return!0;const s=Number.isFinite(+r),a=o>=t.length;if(r=!r&&ke.isArray(n)?n.length:r,a)return ke.hasOwnProp(n,r)?n[r]=[n[r],i]:n[r]=i,!s;n[r]&&ke.isObject(n[r])||(n[r]=[]);return e(t,i,n[r],o)&&ke.isArray(n[r])&&(n[r]=function(t){const e={},i=Object.keys(t);let n;const o=i.length;let r;for(n=0;n<o;n++)r=i[n],e[r]=t[r];return e}(n[r])),!s}if(ke.isFormData(t)&&ke.isFunction(t.entries)){const i={};return ke.forEachEntry(t,((t,n)=>{e(function(t){return ke.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}(t),n,i,0)})),i}return null};const ni={transitional:$e,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const i=e.getContentType()||"",n=i.indexOf("application/json")>-1,o=ke.isObject(t);o&&ke.isHTMLForm(t)&&(t=new FormData(t));if(ke.isFormData(t))return n?JSON.stringify(ii(t)):t;if(ke.isArrayBuffer(t)||ke.isBuffer(t)||ke.isStream(t)||ke.isFile(t)||ke.isBlob(t)||ke.isReadableStream(t))return t;if(ke.isArrayBufferView(t))return t.buffer;if(ke.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let r;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return Ne(t,new ei.classes.URLSearchParams,Object.assign({visitor:function(t,e,i,n){return ei.isNode&&ke.isBuffer(t)?(this.append(e,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((r=ke.isFileList(t))||i.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return Ne(r?{"files[]":t}:t,e&&new e,this.formSerializer)}}return o||n?(e.setContentType("application/json",!1),function(t,e,i){if(ke.isString(t))try{return(e||JSON.parse)(t),ke.trim(t)}catch(In){if("SyntaxError"!==In.name)throw In}return(i||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){const e=this.transitional||ni.transitional,i=e&&e.forcedJSONParsing,n="json"===this.responseType;if(ke.isResponse(t)||ke.isReadableStream(t))return t;if(t&&ke.isString(t)&&(i&&!this.responseType||n)){const i=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(In){if(i){if("SyntaxError"===In.name)throw Le.from(In,Le.ERR_BAD_RESPONSE,this,null,this.response);throw In}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ei.classes.FormData,Blob:ei.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ke.forEach(["delete","get","head","post","put","patch"],(t=>{ni.headers[t]={}}));const oi=ni,ri=ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),si=Symbol("internals");function ai(t){return t&&String(t).trim().toLowerCase()}function li(t){return!1===t||null==t?t:ke.isArray(t)?t.map(li):String(t)}function ui(t,e,i,n,o){return ke.isFunction(n)?n.call(this,e,i):(o&&(e=i),ke.isString(e)?ke.isString(n)?-1!==e.indexOf(n):ke.isRegExp(n)?n.test(e):void 0:void 0)}class ci{constructor(t){t&&this.set(t)}set(t,e,i){const n=this;function o(t,e,i){const o=ai(e);if(!o)throw new Error("header name must be a non-empty string");const r=ke.findKey(n,o);(!r||void 0===n[r]||!0===i||void 0===i&&!1!==n[r])&&(n[r||e]=li(t))}const r=(t,e)=>ke.forEach(t,((t,i)=>o(t,i,e)));if(ke.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(ke.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim()))r((t=>{const e={};let i,n,o;return t&&t.split("\n").forEach((function(t){o=t.indexOf(":"),i=t.substring(0,o).trim().toLowerCase(),n=t.substring(o+1).trim(),!i||e[i]&&ri[i]||("set-cookie"===i?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)})),e})(t),e);else if(ke.isHeaders(t))for(const[s,a]of t.entries())o(a,s,i);else null!=t&&o(e,t,i);return this}get(t,e){if(t=ai(t)){const i=ke.findKey(this,t);if(i){const t=this[i];if(!e)return t;if(!0===e)return function(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}(t);if(ke.isFunction(e))return e.call(this,t,i);if(ke.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ai(t)){const i=ke.findKey(this,t);return!(!i||void 0===this[i]||e&&!ui(0,this[i],i,e))}return!1}delete(t,e){const i=this;let n=!1;function o(t){if(t=ai(t)){const o=ke.findKey(i,t);!o||e&&!ui(0,i[o],o,e)||(delete i[o],n=!0)}}return ke.isArray(t)?t.forEach(o):o(t),n}clear(t){const e=Object.keys(this);let i=e.length,n=!1;for(;i--;){const o=e[i];t&&!ui(0,this[o],o,t,!0)||(delete this[o],n=!0)}return n}normalize(t){const e=this,i={};return ke.forEach(this,((n,o)=>{const r=ke.findKey(i,o);if(r)return e[r]=li(n),void delete e[o];const s=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,i)=>e.toUpperCase()+i))}(o):String(o).trim();s!==o&&delete e[o],e[s]=li(n),i[s]=!0})),this}concat(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return ke.forEach(this,((i,n)=>{null!=i&&!1!==i&&(e[n]=t&&ke.isArray(i)?i.join(", "):i)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[e,i]=t;return e+": "+i})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n.forEach((t=>e.set(t))),e}static accessor(t){const e=(this[si]=this[si]={accessors:{}}).accessors,i=this.prototype;function n(t){const n=ai(t);e[n]||(!function(t,e){const i=ke.toCamelCase(" "+e);["get","set","has"].forEach((n=>{Object.defineProperty(t,n+i,{value:function(t,i,o){return this[n].call(this,e,t,i,o)},configurable:!0})}))}(i,t),e[n]=!0)}return ke.isArray(t)?t.forEach(n):n(t),this}}ci.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ke.reduceDescriptors(ci.prototype,((t,e)=>{let{value:i}=t,n=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(t){this[n]=t}}})),ke.freezeMethods(ci);const hi=ci;function di(t,e){const i=this||oi,n=e||i,o=hi.from(n.headers);let r=n.data;return ke.forEach(t,(function(t){r=t.call(i,r,o.normalize(),e?e.status:void 0)})),o.normalize(),r}function fi(t){return!(!t||!t.__CANCEL__)}function pi(t,e,i){Le.call(this,null==t?"canceled":t,Le.ERR_CANCELED,e,i),this.name="CanceledError"}ke.inherits(pi,Le,{__CANCEL__:!0});const mi=pi;function gi(t,e,i){const n=i.config.validateStatus;i.status&&n&&!n(i.status)?e(new Le("Request failed with status code "+i.status,[Le.ERR_BAD_REQUEST,Le.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}const yi=function(t,e){t=t||10;const i=new Array(t),n=new Array(t);let o,r=0,s=0;return e=void 0!==e?e:1e3,function(a){const l=Date.now(),u=n[s];o||(o=l),i[r]=a,n[r]=l;let c=s,h=0;for(;c!==r;)h+=i[c++],c%=t;if(r=(r+1)%t,r===s&&(s=(s+1)%t),l-o<e)return;const d=u&&l-u;return d?Math.round(1e3*h/d):void 0}};const _i=function(t,e){let i,n,o=0,r=1e3/e;const s=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();o=r,i=null,n&&(clearTimeout(n),n=null),t.apply(null,e)};return[function(){const t=Date.now(),e=t-o;for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];e>=r?s(l,t):(i=l,n||(n=setTimeout((()=>{n=null,s(i)}),r-e)))},()=>i&&s(i)]},vi=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const o=yi(50,250);return _i((i=>{const r=i.loaded,s=i.lengthComputable?i.total:void 0,a=r-n,l=o(a);n=r;t({loaded:r,total:s,progress:s?r/s:void 0,bytes:a,rate:l||void 0,estimated:l&&s&&r<=s?(s-r)/l:void 0,event:i,lengthComputable:null!=s,[e?"download":"upload"]:!0})}),i)},xi=(t,e)=>{const i=null!=t;return[n=>e[0]({lengthComputable:i,total:t,loaded:n}),e[1]]},bi=t=>function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return ke.asap((()=>t(...i)))},Ci=ei.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,ei.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(ei.origin),ei.navigator&&/(msie|trident)/i.test(ei.navigator.userAgent)):()=>!0,wi=ei.hasStandardBrowserEnv?{write(t,e,i,n,o,r){const s=[t+"="+encodeURIComponent(e)];ke.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),ke.isString(n)&&s.push("path="+n),ke.isString(o)&&s.push("domain="+o),!0===r&&s.push("secure"),document.cookie=s.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Si(t,e,i){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e);return t&&(n||0==i)?function(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}const Ti=t=>t instanceof hi?{...t}:t;function Ai(t,e){e=e||{};const i={};function n(t,e,i,n){return ke.isPlainObject(t)&&ke.isPlainObject(e)?ke.merge.call({caseless:n},t,e):ke.isPlainObject(e)?ke.merge({},e):ke.isArray(e)?e.slice():e}function o(t,e,i,o){return ke.isUndefined(e)?ke.isUndefined(t)?void 0:n(void 0,t,0,o):n(t,e,0,o)}function r(t,e){if(!ke.isUndefined(e))return n(void 0,e)}function s(t,e){return ke.isUndefined(e)?ke.isUndefined(t)?void 0:n(void 0,t):n(void 0,e)}function a(i,o,r){return r in e?n(i,o):r in t?n(void 0,i):void 0}const l={url:r,method:r,data:r,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(t,e,i)=>o(Ti(t),Ti(e),0,!0)};return ke.forEach(Object.keys(Object.assign({},t,e)),(function(n){const r=l[n]||o,s=r(t[n],e[n],n);ke.isUndefined(s)&&r!==a||(i[n]=s)})),i}const Mi=t=>{const e=Ai({},t);let i,{data:n,withXSRFToken:o,xsrfHeaderName:r,xsrfCookieName:s,headers:a,auth:l}=e;if(e.headers=a=hi.from(a),e.url=qe(Si(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),ke.isFormData(n))if(ei.hasStandardBrowserEnv||ei.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(i=a.getContentType())){const[t,...e]=i?i.split(";").map((t=>t.trim())).filter(Boolean):[];a.setContentType([t||"multipart/form-data",...e].join("; "))}if(ei.hasStandardBrowserEnv&&(o&&ke.isFunction(o)&&(o=o(e)),o||!1!==o&&Ci(e.url))){const t=r&&s&&wi.read(s);t&&a.set(r,t)}return e},Ii="undefined"!==typeof XMLHttpRequest&&function(t){return new Promise((function(e,i){const n=Mi(t);let o=n.data;const r=hi.from(n.headers).normalize();let s,a,l,u,c,{responseType:h,onUploadProgress:d,onDownloadProgress:f}=n;function p(){u&&u(),c&&c(),n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}let m=new XMLHttpRequest;function g(){if(!m)return;const n=hi.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());gi((function(t){e(t),p()}),(function(t){i(t),p()}),{data:h&&"text"!==h&&"json"!==h?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:t,request:m}),m=null}m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(i(new Le("Request aborted",Le.ECONNABORTED,t,m)),m=null)},m.onerror=function(){i(new Le("Network Error",Le.ERR_NETWORK,t,m)),m=null},m.ontimeout=function(){let e=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const o=n.transitional||$e;n.timeoutErrorMessage&&(e=n.timeoutErrorMessage),i(new Le(e,o.clarifyTimeoutError?Le.ETIMEDOUT:Le.ECONNABORTED,t,m)),m=null},void 0===o&&r.setContentType(null),"setRequestHeader"in m&&ke.forEach(r.toJSON(),(function(t,e){m.setRequestHeader(e,t)})),ke.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),h&&"json"!==h&&(m.responseType=n.responseType),f&&([l,c]=vi(f,!0),m.addEventListener("progress",l)),d&&m.upload&&([a,u]=vi(d),m.upload.addEventListener("progress",a),m.upload.addEventListener("loadend",u)),(n.cancelToken||n.signal)&&(s=e=>{m&&(i(!e||e.type?new mi(null,t,m):e),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const y=function(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(n.url);y&&-1===ei.protocols.indexOf(y)?i(new Le("Unsupported protocol "+y+":",Le.ERR_BAD_REQUEST,t)):m.send(o||null)}))},Ei=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let i,n=new AbortController;const o=function(t){if(!i){i=!0,s();const e=t instanceof Error?t:this.reason;n.abort(e instanceof Le?e:new mi(e instanceof Error?e.message:e))}};let r=e&&setTimeout((()=>{r=null,o(new Le(`timeout ${e} of ms exceeded`,Le.ETIMEDOUT))}),e);const s=()=>{t&&(r&&clearTimeout(r),r=null,t.forEach((t=>{t.unsubscribe?t.unsubscribe(o):t.removeEventListener("abort",o)})),t=null)};t.forEach((t=>t.addEventListener("abort",o)));const{signal:a}=n;return a.unsubscribe=()=>ke.asap(s),a}},Pi=function*(t,e){let i=t.byteLength;if(!e||i<e)return void(yield t);let n,o=0;for(;o<i;)n=o+e,yield t.slice(o,n),o=n},ki=async function*(t){if(t[Symbol.asyncIterator])return void(yield*t);const e=t.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},Bi=(t,e,i,n)=>{const o=async function*(t,e){for await(const i of ki(t))yield*Pi(i,e)}(t,e);let r,s=0,a=t=>{r||(r=!0,n&&n(t))};return new ReadableStream({async pull(t){try{const{done:e,value:n}=await o.next();if(e)return a(),void t.close();let r=n.byteLength;if(i){let t=s+=r;i(t)}t.enqueue(new Uint8Array(n))}catch(e){throw a(e),e}},cancel:t=>(a(t),o.return())},{highWaterMark:2})},Di="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,Ri=Di&&"function"===typeof ReadableStream,Li=Di&&("function"===typeof TextEncoder?(zi=new TextEncoder,t=>zi.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var zi;const Oi=function(t){try{for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return!!t(...i)}catch(In){return!1}},Ui=Ri&&Oi((()=>{let t=!1;const e=new Request(ei.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})),Fi=Ri&&Oi((()=>ke.isReadableStream(new Response("").body))),Ni={stream:Fi&&(t=>t.body)};var Vi;Di&&(Vi=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!Ni[t]&&(Ni[t]=ke.isFunction(Vi[t])?e=>e[t]():(e,i)=>{throw new Le(`Response type '${t}' is not supported`,Le.ERR_NOT_SUPPORT,i)})})));const Hi=async(t,e)=>{const i=ke.toFiniteNumber(t.getContentLength());return null==i?(async t=>{if(null==t)return 0;if(ke.isBlob(t))return t.size;if(ke.isSpecCompliantForm(t)){const e=new Request(ei.origin,{method:"POST",body:t});return(await e.arrayBuffer()).byteLength}return ke.isArrayBufferView(t)||ke.isArrayBuffer(t)?t.byteLength:(ke.isURLSearchParams(t)&&(t+=""),ke.isString(t)?(await Li(t)).byteLength:void 0)})(e):i},ji=Di&&(async t=>{let{url:e,method:i,data:n,signal:o,cancelToken:r,timeout:s,onDownloadProgress:a,onUploadProgress:l,responseType:u,headers:c,withCredentials:h="same-origin",fetchOptions:d}=Mi(t);u=u?(u+"").toLowerCase():"text";let f,p=Ei([o,r&&r.toAbortSignal()],s);const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(l&&Ui&&"get"!==i&&"head"!==i&&0!==(g=await Hi(c,n))){let t,i=new Request(e,{method:"POST",body:n,duplex:"half"});if(ke.isFormData(n)&&(t=i.headers.get("content-type"))&&c.setContentType(t),i.body){const[t,e]=xi(g,vi(bi(l)));n=Bi(i.body,65536,t,e)}}ke.isString(h)||(h=h?"include":"omit");const o="credentials"in Request.prototype;f=new Request(e,{...d,signal:p,method:i.toUpperCase(),headers:c.normalize().toJSON(),body:n,duplex:"half",credentials:o?h:void 0});let r=await fetch(f);const s=Fi&&("stream"===u||"response"===u);if(Fi&&(a||s&&m)){const t={};["status","statusText","headers"].forEach((e=>{t[e]=r[e]}));const e=ke.toFiniteNumber(r.headers.get("content-length")),[i,n]=a&&xi(e,vi(bi(a),!0))||[];r=new Response(Bi(r.body,65536,i,(()=>{n&&n(),m&&m()})),t)}u=u||"text";let y=await Ni[ke.findKey(Ni,u)||"text"](r,t);return!s&&m&&m(),await new Promise(((e,i)=>{gi(e,i,{data:y,headers:hi.from(r.headers),status:r.status,statusText:r.statusText,config:t,request:f})}))}catch(y){if(m&&m(),y&&"TypeError"===y.name&&/fetch/i.test(y.message))throw Object.assign(new Le("Network Error",Le.ERR_NETWORK,t,f),{cause:y.cause||y});throw Le.from(y,y&&y.code,t,f)}}),Gi={http:null,xhr:Ii,fetch:ji};ke.forEach(Gi,((t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(In){}Object.defineProperty(t,"adapterName",{value:e})}}));const Wi=t=>`- ${t}`,qi=t=>ke.isFunction(t)||null===t||!1===t,Zi=t=>{t=ke.isArray(t)?t:[t];const{length:e}=t;let i,n;const o={};for(let r=0;r<e;r++){let e;if(i=t[r],n=i,!qi(i)&&(n=Gi[(e=String(i)).toLowerCase()],void 0===n))throw new Le(`Unknown adapter '${e}'`);if(n)break;o[e||"#"+r]=n}if(!n){const t=Object.entries(o).map((t=>{let[e,i]=t;return`adapter ${e} `+(!1===i?"is not supported by the environment":"is not available in the build")}));let i=e?t.length>1?"since :\n"+t.map(Wi).join("\n"):" "+Wi(t[0]):"as no adapter specified";throw new Le("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n};function $i(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new mi(null,t)}function Ki(t){$i(t),t.headers=hi.from(t.headers),t.data=di.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1);return Zi(t.adapter||oi.adapter)(t).then((function(e){return $i(t),e.data=di.call(t,t.transformResponse,e),e.headers=hi.from(e.headers),e}),(function(e){return fi(e)||($i(t),e&&e.response&&(e.response.data=di.call(t,t.transformResponse,e.response),e.response.headers=hi.from(e.response.headers))),Promise.reject(e)}))}const Yi="1.8.4",Ji={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{Ji[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));const Xi={};Ji.transitional=function(t,e,i){function n(t,e){return"[Axios v1.8.4] Transitional option '"+t+"'"+e+(i?". "+i:"")}return(i,o,r)=>{if(!1===t)throw new Le(n(o," has been removed"+(e?" in "+e:"")),Le.ERR_DEPRECATED);return e&&!Xi[o]&&(Xi[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,o,r)}},Ji.spelling=function(t){return(e,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};const Qi={assertOptions:function(t,e,i){if("object"!==typeof t)throw new Le("options must be an object",Le.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let o=n.length;for(;o-- >0;){const r=n[o],s=e[r];if(s){const e=t[r],i=void 0===e||s(e,r,t);if(!0!==i)throw new Le("option "+r+" must be "+i,Le.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new Le("Unknown option "+r,Le.ERR_BAD_OPTION)}},validators:Ji},tn=Qi.validators;class en{constructor(t){this.defaults=t,this.interceptors={request:new Ze,response:new Ze}}async request(t,e){try{return await this._request(t,e)}catch(i){if(i instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const e=t.stack?t.stack.replace(/^.+\n/,""):"";try{i.stack?e&&!String(i.stack).endsWith(e.replace(/^.+\n.+\n/,""))&&(i.stack+="\n"+e):i.stack=e}catch(In){}}throw i}}_request(t,e){"string"===typeof t?(e=e||{}).url=t:e=t||{},e=Ai(this.defaults,e);const{transitional:i,paramsSerializer:n,headers:o}=e;void 0!==i&&Qi.assertOptions(i,{silentJSONParsing:tn.transitional(tn.boolean),forcedJSONParsing:tn.transitional(tn.boolean),clarifyTimeoutError:tn.transitional(tn.boolean)},!1),null!=n&&(ke.isFunction(n)?e.paramsSerializer={serialize:n}:Qi.assertOptions(n,{encode:tn.function,serialize:tn.function},!0)),void 0!==e.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Qi.assertOptions(e,{baseUrl:tn.spelling("baseURL"),withXsrfToken:tn.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=o&&ke.merge(o.common,o[e.method]);o&&ke.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete o[t]})),e.headers=hi.concat(r,o);const s=[];let a=!0;this.interceptors.request.forEach((function(t){"function"===typeof t.runWhen&&!1===t.runWhen(e)||(a=a&&t.synchronous,s.unshift(t.fulfilled,t.rejected))}));const l=[];let u;this.interceptors.response.forEach((function(t){l.push(t.fulfilled,t.rejected)}));let c,h=0;if(!a){const t=[Ki.bind(this),void 0];for(t.unshift.apply(t,s),t.push.apply(t,l),c=t.length,u=Promise.resolve(e);h<c;)u=u.then(t[h++],t[h++]);return u}c=s.length;let d=e;for(h=0;h<c;){const t=s[h++],e=s[h++];try{d=t(d)}catch(f){e.call(this,f);break}}try{u=Ki.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,c=l.length;h<c;)u=u.then(l[h++],l[h++]);return u}getUri(t){return qe(Si((t=Ai(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}}ke.forEach(["delete","get","head","options"],(function(t){en.prototype[t]=function(e,i){return this.request(Ai(i||{},{method:t,url:e,data:(i||{}).data}))}})),ke.forEach(["post","put","patch"],(function(t){function e(e){return function(i,n,o){return this.request(Ai(o||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}en.prototype[t]=e(),en.prototype[t+"Form"]=e(!0)}));const nn=en;class on{constructor(t){if("function"!==typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const i=this;this.promise.then((t=>{if(!i._listeners)return;let e=i._listeners.length;for(;e-- >0;)i._listeners[e](t);i._listeners=null})),this.promise.then=t=>{let e;const n=new Promise((t=>{i.subscribe(t),e=t})).then(t);return n.cancel=function(){i.unsubscribe(e)},n},t((function(t,n,o){i.reason||(i.reason=new mi(t,n,o),e(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=e=>{t.abort(e)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new on((function(e){t=e})),cancel:t}}}const rn=on;const sn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(sn).forEach((t=>{let[e,i]=t;sn[i]=e}));const an=sn;const ln=function t(e){const i=new nn(e),n=$t(nn.prototype.request,i);return ke.extend(n,nn.prototype,i,{allOwnKeys:!0}),ke.extend(n,i,null,{allOwnKeys:!0}),n.create=function(i){return t(Ai(e,i))},n}(oi);ln.Axios=nn,ln.CanceledError=mi,ln.CancelToken=rn,ln.isCancel=fi,ln.VERSION=Yi,ln.toFormData=Ne,ln.AxiosError=Le,ln.Cancel=ln.CanceledError,ln.all=function(t){return Promise.all(t)},ln.spread=function(t){return function(e){return t.apply(null,e)}},ln.isAxiosError=function(t){return ke.isObject(t)&&!0===t.isAxiosError},ln.mergeConfig=Ai,ln.AxiosHeaders=hi,ln.formToJSON=t=>ii(ke.isHTMLForm(t)?new FormData(t):t),ln.getAdapter=Zi,ln.HttpStatusCode=an,ln.default=ln;const un=ln.create({baseURL:"http://54.167.93.51:8000"}),cn=()=>{const t=et(),[e,i]=(0,n.useState)([]),[o,r]=(0,n.useState)(""),[s,a]=(0,n.useState)("");return(0,Pt.jsxs)("div",{className:"upload-form-container",children:[(0,Pt.jsx)("div",{className:"drag-and-drop",children:(0,Pt.jsx)(Wt,{onFilesSelected:t=>{i(t)}})}),(0,Pt.jsxs)("div",{className:"university-search-container",children:[(0,Pt.jsx)(Zt,{onUniversitySelect:t=>{r(t)}}),(0,Pt.jsx)("button",{className:"upload-button",onClick:async()=>{if(0===e.length||!o)return void alert("Please upload a file and select a university before submitting.");console.log("Files:",e),console.log("University:",o);const i=new FormData;e.forEach((t=>i.append("file",t))),i.append("school_location",o);try{const e=await un.post("/api/upload/",i,{headers:{"Content-Type":"multipart/form-data"}});a("File uploaded successfully!"),console.log("Response:",e.data);const n=e.data.short_id;t(`/view/${n}`)}catch(n){console.error("Error uploading file:",n),a("Error uploading file.")}},children:"Submit"})]}),s&&(0,Pt.jsx)("p",{children:s})]})},hn=()=>(0,Pt.jsxs)("div",{id:"about",className:"about-container",children:[(0,Pt.jsx)("div",{className:"about-header",children:(0,Pt.jsx)("h1",{children:"About"})}),(0,Pt.jsxs)("div",{className:"about-content",children:[(0,Pt.jsxs)("section",{className:"about-section",children:[(0,Pt.jsx)("h2",{children:"What is Routify?"}),(0,Pt.jsx)("p",{children:"Routify is an intuitive app designed to tackle the issue of getting the classes you want, only to find they are halfway across campus. By uploading your class schedule, Routify helps you visualize and plan your routes between classes, saving time and reducing stress."})]}),(0,Pt.jsxs)("section",{className:"about-section",children:[(0,Pt.jsx)("h2",{children:"How it Works"}),(0,Pt.jsx)("p",{children:"Simply upload your class schedule as an .ics file and Routify will map your classes for each day of the week. With time and distance estimates, you\u2019ll always know if your schedule works for you."})]}),(0,Pt.jsxs)("section",{className:"about-section",children:[(0,Pt.jsx)("h2",{children:"Why Routify?"}),(0,Pt.jsx)("p",{children:"As previous first-years ourselves, we know the confusion of navigating a huge new campus all too well. We also know that just because your schedule works online, it doesn't always work in-person. Whether you're a new student or someone just looking to shave off some time from their schedule, Routify has the answer."})]})]})]}),dn=i.p+"static/media/jonathan_lam.ba30e8dd3bb502dc72e2.jpg",fn=i.p+"static/media/kyle_luong.b87d1729fae17d37d31a.jpeg",pn=()=>(0,Pt.jsxs)("div",{id:"team",className:"team-container",children:[(0,Pt.jsx)("div",{className:"team-header",children:(0,Pt.jsx)("h1",{children:"The Team"})}),(0,Pt.jsx)("div",{className:"team-content",children:(0,Pt.jsxs)("div",{className:"team-cards",children:[(0,Pt.jsxs)("div",{className:"team-card",children:[(0,Pt.jsx)("div",{className:"team-card-image",children:(0,Pt.jsx)("img",{src:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wgARCADIAMgDASIAAhEBAxEB/8QAHAAAAAcBAQAAAAAAAAAAAAAAAAECAwQFBwYI/8QAGgEAAgMBAQAAAAAAAAAAAAAAAAECAwQFBv/aAAwDAQACEAMQAAAB9CgE4mQIDIgBsozJutyXjOeUrRNcpk9UI2uw2zzGyj3zI8N+uEdkTIE6lsA4TYTWGwFwQKSABACNDMm82apjo4TdrPJUjXYUlVtQrooLVPGsIMoN9HzQS9rdRiOmOPTHTy2pojrE6EALwEGwRkAIEzzjinu3xvF1XYdlc8/qUM+n6GjTQ8FqWVQnx6OytteHKLa10q7L1dnXOUu4tuUnWw6yVy9ndVdiEJx7AEUgyBNAgQHl+ncXGfG2C9E4/a8ua/1V7G3J8w1zhqdHCXPfVVlOb6Hylzqw9a/DlGeS8SpRObBekr4QRfTphENNQIEAIEIcf11Fm3VPWcjecjrsQZES2WT1PQcrVd2FKhFcaq3hXenLZSoUnRzbRbLjit5iU1KChZVpJAttABEBpBMCFEykTa8tx+xQtXs7N08P5LTuOlIptHbQz3cu2i7eUxISsjPdZcknZkGY4zgBbVopEWuhRETZkAwiMNFQ33GZtNNGvee4ffz2hnUs0O14x6yjb61qx38msNwU2Omk5JcqJLFYBIup0UiGyoyAEAYYGOK83SWtVuPa5Xfs1eD856DPuE0XmHKioNCrr82MaTlpdfi+nZ/lvQqp7EOZ6Omb8yJOFJBiyvQgk9tKhSYe1s2B59FmNKRYgXXclFkeolalwfG6vFQZ/QZN1Nwu8eRuly+PUoaMqH480G7WAgNQ0bzMK5evRkggemfNW7+Nt2eYyldg2h4ouOmRJBMeRHZ6N3ryv2NUskus6k9Cr1B5I9YeS+dfDJ00MTkNNSI70BNxsCLuBQCifrzzBu+FdDKtcZ9jyFmnCnRnUEw4yO79JeUvWDeIWec9Jrq9MeKvW/kfFcsE5BsGwmDDRKg1hCpEcGIPb8w7vgtuZqZXTYyfDQYZE2mSUHFt6Lnrl8LTnbuk30elfNupZZydbhpYg44CaphaFAlSFMIAI1LhwNWdhQClIMBgQADAAhJyKBZG6qQOtku+eA5Gx2EBTNCQKpAwAS6AwAC2H//EACwQAAAGAQIFBAICAwAAAAAAAAABAgMEBREGEhATFCExByAiMBVBIzIlJjb/2gAIAQEAAQUC97zyWE6g9Qk1zkrXs99KppuGh8LWhwEW1VbqSdVnU+pLD4asG5CGnuYWRkZ+s30i91bAq03Ni5ZSy7jHckmMYSg9oNY3CruX6p7Tty1bwdwyMjIyM/Rq2T+LafeVIdfSeUIPJNmQWr5llY5RhSccaO7kU0monqmsE5kbhn6VeNdztzu4+TsSREne6+ySY7cL4tQ+0gsKM8kfkF3GiZi1VKJQS/kE4Nw3DPuPxqDTpsiWhUVVbEXKcXSqizYWlXbApelDaS/XtwWJNc4YWjYG4y3jebU0utrHZzkFlMOOToQ+G5AS6CcBK98iMiQ3qurchXmi69qRXP0820ck1c+GpidJWLN3pUyEv2zjmlloTVQ1xlakY5U3TzCWa4jGQRhK8Bt4IdCV/Rr+uRJptBp/w85+yOTNbtnLHTEJxDWsWuYmKTqQtmzW5XlJQeq0fzVyeXDIwQIuBBtwIX9GpZJKi6Qjqh1aGNyDhtcxDRILUaTWqMREvYjavGbyN1b1Q8tSUmEguKQg/olHsu4MpuS4058ZBnvfuVxJN/dvc+NLJ9a3Pio+8x825EBPzSEmC4pCfotI5PMwIxR2UHsEyYhgnZJG1aPx3AmShodTuLOQ4xzTYRsQkJCfHBIT9Ci3E61yVqXgreq/NHIhw4jM8q40NQW3XEqwZKwGWMFgEEhHgEEBP0vN81DpqaNrcYkQEvos4LBG63yyzg4DfWSVs4GwbQRBPgEEBP1WSN4KQuIuZep2TLQlDq8kajWem0ZnOthSBgEXsbCfqXbMzbN6NuEuiS6ibVOsq5RkCR3XZPVAqL6NeMuJBkC9iAn6Hnm47eo9dIdZ0CzlSg8ram1cIi5eTNsW7ClQmJDkZ2t1u4kRZ8eejiQQE+++1hCpCudRzb54aDdUthmUiZHUklps2SNXJ79PkagidJpMGGHnI64Gr3mxE1BClhKiMJCQXtt9RQqVF1ribZBa8mwkGXbSFn+I1JdQndMWKZqHUyy5hoYwIcJUx31LmoU4MAvOOES0kwTg6zIhAuYc8FxsrmJUN3PqBJlh5xTqzMYyZJ2hXYLM0ikmtahobPRao4KHLQ6zRTZJvtt1MTUks5ttgZwDVkJLJbQZDA3Gg9H3bjwM9pWmvZ0t12Qt5YMYCy+LbasF4WPSee5ybWyZqIFtqO2/JaU9RpcCZdPbmp5YlgmyWCa2mRDAVwPuKWV0lpfSekpz7O8McCInFnwUPS2Rtudc2f59+xSpotO0x2L0WCtMGUvmyMBAX2THMzC1YBq4F5zg9fSOTRPeCGQQMh/VSgYMafkHHuIVShL+vOQdzoZJORbFfTwj8kMB48IR8ULVniX9B6lSOyu5Mn8AkKBkCP4KPg25yZFvdHCp5B7homzTDvdbSOmoj8kCDp5WauBAwfZoeoz266DZ4c4HwyDMEHfFhanMrJrKmDZVypWvJRP0J+SBngvPEgoOeR6gq/2EL+K8jPD9H2BhIcEJwzUvKg+0pty6ndTpP9h0+3s/Zd1H3P1B/wCg/TnySyvcniYMEFeGD2SPBPKNbjsk1VX7Czyr2l2Josq//8QAJxEAAQMCBQQCAwAAAAAAAAAAAQACAxEgEBIhIjEEEzBBMlEjM0D/2gAIAQMBAT8B/hAJXb1ojGQqYUvBTWhrAVG13tqkb9Bdk13BFlHkKiLURbGx0hytTNsdCm7NKpzcwohFl9p8Rq5+JVLOicGy6+09oOgQNRQhcJxUrssdPvE3dNNn0dyq5Sn7k91EXF2pxN3TftGG5Sj8ZTTiboXZZAcKrqHUjOAdgb4eoHD13Gj2ppe5xxZXwR7lW0GlxO1Qu58knwKiKF/qw/EpiCFhX//EACYRAAICAQMEAgIDAAAAAAAAAAABAhEDEBIgBCEiMTBBM1ETQEL/2gAIAQIBAT8B/otoc+1iyJl6X8EpXNonOP0yE/2z+Zf5Zv8AGzcKYpF8JSUFciXllbJef0J7XY8u76N6pR1TE+HUxvH2E6diXfsSTEiCuV/D1OHY7j6Mc2vRLKyKsqtULj1H4mdjxMbuaRKOqFwozQ3Y2tcELno4foa0WiXDN07vxFCXqjFj2FCKNiH2I8auSszNY1Rtp2Ueuw9JR3C9cccd06Osx0kkP1pffguPT/mR1Csl25I++EO04mQn7Jaoj6P/xAA5EAABAwEFBAcHAwQDAAAAAAABAAIDEQQSITFBECIwURMgMkJSYXEFFCOBobHRQFORJUNiwXJzgv/aAAgBAQAGPwLr3nGgToYIrzx33p17oyT/AI5Il2qwPyWINUHRZodFM9gb3DiE1lsZ0bvGMkHxEPYdQVWnGzCfR3vFpy3cfqjPL2zkOSx6lF5bBJDI4UzFUyWN293hyPGL2yX3HHoiK08058h81U5lZKt1ChrRU06t+J5DT2m6FNmJrXz4skAJvk1chTNNvYuKbQaVKc84eXNVcMSidKr02HaGv7poDxbfajec5zyU1rt13hTPCHAH+VQ13WYga8l0s25ybyRoanRC9mNAnSOF2uhWJWAzyRa7NNuDdriU2NmQ4pa4A1UrZcamoPNWkvGBdd/hFwc2OMdm9n6pv9RdhoE1p30TL2tK6KgJKqZN7zRY/eGhQ82qEjNwrx3T3KyQkGvkpDzkP2CuWeLo49ZD+ERI99znUb3yTX2gfFVRmmCMmNnecM04yPw0oQvjAeqgdzChbyaOO6wgF0tpaQKaLoXdtsjgUSVW6FRgVUViNlkb5lPjfnGacdr3dlsValWh0fZv7MEyGOCSQkVc/QK6GEkIPYCOe1ju6M1K/RxqOOfS7UJjAQaNzGwE680T0jR6lEEgvGq3SDtdUEjyKA49Cq907GRdI6NgdUlqc2YuqOareJd5OKaWueGjHNU2X8d79CWq4/ArdVZKI3WtC3djY9Nf0Y9FjiF2kcdo/wCJ/RzWSI3jA0XnDmdFjkiWnFHIjayeA0eHa5EclVm5MO1Ecx+gdJK9sbG5ucaBOs/s5xxwdPl/CttoPNsf3PWe/SMglCSJ5jeMnNQZbWdIP3GZq/BIJB5acUsve8Wn9phy9V8d/wAPSNuDRs9qwR4zNay0xjndzH1TZY8WuCz6jpnYG02kNb6Cu0PjeWOGrSg20s6UeJuBWEwY7k/BYcD48tZNIm4uTmRH3WHwszPz2F2yxTE0je7on+hwTpmAn2baHV/63clUHNYO2CNgx58grDYocIYWGg63wpSB4dEBaov/AFH+F8GdrneE4HqXrTMGnRnePyRjsY92i8XeP4Rc5xcTmTtpy2VGYVnleGyNmj32nEV1Rf7Ofu/sPP2K6OSCQP5XUAIujbq9+ARghzPbk1cpXaN3RwKg0I1UllneXubvNc7NEnIKWOzkWaGuBZ2qeqL3uL3HVx6uDiFzPPZJZSax1qByU1rtBoyMfz5KW1e+PjdPiGQuwaNAug9ozOtFkkPbfi6M804txqMFKP8AI7D14X6F10/NWyXlGaeq9erQqm10V6neTbFZ3fBgdWoyc5EOF1zTQrpXdhp+q6LO4N0nkpHc3E9Q9T02Fn7sgb/v/Sry6oPUhxuiTcNEd2nmrQ2DuBrXkauogBmHmqtT8ujgdJ9OpTqu2WGHzc4o8GKTwuBXTsIrdoPVOLiTeNSU2CvwJzdx0OitdM5GBv14LfPHZCzwRj7nY4fPg2GGvdvn1y/KuO5VwTH1u3XVqrJIMpmt/PUr1QNj/Jrftsa7glp7ow2FrhQr2I2tSA4H5YcOX0b9uH67CXGpVlgP9pz/AK8P/8QAKBABAAIBAwIGAwEBAQAAAAAAAQARITFBURBhIHGBkaGxwdHw4fEw/9oACAEBAAE/IXx0V95CB3Nm2vID9kT3teQOAVqEjdliFlnCmN7YNTEhpVJ8QdZPwNPlL5Gw/dNYLQMFR9pqwFp4BcuXLj1uXLgWqmt2MJBgUo99h2Jatujom8LI5AfNgmmz7gaL8obVfpEHLeztN0M4rDqIbhV8/FKaHihcfC5I+U2gA/SWZuBu8Q+k2uJS3h3ldomXyj3UBpxKLldxEHL2vmftRwpNzviGMddghCwbxaDFHouXLj4UiqHiVK+NDsSphQVvmbDO1doYCop/X3LOFdU0hVMs3PiPiyVLKvpCQ5cdJcyTds+0neh7pfCTxllBLzgBq2sP2hNJOFpkloCsPZB+ZS/FMzX/AIgGzPtf6jhSFcCYW6Bmb2g+rj2ICQMNkHDrjh8wXqEB8onDAmoohvHHWWby/rN+G4CtGiQakYvi0ED7ICYL1G3rQGBvxH3LHL0UdZQBaXBWcXtNVptFRDHdO0JIBU4gEGSegRmjdDfv4y5cFNFSZypiFW4jW2ayK70bZX81D3jDHlM6Bxp5z0laTFcFq57BwcymdssIXPLGY9unz/sIL/i6WXWVMYemuZfR63BjlYs7mLx+GMfiVCGMsLyJRBghzUG0Cg12imBflNGaRDe6mxiJbdE9ug8w46E1yuPS5cuXLhn6aNAzBLp2vlot94bWVhulQ/pAPzX6l6sMmJj+uLszUbVK8d4OyzT1TEtN7EUzEeOhDnpXpfhZGy2gtBmwsCq8sxOJR6clErh5hqnJXSPYDiYaWWaQthcHZRnEweFGhFFH0EPRfiYCZBiBhpFGSBZEp4GaYtGFClH5isd9H5i9gteqAtsGCGJnWWVbQr0qKBiz1HrfhFzF6PDGg9zZJeLZuaTVbylo7EZggdoLXmfq1LtNCFBHoZ5hB0Ppet+I8vKOK92NZGLXZpNZrGiEY2advptZmgY6EUcdf/EVDRmLH4VB0spWw7pgsG9QRTFDK/QhBe6UtbXz/UOTvKJmhqXLh11z0vwiwK6I9YsrtGj5+sdtd/Ggh7S6bimjWOXUr2n3skWj8zX32KScO3VXrNH4nOTbZ8xqdSCDodfDUGwDTUO7b7mdpf8AGO73YOO0C/z0ZPWK+sZTIFbRRfojoKxARi0mgxLyf5X0E0SXVGCgB/To/EoBh3/6goqx4mbDjpvPWokop3J6besOt3FuLv8ApGzZe8ts8joN6oHT/dT6TOPRNH1XZ1J7NCKugwcnMv7LXZvLM6ROTQv7lTKCqMIqoE7+N+xlwp/Wr9ygEm98LH0Jjk2DPkwltZv9b8PeLue0WrKJcg1ZQDpGINXYlA29feBfaHspQTzjjws6I/rR94G7lD8kV1bsD9y41PNqfg7R3ul5R0ogNGsbqlgAdkAckpwW0um5cNFWRYckYzPu/Samu7iwvozlUJuN5zDXyQcTXLCt0zdFrd7DuuI/ANZdm+XzBFWz+0hyfyibdTcdGcgBfMqpnWs7uQ6iKipizIHLM7V6AwmRqRruKPlnt8NYGJolVLy41hopg4IUEc1PXAdyqfxLw25bR/IXEgUxuJGTjUDmEbbBwMGp/wBBhmRFTTiK1lgXDMyWMGyZN4LBAjSNzPmfRi4YDmuOMESUXLQNpy2YsR3Kldp1WGHzQuFMHtwAAv2weYw37C82PxUDSino6+SLPpM5UDyjql6EuianmibysLqF7B+Ya3JLRyYZUPRbLh2xMETEydX2soaa1uzH92lZQ3GvLBWg4/q7espir0u1fuakxZqlMbEuI9DomK5MGke8wP1U/UuXDvh0Goosxx03mHKD6/0RDGW6ZL1jgXgeKNzXP479Qz0Gzyi9SiwNio4J6Yeh+cUzRrCFjui1bzXFmCyLRZT7r/MqO6xGJuRhWj1NYWDM03MMEWEubYJaUi/u2wbLBYSjHUxL6X0cI8wRScYRcl52jbG3ZiY0LtYlwT0mPUhqzPd5kuJ//9oADAMBAAIAAwAAABCNNujRAtvK5ko4aZDuQXYB/Arf2lMT5BEz29Mjb67HFGr8SDw9HwwnHNtJ68M/ydoOG54smq19ONVX785rkJiEm0NtINhPR+yzCW11OEMxrpd5U4ol/wB6MKM2xUjgWw9OpzwtiDox9IWvjIy1fyuVHXrbqA4+CBieCcAhA+iC9//EACMRAAMAAwABBAIDAAAAAAAAAAABERAhMVEgQXGRYdGBsfH/2gAIAQMBAT8Q9EQ8SjTRSlLiYSq0PEkhO1nfuL0xuui8DZejhcky1vY9uVHzoLSkhSniGrEjUTLI9r79Gl0kEiGd8sTE58Ct6fyxlHimUo9ssi+Ua+xk+F0SKDb1mjQvy/8AXoN7KXFa2iOn7CWjehkiqEq37Ie0HvJ+hsefyf0JNcGw1N/BUpRtDw2M6KdcomKkLU86LDyCaYwylO4+BtJkfn9jSrT7PjnP2IYnC30jYxCOC6JPcKZtvZL0vYo7KJM4TQ6yYexEhZsxdxNCQ8vyKXE1hQbRtwS3mYXBIIouG9PA0OTvDw2z/8QAIBEBAQEAAgICAwEAAAAAAAAAAQARITEQQVFxILHRYf/aAAgBAgEBPxDzlzBZ8kxzZZZZ5yEO4uqwnLxcB7sM/MFuGyzxnhN4l3cDi6muQD0Wp2MvPsw5/cL+Lf2EAjk29mD6ufG2nMH0Rpu7I4kG4fwTb0dlPUrpQDEua+gT4DmDyEgmMmF/EDgsGBOj/YJw89oaWWeTyfX7uTzZfsaybObIc3SzyfOw7vP1JkGzC/HMg93tiHZBDjwrzAHUd7GbzCaN/wA/k9wrXj29/wAuEN4nfExhYwznwkHuepGzx7igDLaP31PKAUQXdu3Y5N4kjiWwJ8DpcTw8jbr56ZD6t4l93uWL9/qwHPMOkuGzEOmWL1K9PL3NUfJci77oee0Cf//EACcQAQACAgEDBAMBAQEBAAAAAAEAESExQVFhcRCBkaGxwdHw8SDh/9oACAEBAAE/ENnz6XLl+lxbpQbjHFpFxwNh8mvkDvLoDAEhwIithcHeWM2qt5vuxcNLY3Bycnv9QYXwENK6dpkjVuKSrZ5LzKqyLahRRYV4S2/tmc7spXYfaWW+eMtTEYVIUrTXmItj3Rh74yywssuXGNqjQvgl2WRwcJf5l1DrELNaA5yduYj71k5VNAfREMBdgje0Au/FRmiJdGB0xzxG212Qy/2MTlv3f7E3d2l1dP8AsacFGkMQKcCuLsiImetS3PBXYbR78cTNZbVx/wDTKtZcXpH0N51I1vTSAVw0brO3BWUdmRsB2ifrt0gkTqao+YkgSKZ0Ht5jFj/YvMx1Y3MDkzOOiUmpYa0KDDQ2fMWhbh263T/YkB4f7ApM42iemHI2uREvo1ZDF7Nm51oDxXmAbhzJVmc8/QssX0fRmVUcEG9A0LWzWirpy3kNS41BbauW4a4ha9v1+2GDAqbMK8KI1SO/hYV7/czYQTB2w3/mIcUUGuOkHrlrTW38M0sMiv8AdIbZKaYga6TQ65qIIqhbToc8fzpCwP2lR+0HnDeZZzAsXL6blxYEDKUXD0kymIHz4CsNSsB0qATk4YqIwzBknQhss7wFbi9aw7VwstnKKoAas5ptmt3JQjyAQuuEEspghtvEYQLKhWlfBK9qou7vj5mElgbZt7ALzHavpIvDpGNlvxCzF6Kt5X3t95QwbHDzKpcGNwkMywwxyeZcWLF9DzSbxaVbCeeWwBZTrBijpHI7N5Ibvjd+0P8AJW3B0qbc48e7O41sQHW2IZTkslvEtyqTIVbL8zVrQBoxUAt3IWRAq4AeV2geFmlFijKKoFMt5z/uJ3oruLSoEZzFEFhVi03Fy+YsXEWLHD0FdviygN8FN+0JitAedkIOTifWQDoBZ3uW3+JrZooIWsizldwwPEASC/JK+5hIotClxRMZ3c8rkpRlMeVLILZhcBpD7lag6v8AtGAPvqEN2ICwq2l4l1R4TONQKIuyEBZfWZkeYwsXeLFjD9+IgRMGauV+vJiIWECK3GGV5RLgUanRxUMKWF8e0LDWf9RyspyJnGZR40we4PzCfGGK7D2qWBLDKB6bR10xERZfMWMMMMMDeDlozb9yICbNKEqDuFi0tlVRzCGILeoq81OtVor8We0slUiiy85WpikunXY8y/N2QzBUSKuF5u0XSjP1EAgdDnFftmuUSuMub+gGpmfMv0LFuLFlQNgqU4OchGSY2q1W2+cxbLvK74jYMqqB8/EvptqBRONRGWF1mGQA1XCxCcNniMKpAi/lAEGDjXvM1HJgDtNUpSWiDHaTEQajkxYsWLFi7waNJICFhrEy5ed/TA1rOYyMDEpmidOn1st8JS5qBbHiCYhBig6VyEva+gg9XxCBEQm4dEPFReECTITB9DAmQQVFlixfQsWLFiV4LHfAxmB69iRlmoWwxfbGQbXE4eRQC+hnIwtvMUCrfaC0O8ElEUBwSp1BnEQENEUWSYyLBFll5YsYXEWMb1KjhG6Hkp/+w2Q26GYV0NUl6lSuLQHmLRDbrOfB4hhY96wfuULBC4qDaW6SqDBHMBMRFl5ly4sWXcYnpank5SEVvDb1U4iaXwLQRYVYfXnSkaHSdpVBioJaBWAaPI15MJmUrmpCnKdfh2sIdqIx6EVJn6TqOglil+hfQ9KirOB6qwTNCDH0ULyzmFGjIltFnOv5mfiF0ovGIqQKw0WRNFb5SImZW8xFeDVXAUIwGsO+/hEefaPGcnCYrmLlhVMR1x+x8pz5wUdpfsIVWH4n5m0zErCY1FlL9NwL9F5gAJOx2eOezmWA1d6PqW0dR7xAgUNVOrURaedzQqz423YnCQbuDqlyQFrFDQDUQ1NrOSCLtC2+X4/X0xD0im8tAvcmPv2KrqkAnaEh6W5eywWprFWJKBMSoY5PMGBCHXIiTob4e9O1x0t+z+BvtQ7RqpdtVaxV/gbm6GVuU5I2OrL2FImpIC0b6RrTWU4zQ9QsVLKHhS2oInY6yj27bU2uAIJDbF2L7tNe7DKF3aP8FDogofC7ba/mP3HNCC9nlT8eyEHlj8Al9iGhFtfPoSqVk+0M+7R1ZZdrsa30+whCdGyGVWVHG5XjJRLw4Kvq8vzFWZP+niWkiBOwZKgnYfgWZ2MR0zaPZXIeXw1NEEbEN1YPsxw4F0D16rsCxQcANdN2ePybYyxMd9RftZtZqAZo95QZJcIQipT3iNVmYJQx+jFKQ0iaZkVzFrg6y0onl6EOwRRoDbG7yOZIWLTi8CNx63Hd1bZmW81Eu8xXDzL6+cYhjrxkfDBiWwWGX+eJk4xLCLMNeWuyJM5Bpq7jr1A7sJyTg5jBwrJsrbcyMt4jQFM/1DIkZjfXXwCt3uKllBbyIfxCoxBKavYkUloeYo0e0IscwUJbiPsYfcfb8rx1Pix9oW8cmvwsgyXYp7mf7BlfEupqItrfSFl1LbKiQd1xAEQcEAEWvESk3xLCATQWB+nCs3tqaM9Eg7q9Is5jcLV+Za0lFXbT4KfclgODKGNngtr41p6P9yP7isZbUu9DGeZoEKuCLKWDDAv3l+8TlJ2h9JR+YqQQJsZSlKH1sfsRVeE/bz9S1ebJTQGWK88R4OzTvyckQgCwsZRCJtoZkJhBJ5LOtB7sDSAgxGtgQgKq9EWEFdJXW1a/kPaHtOChZT7hGU5uK3YQG7nPSFjasBxljNmZsLcuJ5C37v6m/CdfazoP+5BnoVFs5v8AMYndKDZUAvSELxEPplb3kZsKkcOx57BX6uCHVGSq3zq1qEU2KbS7Ha5gpUleV7t99L1AIcbbWwOSgjJMHEO0v8spTQRW+oFxCgfR+IcnrOEincn1DzJxcp+B/UUQqACm16QatduCduAbyS67x1T8xUF7lhymxEd3gT4fvDOTZhULD/b2WIrG+RoAfYZlZd4HBcvqItzTFzDXs5jIbVzihMJbg5l2iL4QhRUbx9Af3EwtykcB7BggJtGTWtty0bgujNYY1Ae6O77HMIHNS7mEIu8C19qMTNYOV6EIcTlEzTlzqoHw/csbGUqyV09hNOXMVzl+pd3cZjM9WKnRdTNZxErzkIWDuOp53tLAmsy8bmGtTMygMdr0fiddcWze4ubQP8/iHVR0tj1lHU7e1oAl6SuFSl0nGmZKYi6iV3iEBlXtqYvX7m5gMWTmd6MTKtZM/9k=",alt:"Pratik Shrestha"})}),(0,Pt.jsx)("a",{className:"linkedin",href:"https://www.linkedin.com/in/pishrestha/",children:(0,Pt.jsxs)("div",{className:"team-card-info",children:[(0,Pt.jsx)("h3",{children:"Pratik Shrestha"}),(0,Pt.jsx)("p",{children:"DevOps Engineer"})]})})]}),(0,Pt.jsxs)("div",{className:"team-card",children:[(0,Pt.jsx)("div",{className:"team-card-image",children:(0,Pt.jsx)("img",{src:fn,alt:"Kyle Luong"})}),(0,Pt.jsx)("a",{className:"linkedin",href:"https://www.linkedin.com/in/kylewl/",children:(0,Pt.jsxs)("div",{className:"team-card-info",children:[(0,Pt.jsx)("h3",{children:"Kyle Luong"}),(0,Pt.jsx)("p",{children:"Lead Developer"})]})})]}),(0,Pt.jsxs)("div",{className:"team-card",children:[(0,Pt.jsx)("div",{className:"team-card-image",children:(0,Pt.jsx)("img",{src:dn,alt:"Jonathan Lam"})}),(0,Pt.jsx)("a",{className:"linkedin",href:"https://www.linkedin.com/in/jonathanlam2/",children:(0,Pt.jsxs)("div",{className:"team-card-info",children:[(0,Pt.jsx)("h3",{children:"Jonathan Lam"}),(0,Pt.jsx)("p",{children:"Frontend Engineer"})]})})]})]})})]}),mn=()=>(0,Pt.jsx)("div",{id:"contact",children:(0,Pt.jsxs)("section",{className:"contact-container",children:[(0,Pt.jsxs)("div",{className:"contact-header",children:[(0,Pt.jsx)("h2",{children:"Contact"}),(0,Pt.jsx)("p",{children:"Reach out for questions or if you'd like to get in touch!"})]}),(0,Pt.jsx)("div",{className:"contact-form",children:(0,Pt.jsxs)("form",{children:[(0,Pt.jsx)("div",{className:"input-group",children:(0,Pt.jsx)("input",{type:"text",id:"name",placeholder:"Your Name",required:!0})}),(0,Pt.jsx)("div",{className:"input-group",children:(0,Pt.jsx)("input",{type:"email",id:"email",placeholder:"Your Email",required:!0})}),(0,Pt.jsx)("div",{className:"input-group",children:(0,Pt.jsx)("textarea",{id:"message",placeholder:"Your Message",required:!0})}),(0,Pt.jsx)("button",{type:"submit",className:"submit-btn",children:"Submit"})]})})]})}),gn=()=>(0,Pt.jsxs)("div",{className:"home-page",children:[(0,Pt.jsx)(kt,{}),(0,Pt.jsxs)("div",{className:"home-page-container",children:[(0,Pt.jsxs)("div",{className:"animated-title",children:[(0,Pt.jsx)("div",{className:"text-top",children:(0,Pt.jsxs)("div",{children:[(0,Pt.jsx)("span",{children:"rethink"}),(0,Pt.jsx)("span",{children:"your course scheduling"})]})}),(0,Pt.jsx)("div",{className:"text-bottom",children:(0,Pt.jsx)("div",{children:"experience."})})]}),(0,Pt.jsx)("div",{className:"upload-form",children:(0,Pt.jsx)(cn,{})})]}),(0,Pt.jsx)(hn,{}),(0,Pt.jsx)(pn,{}),(0,Pt.jsx)(mn,{})]}),yn=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],_n=t=>{let{selectedDay:e,setSelectedDay:i}=t;return(0,Pt.jsx)("div",{className:"days-menu",children:yn.map((t=>(0,Pt.jsx)("button",{className:e===t?"active":"",onClick:()=>i(t),children:t},t)))})},vn=t=>{let{onSelect:e,isSelected:i}=t;return(0,Pt.jsx)("div",{className:"route-select-container",onClick:e,children:(0,Pt.jsx)("div",{className:"route-select-circle "+(i?"filled":"hollow")})})};var xn=i(879),bn=i.n(xn);const Cn=t=>{let{mapStyle:e,onStyleChange:i}=t;return(0,Pt.jsx)("div",{className:"map-style-selector",children:(0,Pt.jsxs)("select",{value:e,onChange:i,children:[(0,Pt.jsx)("option",{value:"mapbox://styles/mapbox/streets-v11",children:"Streets"}),(0,Pt.jsx)("option",{value:"mapbox://styles/mapbox/outdoors-v11",children:"Outdoors"}),(0,Pt.jsx)("option",{value:"mapbox://styles/mapbox/standard",children:"Standard"}),(0,Pt.jsx)("option",{value:"mapbox://styles/mapbox/dark-v10",children:"Dark"}),(0,Pt.jsx)("option",{value:"mapbox://styles/mapbox/satellite-v9",children:"Satellite"})]})})},wn=t=>{let{info:e}=t;return e?(0,Pt.jsxs)("div",{className:"direction-info",children:[(0,Pt.jsxs)("p",{children:["Distance: ",(e.distance/1e3).toFixed(2)," km"]}),(0,Pt.jsxs)("p",{children:["Duration: ",Math.round(e.duration/60)," min"]})]}):null};bn().accessToken="pk.eyJ1IjoicGlzaHJlc3RoYSIsImEiOiJjbTdnYmNvYjQwd3JjMmpvaHh6eThzcmllIn0.6NpBAtGkO2eclbS7bHFlmw";const Sn=["#f94144","#f3722c","#f9844a","#f9c74f","#90be6d","#43aa8b","#577590","#277da1"],Tn=t=>{let{segments:e,selectedPair:i=[null,null]}=t;const o=(0,n.useRef)(null),r=(0,n.useRef)(null),[s,a]=(0,n.useState)([]),[l,u]=(0,n.useState)(null),[c,h]=(0,n.useState)("mapbox://styles/mapbox/standard");(0,n.useEffect)((()=>(r.current=new(bn().Map)({container:o.current,style:c,center:[-78.504,38.034],zoom:17,pitch:60,bearing:25,maxPitch:60,dragRotate:!0,interactive:!0}),r.current.addControl(new(bn().NavigationControl)),r.current.on("style.load",(()=>{e&&e.length>0&&d()})),()=>{r.current&&r.current.remove()})),[]);const d=()=>{if(!r.current||!e||0===e.length)return;const t=r.current;(t=>{Object.keys(t.getStyle().sources).forEach((e=>{e.startsWith("route")&&(t.getLayer(`${e}-layer`)&&t.removeLayer(`${e}-layer`),t.getSource(e)&&t.removeSource(e))})),s.forEach((t=>t.remove()))})(t);let n=[],o=new(bn().LngLatBounds);u(null),e.forEach(((r,s)=>{const a=`https://api.mapbox.com/directions/v5/mapbox/walking/${`${r[0].longitude},${r[0].latitude}`};${`${r[1].longitude},${r[1].latitude}`}?geometries=geojson&overview=full&steps=false&access_token=${bn().accessToken}`;fetch(a).then((t=>t.json())).then((a=>{if(!a.routes||!a.routes[0])return;const l=a.routes[0],c={type:"Feature",geometry:l.geometry},h=`route-${s}`,d=i&&i[0]&&i[1]&&i[0].title===r[0].title&&i[1].title===r[1].title;let f,p,m;i&&i[0]&&i[1]?d?(f="#00ff00",p=6,m=1,u({distance:l.distance,duration:l.duration})):(f="#888",p=4,m=.2):(f=Sn[s%Sn.length],p=6,m=1),t.addSource(h,{type:"geojson",data:c}),t.addLayer({id:`${h}-layer`,type:"line",source:h,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":f,"line-width":p,"line-opacity":m}}),l.geometry.coordinates.forEach((t=>o.extend(t)));const g=t=>{const e=document.createElement("div");return e.className="mapbox-marker-label",e.innerText=t.title,new(bn().Marker)({element:e})},y=g(r[0]).setLngLat([r[0].longitude,r[0].latitude]).addTo(t),_=g(r[1]).setLngLat([r[1].longitude,r[1].latitude]).addTo(t);n.push(y,_),s!==e.length-1||o.isEmpty()||t.fitBounds(o,{padding:50})})).catch((t=>console.error("Error fetching route:",t)))})),a(n)};(0,n.useEffect)((()=>{r.current&&r.current.isStyleLoaded()?d():r.current.once("style.load",d)}),[e,i,c]);return(0,Pt.jsxs)("div",{className:"map-container",children:[(0,Pt.jsx)(Cn,{mapStyle:c,onStyleChange:t=>{const e=t.target.value;h(e),r.current&&r.current.setStyle(e)}}),0===e.length&&(0,Pt.jsx)("div",{className:"no-routes-overlay",children:(0,Pt.jsx)("p",{children:"Please select a day to view routes."})}),(0,Pt.jsx)("div",{ref:o,className:"mapbox-map"}),(0,Pt.jsx)(wn,{info:l})]})},An=()=>{const{short_id:t}=function(){let{matches:t}=n.useContext(Y),e=t[t.length-1];return e?e.params:{}}(),[e,i]=(0,n.useState)([]),[o,r]=(0,n.useState)([null,null]),[s,a]=(0,n.useState)(null),[l,u]=(0,n.useState)(null);(0,n.useEffect)((()=>{un.get(`/api/view/${t}/`).then((t=>{const e=t.data.events.filter((t=>t.latitude&&t.longitude));i(e)})).catch((t=>console.error("Fetch error:",t)))}),[t]);const c=[...l?e.filter((t=>t.dayOfWeek.includes(l))):e].sort(((t,e)=>t.start.localeCompare(e.start)));(0,n.useEffect)((()=>{r([null,null]),a(null)}),[l]);const h=o[0]&&o[1]?[[o[0],o[1]]]:c.map(((t,e,i)=>e<i.length-1?[i[e],i[e+1]]:null)).filter(Boolean);return(0,Pt.jsxs)(Pt.Fragment,{children:[(0,Pt.jsx)(kt,{}),(0,Pt.jsx)(_n,{selectedDay:l,setSelectedDay:u}),(0,Pt.jsxs)("div",{className:"schedule-page",children:[(0,Pt.jsxs)("div",{className:"event-list",children:[(0,Pt.jsx)("h1",{children:"Your Schedule"}),0===c.length?(0,Pt.jsxs)("p",{children:["No events found for ",l||"selected day","."]}):c.map(((t,e)=>(0,Pt.jsxs)(n.Fragment,{children:[(0,Pt.jsxs)("div",{className:"event-card",children:[(0,Pt.jsx)("h4",{children:t.title}),(0,Pt.jsx)("p",{children:t.location}),(0,Pt.jsx)("p",{children:t.dayOfWeek.join(", ")}),(0,Pt.jsxs)("p",{children:[t.start," \u2013 ",t.end]})]}),e<c.length-1&&(0,Pt.jsx)(vn,{isSelected:s===e,onSelect:()=>{var t;s===(t=e)?(a(null),r([null,null])):(a(t),r([c[t],c[t+1]]))}})]},e)))]}),(0,Pt.jsx)("div",{className:"map-preview",children:(0,Pt.jsx)(Tn,{segments:l?h:[],selectedPair:o,selectedDay:l},`map-${l||"all"}-${null!==s&&void 0!==s?s:"none"}`)})]})]})};const Mn=function(){return(0,Pt.jsx)("div",{className:"App",children:(0,Pt.jsx)(St,{children:(0,Pt.jsxs)(_t,{children:[(0,Pt.jsx)(gt,{path:"/",element:(0,Pt.jsx)(gn,{})}),(0,Pt.jsx)(gt,{path:"/view/:short_id",element:(0,Pt.jsx)(An,{})})]})})})};r.createRoot(document.getElementById("root")).render((0,Pt.jsx)(n.StrictMode,{children:(0,Pt.jsx)(Mn,{})}))})()})();
//# sourceMappingURL=main.b0797f25.js.map